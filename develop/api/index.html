
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://wsp-sag.github.io/network_wrangler/develop/api/">
      
      
        <link rel="prev" href="..">
      
      
        <link rel="next" href="../design/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.1.8">
    
    
      
        <title>API Documentation - Network Wrangler</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.ded33207.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.a0c5b2b5.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.13.0/css/all.css">
    
      <link rel="stylesheet" href="../css/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="grey">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#api-documentation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Network Wrangler" class="md-header__button md-logo" aria-label="Network Wrangler" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Network Wrangler
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              API Documentation
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
          
            
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="grey"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
            
              <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
              </label>
            
          
            
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="grey"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
            
              <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
              </label>
            
          
        </form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/wsp-sag/network_wrangler" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href=".." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  
    
  


  <li class="md-tabs__item">
    <a href="./" class="md-tabs__link md-tabs__link--active">
      API Documentation
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../design/" class="md-tabs__link">
      Design
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../development/" class="md-tabs__link">
      Development
    </a>
  </li>

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
                
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" hidden>
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Network Wrangler" class="md-nav__button md-logo" aria-label="Network Wrangler" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Network Wrangler
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/wsp-sag/network_wrangler" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          API Documentation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        API Documentation
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#base-classes" class="md-nav__link">
    Base Classes
  </a>
  
    <nav class="md-nav" aria-label="Base Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#network_wrangler.ProjectCard" class="md-nav__link">
    ProjectCard
  </a>
  
    <nav class="md-nav" aria-label="ProjectCard">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#network_wrangler.projectcard.ProjectCard.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.projectcard.ProjectCard.build_selection_query" class="md-nav__link">
    build_selection_query()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.projectcard.ProjectCard.has_any_tags" class="md-nav__link">
    has_any_tags()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.projectcard.ProjectCard.read" class="md-nav__link">
    read()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.projectcard.ProjectCard.read_wrangler_card" class="md-nav__link">
    read_wrangler_card()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.projectcard.ProjectCard.read_yml" class="md-nav__link">
    read_yml()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.projectcard.ProjectCard.validate_project_card_schema" class="md-nav__link">
    validate_project_card_schema()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.projectcard.ProjectCard.write" class="md-nav__link">
    write()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.Scenario" class="md-nav__link">
    Scenario
  </a>
  
    <nav class="md-nav" aria-label="Scenario">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#network_wrangler.scenario.Scenario.queued_projects" class="md-nav__link">
    queued_projects
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.scenario.Scenario.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.scenario.Scenario.add_project_cards" class="md-nav__link">
    add_project_cards()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.scenario.Scenario.add_projects_from_directory" class="md-nav__link">
    add_projects_from_directory()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.scenario.Scenario.add_projects_from_files" class="md-nav__link">
    add_projects_from_files()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.scenario.Scenario.apply_all_projects" class="md-nav__link">
    apply_all_projects()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.scenario.Scenario.apply_projects" class="md-nav__link">
    apply_projects()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.scenario.Scenario.create_scenario" class="md-nav__link">
    create_scenario()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.scenario.Scenario.order_projects" class="md-nav__link">
    order_projects()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.scenario.Scenario.summarize" class="md-nav__link">
    summarize()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.scenario.Scenario.write" class="md-nav__link">
    write()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.RoadwayNetwork" class="md-nav__link">
    RoadwayNetwork
  </a>
  
    <nav class="md-nav" aria-label="RoadwayNetwork">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.add_incident_link_data_to_nodes" class="md-nav__link">
    add_incident_link_data_to_nodes()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.add_new_roadway_feature_change" class="md-nav__link">
    add_new_roadway_feature_change()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.addition_map" class="md-nav__link">
    addition_map()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.apply" class="md-nav__link">
    apply()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.apply_managed_lane_feature_change" class="md-nav__link">
    apply_managed_lane_feature_change()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.apply_python_calculation" class="md-nav__link">
    apply_python_calculation()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.apply_roadway_feature_change" class="md-nav__link">
    apply_roadway_feature_change()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.assess_connectivity" class="md-nav__link">
    assess_connectivity()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.build_selection_key" class="md-nav__link">
    build_selection_key()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.coerce_types" class="md-nav__link">
    coerce_types()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.delete_links" class="md-nav__link">
    delete_links()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.delete_nodes" class="md-nav__link">
    delete_nodes()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.delete_roadway_feature_change" class="md-nav__link">
    delete_roadway_feature_change()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.deletion_map" class="md-nav__link">
    deletion_map()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.get_modal_graph" class="md-nav__link">
    get_modal_graph()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.get_modal_links_nodes" class="md-nav__link">
    get_modal_links_nodes()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.get_property_by_time_period_and_group" class="md-nav__link">
    get_property_by_time_period_and_group()
  </a>
  
    <nav class="md-nav" aria-label="get_property_by_time_period_and_group()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.get_property_by_time_period_and_group--args" class="md-nav__link">
    args
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.get_property_by_time_period_and_group--returns" class="md-nav__link">
    returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.has_link" class="md-nav__link">
    has_link()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.has_node" class="md-nav__link">
    has_node()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.identify_segment" class="md-nav__link">
    identify_segment()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.identify_segment_endpoints" class="md-nav__link">
    identify_segment_endpoints()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.is_network_connected" class="md-nav__link">
    is_network_connected()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.links_with_nodes" class="md-nav__link">
    links_with_nodes()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.network_connection_plot" class="md-nav__link">
    network_connection_plot()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.new_links_valid" class="md-nav__link">
    new_links_valid()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.nodes_in_links" class="md-nav__link">
    nodes_in_links()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.orig_dest_nodes_foreign_key" class="md-nav__link">
    orig_dest_nodes_foreign_key()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.ox_graph" class="md-nav__link">
    ox_graph()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.path_search" class="md-nav__link">
    path_search()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.read" class="md-nav__link">
    read()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.read_links" class="md-nav__link">
    read_links()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.read_nodes" class="md-nav__link">
    read_nodes()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.read_shapes" class="md-nav__link">
    read_shapes()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.roadway_net_to_gdf" class="md-nav__link">
    roadway_net_to_gdf()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.select_node_features" class="md-nav__link">
    select_node_features()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.select_roadway_features" class="md-nav__link">
    select_roadway_features()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.select_roadway_link_features" class="md-nav__link">
    select_roadway_link_features()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.selection_has_unique_link_id" class="md-nav__link">
    selection_has_unique_link_id()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.selection_map" class="md-nav__link">
    selection_map()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.shortest_path" class="md-nav__link">
    shortest_path()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.update_node_geometry" class="md-nav__link">
    update_node_geometry()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.validate_link_schema" class="md-nav__link">
    validate_link_schema()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.validate_node_schema" class="md-nav__link">
    validate_node_schema()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.validate_object_types" class="md-nav__link">
    validate_object_types()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.validate_properties" class="md-nav__link">
    validate_properties()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.validate_selection" class="md-nav__link">
    validate_selection()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.validate_shape_schema" class="md-nav__link">
    validate_shape_schema()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.validate_uniqueness" class="md-nav__link">
    validate_uniqueness()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.write" class="md-nav__link">
    write()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.TransitNetwork" class="md-nav__link">
    TransitNetwork
  </a>
  
    <nav class="md-nav" aria-label="TransitNetwork">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#network_wrangler.transitnetwork.TransitNetwork.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.transitnetwork.TransitNetwork.apply" class="md-nav__link">
    apply()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.transitnetwork.TransitNetwork.apply_python_calculation" class="md-nav__link">
    apply_python_calculation()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.transitnetwork.TransitNetwork.apply_transit_feature_change" class="md-nav__link">
    apply_transit_feature_change()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.transitnetwork.TransitNetwork.empty" class="md-nav__link">
    empty()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.transitnetwork.TransitNetwork.read" class="md-nav__link">
    read()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.transitnetwork.TransitNetwork.route_ids_in_routestxt" class="md-nav__link">
    route_ids_in_routestxt()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.transitnetwork.TransitNetwork.select_transit_features" class="md-nav__link">
    select_transit_features()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.transitnetwork.TransitNetwork.select_transit_features_by_nodes" class="md-nav__link">
    select_transit_features_by_nodes()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.transitnetwork.TransitNetwork.shape_ids_in_shapestxt" class="md-nav__link">
    shape_ids_in_shapestxt()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.transitnetwork.TransitNetwork.stop_ids_in_stopstxt" class="md-nav__link">
    stop_ids_in_stopstxt()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.transitnetwork.TransitNetwork.transit_net_to_gdf" class="md-nav__link">
    transit_net_to_gdf()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.transitnetwork.TransitNetwork.trip_ids_in_tripstxt" class="md-nav__link">
    trip_ids_in_tripstxt()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.transitnetwork.TransitNetwork.validate_feed" class="md-nav__link">
    validate_feed()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.transitnetwork.TransitNetwork.validate_frequencies" class="md-nav__link">
    validate_frequencies()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.transitnetwork.TransitNetwork.validate_network_keys" class="md-nav__link">
    validate_network_keys()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.transitnetwork.TransitNetwork.validate_road_network_consistencies" class="md-nav__link">
    validate_road_network_consistencies()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.transitnetwork.TransitNetwork.validate_transit_shapes" class="md-nav__link">
    validate_transit_shapes()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.transitnetwork.TransitNetwork.validate_transit_stops" class="md-nav__link">
    validate_transit_stops()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.transitnetwork.TransitNetwork.write" class="md-nav__link">
    write()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utils-and-functions" class="md-nav__link">
    Utils and Functions
  </a>
  
    <nav class="md-nav" aria-label="Utils and Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#network_wrangler.utils" class="md-nav__link">
    utils
  </a>
  
    <nav class="md-nav" aria-label="utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#network_wrangler.utils.create_unique_shape_id" class="md-nav__link">
    create_unique_shape_id()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.utils.haversine_distance" class="md-nav__link">
    haversine_distance()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.utils.line_string_from_location_references" class="md-nav__link">
    line_string_from_location_references()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.utils.links_df_to_json" class="md-nav__link">
    links_df_to_json()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.utils.location_reference_from_nodes" class="md-nav__link">
    location_reference_from_nodes()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.utils.make_slug" class="md-nav__link">
    make_slug()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.utils.offset_location_reference" class="md-nav__link">
    offset_location_reference()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.utils.parse_time_spans_to_secs" class="md-nav__link">
    parse_time_spans_to_secs()
  </a>
  
    <nav class="md-nav" aria-label="parse_time_spans_to_secs()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#network_wrangler.utils.parse_time_spans_to_secs--returns" class="md-nav__link">
    returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.utils.point_df_to_geojson" class="md-nav__link">
    point_df_to_geojson()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.utils.point_from_xy" class="md-nav__link">
    point_from_xy()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.utils.topological_sort" class="md-nav__link">
    topological_sort()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.utils.update_points_in_linestring" class="md-nav__link">
    update_points_in_linestring()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.logger" class="md-nav__link">
    logger
  </a>
  
    <nav class="md-nav" aria-label="logger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#network_wrangler.logger.setup_logging" class="md-nav__link">
    setup_logging()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#schemas" class="md-nav__link">
    Schemas
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../design/" class="md-nav__link">
        Design
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../development/" class="md-nav__link">
        Development
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
                
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#base-classes" class="md-nav__link">
    Base Classes
  </a>
  
    <nav class="md-nav" aria-label="Base Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#network_wrangler.ProjectCard" class="md-nav__link">
    ProjectCard
  </a>
  
    <nav class="md-nav" aria-label="ProjectCard">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#network_wrangler.projectcard.ProjectCard.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.projectcard.ProjectCard.build_selection_query" class="md-nav__link">
    build_selection_query()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.projectcard.ProjectCard.has_any_tags" class="md-nav__link">
    has_any_tags()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.projectcard.ProjectCard.read" class="md-nav__link">
    read()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.projectcard.ProjectCard.read_wrangler_card" class="md-nav__link">
    read_wrangler_card()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.projectcard.ProjectCard.read_yml" class="md-nav__link">
    read_yml()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.projectcard.ProjectCard.validate_project_card_schema" class="md-nav__link">
    validate_project_card_schema()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.projectcard.ProjectCard.write" class="md-nav__link">
    write()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.Scenario" class="md-nav__link">
    Scenario
  </a>
  
    <nav class="md-nav" aria-label="Scenario">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#network_wrangler.scenario.Scenario.queued_projects" class="md-nav__link">
    queued_projects
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.scenario.Scenario.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.scenario.Scenario.add_project_cards" class="md-nav__link">
    add_project_cards()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.scenario.Scenario.add_projects_from_directory" class="md-nav__link">
    add_projects_from_directory()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.scenario.Scenario.add_projects_from_files" class="md-nav__link">
    add_projects_from_files()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.scenario.Scenario.apply_all_projects" class="md-nav__link">
    apply_all_projects()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.scenario.Scenario.apply_projects" class="md-nav__link">
    apply_projects()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.scenario.Scenario.create_scenario" class="md-nav__link">
    create_scenario()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.scenario.Scenario.order_projects" class="md-nav__link">
    order_projects()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.scenario.Scenario.summarize" class="md-nav__link">
    summarize()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.scenario.Scenario.write" class="md-nav__link">
    write()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.RoadwayNetwork" class="md-nav__link">
    RoadwayNetwork
  </a>
  
    <nav class="md-nav" aria-label="RoadwayNetwork">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.add_incident_link_data_to_nodes" class="md-nav__link">
    add_incident_link_data_to_nodes()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.add_new_roadway_feature_change" class="md-nav__link">
    add_new_roadway_feature_change()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.addition_map" class="md-nav__link">
    addition_map()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.apply" class="md-nav__link">
    apply()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.apply_managed_lane_feature_change" class="md-nav__link">
    apply_managed_lane_feature_change()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.apply_python_calculation" class="md-nav__link">
    apply_python_calculation()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.apply_roadway_feature_change" class="md-nav__link">
    apply_roadway_feature_change()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.assess_connectivity" class="md-nav__link">
    assess_connectivity()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.build_selection_key" class="md-nav__link">
    build_selection_key()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.coerce_types" class="md-nav__link">
    coerce_types()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.delete_links" class="md-nav__link">
    delete_links()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.delete_nodes" class="md-nav__link">
    delete_nodes()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.delete_roadway_feature_change" class="md-nav__link">
    delete_roadway_feature_change()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.deletion_map" class="md-nav__link">
    deletion_map()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.get_modal_graph" class="md-nav__link">
    get_modal_graph()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.get_modal_links_nodes" class="md-nav__link">
    get_modal_links_nodes()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.get_property_by_time_period_and_group" class="md-nav__link">
    get_property_by_time_period_and_group()
  </a>
  
    <nav class="md-nav" aria-label="get_property_by_time_period_and_group()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.get_property_by_time_period_and_group--args" class="md-nav__link">
    args
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.get_property_by_time_period_and_group--returns" class="md-nav__link">
    returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.has_link" class="md-nav__link">
    has_link()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.has_node" class="md-nav__link">
    has_node()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.identify_segment" class="md-nav__link">
    identify_segment()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.identify_segment_endpoints" class="md-nav__link">
    identify_segment_endpoints()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.is_network_connected" class="md-nav__link">
    is_network_connected()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.links_with_nodes" class="md-nav__link">
    links_with_nodes()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.network_connection_plot" class="md-nav__link">
    network_connection_plot()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.new_links_valid" class="md-nav__link">
    new_links_valid()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.nodes_in_links" class="md-nav__link">
    nodes_in_links()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.orig_dest_nodes_foreign_key" class="md-nav__link">
    orig_dest_nodes_foreign_key()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.ox_graph" class="md-nav__link">
    ox_graph()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.path_search" class="md-nav__link">
    path_search()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.read" class="md-nav__link">
    read()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.read_links" class="md-nav__link">
    read_links()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.read_nodes" class="md-nav__link">
    read_nodes()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.read_shapes" class="md-nav__link">
    read_shapes()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.roadway_net_to_gdf" class="md-nav__link">
    roadway_net_to_gdf()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.select_node_features" class="md-nav__link">
    select_node_features()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.select_roadway_features" class="md-nav__link">
    select_roadway_features()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.select_roadway_link_features" class="md-nav__link">
    select_roadway_link_features()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.selection_has_unique_link_id" class="md-nav__link">
    selection_has_unique_link_id()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.selection_map" class="md-nav__link">
    selection_map()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.shortest_path" class="md-nav__link">
    shortest_path()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.update_node_geometry" class="md-nav__link">
    update_node_geometry()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.validate_link_schema" class="md-nav__link">
    validate_link_schema()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.validate_node_schema" class="md-nav__link">
    validate_node_schema()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.validate_object_types" class="md-nav__link">
    validate_object_types()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.validate_properties" class="md-nav__link">
    validate_properties()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.validate_selection" class="md-nav__link">
    validate_selection()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.validate_shape_schema" class="md-nav__link">
    validate_shape_schema()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.validate_uniqueness" class="md-nav__link">
    validate_uniqueness()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.write" class="md-nav__link">
    write()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.TransitNetwork" class="md-nav__link">
    TransitNetwork
  </a>
  
    <nav class="md-nav" aria-label="TransitNetwork">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#network_wrangler.transitnetwork.TransitNetwork.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.transitnetwork.TransitNetwork.apply" class="md-nav__link">
    apply()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.transitnetwork.TransitNetwork.apply_python_calculation" class="md-nav__link">
    apply_python_calculation()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.transitnetwork.TransitNetwork.apply_transit_feature_change" class="md-nav__link">
    apply_transit_feature_change()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.transitnetwork.TransitNetwork.empty" class="md-nav__link">
    empty()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.transitnetwork.TransitNetwork.read" class="md-nav__link">
    read()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.transitnetwork.TransitNetwork.route_ids_in_routestxt" class="md-nav__link">
    route_ids_in_routestxt()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.transitnetwork.TransitNetwork.select_transit_features" class="md-nav__link">
    select_transit_features()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.transitnetwork.TransitNetwork.select_transit_features_by_nodes" class="md-nav__link">
    select_transit_features_by_nodes()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.transitnetwork.TransitNetwork.shape_ids_in_shapestxt" class="md-nav__link">
    shape_ids_in_shapestxt()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.transitnetwork.TransitNetwork.stop_ids_in_stopstxt" class="md-nav__link">
    stop_ids_in_stopstxt()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.transitnetwork.TransitNetwork.transit_net_to_gdf" class="md-nav__link">
    transit_net_to_gdf()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.transitnetwork.TransitNetwork.trip_ids_in_tripstxt" class="md-nav__link">
    trip_ids_in_tripstxt()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.transitnetwork.TransitNetwork.validate_feed" class="md-nav__link">
    validate_feed()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.transitnetwork.TransitNetwork.validate_frequencies" class="md-nav__link">
    validate_frequencies()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.transitnetwork.TransitNetwork.validate_network_keys" class="md-nav__link">
    validate_network_keys()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.transitnetwork.TransitNetwork.validate_road_network_consistencies" class="md-nav__link">
    validate_road_network_consistencies()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.transitnetwork.TransitNetwork.validate_transit_shapes" class="md-nav__link">
    validate_transit_shapes()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.transitnetwork.TransitNetwork.validate_transit_stops" class="md-nav__link">
    validate_transit_stops()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.transitnetwork.TransitNetwork.write" class="md-nav__link">
    write()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utils-and-functions" class="md-nav__link">
    Utils and Functions
  </a>
  
    <nav class="md-nav" aria-label="Utils and Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#network_wrangler.utils" class="md-nav__link">
    utils
  </a>
  
    <nav class="md-nav" aria-label="utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#network_wrangler.utils.create_unique_shape_id" class="md-nav__link">
    create_unique_shape_id()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.utils.haversine_distance" class="md-nav__link">
    haversine_distance()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.utils.line_string_from_location_references" class="md-nav__link">
    line_string_from_location_references()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.utils.links_df_to_json" class="md-nav__link">
    links_df_to_json()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.utils.location_reference_from_nodes" class="md-nav__link">
    location_reference_from_nodes()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.utils.make_slug" class="md-nav__link">
    make_slug()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.utils.offset_location_reference" class="md-nav__link">
    offset_location_reference()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.utils.parse_time_spans_to_secs" class="md-nav__link">
    parse_time_spans_to_secs()
  </a>
  
    <nav class="md-nav" aria-label="parse_time_spans_to_secs()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#network_wrangler.utils.parse_time_spans_to_secs--returns" class="md-nav__link">
    returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.utils.point_df_to_geojson" class="md-nav__link">
    point_df_to_geojson()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.utils.point_from_xy" class="md-nav__link">
    point_from_xy()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.utils.topological_sort" class="md-nav__link">
    topological_sort()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.utils.update_points_in_linestring" class="md-nav__link">
    update_points_in_linestring()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network_wrangler.logger" class="md-nav__link">
    logger
  </a>
  
    <nav class="md-nav" aria-label="logger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#network_wrangler.logger.setup_logging" class="md-nav__link">
    setup_logging()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#schemas" class="md-nav__link">
    Schemas
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="api-documentation">API Documentation<a class="headerlink" href="#api-documentation" title="Permanent link"> ¶</a></h1>
<h2 id="base-classes">Base Classes<a class="headerlink" href="#base-classes" title="Permanent link"> ¶</a></h2>


<div class="doc doc-object doc-class">



<h3 id="network_wrangler.ProjectCard" class="doc doc-heading">
        <code>network_wrangler.ProjectCard</code>


<a href="#network_wrangler.ProjectCard" class="headerlink" title="Permanent link"> ¶</a></h3>


  <div class="doc doc-contents first">
      <p class="doc doc-class-bases">
        Bases: <code>object</code></p>

  
      <p>Representation of a Project Card</p>

  <p><strong>Attributes:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>__dict__</code></td>
          <td>
          </td>
          <td><p>Dictionary of project card attributes</p></td>
        </tr>
        <tr>
          <td><code>valid</code></td>
          <td>
          </td>
          <td><p>Boolean indicating if data conforms to project card data schema</p></td>
        </tr>
    </tbody>
  </table>


        <details class="quote">
          <summary>Source code in <code>network_wrangler/projectcard.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ProjectCard</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Representation of a Project Card</span>

<span class="sd">    Attributes:</span>
<span class="sd">        __dict__: Dictionary of project card attributes</span>
<span class="sd">        valid: Boolean indicating if data conforms to project card data schema</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">FILE_TYPES</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;wr&quot;</span><span class="p">,</span> <span class="s2">&quot;wrangler&quot;</span><span class="p">,</span> <span class="s2">&quot;yml&quot;</span><span class="p">,</span> <span class="s2">&quot;yaml&quot;</span><span class="p">]</span>

    <span class="n">TRANSIT_CATEGORIES</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Transit Service Property Change&quot;</span><span class="p">,</span> <span class="s2">&quot;Add Transit&quot;</span><span class="p">]</span>

    <span class="c1"># categories that may affect transit, but only as a secondary</span>
    <span class="c1"># effect of changing roadways</span>
    <span class="n">SECONDARY_TRANSIT_CATEGORIES</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Roadway Deletion&quot;</span><span class="p">,</span> <span class="s2">&quot;Parallel Managed Lanes&quot;</span><span class="p">]</span>

    <span class="n">ROADWAY_CATEGORIES</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;Roadway Property Change&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Roadway Deletion&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Parallel Managed lanes&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Add New Roadway&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Calculated Roadway&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">UNSPECIFIED_PROJECT_NAMES</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;TO DO User Define&quot;</span><span class="p">,</span> <span class="s2">&quot;USER TO define&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attribute_dictonary</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor</span>

<span class="sd">        args:</span>
<span class="sd">        attribute_dictonary: a nested dictionary of attributes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># add these first so they are first on write out</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tags</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dependencies</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">attribute_dictonary</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># todo more unstructuring of project card yaml</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">path_to_card</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">validate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads and validates a Project card</span>

<span class="sd">        args:</span>
<span class="sd">        path_to_card: the path to the project card</span>

<span class="sd">        Returns a Project Card object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">card_suffix</span> <span class="o">=</span> <span class="n">path_to_card</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">card_suffix</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;yaml&quot;</span><span class="p">,</span> <span class="s2">&quot;yml&quot;</span><span class="p">]:</span>
            <span class="n">attribute_dictionary</span> <span class="o">=</span> <span class="n">ProjectCard</span><span class="o">.</span><span class="n">read_yml</span><span class="p">(</span><span class="n">path_to_card</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">card_suffix</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;wrangler&quot;</span><span class="p">,</span> <span class="s2">&quot;wr&quot;</span><span class="p">]:</span>
            <span class="n">attribute_dictionary</span> <span class="o">=</span> <span class="n">ProjectCard</span><span class="o">.</span><span class="n">read_wrangler_card</span><span class="p">(</span><span class="n">path_to_card</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Card should have a suffix of yaml, yml, wrangler, or wr. </span><span class="se">\</span>
<span class="s2">                Found suffix: </span><span class="si">{</span><span class="n">card_suffix</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">card</span> <span class="o">=</span> <span class="n">ProjectCard</span><span class="p">(</span><span class="n">attribute_dictionary</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">card</span><span class="o">.</span><span class="n">project</span> <span class="ow">in</span> <span class="n">ProjectCard</span><span class="o">.</span><span class="n">UNSPECIFIED_PROJECT_NAMES</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Card must have valid project name: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path_to_card</span><span class="p">)</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">card</span><span class="o">.</span><span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">validate</span><span class="p">:</span>
            <span class="n">card</span><span class="o">.</span><span class="n">valid</span> <span class="o">=</span> <span class="n">ProjectCard</span><span class="o">.</span><span class="n">validate_project_card_schema</span><span class="p">(</span><span class="n">path_to_card</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">card</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">read_wrangler_card</span><span class="p">(</span><span class="n">path_to_card</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads wrangler project cards with YAML front matter and then python code.</span>

<span class="sd">        Args:</span>
<span class="sd">            path_to_card: where the project card is</span>

<span class="sd">        Returns: Attribute Dictionary for Project Card</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reading Wrangler-Style Project Card </span><span class="si">{</span><span class="n">path_to_card</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path_to_card</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">cardfile</span><span class="p">:</span>
            <span class="n">delim</span> <span class="o">=</span> <span class="n">cardfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Using delimiter: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">delim</span><span class="p">))</span>
            <span class="n">_yaml</span><span class="p">,</span> <span class="n">_pycode</span> <span class="o">=</span> <span class="n">cardfile</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">delim</span><span class="p">)</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;_yaml: </span><span class="si">{}</span><span class="se">\n</span><span class="s2">_pycode: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_yaml</span><span class="p">,</span> <span class="n">_pycode</span><span class="p">))</span>

        <span class="n">attribute_dictionary</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">_yaml</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="n">attribute_dictionary</span><span class="p">[</span><span class="s2">&quot;file&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">path_to_card</span>
        <span class="n">attribute_dictionary</span><span class="p">[</span><span class="s2">&quot;pycode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_pycode</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">attribute_dictionary</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">read_yml</span><span class="p">(</span><span class="n">path_to_card</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads &quot;normal&quot; wrangler project cards defined in YAML.</span>

<span class="sd">        Args:</span>
<span class="sd">            path_to_card: where the project card is</span>

<span class="sd">        Returns: Attribute Dictionary for Project Card</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reading YAML-Style Project Card </span><span class="si">{</span><span class="n">path_to_card</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path_to_card</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">cardfile</span><span class="p">:</span>
            <span class="n">attribute_dictionary</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">cardfile</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
            <span class="n">attribute_dictionary</span><span class="p">[</span><span class="s2">&quot;file&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">path_to_card</span>

        <span class="k">return</span> <span class="n">attribute_dictionary</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes project card dictionary to YAML file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">network_wrangler.utils.geo</span> <span class="kn">import</span> <span class="n">make_slug</span>

            <span class="n">filename</span> <span class="o">=</span> <span class="n">make_slug</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.yml&quot;</span>

        <span class="c1"># import collections</span>
        <span class="c1"># out_dict = collections.OrderedDict()</span>
        <span class="n">out_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">out_dict</span><span class="p">[</span><span class="s2">&quot;project&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">out_dict</span><span class="p">[</span><span class="s2">&quot;tags&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">out_dict</span><span class="p">[</span><span class="s2">&quot;dependencies&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">out_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
            <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">out_dict</span><span class="p">,</span> <span class="n">outfile</span><span class="p">,</span> <span class="n">default_flow_style</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Wrote project card to: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">validate_project_card_schema</span><span class="p">(</span>
        <span class="n">card_file</span><span class="p">,</span> <span class="n">card_schema_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;project_card.json&quot;</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests project card schema validity by evaluating if it conforms to the schemas</span>
<span class="sd">        returns: boolean</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">card_schema_file</span><span class="p">):</span>
            <span class="n">base_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span> <span class="s2">&quot;schemas&quot;</span>
            <span class="p">)</span>
            <span class="n">card_schema_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_path</span><span class="p">,</span> <span class="n">card_schema_file</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">card_schema_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">schema_json_file</span><span class="p">:</span>
            <span class="n">schema</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">schema_json_file</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">card_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">card</span><span class="p">:</span>
            <span class="n">card_json</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">card</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">validate</span><span class="p">(</span><span class="n">card_json</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Failed Project Card validation: Validation Error</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;   Project Card File Loc:</span><span class="si">{</span><span class="n">card_file</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;   Project Card Schema Loc:</span><span class="si">{</span><span class="n">card_schema_file</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;      </span><span class="si">{</span><span class="n">exc</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">except</span> <span class="n">SchemaError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Failed Project Card schema validation: Schema Error&quot;</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;   Project Card Schema Loc:</span><span class="si">{</span><span class="n">card_schema_file</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;      </span><span class="si">{</span><span class="n">exc</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">except</span> <span class="n">yaml</span><span class="o">.</span><span class="n">YAMLError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">exc</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">has_any_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tags</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns true if ProjectCard has at lest one tag in tags list.</span>

<span class="sd">        args:</span>
<span class="sd">            tags: list of tags to search for</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">tags</span> <span class="ow">and</span> <span class="nb">set</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span><span class="o">.</span><span class="n">isdisjoint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">):</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Project card tags: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="si">}</span><span class="s2"> don&#39;t match search tags: </span><span class="si">{</span><span class="n">tags</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">build_selection_query</span><span class="p">(</span>
        <span class="n">selection</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
        <span class="nb">type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;links&quot;</span><span class="p">,</span>
        <span class="n">unique_ids</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
        <span class="n">mode</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;drive_access&quot;</span><span class="p">],</span>
        <span class="n">ignore</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generates the query for selecting links within links_df.</span>

<span class="sd">        Args:</span>
<span class="sd">            selection: Selection dictionary from project card.</span>
<span class="sd">            type: one of &quot;links&quot; or &quot;nodes&quot;</span>
<span class="sd">            unique_ids: Properties which are unique in network and can be used</span>
<span class="sd">                for selecting individual links or nodes without other properties.</span>
<span class="sd">            mode: Limits selection to certain modes.</span>
<span class="sd">                Defaults to [&quot;drive_access&quot;].</span>
<span class="sd">            ignore: _description_. Defaults to [].</span>

<span class="sd">        Returns:</span>
<span class="sd">            _type_: _description_</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sel_query</span> <span class="o">=</span> <span class="s2">&quot;(&quot;</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">selection_keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">li</span> <span class="ow">in</span> <span class="n">selection</span><span class="p">[</span><span class="nb">type</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">li</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>

        <span class="n">unique_ids_sel</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">unique_ids</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">selection_keys</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">li</span> <span class="ow">in</span> <span class="n">selection</span><span class="p">[</span><span class="nb">type</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">li</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">ignore</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="k">if</span> <span class="n">unique_ids_sel</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unique_ids</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="n">sel_query</span> <span class="o">=</span> <span class="n">sel_query</span> <span class="o">+</span> <span class="s2">&quot;(&quot;</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>  <span class="c1"># building an OR query with each element in list</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                            <span class="n">sel_query</span> <span class="o">=</span> <span class="n">sel_query</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;.str.contains(&quot;&#39;</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="s1">&#39;&quot;)&#39;</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">sel_query</span> <span class="o">=</span> <span class="n">sel_query</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s2">&quot;==&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">v</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                            <span class="n">sel_query</span> <span class="o">=</span> <span class="n">sel_query</span> <span class="o">+</span> <span class="s2">&quot; or &quot;</span>
                            <span class="n">v</span> <span class="o">=</span> <span class="n">v</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="n">sel_query</span> <span class="o">=</span> <span class="n">sel_query</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="n">sel_query</span> <span class="o">=</span> <span class="n">sel_query</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s2">&quot;==&quot;</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sel_query</span> <span class="o">=</span> <span class="n">sel_query</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s2">&quot;==&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">unique_ids_sel</span> <span class="ow">and</span> <span class="n">count</span> <span class="o">!=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">selection</span><span class="p">[</span><span class="nb">type</span><span class="p">])</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">ignore</span><span class="p">)):</span>
                    <span class="n">sel_query</span> <span class="o">=</span> <span class="n">sel_query</span> <span class="o">+</span> <span class="s2">&quot; and &quot;</span>

                <span class="k">if</span> <span class="n">unique_ids_sel</span> <span class="ow">and</span> <span class="n">count</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_ids_sel</span><span class="p">):</span>
                    <span class="n">sel_query</span> <span class="o">=</span> <span class="n">sel_query</span> <span class="o">+</span> <span class="s2">&quot; and &quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">unique_ids_sel</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">sel_query</span> <span class="o">=</span> <span class="n">sel_query</span> <span class="o">+</span> <span class="s2">&quot; and &quot;</span>

            <span class="c1"># add mode query</span>
            <span class="n">mode_sel</span> <span class="o">=</span> <span class="s2">&quot;(&quot;</span> <span class="o">+</span> <span class="s2">&quot; or &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">m</span> <span class="o">+</span> <span class="s2">&quot;==1&quot;</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">mode</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>
            <span class="n">sel_query</span> <span class="o">=</span> <span class="n">sel_query</span> <span class="o">+</span> <span class="n">mode_sel</span>

        <span class="n">sel_query</span> <span class="o">=</span> <span class="n">sel_query</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>

        <span class="k">return</span> <span class="n">sel_query</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h4 id="network_wrangler.projectcard.ProjectCard.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">attribute_dictonary</span><span class="p">)</span></code>

<a href="#network_wrangler.projectcard.ProjectCard.__init__" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Constructor</p>
      

      <details class="quote">
        <summary>Source code in <code>network_wrangler/projectcard.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attribute_dictonary</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Constructor</span>

<span class="sd">    args:</span>
<span class="sd">    attribute_dictonary: a nested dictionary of attributes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># add these first so they are first on write out</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tags</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dependencies</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">attribute_dictonary</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.projectcard.ProjectCard.build_selection_query" class="doc doc-heading">
<code class="highlight language-python"><span class="n">build_selection_query</span><span class="p">(</span><span class="n">selection</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;links&#39;</span><span class="p">,</span> <span class="n">unique_ids</span><span class="o">=</span><span class="p">[],</span> <span class="n">mode</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;drive_access&#39;</span><span class="p">],</span> <span class="n">ignore</span><span class="o">=</span><span class="p">[])</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#network_wrangler.projectcard.ProjectCard.build_selection_query" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Generates the query for selecting links within links_df.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>selection</code></td>
          <td>
                <code><span title="typing.Mapping">Mapping</span>[str, <span title="typing.Any">Any</span>]</code>
          </td>
          <td><p>Selection dictionary from project card.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>type</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>one of &ldquo;links&rdquo; or &ldquo;nodes&rdquo;</p></td>
          <td>
                <code>&#39;links&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>unique_ids</code></td>
          <td>
                <code><span title="typing.Collection">Collection</span>[str]</code>
          </td>
          <td><p>Properties which are unique in network and can be used
for selecting individual links or nodes without other properties.</p></td>
          <td>
                <code>[]</code>
          </td>
        </tr>
        <tr>
          <td><code>mode</code></td>
          <td>
                <code><span title="typing.Collection">Collection</span>[str]</code>
          </td>
          <td><p>Limits selection to certain modes.
Defaults to [&ldquo;drive_access&rdquo;].</p></td>
          <td>
                <code>[&#39;drive_access&#39;]</code>
          </td>
        </tr>
        <tr>
          <td><code>ignore</code></td>
          <td>
                <code><span title="typing.Collection">Collection</span>[str]</code>
          </td>
          <td><p><em>description</em>. Defaults to [].</p></td>
          <td>
                <code>[]</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>_type_</code></td>          <td>
          </td>
          <td><p><em>description</em></p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/projectcard.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">build_selection_query</span><span class="p">(</span>
    <span class="n">selection</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
    <span class="nb">type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;links&quot;</span><span class="p">,</span>
    <span class="n">unique_ids</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
    <span class="n">mode</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;drive_access&quot;</span><span class="p">],</span>
    <span class="n">ignore</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generates the query for selecting links within links_df.</span>

<span class="sd">    Args:</span>
<span class="sd">        selection: Selection dictionary from project card.</span>
<span class="sd">        type: one of &quot;links&quot; or &quot;nodes&quot;</span>
<span class="sd">        unique_ids: Properties which are unique in network and can be used</span>
<span class="sd">            for selecting individual links or nodes without other properties.</span>
<span class="sd">        mode: Limits selection to certain modes.</span>
<span class="sd">            Defaults to [&quot;drive_access&quot;].</span>
<span class="sd">        ignore: _description_. Defaults to [].</span>

<span class="sd">    Returns:</span>
<span class="sd">        _type_: _description_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sel_query</span> <span class="o">=</span> <span class="s2">&quot;(&quot;</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">selection_keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">li</span> <span class="ow">in</span> <span class="n">selection</span><span class="p">[</span><span class="nb">type</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">li</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>

    <span class="n">unique_ids_sel</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">unique_ids</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">selection_keys</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">li</span> <span class="ow">in</span> <span class="n">selection</span><span class="p">[</span><span class="nb">type</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">li</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">ignore</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">unique_ids_sel</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unique_ids</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">sel_query</span> <span class="o">=</span> <span class="n">sel_query</span> <span class="o">+</span> <span class="s2">&quot;(&quot;</span>
                <span class="n">v</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>  <span class="c1"># building an OR query with each element in list</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                        <span class="n">sel_query</span> <span class="o">=</span> <span class="n">sel_query</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;.str.contains(&quot;&#39;</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="s1">&#39;&quot;)&#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">sel_query</span> <span class="o">=</span> <span class="n">sel_query</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s2">&quot;==&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">v</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                        <span class="n">sel_query</span> <span class="o">=</span> <span class="n">sel_query</span> <span class="o">+</span> <span class="s2">&quot; or &quot;</span>
                        <span class="n">v</span> <span class="o">=</span> <span class="n">v</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">sel_query</span> <span class="o">=</span> <span class="n">sel_query</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">sel_query</span> <span class="o">=</span> <span class="n">sel_query</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s2">&quot;==&quot;</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sel_query</span> <span class="o">=</span> <span class="n">sel_query</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s2">&quot;==&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">unique_ids_sel</span> <span class="ow">and</span> <span class="n">count</span> <span class="o">!=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">selection</span><span class="p">[</span><span class="nb">type</span><span class="p">])</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">ignore</span><span class="p">)):</span>
                <span class="n">sel_query</span> <span class="o">=</span> <span class="n">sel_query</span> <span class="o">+</span> <span class="s2">&quot; and &quot;</span>

            <span class="k">if</span> <span class="n">unique_ids_sel</span> <span class="ow">and</span> <span class="n">count</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_ids_sel</span><span class="p">):</span>
                <span class="n">sel_query</span> <span class="o">=</span> <span class="n">sel_query</span> <span class="o">+</span> <span class="s2">&quot; and &quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">unique_ids_sel</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">sel_query</span> <span class="o">=</span> <span class="n">sel_query</span> <span class="o">+</span> <span class="s2">&quot; and &quot;</span>

        <span class="c1"># add mode query</span>
        <span class="n">mode_sel</span> <span class="o">=</span> <span class="s2">&quot;(&quot;</span> <span class="o">+</span> <span class="s2">&quot; or &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">m</span> <span class="o">+</span> <span class="s2">&quot;==1&quot;</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">mode</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>
        <span class="n">sel_query</span> <span class="o">=</span> <span class="n">sel_query</span> <span class="o">+</span> <span class="n">mode_sel</span>

    <span class="n">sel_query</span> <span class="o">=</span> <span class="n">sel_query</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>

    <span class="k">return</span> <span class="n">sel_query</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.projectcard.ProjectCard.has_any_tags" class="doc doc-heading">
<code class="highlight language-python"><span class="n">has_any_tags</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span></code>

<a href="#network_wrangler.projectcard.ProjectCard.has_any_tags" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Returns true if ProjectCard has at lest one tag in tags list.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>tags</code></td>
          <td>
                <code><span title="typing.Collection">Collection</span>[str]</code>
          </td>
          <td><p>list of tags to search for</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/projectcard.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">has_any_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tags</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns true if ProjectCard has at lest one tag in tags list.</span>

<span class="sd">    args:</span>
<span class="sd">        tags: list of tags to search for</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">tags</span> <span class="ow">and</span> <span class="nb">set</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span><span class="o">.</span><span class="n">isdisjoint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">):</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Project card tags: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="si">}</span><span class="s2"> don&#39;t match search tags: </span><span class="si">{</span><span class="n">tags</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.projectcard.ProjectCard.read" class="doc doc-heading">
<code class="highlight language-python"><span class="n">read</span><span class="p">(</span><span class="n">path_to_card</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#network_wrangler.projectcard.ProjectCard.read" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Reads and validates a Project card</p>
      <p>Returns a Project Card object</p>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/projectcard.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">path_to_card</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">validate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads and validates a Project card</span>

<span class="sd">    args:</span>
<span class="sd">    path_to_card: the path to the project card</span>

<span class="sd">    Returns a Project Card object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">card_suffix</span> <span class="o">=</span> <span class="n">path_to_card</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">card_suffix</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;yaml&quot;</span><span class="p">,</span> <span class="s2">&quot;yml&quot;</span><span class="p">]:</span>
        <span class="n">attribute_dictionary</span> <span class="o">=</span> <span class="n">ProjectCard</span><span class="o">.</span><span class="n">read_yml</span><span class="p">(</span><span class="n">path_to_card</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">card_suffix</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;wrangler&quot;</span><span class="p">,</span> <span class="s2">&quot;wr&quot;</span><span class="p">]:</span>
        <span class="n">attribute_dictionary</span> <span class="o">=</span> <span class="n">ProjectCard</span><span class="o">.</span><span class="n">read_wrangler_card</span><span class="p">(</span><span class="n">path_to_card</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Card should have a suffix of yaml, yml, wrangler, or wr. </span><span class="se">\</span>
<span class="s2">            Found suffix: </span><span class="si">{</span><span class="n">card_suffix</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="n">card</span> <span class="o">=</span> <span class="n">ProjectCard</span><span class="p">(</span><span class="n">attribute_dictionary</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">card</span><span class="o">.</span><span class="n">project</span> <span class="ow">in</span> <span class="n">ProjectCard</span><span class="o">.</span><span class="n">UNSPECIFIED_PROJECT_NAMES</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Card must have valid project name: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path_to_card</span><span class="p">)</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="n">card</span><span class="o">.</span><span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">validate</span><span class="p">:</span>
        <span class="n">card</span><span class="o">.</span><span class="n">valid</span> <span class="o">=</span> <span class="n">ProjectCard</span><span class="o">.</span><span class="n">validate_project_card_schema</span><span class="p">(</span><span class="n">path_to_card</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">card</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.projectcard.ProjectCard.read_wrangler_card" class="doc doc-heading">
<code class="highlight language-python"><span class="n">read_wrangler_card</span><span class="p">(</span><span class="n">path_to_card</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#network_wrangler.projectcard.ProjectCard.read_wrangler_card" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Reads wrangler project cards with YAML front matter and then python code.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>path_to_card</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>where the project card is</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/projectcard.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">read_wrangler_card</span><span class="p">(</span><span class="n">path_to_card</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads wrangler project cards with YAML front matter and then python code.</span>

<span class="sd">    Args:</span>
<span class="sd">        path_to_card: where the project card is</span>

<span class="sd">    Returns: Attribute Dictionary for Project Card</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reading Wrangler-Style Project Card </span><span class="si">{</span><span class="n">path_to_card</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path_to_card</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">cardfile</span><span class="p">:</span>
        <span class="n">delim</span> <span class="o">=</span> <span class="n">cardfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Using delimiter: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">delim</span><span class="p">))</span>
        <span class="n">_yaml</span><span class="p">,</span> <span class="n">_pycode</span> <span class="o">=</span> <span class="n">cardfile</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">delim</span><span class="p">)</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;_yaml: </span><span class="si">{}</span><span class="se">\n</span><span class="s2">_pycode: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_yaml</span><span class="p">,</span> <span class="n">_pycode</span><span class="p">))</span>

    <span class="n">attribute_dictionary</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">_yaml</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
    <span class="n">attribute_dictionary</span><span class="p">[</span><span class="s2">&quot;file&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">path_to_card</span>
    <span class="n">attribute_dictionary</span><span class="p">[</span><span class="s2">&quot;pycode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_pycode</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">attribute_dictionary</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.projectcard.ProjectCard.read_yml" class="doc doc-heading">
<code class="highlight language-python"><span class="n">read_yml</span><span class="p">(</span><span class="n">path_to_card</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#network_wrangler.projectcard.ProjectCard.read_yml" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Reads &ldquo;normal&rdquo; wrangler project cards defined in YAML.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>path_to_card</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>where the project card is</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/projectcard.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">read_yml</span><span class="p">(</span><span class="n">path_to_card</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads &quot;normal&quot; wrangler project cards defined in YAML.</span>

<span class="sd">    Args:</span>
<span class="sd">        path_to_card: where the project card is</span>

<span class="sd">    Returns: Attribute Dictionary for Project Card</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reading YAML-Style Project Card </span><span class="si">{</span><span class="n">path_to_card</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path_to_card</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">cardfile</span><span class="p">:</span>
        <span class="n">attribute_dictionary</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">cardfile</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
        <span class="n">attribute_dictionary</span><span class="p">[</span><span class="s2">&quot;file&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">path_to_card</span>

    <span class="k">return</span> <span class="n">attribute_dictionary</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.projectcard.ProjectCard.validate_project_card_schema" class="doc doc-heading">
<code class="highlight language-python"><span class="n">validate_project_card_schema</span><span class="p">(</span><span class="n">card_file</span><span class="p">,</span> <span class="n">card_schema_file</span><span class="o">=</span><span class="s1">&#39;project_card.json&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#network_wrangler.projectcard.ProjectCard.validate_project_card_schema" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Tests project card schema validity by evaluating if it conforms to the schemas</p>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/projectcard.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">validate_project_card_schema</span><span class="p">(</span>
    <span class="n">card_file</span><span class="p">,</span> <span class="n">card_schema_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;project_card.json&quot;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tests project card schema validity by evaluating if it conforms to the schemas</span>
<span class="sd">    returns: boolean</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">card_schema_file</span><span class="p">):</span>
        <span class="n">base_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span> <span class="s2">&quot;schemas&quot;</span>
        <span class="p">)</span>
        <span class="n">card_schema_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_path</span><span class="p">,</span> <span class="n">card_schema_file</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">card_schema_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">schema_json_file</span><span class="p">:</span>
        <span class="n">schema</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">schema_json_file</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">card_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">card</span><span class="p">:</span>
        <span class="n">card_json</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">card</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">validate</span><span class="p">(</span><span class="n">card_json</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Failed Project Card validation: Validation Error</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;   Project Card File Loc:</span><span class="si">{</span><span class="n">card_file</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;   Project Card Schema Loc:</span><span class="si">{</span><span class="n">card_schema_file</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;      </span><span class="si">{</span><span class="n">exc</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">SchemaError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Failed Project Card schema validation: Schema Error&quot;</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;   Project Card Schema Loc:</span><span class="si">{</span><span class="n">card_schema_file</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;      </span><span class="si">{</span><span class="n">exc</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">yaml</span><span class="o">.</span><span class="n">YAMLError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">exc</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.projectcard.ProjectCard.write" class="doc doc-heading">
<code class="highlight language-python"><span class="n">write</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#network_wrangler.projectcard.ProjectCard.write" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Writes project card dictionary to YAML file</p>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/projectcard.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Writes project card dictionary to YAML file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">network_wrangler.utils.geo</span> <span class="kn">import</span> <span class="n">make_slug</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="n">make_slug</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.yml&quot;</span>

    <span class="c1"># import collections</span>
    <span class="c1"># out_dict = collections.OrderedDict()</span>
    <span class="n">out_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">out_dict</span><span class="p">[</span><span class="s2">&quot;project&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">out_dict</span><span class="p">[</span><span class="s2">&quot;tags&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">out_dict</span><span class="p">[</span><span class="s2">&quot;dependencies&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">out_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
        <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">out_dict</span><span class="p">,</span> <span class="n">outfile</span><span class="p">,</span> <span class="n">default_flow_style</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Wrote project card to: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="network_wrangler.Scenario" class="doc doc-heading">
        <code>network_wrangler.Scenario</code>


<a href="#network_wrangler.Scenario" class="headerlink" title="Permanent link"> ¶</a></h3>


  <div class="doc doc-contents first">
      <p class="doc doc-class-bases">
        Bases: <code>object</code></p>

  
      <p>Holds information about a scenario.</p>
<p>Typical usage example:</p>
<div class="language-python highlight"><pre><span></span><code><span class="n">my_base_year_scenario</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;road_net&quot;</span><span class="p">:</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">read</span><span class="p">(</span>
        <span class="n">link_file</span><span class="o">=</span><span class="n">STPAUL_LINK_FILE</span><span class="p">,</span>
        <span class="n">node_file</span><span class="o">=</span><span class="n">STPAUL_NODE_FILE</span><span class="p">,</span>
        <span class="n">shape_file</span><span class="o">=</span><span class="n">STPAUL_SHAPE_FILE</span><span class="p">,</span>
        <span class="n">fast</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="s2">&quot;transit_net&quot;</span><span class="p">:</span> <span class="n">TransitNetwork</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">STPAUL_DIR</span><span class="p">),</span>
<span class="p">}</span>

<span class="c1"># create a future baseline scenario from base by searching for all cards in dir w/ baseline tag</span>
<span class="n">project_card_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">STPAUL_DIR</span><span class="p">,</span> <span class="s2">&quot;project_cards&quot;</span><span class="p">)</span>
<span class="n">my_scenario</span> <span class="o">=</span> <span class="n">Scenario</span><span class="o">.</span><span class="n">create_scenario</span><span class="p">(</span>
    <span class="n">base_scenario</span><span class="o">=</span><span class="n">my_base_year_scenario</span><span class="p">,</span>
    <span class="n">card_search_dir</span><span class="o">=</span><span class="n">project_card_directory</span><span class="p">,</span>
    <span class="n">filter_tags</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&quot;baseline2050&quot;</span> <span class="p">]</span>
<span class="p">)</span>

<span class="c1"># check project card queue and then apply the projects</span>
<span class="n">my_scenario</span><span class="o">.</span><span class="n">queued_projects</span>
<span class="n">my_scenario</span><span class="o">.</span><span class="n">apply_all_projects</span><span class="p">()</span>

<span class="c1"># check applied projects, write it out, and create a summary report.</span>
<span class="n">my_scenario</span><span class="o">.</span><span class="n">applied_projects</span>
<span class="n">my_scenario</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;baseline&quot;</span><span class="p">)</span>
<span class="n">my_scenario</span><span class="o">.</span><span class="n">summarize</span><span class="p">(</span><span class="n">outfile</span> <span class="o">=</span> <span class="s2">&quot;baseline2050summary.txt&quot;</span><span class="p">)</span>

<span class="c1"># Add some projects to create a build scenario based on a list of files.</span>
<span class="n">build_card_filenames</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;3_multiple_roadway_attribute_change.yml&quot;</span><span class="p">,</span>
    <span class="s2">&quot;multiple_changes.yml&quot;</span><span class="p">,</span>
    <span class="s2">&quot;4_simple_managed_lane.yml&quot;</span><span class="p">,</span>
<span class="p">]</span>
<span class="n">my_scenario</span><span class="o">.</span><span class="n">add_projects_from_files</span><span class="p">(</span><span class="n">build_card_filenames</span><span class="p">)</span>
<span class="n">my_scenario</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;build2050&quot;</span><span class="p">)</span>
<span class="n">my_scenario</span><span class="o">.</span><span class="n">summarize</span><span class="p">(</span><span class="n">outfile</span> <span class="o">=</span> <span class="s2">&quot;build2050summary.txt&quot;</span><span class="p">)</span>
</code></pre></div>

  <p><strong>Attributes:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>base_scenario</code></td>
          <td>
          </td>
          <td><p>dictionary representation of a scenario</p></td>
        </tr>
        <tr>
          <td><code>road_net</code></td>
          <td>
          </td>
          <td><p>instance of RoadwayNetwork for the scenario</p></td>
        </tr>
        <tr>
          <td><code>transit_net</code></td>
          <td>
          </td>
          <td><p>instance of TransitNetwork for the scenario</p></td>
        </tr>
        <tr>
          <td><code>project_cards</code></td>
          <td>
          </td>
          <td><p>Mapping[ProjectCard.name,ProjectCard] Storage of all project cards by name.</p></td>
        </tr>
        <tr>
          <td><code>queued_projects</code></td>
          <td>
          </td>
          <td><p>Projects which are &ldquo;shovel ready&rdquo; - have had pre-requisits checked and
done any required re-ordering. Similar to a git staging, project cards aren&rsquo;t
recognized in this collecton once they are moved to applied.</p></td>
        </tr>
        <tr>
          <td><code>applied_projects</code></td>
          <td>
          </td>
          <td><p>list of project names that have been applied</p></td>
        </tr>
        <tr>
          <td><code>projects</code></td>
          <td>
          </td>
          <td><p>list of all projects either planned, queued, or applied</p></td>
        </tr>
        <tr>
          <td><code>prerequisites</code></td>
          <td>
          </td>
          <td><p>dictionary storing prerequiste information</p></td>
        </tr>
        <tr>
          <td><code>corequisites</code></td>
          <td>
          </td>
          <td><p>dictionary storing corequisite information</p></td>
        </tr>
        <tr>
          <td><code>conflicts</code></td>
          <td>
          </td>
          <td><p>dictionary storing conflict information</p></td>
        </tr>
    </tbody>
  </table>


        <details class="quote">
          <summary>Source code in <code>network_wrangler/scenario.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Scenario</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Holds information about a scenario.</span>

<span class="sd">    Typical usage example:</span>

<span class="sd">    ```python</span>
<span class="sd">    my_base_year_scenario = {</span>
<span class="sd">        &quot;road_net&quot;: RoadwayNetwork.read(</span>
<span class="sd">            link_file=STPAUL_LINK_FILE,</span>
<span class="sd">            node_file=STPAUL_NODE_FILE,</span>
<span class="sd">            shape_file=STPAUL_SHAPE_FILE,</span>
<span class="sd">            fast=True,</span>
<span class="sd">        ),</span>
<span class="sd">        &quot;transit_net&quot;: TransitNetwork.read(STPAUL_DIR),</span>
<span class="sd">    }</span>

<span class="sd">    # create a future baseline scenario from base by searching for all cards in dir w/ baseline tag</span>
<span class="sd">    project_card_directory = os.path.join(STPAUL_DIR, &quot;project_cards&quot;)</span>
<span class="sd">    my_scenario = Scenario.create_scenario(</span>
<span class="sd">        base_scenario=my_base_year_scenario,</span>
<span class="sd">        card_search_dir=project_card_directory,</span>
<span class="sd">        filter_tags = [ &quot;baseline2050&quot; ]</span>
<span class="sd">    )</span>

<span class="sd">    # check project card queue and then apply the projects</span>
<span class="sd">    my_scenario.queued_projects</span>
<span class="sd">    my_scenario.apply_all_projects()</span>

<span class="sd">    # check applied projects, write it out, and create a summary report.</span>
<span class="sd">    my_scenario.applied_projects</span>
<span class="sd">    my_scenario.write(&quot;baseline&quot;)</span>
<span class="sd">    my_scenario.summarize(outfile = &quot;baseline2050summary.txt&quot;)</span>

<span class="sd">    # Add some projects to create a build scenario based on a list of files.</span>
<span class="sd">    build_card_filenames = [</span>
<span class="sd">        &quot;3_multiple_roadway_attribute_change.yml&quot;,</span>
<span class="sd">        &quot;multiple_changes.yml&quot;,</span>
<span class="sd">        &quot;4_simple_managed_lane.yml&quot;,</span>
<span class="sd">    ]</span>
<span class="sd">    my_scenario.add_projects_from_files(build_card_filenames)</span>
<span class="sd">    my_scenario.write(&quot;build2050&quot;)</span>
<span class="sd">    my_scenario.summarize(outfile = &quot;build2050summary.txt&quot;)</span>
<span class="sd">    ```</span>

<span class="sd">    Attributes:</span>
<span class="sd">        base_scenario: dictionary representation of a scenario</span>
<span class="sd">        road_net: instance of RoadwayNetwork for the scenario</span>
<span class="sd">        transit_net: instance of TransitNetwork for the scenario</span>
<span class="sd">        project_cards: Mapping[ProjectCard.name,ProjectCard] Storage of all project cards by name.</span>
<span class="sd">        queued_projects: Projects which are &quot;shovel ready&quot; - have had pre-requisits checked and</span>
<span class="sd">            done any required re-ordering. Similar to a git staging, project cards aren&#39;t</span>
<span class="sd">            recognized in this collecton once they are moved to applied.</span>
<span class="sd">        applied_projects: list of project names that have been applied</span>
<span class="sd">        projects: list of all projects either planned, queued, or applied</span>
<span class="sd">        prerequisites:  dictionary storing prerequiste information</span>
<span class="sd">        corequisites:  dictionary storing corequisite information</span>
<span class="sd">        conflicts: dictionary storing conflict information</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">base_scenario</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Scenario</span><span class="p">,</span> <span class="nb">dict</span><span class="p">],</span>
        <span class="n">project_card_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ProjectCard</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor</span>

<span class="sd">        args:</span>
<span class="sd">        base_scenario: A base scenario object to base this isntance off of, or a dict which</span>
<span class="sd">            describes the scenario attributes including applied projects and respective conflicts.</span>
<span class="sd">            `{&quot;applied_projects&quot;: [],&quot;conflicts&quot;:{...}}`</span>
<span class="sd">        project_card_list: Optional list of ProjectCard instances to add to planned projects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Creating Scenario&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">base_scenario</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Scenario&quot;</span><span class="p">:</span>
            <span class="n">base_scenario</span> <span class="o">=</span> <span class="n">base_scenario</span><span class="o">.</span><span class="vm">__dict__</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">BASE_SCENARIO_SUGGESTED_PROPS</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nb">set</span><span class="p">(</span><span class="n">base_scenario</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Base_scenario doesn&#39;t contain </span><span class="si">{</span><span class="n">BASE_SCENARIO_SUGGESTED_PROPS</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">base_scenario</span> <span class="o">=</span> <span class="n">base_scenario</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="c1"># if the base scenario had roadway or transit networks, use them as the basis.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">road_net</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_scenario</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;road_net&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transit_net</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_scenario</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;transit_net&quot;</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">project_cards</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_planned_projects</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_queued_projects</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">applied_projects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_scenario</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;applied_projects&quot;</span><span class="p">,</span> <span class="p">[])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">prerequisites</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_scenario</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;prerequisites&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">corequisites</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_scenario</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;corequisites&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conflicts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_scenario</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;conflicts&quot;</span><span class="p">,</span> <span class="p">{})</span>

        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">project_card_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_project</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">projects</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">applied_projects</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_planned_projects</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">queued_projects</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a list version of _queued_projects queue.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_queued_projects</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_check_projects_requirements_satisfied</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_planned_projects</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_queued_projects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">order_projects</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_planned_projects</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_queued_projects</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">create_scenario</span><span class="p">(</span>
        <span class="n">base_scenario</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;Scenario&quot;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">{},</span>
        <span class="n">project_card_list</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">project_card_file_list</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">card_search_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">glob_search</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">filter_tags</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
        <span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Scenario</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates scenario from a base scenario and adds project cards.</span>

<span class="sd">        Project cards can be added using any/all of the following methods:</span>
<span class="sd">        1. List of ProjectCard instances</span>
<span class="sd">        2. List of ProjectCard files</span>
<span class="sd">        3. Directory and optional glob search to find project card files in</span>

<span class="sd">        Checks that a project of same name is not already in scenario.</span>
<span class="sd">        If selected, will validate ProjectCard before adding.</span>
<span class="sd">        If provided, will only add ProjectCard if it matches at least one filter_tags.</span>

<span class="sd">        args:</span>
<span class="sd">            base_scenario: base Scenario scenario instances of dictionary of attributes.</span>
<span class="sd">            project_card_list: List of ProjectCard instances to create Scenario from.</span>
<span class="sd">            project_card_file_list: List of ProjectCard files to create Scenario from.</span>
<span class="sd">            card_search_dir (str): Directory to search for project card files in.</span>
<span class="sd">            glob_search (str, optional): Optional glob search parameters for card_search_dir.</span>
<span class="sd">            filter_tags (Collection[str], optional): If used, will only add the project card if</span>
<span class="sd">                its tags match one or more of these filter_tags. Defaults to []</span>
<span class="sd">                which means no tag-filtering will occur.</span>
<span class="sd">            validate (bool, optional): If True, will validate the projectcard before</span>
<span class="sd">                being adding it to the scenario. Defaults to True.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">scenario</span> <span class="o">=</span> <span class="n">Scenario</span><span class="p">(</span><span class="n">base_scenario</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">project_card_list</span><span class="p">:</span>
            <span class="n">scenario</span><span class="o">.</span><span class="n">add_project_cards</span><span class="p">(</span>
                <span class="n">project_card_list</span><span class="p">,</span> <span class="n">filter_tags</span><span class="o">=</span><span class="n">filter_tags</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="n">validate</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">project_card_file_list</span><span class="p">:</span>
            <span class="n">scenario</span><span class="o">.</span><span class="n">add_projects_from_files</span><span class="p">(</span>
                <span class="n">project_card_file_list</span><span class="p">,</span> <span class="n">filter_tags</span><span class="o">=</span><span class="n">filter_tags</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="n">validate</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">card_search_dir</span><span class="p">:</span>
            <span class="n">scenario</span><span class="o">.</span><span class="n">add_projects_from_directory</span><span class="p">(</span>
                <span class="n">card_search_dir</span><span class="p">,</span>
                <span class="n">glob_search</span><span class="o">=</span><span class="n">glob_search</span><span class="p">,</span>
                <span class="n">filter_tags</span><span class="o">=</span><span class="n">filter_tags</span><span class="p">,</span>
                <span class="n">validate</span><span class="o">=</span><span class="n">validate</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">scenario</span>

    <span class="k">def</span> <span class="nf">_add_dependencies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_name</span><span class="p">,</span> <span class="n">dependencies</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add dependencies from a project card to relevant scenario variables.</span>

<span class="sd">        Updates existing &quot;prerequisites&quot;, &quot;corequisites&quot; and &quot;conflicts&quot;.</span>
<span class="sd">        Lowercases everything to enable string matching.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name: name of project you are adding dependencies for.</span>
<span class="sd">            dependencies: Dictionary of depndencies by dependency type and list of associated</span>
<span class="sd">                projects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">project_name</span> <span class="o">=</span> <span class="n">project_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adding </span><span class="si">{</span><span class="n">project_name</span><span class="si">}</span><span class="s2"> dependencies:</span><span class="se">\n</span><span class="si">{</span><span class="n">dependencies</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">d</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dependencies</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">_dep</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">lower</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">d</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">project_name</span><span class="p">:</span> <span class="n">_dep</span><span class="p">})</span>

    <span class="k">def</span> <span class="nf">_add_project</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_card</span><span class="p">:</span> <span class="n">ProjectCard</span><span class="p">,</span>
        <span class="n">validate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">filter_tags</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds a single ProjectCard instances to the Scenario.</span>

<span class="sd">        Checks that a project of same name is not already in scenario.</span>
<span class="sd">        If selected, will validate ProjectCard before adding.</span>
<span class="sd">        If provided, will only add ProjectCard if it matches at least one filter_tags.</span>

<span class="sd">        Resets scenario queued_projects.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_card (ProjectCard): ProjectCard instance to add to scenario.</span>
<span class="sd">            validate (bool, optional): If True, will validate the projectcard before</span>
<span class="sd">                being adding it to the scenario. Defaults to True.</span>
<span class="sd">            filter_tags (Collection[str], optional): If used, will only add the project card if</span>
<span class="sd">                its tags match one or more of these filter_tags. Defaults to []</span>
<span class="sd">                which means no tag-filtering will occur.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">project_name</span> <span class="o">=</span> <span class="n">project_card</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">filter_tags</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">lower</span><span class="p">,</span> <span class="n">filter_tags</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">project_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">projects</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ProjectCardError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Names not unique from existing scenario projects: </span><span class="si">{</span><span class="n">project_card</span><span class="o">.</span><span class="n">project</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">filter_tags</span> <span class="ow">and</span> <span class="nb">set</span><span class="p">(</span><span class="n">project_card</span><span class="o">.</span><span class="n">tags</span><span class="p">)</span><span class="o">.</span><span class="n">isdisjoint</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">filter_tags</span><span class="p">)):</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Skipping </span><span class="si">{</span><span class="n">project_name</span><span class="si">}</span><span class="s2"> - no overlapping tags with </span><span class="si">{</span><span class="n">filter_tags</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">validate</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">project_card</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;file&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Could not validate Project Card </span><span class="si">{</span><span class="n">project_card</span><span class="o">.</span><span class="n">project</span><span class="si">}</span><span class="s2"> because no file specified&quot;</span>
                <span class="p">)</span>
                <span class="k">return</span>
            <span class="n">project_card</span><span class="o">.</span><span class="n">validate_project_card_schema</span><span class="p">(</span><span class="n">project_card</span><span class="o">.</span><span class="n">file</span><span class="p">)</span>

        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adding </span><span class="si">{</span><span class="n">project_name</span><span class="si">}</span><span class="s2"> to scenario.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project_cards</span><span class="p">[</span><span class="n">project_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">project_card</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_planned_projects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">project_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_queued_projects</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_dependencies</span><span class="p">(</span><span class="n">project_name</span><span class="p">,</span> <span class="n">project_card</span><span class="o">.</span><span class="n">dependencies</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_project_cards</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_card_list</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="n">ProjectCard</span><span class="p">],</span>
        <span class="n">validate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">filter_tags</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds a list of ProjectCard instances to the Scenario.</span>

<span class="sd">        Checks that a project of same name is not already in scenario.</span>
<span class="sd">        If selected, will validate ProjectCard before adding.</span>
<span class="sd">        If provided, will only add ProjectCard if it matches at least one filter_tags.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_card_list (Collection[ProjectCard]): List of ProjectCard instances to add to</span>
<span class="sd">                scenario.</span>
<span class="sd">            validate (bool, optional): If True, will require each ProjectCard is validated before</span>
<span class="sd">                being added to scenario. Defaults to True.</span>
<span class="sd">            filter_tags (Collection[str], optional): If used, will filter ProjectCard instances</span>
<span class="sd">                and only add those whose tags match one or more of these filter_tags.</span>
<span class="sd">                Defaults to [] - which means no tag-filtering will occur.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">project_card_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_project</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="n">validate</span><span class="p">,</span> <span class="n">filter_tags</span><span class="o">=</span><span class="n">filter_tags</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_projects_from_files</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_card_file_list</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">validate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">filter_tags</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds a list of ProjectCard files  to the Scenario.</span>

<span class="sd">        Creates ProjectCard instances from each file.</span>
<span class="sd">        Checks that a project of same name is not already in scenario.</span>
<span class="sd">        If selected, will validate ProjectCard before adding.</span>
<span class="sd">        If provided, will only add ProjectCard if it matches at least one filter_tags.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_card_file_list (Collection[str]): List of project card files to add to</span>
<span class="sd">                scenario.</span>
<span class="sd">            validate (bool, optional): If True, will require each ProjectCard is validated before</span>
<span class="sd">                being added to scenario. Defaults to True.</span>
<span class="sd">            filter_tags (Collection[str], optional): If used, will filter ProjectCard instances</span>
<span class="sd">                and only add those whose tags match one or more of these filter_tags.</span>
<span class="sd">                Defaults to [] - which means no tag-filtering will occur.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_project_card_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">ProjectCard</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">_pc_file</span><span class="p">)</span> <span class="k">for</span> <span class="n">_pc_file</span> <span class="ow">in</span> <span class="n">project_card_file_list</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_project_cards</span><span class="p">(</span>
            <span class="n">_project_card_list</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="n">validate</span><span class="p">,</span> <span class="n">filter_tags</span><span class="o">=</span><span class="n">filter_tags</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_projects_from_directory</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">search_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">glob_search</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">validate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">filter_tags</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds ProjectCards from project card files found in a directory to the Scenario.</span>

<span class="sd">        Finds files in directory which have ProjectCard.FILE_TYPE suffices.</span>
<span class="sd">        If provided, will filter directory search using glob_search pattern.</span>
<span class="sd">        Creates ProjectCard instances from each file.</span>
<span class="sd">        Checks that a project of same name is not already in scenario.</span>
<span class="sd">        If selected, will validate ProjectCard before adding.</span>
<span class="sd">        If provided, will only add ProjectCard if it matches at least one filter_tags.</span>

<span class="sd">        Args:</span>
<span class="sd">            search_dir (str): Search directory.</span>
<span class="sd">            glob_search (str, optional): Optional glob search parameters.</span>
<span class="sd">            validate (bool, optional): If True, will require each ProjectCard is validated before</span>
<span class="sd">                being added to scenario. Defaults to True.</span>
<span class="sd">            filter_tags (Collection[str], optional): If used, will filter ProjectCard instances</span>
<span class="sd">                and only add those whse tags match one or more of these filter_tags. Defaults to []</span>
<span class="sd">                which means no tag-filtering will occur.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_project_card_file_list</span> <span class="o">=</span> <span class="n">project_card_files_from_directory</span><span class="p">(</span>
            <span class="n">search_dir</span><span class="p">,</span> <span class="n">glob_search</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_projects_from_files</span><span class="p">(</span>
            <span class="n">_project_card_file_list</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="n">validate</span><span class="p">,</span> <span class="n">filter_tags</span><span class="o">=</span><span class="n">filter_tags</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_projects_requirements_satisfied</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_list</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Checks that all requirements are satisified to apply this specific set of projects including:</span>

<span class="sd">        1. has an associaed project card</span>
<span class="sd">        2. is in scenario&#39;s planned projects</span>
<span class="sd">        3. pre-requisites satisfied</span>
<span class="sd">        4. co-requisies satisfied by applied or co-applied projects</span>
<span class="sd">        5. no conflicing applied or co-applied projects</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): name of project.</span>
<span class="sd">            co_applied_project_list (Collection[str]): List of projects that will be applied</span>
<span class="sd">                with this project.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_projects_planned</span><span class="p">(</span><span class="n">project_list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_projects_have_project_cards</span><span class="p">(</span><span class="n">project_list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_projects_prerequisites</span><span class="p">(</span><span class="n">project_list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_projects_corequisites</span><span class="p">(</span><span class="n">project_list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_projects_conflicts</span><span class="p">(</span><span class="n">project_list</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_projects_planned</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_names</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Checks that a list of projects are in the scenario&#39;s planned projects.&quot;&quot;&quot;</span>
        <span class="n">_missing_ps</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_planned_projects</span> <span class="k">if</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_planned_projects</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="n">_missing_ps</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Projects are not in planned projects:</span><span class="se">\n</span><span class="s2"> </span><span class="si">{</span><span class="n">_missing_ps</span><span class="si">}</span><span class="s2">. Add them by </span><span class="se">\</span>
<span class="s2">                using add_project_cards(), add_projects_from_files(), or </span><span class="se">\</span>
<span class="s2">                add_projects_from_directory().&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_projects_have_project_cards</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_list</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Checks that a list of projects has an associated project card in the scenario.&quot;&quot;&quot;</span>
        <span class="n">_missing</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">project_list</span> <span class="k">if</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_cards</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">_missing</span><span class="p">:</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Projects referenced which are missing project cards: </span><span class="si">{</span><span class="n">_missing</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_check_projects_prerequisites</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_names</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Checks that list of projects&#39; pre-requisites have been or will be applied to scenario.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">project_names</span><span class="p">)</span><span class="o">.</span><span class="n">isdisjoint</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prerequisites</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
            <span class="k">return</span>
        <span class="n">_prereqs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">project_names</span><span class="p">:</span>
            <span class="n">_prereqs</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prerequisites</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">_projects_applied</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">applied_projects</span> <span class="o">+</span> <span class="n">project_names</span>
        <span class="n">_missing</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">_prereqs</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">_projects_applied</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">_missing</span><span class="p">:</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;project_names: </span><span class="si">{</span><span class="n">project_names</span><span class="si">}</span><span class="se">\n</span><span class="s2">projects_have_or_will_be_applied:</span><span class="si">{</span><span class="n">_projects_applied</span><span class="si">}</span><span class="se">\n</span><span class="s2">missing: </span><span class="si">{</span><span class="n">_missing</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="n">ScenarioPrerequisiteError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Missing </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">_missing</span><span class="p">)</span><span class="si">}</span><span class="s2"> pre-requisites: </span><span class="si">{</span><span class="n">_missing</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_projects_corequisites</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_names</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Checks that a list of projects&#39; co-requisites have been or will be applied to scenario.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">project_names</span><span class="p">)</span><span class="o">.</span><span class="n">isdisjoint</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corequisites</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
            <span class="k">return</span>
        <span class="n">_coreqs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">project_names</span><span class="p">:</span>
            <span class="n">_coreqs</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corequisites</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">_projects_applied</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">applied_projects</span> <span class="o">+</span> <span class="n">project_names</span>
        <span class="n">_missing</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">_coreqs</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">_projects_applied</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">_missing</span><span class="p">:</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;project_names: </span><span class="si">{</span><span class="n">project_names</span><span class="si">}</span><span class="se">\n</span><span class="s2">projects_have_or_will_be_applied:</span><span class="si">{</span><span class="n">_projects_applied</span><span class="si">}</span><span class="se">\n</span><span class="s2">missing: </span><span class="si">{</span><span class="n">_missing</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="n">ScenarioCorequisiteError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Missing </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">_missing</span><span class="p">)</span><span class="si">}</span><span class="s2"> corequisites: </span><span class="si">{</span><span class="n">_missing</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_projects_conflicts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_names</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Checks that list of projects&#39; conflicts have not been or will be applied to scenario.&quot;&quot;&quot;</span>
        <span class="c1"># WranglerLogger.debug(&quot;Checking Conflicts...&quot;)</span>
        <span class="n">projects_to_check</span> <span class="o">=</span> <span class="n">project_names</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">applied_projects</span>
        <span class="c1"># WranglerLogger.debug(f&quot;\nprojects_to_check:{projects_to_check}\nprojects_with_conflicts:{set(self.conflicts.keys())}&quot;)</span>
        <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">projects_to_check</span><span class="p">)</span><span class="o">.</span><span class="n">isdisjoint</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conflicts</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
            <span class="c1"># WranglerLogger.debug(&quot;Projects have no conflicts to check&quot;)</span>
            <span class="k">return</span>
        <span class="n">_conflicts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">project_names</span><span class="p">:</span>
            <span class="n">_conflicts</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conflicts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">_conflict_problems</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">_conflicts</span> <span class="k">if</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">projects_to_check</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">_conflict_problems</span><span class="p">:</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Conflict Problems: </span><span class="se">\n</span><span class="si">{</span><span class="n">_conflict_problems</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">_conf_dict</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">k</span><span class="p">:</span> <span class="n">v</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">conflicts</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">projects_to_check</span>
                <span class="ow">and</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">.</span><span class="n">isdisjoint</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">_conflict_problems</span><span class="p">))</span>
            <span class="p">}</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Problematic Conflicts:</span><span class="se">\n</span><span class="si">{</span><span class="n">_conf_dict</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">ScenarioConflictError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">_conflicts</span><span class="p">)</span><span class="si">}</span><span class="s2"> conflicts: </span><span class="si">{</span><span class="n">_conflict_problems</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">order_projects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_list</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">deque</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Orders a list of projects based on moving up pre-requisites into a deque.</span>

<span class="sd">        args:</span>
<span class="sd">            project_list: list of projects to order</span>

<span class="sd">        Returns: deque for applying projects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">project_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">project_list</span><span class="p">]</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_projects_have_project_cards</span><span class="p">(</span><span class="n">project_list</span><span class="p">)</span>

        <span class="c1"># build prereq (adjacency) list for topological sort</span>
        <span class="n">adjacency_list</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="n">visited_list</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">project</span> <span class="ow">in</span> <span class="n">project_list</span><span class="p">:</span>
            <span class="n">visited_list</span><span class="p">[</span><span class="n">project</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">prerequisites</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">project</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">for</span> <span class="n">prereq</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prerequisites</span><span class="p">[</span><span class="n">project</span><span class="p">]:</span>
                <span class="c1"># this will always be true, else would have been flagged in missing \</span>
                <span class="c1"># prerequsite check, but just in case</span>
                <span class="k">if</span> <span class="n">prereq</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">project_list</span><span class="p">:</span>
                    <span class="n">adjacency_list</span><span class="p">[</span><span class="n">prereq</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="p">[</span><span class="n">project</span><span class="p">]</span>

        <span class="c1"># sorted_project_names is topological sorted project card names (based on prerequsiite)</span>
        <span class="n">_ordered_projects</span> <span class="o">=</span> <span class="n">topological_sort</span><span class="p">(</span>
            <span class="n">adjacency_list</span><span class="o">=</span><span class="n">adjacency_list</span><span class="p">,</span> <span class="n">visited_list</span><span class="o">=</span><span class="n">visited_list</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">_ordered_projects</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">project_list</span><span class="p">):</span>
            <span class="n">_missing</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">project_list</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">_ordered_projects</span><span class="p">))</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Project sort resulted in missing projects:</span><span class="si">{</span><span class="n">_missing</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">project_deque</span> <span class="o">=</span> <span class="n">deque</span><span class="p">(</span><span class="n">_ordered_projects</span><span class="p">)</span>

        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ordered Projects:</span><span class="se">\n</span><span class="si">{</span><span class="n">project_deque</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">project_deque</span>

    <span class="k">def</span> <span class="nf">apply_all_projects</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Applies all planned projects in the queue.&quot;&quot;&quot;</span>
        <span class="c1"># Call this to make sure projects are appropriately queued in hidden variable.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queued_projects</span>

        <span class="c1"># Use hidden variable.</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_queued_projects</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_apply_project</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_queued_projects</span><span class="o">.</span><span class="n">popleft</span><span class="p">())</span>

        <span class="c1"># set this so it will trigger re-queuing any more projects.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_queued_projects</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_apply_change</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">change</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Applies a specific change specified in a project card.</span>

<span class="sd">        &quot;category&quot; must be in at least one of:</span>
<span class="sd">        - ROADWAY_CATEGORIES</span>
<span class="sd">        - TRANSIT_CATEGORIES</span>

<span class="sd">        Args:</span>
<span class="sd">            change (dict): dictionary of a project card change</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">change</span><span class="p">[</span><span class="s2">&quot;category&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">ProjectCard</span><span class="o">.</span><span class="n">ROADWAY_CATEGORIES</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_net</span><span class="p">:</span>
                <span class="k">raise</span> <span class="p">(</span><span class="s2">&quot;Missing Roadway Network&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">road_net</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">change</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">change</span><span class="p">[</span><span class="s2">&quot;category&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">ProjectCard</span><span class="o">.</span><span class="n">TRANSIT_CATEGORIES</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">transit_net</span><span class="p">:</span>
                <span class="k">raise</span> <span class="p">(</span><span class="s2">&quot;Missing Transit Network&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transit_net</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">change</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">change</span><span class="p">[</span><span class="s2">&quot;category&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">ProjectCard</span><span class="o">.</span><span class="n">SECONDARY_TRANSIT_CATEGORIES</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">transit_net</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transit_net</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">change</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="n">change</span><span class="p">[</span><span class="s2">&quot;category&quot;</span><span class="p">]</span>
            <span class="ow">not</span> <span class="ow">in</span> <span class="n">ProjectCard</span><span class="o">.</span><span class="n">TRANSIT_CATEGORIES</span> <span class="o">+</span> <span class="n">ProjectCard</span><span class="o">.</span><span class="n">ROADWAY_CATEGORIES</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="n">ProjectCardError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Don&#39;t understand project category: </span><span class="si">{</span><span class="n">change</span><span class="p">[</span><span class="s1">&#39;category&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_apply_project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Applies project card to scenario.</span>

<span class="sd">        If a list of changes is specified in referenced project card, iterates through each change.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): name of project to be applied.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">project_name</span> <span class="o">=</span> <span class="n">project_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Applying </span><span class="si">{</span><span class="n">project_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_cards</span><span class="p">[</span><span class="n">project_name</span><span class="p">]</span><span class="o">.</span><span class="vm">__dict__</span>
        <span class="k">if</span> <span class="s2">&quot;changes&quot;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">pc</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;changes&quot;</span><span class="p">]:</span>
                <span class="n">pc</span><span class="p">[</span><span class="s2">&quot;project&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;project&quot;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_apply_change</span><span class="p">(</span><span class="n">pc</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_apply_change</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_planned_projects</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">project_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">applied_projects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">project_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">apply_projects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_list</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Applies a specific list of projects from the planned project queue.</span>

<span class="sd">        Will order the list of projects based on pre-requisites.</span>

<span class="sd">        NOTE: does not check co-requisites b/c that isn&#39;t possible when applying a sin</span>

<span class="sd">        Args:</span>
<span class="sd">            project_list: List of projects to be applied. All need to be in the planned project</span>
<span class="sd">                queue.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">project_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">project_list</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_check_projects_requirements_satisfied</span><span class="p">(</span><span class="n">project_list</span><span class="p">)</span>
        <span class="n">ordered_project_queue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">order_projects</span><span class="p">(</span><span class="n">project_list</span><span class="p">)</span>

        <span class="k">while</span> <span class="n">ordered_project_queue</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_apply_project</span><span class="p">(</span><span class="n">ordered_project_queue</span><span class="o">.</span><span class="n">popleft</span><span class="p">())</span>

        <span class="c1"># Set so that when called again it will retrigger queueing from planned projects.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ordered_projects</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Union</span><span class="p">(</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;_summary_</span>

<span class="sd">        Args:</span>
<span class="sd">            path: Path to write scenario networks and scenario summary to.</span>
<span class="sd">            name: Name to use.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">road_net</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transit_net</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">summarize</span><span class="p">(</span><span class="n">outfile</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">summarize</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">project_detail</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">outfile</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;a&quot;</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A high level summary of the created scenario.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_detail: If True (default), will write out project card summaries.</span>
<span class="sd">            outfile: If specified, will write scenario summary to text file.</span>
<span class="sd">            mode: Outfile open mode. &#39;a&#39; to append &#39;w&#39; to overwrite.</span>

<span class="sd">        Returns:</span>
<span class="sd">            string of summary</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Summarizing Scenario </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">report_str</span> <span class="o">=</span> <span class="s2">&quot;------------------------------</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">report_str</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;Scenario created on </span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="n">report_str</span> <span class="o">+=</span> <span class="s2">&quot;Base Scenario:</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">report_str</span> <span class="o">+=</span> <span class="s2">&quot;--Road Network:</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">report_str</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;----Link File: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_scenario</span><span class="p">[</span><span class="s1">&#39;road_net&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">link_file</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">report_str</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;----Node File: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_scenario</span><span class="p">[</span><span class="s1">&#39;road_net&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">node_file</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">report_str</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;----Shape File: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_scenario</span><span class="p">[</span><span class="s1">&#39;road_net&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape_file</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">report_str</span> <span class="o">+=</span> <span class="s2">&quot;--Transit Network:</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">report_str</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;----Feed Path: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_scenario</span><span class="p">[</span><span class="s1">&#39;transit_net&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">feed_path</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="n">report_str</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Project Cards:</span><span class="se">\n</span><span class="s2"> -&quot;</span>
        <span class="n">report_str</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">pc</span><span class="o">.</span><span class="n">file</span> <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">pc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_cards</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>

        <span class="n">report_str</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Applied Projects:</span><span class="se">\n</span><span class="s2">-&quot;</span>
        <span class="n">report_str</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">applied_projects</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">project_detail</span><span class="p">:</span>
            <span class="n">report_str</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">---Project Card Details---</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_cards</span><span class="p">:</span>
                <span class="n">report_str</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">pprint</span><span class="o">.</span><span class="n">pformat</span><span class="p">(</span>
                        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">project_cards</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="vm">__dict__</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">applied_projects</span><span class="p">]</span>
                    <span class="p">)</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="n">outfile</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">report_str</span><span class="p">)</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Wrote Scenario Report to: </span><span class="si">{</span><span class="n">outfile</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">report_str</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="network_wrangler.scenario.Scenario.queued_projects" class="doc doc-heading">
<code class="highlight language-python"><span class="n">queued_projects</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#network_wrangler.scenario.Scenario.queued_projects" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Returns a list version of _queued_projects queue.</p>
  </div>

</div>



<div class="doc doc-object doc-function">



<h4 id="network_wrangler.scenario.Scenario.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">base_scenario</span><span class="p">,</span> <span class="n">project_card_list</span><span class="o">=</span><span class="p">[],</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></code>

<a href="#network_wrangler.scenario.Scenario.__init__" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Constructor</p>

<details class="base_scenario">
  <summary>A base scenario object to base this isntance off of, or a dict which</summary>
  <p>describes the scenario attributes including applied projects and respective conflicts.
<code>{"applied_projects": [],"conflicts":{...}}</code></p>
</details>      

      <details class="quote">
        <summary>Source code in <code>network_wrangler/scenario.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">base_scenario</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Scenario</span><span class="p">,</span> <span class="nb">dict</span><span class="p">],</span>
    <span class="n">project_card_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ProjectCard</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Constructor</span>

<span class="sd">    args:</span>
<span class="sd">    base_scenario: A base scenario object to base this isntance off of, or a dict which</span>
<span class="sd">        describes the scenario attributes including applied projects and respective conflicts.</span>
<span class="sd">        `{&quot;applied_projects&quot;: [],&quot;conflicts&quot;:{...}}`</span>
<span class="sd">    project_card_list: Optional list of ProjectCard instances to add to planned projects.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Creating Scenario&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">base_scenario</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Scenario&quot;</span><span class="p">:</span>
        <span class="n">base_scenario</span> <span class="o">=</span> <span class="n">base_scenario</span><span class="o">.</span><span class="vm">__dict__</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">BASE_SCENARIO_SUGGESTED_PROPS</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nb">set</span><span class="p">(</span><span class="n">base_scenario</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Base_scenario doesn&#39;t contain </span><span class="si">{</span><span class="n">BASE_SCENARIO_SUGGESTED_PROPS</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">base_scenario</span> <span class="o">=</span> <span class="n">base_scenario</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="c1"># if the base scenario had roadway or transit networks, use them as the basis.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">road_net</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_scenario</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;road_net&quot;</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">transit_net</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_scenario</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;transit_net&quot;</span><span class="p">))</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">project_cards</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_planned_projects</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_queued_projects</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">applied_projects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_scenario</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;applied_projects&quot;</span><span class="p">,</span> <span class="p">[])</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">prerequisites</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_scenario</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;prerequisites&quot;</span><span class="p">,</span> <span class="p">{})</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">corequisites</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_scenario</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;corequisites&quot;</span><span class="p">,</span> <span class="p">{})</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">conflicts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_scenario</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;conflicts&quot;</span><span class="p">,</span> <span class="p">{})</span>

    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">project_card_list</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_project</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.scenario.Scenario.add_project_cards" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_project_cards</span><span class="p">(</span><span class="n">project_card_list</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">filter_tags</span><span class="o">=</span><span class="p">[])</span></code>

<a href="#network_wrangler.scenario.Scenario.add_project_cards" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Adds a list of ProjectCard instances to the Scenario.</p>
<p>Checks that a project of same name is not already in scenario.
If selected, will validate ProjectCard before adding.
If provided, will only add ProjectCard if it matches at least one filter_tags.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>project_card_list</code></td>
          <td>
                <code><span title="typing.Collection">Collection</span>[<a class="autorefs autorefs-internal" title="network_wrangler.projectcard.ProjectCard" href="#network_wrangler.ProjectCard">ProjectCard</a>]</code>
          </td>
          <td><p>List of ProjectCard instances to add to
scenario.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>validate</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>If True, will require each ProjectCard is validated before
being added to scenario. Defaults to True.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>filter_tags</code></td>
          <td>
                <code><span title="typing.Collection">Collection</span>[str]</code>
          </td>
          <td><p>If used, will filter ProjectCard instances
and only add those whose tags match one or more of these filter_tags.
Defaults to [] - which means no tag-filtering will occur.</p></td>
          <td>
                <code>[]</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/scenario.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_project_cards</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">project_card_list</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="n">ProjectCard</span><span class="p">],</span>
    <span class="n">validate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">filter_tags</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Adds a list of ProjectCard instances to the Scenario.</span>

<span class="sd">    Checks that a project of same name is not already in scenario.</span>
<span class="sd">    If selected, will validate ProjectCard before adding.</span>
<span class="sd">    If provided, will only add ProjectCard if it matches at least one filter_tags.</span>

<span class="sd">    Args:</span>
<span class="sd">        project_card_list (Collection[ProjectCard]): List of ProjectCard instances to add to</span>
<span class="sd">            scenario.</span>
<span class="sd">        validate (bool, optional): If True, will require each ProjectCard is validated before</span>
<span class="sd">            being added to scenario. Defaults to True.</span>
<span class="sd">        filter_tags (Collection[str], optional): If used, will filter ProjectCard instances</span>
<span class="sd">            and only add those whose tags match one or more of these filter_tags.</span>
<span class="sd">            Defaults to [] - which means no tag-filtering will occur.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">project_card_list</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_project</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="n">validate</span><span class="p">,</span> <span class="n">filter_tags</span><span class="o">=</span><span class="n">filter_tags</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.scenario.Scenario.add_projects_from_directory" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_projects_from_directory</span><span class="p">(</span><span class="n">search_dir</span><span class="p">,</span> <span class="n">glob_search</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">filter_tags</span><span class="o">=</span><span class="p">[])</span></code>

<a href="#network_wrangler.scenario.Scenario.add_projects_from_directory" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Adds ProjectCards from project card files found in a directory to the Scenario.</p>
<p>Finds files in directory which have ProjectCard.FILE_TYPE suffices.
If provided, will filter directory search using glob_search pattern.
Creates ProjectCard instances from each file.
Checks that a project of same name is not already in scenario.
If selected, will validate ProjectCard before adding.
If provided, will only add ProjectCard if it matches at least one filter_tags.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>search_dir</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Search directory.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>glob_search</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Optional glob search parameters.</p></td>
          <td>
                <code>&#39;&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>validate</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>If True, will require each ProjectCard is validated before
being added to scenario. Defaults to True.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>filter_tags</code></td>
          <td>
                <code><span title="typing.Collection">Collection</span>[str]</code>
          </td>
          <td><p>If used, will filter ProjectCard instances
and only add those whse tags match one or more of these filter_tags. Defaults to []
which means no tag-filtering will occur.</p></td>
          <td>
                <code>[]</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/scenario.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_projects_from_directory</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">search_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">glob_search</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">validate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">filter_tags</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Adds ProjectCards from project card files found in a directory to the Scenario.</span>

<span class="sd">    Finds files in directory which have ProjectCard.FILE_TYPE suffices.</span>
<span class="sd">    If provided, will filter directory search using glob_search pattern.</span>
<span class="sd">    Creates ProjectCard instances from each file.</span>
<span class="sd">    Checks that a project of same name is not already in scenario.</span>
<span class="sd">    If selected, will validate ProjectCard before adding.</span>
<span class="sd">    If provided, will only add ProjectCard if it matches at least one filter_tags.</span>

<span class="sd">    Args:</span>
<span class="sd">        search_dir (str): Search directory.</span>
<span class="sd">        glob_search (str, optional): Optional glob search parameters.</span>
<span class="sd">        validate (bool, optional): If True, will require each ProjectCard is validated before</span>
<span class="sd">            being added to scenario. Defaults to True.</span>
<span class="sd">        filter_tags (Collection[str], optional): If used, will filter ProjectCard instances</span>
<span class="sd">            and only add those whse tags match one or more of these filter_tags. Defaults to []</span>
<span class="sd">            which means no tag-filtering will occur.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_project_card_file_list</span> <span class="o">=</span> <span class="n">project_card_files_from_directory</span><span class="p">(</span>
        <span class="n">search_dir</span><span class="p">,</span> <span class="n">glob_search</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">add_projects_from_files</span><span class="p">(</span>
        <span class="n">_project_card_file_list</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="n">validate</span><span class="p">,</span> <span class="n">filter_tags</span><span class="o">=</span><span class="n">filter_tags</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.scenario.Scenario.add_projects_from_files" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_projects_from_files</span><span class="p">(</span><span class="n">project_card_file_list</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">filter_tags</span><span class="o">=</span><span class="p">[])</span></code>

<a href="#network_wrangler.scenario.Scenario.add_projects_from_files" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Adds a list of ProjectCard files  to the Scenario.</p>
<p>Creates ProjectCard instances from each file.
Checks that a project of same name is not already in scenario.
If selected, will validate ProjectCard before adding.
If provided, will only add ProjectCard if it matches at least one filter_tags.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>project_card_file_list</code></td>
          <td>
                <code><span title="typing.Collection">Collection</span>[str]</code>
          </td>
          <td><p>List of project card files to add to
scenario.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>validate</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>If True, will require each ProjectCard is validated before
being added to scenario. Defaults to True.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>filter_tags</code></td>
          <td>
                <code><span title="typing.Collection">Collection</span>[str]</code>
          </td>
          <td><p>If used, will filter ProjectCard instances
and only add those whose tags match one or more of these filter_tags.
Defaults to [] - which means no tag-filtering will occur.</p></td>
          <td>
                <code>[]</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/scenario.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_projects_from_files</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">project_card_file_list</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">validate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">filter_tags</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Adds a list of ProjectCard files  to the Scenario.</span>

<span class="sd">    Creates ProjectCard instances from each file.</span>
<span class="sd">    Checks that a project of same name is not already in scenario.</span>
<span class="sd">    If selected, will validate ProjectCard before adding.</span>
<span class="sd">    If provided, will only add ProjectCard if it matches at least one filter_tags.</span>

<span class="sd">    Args:</span>
<span class="sd">        project_card_file_list (Collection[str]): List of project card files to add to</span>
<span class="sd">            scenario.</span>
<span class="sd">        validate (bool, optional): If True, will require each ProjectCard is validated before</span>
<span class="sd">            being added to scenario. Defaults to True.</span>
<span class="sd">        filter_tags (Collection[str], optional): If used, will filter ProjectCard instances</span>
<span class="sd">            and only add those whose tags match one or more of these filter_tags.</span>
<span class="sd">            Defaults to [] - which means no tag-filtering will occur.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_project_card_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">ProjectCard</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">_pc_file</span><span class="p">)</span> <span class="k">for</span> <span class="n">_pc_file</span> <span class="ow">in</span> <span class="n">project_card_file_list</span>
    <span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">add_project_cards</span><span class="p">(</span>
        <span class="n">_project_card_list</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="n">validate</span><span class="p">,</span> <span class="n">filter_tags</span><span class="o">=</span><span class="n">filter_tags</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.scenario.Scenario.apply_all_projects" class="doc doc-heading">
<code class="highlight language-python"><span class="n">apply_all_projects</span><span class="p">()</span></code>

<a href="#network_wrangler.scenario.Scenario.apply_all_projects" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Applies all planned projects in the queue.</p>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/scenario.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">apply_all_projects</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Applies all planned projects in the queue.&quot;&quot;&quot;</span>
    <span class="c1"># Call this to make sure projects are appropriately queued in hidden variable.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">queued_projects</span>

    <span class="c1"># Use hidden variable.</span>
    <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_queued_projects</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_apply_project</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_queued_projects</span><span class="o">.</span><span class="n">popleft</span><span class="p">())</span>

    <span class="c1"># set this so it will trigger re-queuing any more projects.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_queued_projects</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.scenario.Scenario.apply_projects" class="doc doc-heading">
<code class="highlight language-python"><span class="n">apply_projects</span><span class="p">(</span><span class="n">project_list</span><span class="p">)</span></code>

<a href="#network_wrangler.scenario.Scenario.apply_projects" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Applies a specific list of projects from the planned project queue.</p>
<p>Will order the list of projects based on pre-requisites.</p>
<p>NOTE: does not check co-requisites b/c that isn&rsquo;t possible when applying a sin</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>project_list</code></td>
          <td>
                <code><span title="typing.Collection">Collection</span>[str]</code>
          </td>
          <td><p>List of projects to be applied. All need to be in the planned project
queue.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/scenario.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">apply_projects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_list</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Applies a specific list of projects from the planned project queue.</span>

<span class="sd">    Will order the list of projects based on pre-requisites.</span>

<span class="sd">    NOTE: does not check co-requisites b/c that isn&#39;t possible when applying a sin</span>

<span class="sd">    Args:</span>
<span class="sd">        project_list: List of projects to be applied. All need to be in the planned project</span>
<span class="sd">            queue.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">project_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">project_list</span><span class="p">]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_check_projects_requirements_satisfied</span><span class="p">(</span><span class="n">project_list</span><span class="p">)</span>
    <span class="n">ordered_project_queue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">order_projects</span><span class="p">(</span><span class="n">project_list</span><span class="p">)</span>

    <span class="k">while</span> <span class="n">ordered_project_queue</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_apply_project</span><span class="p">(</span><span class="n">ordered_project_queue</span><span class="o">.</span><span class="n">popleft</span><span class="p">())</span>

    <span class="c1"># Set so that when called again it will retrigger queueing from planned projects.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_ordered_projects</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.scenario.Scenario.create_scenario" class="doc doc-heading">
<code class="highlight language-python"><span class="n">create_scenario</span><span class="p">(</span><span class="n">base_scenario</span><span class="o">=</span><span class="p">{},</span> <span class="n">project_card_list</span><span class="o">=</span><span class="p">[],</span> <span class="n">project_card_file_list</span><span class="o">=</span><span class="p">[],</span> <span class="n">card_search_dir</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">glob_search</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">filter_tags</span><span class="o">=</span><span class="p">[],</span> <span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#network_wrangler.scenario.Scenario.create_scenario" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Creates scenario from a base scenario and adds project cards.</p>
<p>Project cards can be added using any/all of the following methods:
1. List of ProjectCard instances
2. List of ProjectCard files
3. Directory and optional glob search to find project card files in</p>
<p>Checks that a project of same name is not already in scenario.
If selected, will validate ProjectCard before adding.
If provided, will only add ProjectCard if it matches at least one filter_tags.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>base_scenario</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[<a class="autorefs autorefs-internal" title="network_wrangler.scenario.Scenario" href="#network_wrangler.Scenario">Scenario</a>, dict]</code>
          </td>
          <td><p>base Scenario scenario instances of dictionary of attributes.</p></td>
          <td>
                <code>{}</code>
          </td>
        </tr>
        <tr>
          <td><code>project_card_list</code></td>
          <td>
          </td>
          <td><p>List of ProjectCard instances to create Scenario from.</p></td>
          <td>
                <code>[]</code>
          </td>
        </tr>
        <tr>
          <td><code>project_card_file_list</code></td>
          <td>
          </td>
          <td><p>List of ProjectCard files to create Scenario from.</p></td>
          <td>
                <code>[]</code>
          </td>
        </tr>
        <tr>
          <td><code>card_search_dir</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Directory to search for project card files in.</p></td>
          <td>
                <code>&#39;&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>glob_search</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Optional glob search parameters for card_search_dir.</p></td>
          <td>
                <code>&#39;&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>filter_tags</code></td>
          <td>
                <code><span title="typing.Collection">Collection</span>[str]</code>
          </td>
          <td><p>If used, will only add the project card if
its tags match one or more of these filter_tags. Defaults to []
which means no tag-filtering will occur.</p></td>
          <td>
                <code>[]</code>
          </td>
        </tr>
        <tr>
          <td><code>validate</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>If True, will validate the projectcard before
being adding it to the scenario. Defaults to True.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/scenario.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">create_scenario</span><span class="p">(</span>
    <span class="n">base_scenario</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;Scenario&quot;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">{},</span>
    <span class="n">project_card_list</span><span class="o">=</span><span class="p">[],</span>
    <span class="n">project_card_file_list</span><span class="o">=</span><span class="p">[],</span>
    <span class="n">card_search_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">glob_search</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">filter_tags</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
    <span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Scenario</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates scenario from a base scenario and adds project cards.</span>

<span class="sd">    Project cards can be added using any/all of the following methods:</span>
<span class="sd">    1. List of ProjectCard instances</span>
<span class="sd">    2. List of ProjectCard files</span>
<span class="sd">    3. Directory and optional glob search to find project card files in</span>

<span class="sd">    Checks that a project of same name is not already in scenario.</span>
<span class="sd">    If selected, will validate ProjectCard before adding.</span>
<span class="sd">    If provided, will only add ProjectCard if it matches at least one filter_tags.</span>

<span class="sd">    args:</span>
<span class="sd">        base_scenario: base Scenario scenario instances of dictionary of attributes.</span>
<span class="sd">        project_card_list: List of ProjectCard instances to create Scenario from.</span>
<span class="sd">        project_card_file_list: List of ProjectCard files to create Scenario from.</span>
<span class="sd">        card_search_dir (str): Directory to search for project card files in.</span>
<span class="sd">        glob_search (str, optional): Optional glob search parameters for card_search_dir.</span>
<span class="sd">        filter_tags (Collection[str], optional): If used, will only add the project card if</span>
<span class="sd">            its tags match one or more of these filter_tags. Defaults to []</span>
<span class="sd">            which means no tag-filtering will occur.</span>
<span class="sd">        validate (bool, optional): If True, will validate the projectcard before</span>
<span class="sd">            being adding it to the scenario. Defaults to True.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">scenario</span> <span class="o">=</span> <span class="n">Scenario</span><span class="p">(</span><span class="n">base_scenario</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">project_card_list</span><span class="p">:</span>
        <span class="n">scenario</span><span class="o">.</span><span class="n">add_project_cards</span><span class="p">(</span>
            <span class="n">project_card_list</span><span class="p">,</span> <span class="n">filter_tags</span><span class="o">=</span><span class="n">filter_tags</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="n">validate</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">project_card_file_list</span><span class="p">:</span>
        <span class="n">scenario</span><span class="o">.</span><span class="n">add_projects_from_files</span><span class="p">(</span>
            <span class="n">project_card_file_list</span><span class="p">,</span> <span class="n">filter_tags</span><span class="o">=</span><span class="n">filter_tags</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="n">validate</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">card_search_dir</span><span class="p">:</span>
        <span class="n">scenario</span><span class="o">.</span><span class="n">add_projects_from_directory</span><span class="p">(</span>
            <span class="n">card_search_dir</span><span class="p">,</span>
            <span class="n">glob_search</span><span class="o">=</span><span class="n">glob_search</span><span class="p">,</span>
            <span class="n">filter_tags</span><span class="o">=</span><span class="n">filter_tags</span><span class="p">,</span>
            <span class="n">validate</span><span class="o">=</span><span class="n">validate</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">scenario</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.scenario.Scenario.order_projects" class="doc doc-heading">
<code class="highlight language-python"><span class="n">order_projects</span><span class="p">(</span><span class="n">project_list</span><span class="p">)</span></code>

<a href="#network_wrangler.scenario.Scenario.order_projects" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Orders a list of projects based on moving up pre-requisites into a deque.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>project_list</code></td>
          <td>
                <code><span title="typing.Collection">Collection</span>[str]</code>
          </td>
          <td><p>list of projects to order</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/scenario.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">order_projects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_list</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">deque</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Orders a list of projects based on moving up pre-requisites into a deque.</span>

<span class="sd">    args:</span>
<span class="sd">        project_list: list of projects to order</span>

<span class="sd">    Returns: deque for applying projects.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">project_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">project_list</span><span class="p">]</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_projects_have_project_cards</span><span class="p">(</span><span class="n">project_list</span><span class="p">)</span>

    <span class="c1"># build prereq (adjacency) list for topological sort</span>
    <span class="n">adjacency_list</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">visited_list</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">project</span> <span class="ow">in</span> <span class="n">project_list</span><span class="p">:</span>
        <span class="n">visited_list</span><span class="p">[</span><span class="n">project</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">prerequisites</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">project</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="k">for</span> <span class="n">prereq</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prerequisites</span><span class="p">[</span><span class="n">project</span><span class="p">]:</span>
            <span class="c1"># this will always be true, else would have been flagged in missing \</span>
            <span class="c1"># prerequsite check, but just in case</span>
            <span class="k">if</span> <span class="n">prereq</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">project_list</span><span class="p">:</span>
                <span class="n">adjacency_list</span><span class="p">[</span><span class="n">prereq</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="p">[</span><span class="n">project</span><span class="p">]</span>

    <span class="c1"># sorted_project_names is topological sorted project card names (based on prerequsiite)</span>
    <span class="n">_ordered_projects</span> <span class="o">=</span> <span class="n">topological_sort</span><span class="p">(</span>
        <span class="n">adjacency_list</span><span class="o">=</span><span class="n">adjacency_list</span><span class="p">,</span> <span class="n">visited_list</span><span class="o">=</span><span class="n">visited_list</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">_ordered_projects</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">project_list</span><span class="p">):</span>
        <span class="n">_missing</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">project_list</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">_ordered_projects</span><span class="p">))</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Project sort resulted in missing projects:</span><span class="si">{</span><span class="n">_missing</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">project_deque</span> <span class="o">=</span> <span class="n">deque</span><span class="p">(</span><span class="n">_ordered_projects</span><span class="p">)</span>

    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ordered Projects:</span><span class="se">\n</span><span class="si">{</span><span class="n">project_deque</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">project_deque</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.scenario.Scenario.summarize" class="doc doc-heading">
<code class="highlight language-python"><span class="n">summarize</span><span class="p">(</span><span class="n">project_detail</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">outfile</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">)</span></code>

<a href="#network_wrangler.scenario.Scenario.summarize" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>A high level summary of the created scenario.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>project_detail</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>If True (default), will write out project card summaries.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>outfile</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>If specified, will write scenario summary to text file.</p></td>
          <td>
                <code>&#39;&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>mode</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Outfile open mode. &lsquo;a&rsquo; to append &lsquo;w&rsquo; to overwrite.</p></td>
          <td>
                <code>&#39;a&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>str</code>
          </td>
          <td><p>string of summary</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/scenario.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">summarize</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">project_detail</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">outfile</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;a&quot;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A high level summary of the created scenario.</span>

<span class="sd">    Args:</span>
<span class="sd">        project_detail: If True (default), will write out project card summaries.</span>
<span class="sd">        outfile: If specified, will write scenario summary to text file.</span>
<span class="sd">        mode: Outfile open mode. &#39;a&#39; to append &#39;w&#39; to overwrite.</span>

<span class="sd">    Returns:</span>
<span class="sd">        string of summary</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Summarizing Scenario </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">report_str</span> <span class="o">=</span> <span class="s2">&quot;------------------------------</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">report_str</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;Scenario created on </span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>

    <span class="n">report_str</span> <span class="o">+=</span> <span class="s2">&quot;Base Scenario:</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">report_str</span> <span class="o">+=</span> <span class="s2">&quot;--Road Network:</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">report_str</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;----Link File: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_scenario</span><span class="p">[</span><span class="s1">&#39;road_net&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">link_file</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">report_str</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;----Node File: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_scenario</span><span class="p">[</span><span class="s1">&#39;road_net&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">node_file</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">report_str</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;----Shape File: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_scenario</span><span class="p">[</span><span class="s1">&#39;road_net&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape_file</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">report_str</span> <span class="o">+=</span> <span class="s2">&quot;--Transit Network:</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">report_str</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;----Feed Path: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_scenario</span><span class="p">[</span><span class="s1">&#39;transit_net&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">feed_path</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>

    <span class="n">report_str</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Project Cards:</span><span class="se">\n</span><span class="s2"> -&quot;</span>
    <span class="n">report_str</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">pc</span><span class="o">.</span><span class="n">file</span> <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">pc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_cards</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>

    <span class="n">report_str</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Applied Projects:</span><span class="se">\n</span><span class="s2">-&quot;</span>
    <span class="n">report_str</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">applied_projects</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">project_detail</span><span class="p">:</span>
        <span class="n">report_str</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">---Project Card Details---</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_cards</span><span class="p">:</span>
            <span class="n">report_str</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">pprint</span><span class="o">.</span><span class="n">pformat</span><span class="p">(</span>
                    <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">project_cards</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="vm">__dict__</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">applied_projects</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="p">)</span>

    <span class="k">if</span> <span class="n">outfile</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">report_str</span><span class="p">)</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Wrote Scenario Report to: </span><span class="si">{</span><span class="n">outfile</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">report_str</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.scenario.Scenario.write" class="doc doc-heading">
<code class="highlight language-python"><span class="n">write</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span></code>

<a href="#network_wrangler.scenario.Scenario.write" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p><em>summary</em></p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>path</code></td>
          <td>
                <code><span title="typing.Union">Union</span>(<span title="pathlib.Path">Path</span>, str)</code>
          </td>
          <td><p>Path to write scenario networks and scenario summary to.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>name</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Name to use.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/scenario.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Union</span><span class="p">(</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;_summary_</span>

<span class="sd">    Args:</span>
<span class="sd">        path: Path to write scenario networks and scenario summary to.</span>
<span class="sd">        name: Name to use.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">road_net</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">transit_net</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">summarize</span><span class="p">(</span><span class="n">outfile</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="network_wrangler.RoadwayNetwork" class="doc doc-heading">
        <code>network_wrangler.RoadwayNetwork</code>


<a href="#network_wrangler.RoadwayNetwork" class="headerlink" title="Permanent link"> ¶</a></h3>


  <div class="doc doc-contents first">
      <p class="doc doc-class-bases">
        Bases: <code>object</code></p>

  
      <p>Representation of a Roadway Network.</p>
<p>Typical usage example:</p>
<div class="language-py highlight"><pre><span></span><code><span class="n">net</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">read</span><span class="p">(</span>
    <span class="n">link_file</span><span class="o">=</span><span class="n">MY_LINK_FILE</span><span class="p">,</span>
    <span class="n">node_file</span><span class="o">=</span><span class="n">MY_NODE_FILE</span><span class="p">,</span>
    <span class="n">shape_file</span><span class="o">=</span><span class="n">MY_SHAPE_FILE</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">my_selection</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;link&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;I 35E&quot;</span><span class="p">]}],</span>
    <span class="s2">&quot;A&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;osm_node_id&quot;</span><span class="p">:</span> <span class="s2">&quot;961117623&quot;</span><span class="p">},</span>  <span class="c1"># start searching for segments at A</span>
    <span class="s2">&quot;B&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;osm_node_id&quot;</span><span class="p">:</span> <span class="s2">&quot;2564047368&quot;</span><span class="p">},</span>
<span class="p">}</span>
<span class="n">net</span><span class="o">.</span><span class="n">select_roadway_features</span><span class="p">(</span><span class="n">my_selection</span><span class="p">)</span>

<span class="n">my_change</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s1">&#39;property&#39;</span><span class="p">:</span> <span class="s1">&#39;lanes&#39;</span><span class="p">,</span>
        <span class="s1">&#39;existing&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s1">&#39;set&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s1">&#39;property&#39;</span><span class="p">:</span> <span class="s1">&#39;drive_access&#39;</span><span class="p">,</span>
        <span class="s1">&#39;set&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">]</span>

<span class="n">my_net</span><span class="o">.</span><span class="n">apply_roadway_feature_change</span><span class="p">(</span>
    <span class="n">my_net</span><span class="o">.</span><span class="n">select_roadway_features</span><span class="p">(</span><span class="n">my_selection</span><span class="p">),</span>
    <span class="n">my_change</span>
<span class="p">)</span>

    <span class="n">net</span> <span class="o">=</span> <span class="n">create_managed_lane_network</span><span class="p">(</span><span class="n">net</span><span class="p">)</span>
    <span class="n">net</span><span class="o">.</span><span class="n">is_network_connected</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;drive&quot;</span><span class="p">,</span> <span class="n">nodes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">m_nodes_df</span><span class="p">,</span> <span class="n">links</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">m_links_df</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">disconnected_nodes</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">assess_connectivity</span><span class="p">(</span>
        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;walk&quot;</span><span class="p">,</span>
        <span class="n">ignore_end_nodes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">nodes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">m_nodes_df</span><span class="p">,</span>
        <span class="n">links</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">m_links_df</span>
    <span class="p">)</span>
    <span class="n">net</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">my_out_prefix</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">my_dir</span><span class="p">,</span> <span class="n">for_model</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</code></pre></div>

  <p><strong>Attributes:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>nodes_df</code></td>
          <td>
                <code><span title="geopandas.geodataframe.GeoDataFrame">GeoDataFrame</span></code>
          </td>
          <td><p>node data</p></td>
        </tr>
        <tr>
          <td><code>links_df</code></td>
          <td>
                <code><span title="geopandas.geodataframe.GeoDataFrame">GeoDataFrame</span></code>
          </td>
          <td><p>link data, including start and end
nodes and associated shape</p></td>
        </tr>
        <tr>
          <td><code>shapes_df</code></td>
          <td>
                <code><span title="geopandas.geodataframe.GeoDataFrame">GeoDataFrame</span></code>
          </td>
          <td><p>detailed shape data</p></td>
        </tr>
        <tr>
          <td><code>selections</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>dictionary storing selections in case they are made repeatedly</p></td>
        </tr>
        <tr>
          <td><code>BOOL_PROPERTIES</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>list of properties which should be coerced to booleans</p></td>
        </tr>
        <tr>
          <td><code>STR_PROPERTIES</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>list of properties which should be coerced to strings</p></td>
        </tr>
        <tr>
          <td><code>INT_PROPERTIES</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>list of properties which should be coerced to integers</p></td>
        </tr>
        <tr>
          <td><code>CRS</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>coordinate reference system in PROJ4 format.
See https://proj.org/operations/projections/index.html#</p></td>
        </tr>
        <tr>
          <td><code>ESPG</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>integer representing coordinate system https://epsg.io/</p></td>
        </tr>
        <tr>
          <td><code>NODE_FOREIGN_KEY_TO_LINK</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>column in <code>nodes_df</code> associated with the
LINK_FOREIGN_KEY</p></td>
        </tr>
        <tr>
          <td><code>LINK_FOREIGN_KEY_TO_NODE</code></td>
          <td>
                <code>list(str</code>
          </td>
          <td><p>list of columns in <code>links_df</code> that
represent the NODE_FOREIGN_KEY</p></td>
        </tr>
        <tr>
          <td><code>UNIQUE_LINK_KEY</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>column that is a unique key for links</p></td>
        </tr>
        <tr>
          <td><code>UNIQUE_NODE_KEY</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>column that is a unique key for nodes</p></td>
        </tr>
        <tr>
          <td><code>UNIQUE_SHAPE_KEY</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>column that is a unique shape key</p></td>
        </tr>
        <tr>
          <td><code>UNIQUE_MODEL_LINK_IDENTIFIERS</code></td>
          <td>
                <code>list(str</code>
          </td>
          <td><p>list of all unique
identifiers for links, including the UNIQUE_LINK_KEY</p></td>
        </tr>
        <tr>
          <td><code>EXPLICIT_LINK_IDENTIFIERS</code></td>
          <td>
                <code>list(str</code>
          </td>
          <td><p>list of identifiers which are explicit enough
to use in project selection by themselves. Includes UNIQUE_MODEL_LINK_IDENFIERS as
well as some identifiers which may be split across model links such as osm_link_id.</p></td>
        </tr>
        <tr>
          <td><code>UNIQUE_NODE_IDENTIFIERS</code></td>
          <td>
                <code>list(str</code>
          </td>
          <td><p>list of all unique identifiers
for nodes, including the UNIQUE_NODE_KEY</p></td>
        </tr>
        <tr>
          <td><code>SEARCH_BREADTH</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>initial number of links from name-based
selection that are traveresed before trying another shortest
path when searching for paths between A and B node</p></td>
        </tr>
        <tr>
          <td><code>MAX_SEARCH_BREADTH</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>maximum number of links traversed between
links that match the searched name when searching for paths
between A and B node</p></td>
        </tr>
        <tr>
          <td><code>SP_WEIGHT_FACTOR</code></td>
          <td>
                <code>Union(int, float</code>
          </td>
          <td><p>penalty assigned for each
degree of distance between a link and a link with the searched-for
name when searching for paths between A and B node</p></td>
        </tr>
        <tr>
          <td><code>MANAGED_LANES_TO_NODE_ID_SCALAR</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>scalar value added to
the general purpose lanes&rsquo; <code>model_node_id</code> when creating
an associated node for a parallel managed lane</p></td>
        </tr>
        <tr>
          <td><code>MANAGED_LANES_TO_LINK_ID_SCALAR</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>scalar value added to
the general purpose lanes&rsquo; <code>model_link_id</code> when creating
an associated link for a parallel managed lane</p></td>
        </tr>
        <tr>
          <td><code>MANAGED_LANES_REQUIRED_ATTRIBUTES</code></td>
          <td>
                <code>list(str</code>
          </td>
          <td><p>list of attributes
that must be provided in managed lanes</p></td>
        </tr>
        <tr>
          <td><code>KEEP_SAME_ATTRIBUTES_ML_AND_GP</code></td>
          <td>
                <code>list(str</code>
          </td>
          <td><p>list of attributes
to copy from a general purpose lane to managed lane</p></td>
        </tr>
    </tbody>
  </table>


        <details class="quote">
          <summary>Source code in <code>network_wrangler/roadwaynetwork.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  54</span>
<span class="normal">  55</span>
<span class="normal">  56</span>
<span class="normal">  57</span>
<span class="normal">  58</span>
<span class="normal">  59</span>
<span class="normal">  60</span>
<span class="normal">  61</span>
<span class="normal">  62</span>
<span class="normal">  63</span>
<span class="normal">  64</span>
<span class="normal">  65</span>
<span class="normal">  66</span>
<span class="normal">  67</span>
<span class="normal">  68</span>
<span class="normal">  69</span>
<span class="normal">  70</span>
<span class="normal">  71</span>
<span class="normal">  72</span>
<span class="normal">  73</span>
<span class="normal">  74</span>
<span class="normal">  75</span>
<span class="normal">  76</span>
<span class="normal">  77</span>
<span class="normal">  78</span>
<span class="normal">  79</span>
<span class="normal">  80</span>
<span class="normal">  81</span>
<span class="normal">  82</span>
<span class="normal">  83</span>
<span class="normal">  84</span>
<span class="normal">  85</span>
<span class="normal">  86</span>
<span class="normal">  87</span>
<span class="normal">  88</span>
<span class="normal">  89</span>
<span class="normal">  90</span>
<span class="normal">  91</span>
<span class="normal">  92</span>
<span class="normal">  93</span>
<span class="normal">  94</span>
<span class="normal">  95</span>
<span class="normal">  96</span>
<span class="normal">  97</span>
<span class="normal">  98</span>
<span class="normal">  99</span>
<span class="normal"> 100</span>
<span class="normal"> 101</span>
<span class="normal"> 102</span>
<span class="normal"> 103</span>
<span class="normal"> 104</span>
<span class="normal"> 105</span>
<span class="normal"> 106</span>
<span class="normal"> 107</span>
<span class="normal"> 108</span>
<span class="normal"> 109</span>
<span class="normal"> 110</span>
<span class="normal"> 111</span>
<span class="normal"> 112</span>
<span class="normal"> 113</span>
<span class="normal"> 114</span>
<span class="normal"> 115</span>
<span class="normal"> 116</span>
<span class="normal"> 117</span>
<span class="normal"> 118</span>
<span class="normal"> 119</span>
<span class="normal"> 120</span>
<span class="normal"> 121</span>
<span class="normal"> 122</span>
<span class="normal"> 123</span>
<span class="normal"> 124</span>
<span class="normal"> 125</span>
<span class="normal"> 126</span>
<span class="normal"> 127</span>
<span class="normal"> 128</span>
<span class="normal"> 129</span>
<span class="normal"> 130</span>
<span class="normal"> 131</span>
<span class="normal"> 132</span>
<span class="normal"> 133</span>
<span class="normal"> 134</span>
<span class="normal"> 135</span>
<span class="normal"> 136</span>
<span class="normal"> 137</span>
<span class="normal"> 138</span>
<span class="normal"> 139</span>
<span class="normal"> 140</span>
<span class="normal"> 141</span>
<span class="normal"> 142</span>
<span class="normal"> 143</span>
<span class="normal"> 144</span>
<span class="normal"> 145</span>
<span class="normal"> 146</span>
<span class="normal"> 147</span>
<span class="normal"> 148</span>
<span class="normal"> 149</span>
<span class="normal"> 150</span>
<span class="normal"> 151</span>
<span class="normal"> 152</span>
<span class="normal"> 153</span>
<span class="normal"> 154</span>
<span class="normal"> 155</span>
<span class="normal"> 156</span>
<span class="normal"> 157</span>
<span class="normal"> 158</span>
<span class="normal"> 159</span>
<span class="normal"> 160</span>
<span class="normal"> 161</span>
<span class="normal"> 162</span>
<span class="normal"> 163</span>
<span class="normal"> 164</span>
<span class="normal"> 165</span>
<span class="normal"> 166</span>
<span class="normal"> 167</span>
<span class="normal"> 168</span>
<span class="normal"> 169</span>
<span class="normal"> 170</span>
<span class="normal"> 171</span>
<span class="normal"> 172</span>
<span class="normal"> 173</span>
<span class="normal"> 174</span>
<span class="normal"> 175</span>
<span class="normal"> 176</span>
<span class="normal"> 177</span>
<span class="normal"> 178</span>
<span class="normal"> 179</span>
<span class="normal"> 180</span>
<span class="normal"> 181</span>
<span class="normal"> 182</span>
<span class="normal"> 183</span>
<span class="normal"> 184</span>
<span class="normal"> 185</span>
<span class="normal"> 186</span>
<span class="normal"> 187</span>
<span class="normal"> 188</span>
<span class="normal"> 189</span>
<span class="normal"> 190</span>
<span class="normal"> 191</span>
<span class="normal"> 192</span>
<span class="normal"> 193</span>
<span class="normal"> 194</span>
<span class="normal"> 195</span>
<span class="normal"> 196</span>
<span class="normal"> 197</span>
<span class="normal"> 198</span>
<span class="normal"> 199</span>
<span class="normal"> 200</span>
<span class="normal"> 201</span>
<span class="normal"> 202</span>
<span class="normal"> 203</span>
<span class="normal"> 204</span>
<span class="normal"> 205</span>
<span class="normal"> 206</span>
<span class="normal"> 207</span>
<span class="normal"> 208</span>
<span class="normal"> 209</span>
<span class="normal"> 210</span>
<span class="normal"> 211</span>
<span class="normal"> 212</span>
<span class="normal"> 213</span>
<span class="normal"> 214</span>
<span class="normal"> 215</span>
<span class="normal"> 216</span>
<span class="normal"> 217</span>
<span class="normal"> 218</span>
<span class="normal"> 219</span>
<span class="normal"> 220</span>
<span class="normal"> 221</span>
<span class="normal"> 222</span>
<span class="normal"> 223</span>
<span class="normal"> 224</span>
<span class="normal"> 225</span>
<span class="normal"> 226</span>
<span class="normal"> 227</span>
<span class="normal"> 228</span>
<span class="normal"> 229</span>
<span class="normal"> 230</span>
<span class="normal"> 231</span>
<span class="normal"> 232</span>
<span class="normal"> 233</span>
<span class="normal"> 234</span>
<span class="normal"> 235</span>
<span class="normal"> 236</span>
<span class="normal"> 237</span>
<span class="normal"> 238</span>
<span class="normal"> 239</span>
<span class="normal"> 240</span>
<span class="normal"> 241</span>
<span class="normal"> 242</span>
<span class="normal"> 243</span>
<span class="normal"> 244</span>
<span class="normal"> 245</span>
<span class="normal"> 246</span>
<span class="normal"> 247</span>
<span class="normal"> 248</span>
<span class="normal"> 249</span>
<span class="normal"> 250</span>
<span class="normal"> 251</span>
<span class="normal"> 252</span>
<span class="normal"> 253</span>
<span class="normal"> 254</span>
<span class="normal"> 255</span>
<span class="normal"> 256</span>
<span class="normal"> 257</span>
<span class="normal"> 258</span>
<span class="normal"> 259</span>
<span class="normal"> 260</span>
<span class="normal"> 261</span>
<span class="normal"> 262</span>
<span class="normal"> 263</span>
<span class="normal"> 264</span>
<span class="normal"> 265</span>
<span class="normal"> 266</span>
<span class="normal"> 267</span>
<span class="normal"> 268</span>
<span class="normal"> 269</span>
<span class="normal"> 270</span>
<span class="normal"> 271</span>
<span class="normal"> 272</span>
<span class="normal"> 273</span>
<span class="normal"> 274</span>
<span class="normal"> 275</span>
<span class="normal"> 276</span>
<span class="normal"> 277</span>
<span class="normal"> 278</span>
<span class="normal"> 279</span>
<span class="normal"> 280</span>
<span class="normal"> 281</span>
<span class="normal"> 282</span>
<span class="normal"> 283</span>
<span class="normal"> 284</span>
<span class="normal"> 285</span>
<span class="normal"> 286</span>
<span class="normal"> 287</span>
<span class="normal"> 288</span>
<span class="normal"> 289</span>
<span class="normal"> 290</span>
<span class="normal"> 291</span>
<span class="normal"> 292</span>
<span class="normal"> 293</span>
<span class="normal"> 294</span>
<span class="normal"> 295</span>
<span class="normal"> 296</span>
<span class="normal"> 297</span>
<span class="normal"> 298</span>
<span class="normal"> 299</span>
<span class="normal"> 300</span>
<span class="normal"> 301</span>
<span class="normal"> 302</span>
<span class="normal"> 303</span>
<span class="normal"> 304</span>
<span class="normal"> 305</span>
<span class="normal"> 306</span>
<span class="normal"> 307</span>
<span class="normal"> 308</span>
<span class="normal"> 309</span>
<span class="normal"> 310</span>
<span class="normal"> 311</span>
<span class="normal"> 312</span>
<span class="normal"> 313</span>
<span class="normal"> 314</span>
<span class="normal"> 315</span>
<span class="normal"> 316</span>
<span class="normal"> 317</span>
<span class="normal"> 318</span>
<span class="normal"> 319</span>
<span class="normal"> 320</span>
<span class="normal"> 321</span>
<span class="normal"> 322</span>
<span class="normal"> 323</span>
<span class="normal"> 324</span>
<span class="normal"> 325</span>
<span class="normal"> 326</span>
<span class="normal"> 327</span>
<span class="normal"> 328</span>
<span class="normal"> 329</span>
<span class="normal"> 330</span>
<span class="normal"> 331</span>
<span class="normal"> 332</span>
<span class="normal"> 333</span>
<span class="normal"> 334</span>
<span class="normal"> 335</span>
<span class="normal"> 336</span>
<span class="normal"> 337</span>
<span class="normal"> 338</span>
<span class="normal"> 339</span>
<span class="normal"> 340</span>
<span class="normal"> 341</span>
<span class="normal"> 342</span>
<span class="normal"> 343</span>
<span class="normal"> 344</span>
<span class="normal"> 345</span>
<span class="normal"> 346</span>
<span class="normal"> 347</span>
<span class="normal"> 348</span>
<span class="normal"> 349</span>
<span class="normal"> 350</span>
<span class="normal"> 351</span>
<span class="normal"> 352</span>
<span class="normal"> 353</span>
<span class="normal"> 354</span>
<span class="normal"> 355</span>
<span class="normal"> 356</span>
<span class="normal"> 357</span>
<span class="normal"> 358</span>
<span class="normal"> 359</span>
<span class="normal"> 360</span>
<span class="normal"> 361</span>
<span class="normal"> 362</span>
<span class="normal"> 363</span>
<span class="normal"> 364</span>
<span class="normal"> 365</span>
<span class="normal"> 366</span>
<span class="normal"> 367</span>
<span class="normal"> 368</span>
<span class="normal"> 369</span>
<span class="normal"> 370</span>
<span class="normal"> 371</span>
<span class="normal"> 372</span>
<span class="normal"> 373</span>
<span class="normal"> 374</span>
<span class="normal"> 375</span>
<span class="normal"> 376</span>
<span class="normal"> 377</span>
<span class="normal"> 378</span>
<span class="normal"> 379</span>
<span class="normal"> 380</span>
<span class="normal"> 381</span>
<span class="normal"> 382</span>
<span class="normal"> 383</span>
<span class="normal"> 384</span>
<span class="normal"> 385</span>
<span class="normal"> 386</span>
<span class="normal"> 387</span>
<span class="normal"> 388</span>
<span class="normal"> 389</span>
<span class="normal"> 390</span>
<span class="normal"> 391</span>
<span class="normal"> 392</span>
<span class="normal"> 393</span>
<span class="normal"> 394</span>
<span class="normal"> 395</span>
<span class="normal"> 396</span>
<span class="normal"> 397</span>
<span class="normal"> 398</span>
<span class="normal"> 399</span>
<span class="normal"> 400</span>
<span class="normal"> 401</span>
<span class="normal"> 402</span>
<span class="normal"> 403</span>
<span class="normal"> 404</span>
<span class="normal"> 405</span>
<span class="normal"> 406</span>
<span class="normal"> 407</span>
<span class="normal"> 408</span>
<span class="normal"> 409</span>
<span class="normal"> 410</span>
<span class="normal"> 411</span>
<span class="normal"> 412</span>
<span class="normal"> 413</span>
<span class="normal"> 414</span>
<span class="normal"> 415</span>
<span class="normal"> 416</span>
<span class="normal"> 417</span>
<span class="normal"> 418</span>
<span class="normal"> 419</span>
<span class="normal"> 420</span>
<span class="normal"> 421</span>
<span class="normal"> 422</span>
<span class="normal"> 423</span>
<span class="normal"> 424</span>
<span class="normal"> 425</span>
<span class="normal"> 426</span>
<span class="normal"> 427</span>
<span class="normal"> 428</span>
<span class="normal"> 429</span>
<span class="normal"> 430</span>
<span class="normal"> 431</span>
<span class="normal"> 432</span>
<span class="normal"> 433</span>
<span class="normal"> 434</span>
<span class="normal"> 435</span>
<span class="normal"> 436</span>
<span class="normal"> 437</span>
<span class="normal"> 438</span>
<span class="normal"> 439</span>
<span class="normal"> 440</span>
<span class="normal"> 441</span>
<span class="normal"> 442</span>
<span class="normal"> 443</span>
<span class="normal"> 444</span>
<span class="normal"> 445</span>
<span class="normal"> 446</span>
<span class="normal"> 447</span>
<span class="normal"> 448</span>
<span class="normal"> 449</span>
<span class="normal"> 450</span>
<span class="normal"> 451</span>
<span class="normal"> 452</span>
<span class="normal"> 453</span>
<span class="normal"> 454</span>
<span class="normal"> 455</span>
<span class="normal"> 456</span>
<span class="normal"> 457</span>
<span class="normal"> 458</span>
<span class="normal"> 459</span>
<span class="normal"> 460</span>
<span class="normal"> 461</span>
<span class="normal"> 462</span>
<span class="normal"> 463</span>
<span class="normal"> 464</span>
<span class="normal"> 465</span>
<span class="normal"> 466</span>
<span class="normal"> 467</span>
<span class="normal"> 468</span>
<span class="normal"> 469</span>
<span class="normal"> 470</span>
<span class="normal"> 471</span>
<span class="normal"> 472</span>
<span class="normal"> 473</span>
<span class="normal"> 474</span>
<span class="normal"> 475</span>
<span class="normal"> 476</span>
<span class="normal"> 477</span>
<span class="normal"> 478</span>
<span class="normal"> 479</span>
<span class="normal"> 480</span>
<span class="normal"> 481</span>
<span class="normal"> 482</span>
<span class="normal"> 483</span>
<span class="normal"> 484</span>
<span class="normal"> 485</span>
<span class="normal"> 486</span>
<span class="normal"> 487</span>
<span class="normal"> 488</span>
<span class="normal"> 489</span>
<span class="normal"> 490</span>
<span class="normal"> 491</span>
<span class="normal"> 492</span>
<span class="normal"> 493</span>
<span class="normal"> 494</span>
<span class="normal"> 495</span>
<span class="normal"> 496</span>
<span class="normal"> 497</span>
<span class="normal"> 498</span>
<span class="normal"> 499</span>
<span class="normal"> 500</span>
<span class="normal"> 501</span>
<span class="normal"> 502</span>
<span class="normal"> 503</span>
<span class="normal"> 504</span>
<span class="normal"> 505</span>
<span class="normal"> 506</span>
<span class="normal"> 507</span>
<span class="normal"> 508</span>
<span class="normal"> 509</span>
<span class="normal"> 510</span>
<span class="normal"> 511</span>
<span class="normal"> 512</span>
<span class="normal"> 513</span>
<span class="normal"> 514</span>
<span class="normal"> 515</span>
<span class="normal"> 516</span>
<span class="normal"> 517</span>
<span class="normal"> 518</span>
<span class="normal"> 519</span>
<span class="normal"> 520</span>
<span class="normal"> 521</span>
<span class="normal"> 522</span>
<span class="normal"> 523</span>
<span class="normal"> 524</span>
<span class="normal"> 525</span>
<span class="normal"> 526</span>
<span class="normal"> 527</span>
<span class="normal"> 528</span>
<span class="normal"> 529</span>
<span class="normal"> 530</span>
<span class="normal"> 531</span>
<span class="normal"> 532</span>
<span class="normal"> 533</span>
<span class="normal"> 534</span>
<span class="normal"> 535</span>
<span class="normal"> 536</span>
<span class="normal"> 537</span>
<span class="normal"> 538</span>
<span class="normal"> 539</span>
<span class="normal"> 540</span>
<span class="normal"> 541</span>
<span class="normal"> 542</span>
<span class="normal"> 543</span>
<span class="normal"> 544</span>
<span class="normal"> 545</span>
<span class="normal"> 546</span>
<span class="normal"> 547</span>
<span class="normal"> 548</span>
<span class="normal"> 549</span>
<span class="normal"> 550</span>
<span class="normal"> 551</span>
<span class="normal"> 552</span>
<span class="normal"> 553</span>
<span class="normal"> 554</span>
<span class="normal"> 555</span>
<span class="normal"> 556</span>
<span class="normal"> 557</span>
<span class="normal"> 558</span>
<span class="normal"> 559</span>
<span class="normal"> 560</span>
<span class="normal"> 561</span>
<span class="normal"> 562</span>
<span class="normal"> 563</span>
<span class="normal"> 564</span>
<span class="normal"> 565</span>
<span class="normal"> 566</span>
<span class="normal"> 567</span>
<span class="normal"> 568</span>
<span class="normal"> 569</span>
<span class="normal"> 570</span>
<span class="normal"> 571</span>
<span class="normal"> 572</span>
<span class="normal"> 573</span>
<span class="normal"> 574</span>
<span class="normal"> 575</span>
<span class="normal"> 576</span>
<span class="normal"> 577</span>
<span class="normal"> 578</span>
<span class="normal"> 579</span>
<span class="normal"> 580</span>
<span class="normal"> 581</span>
<span class="normal"> 582</span>
<span class="normal"> 583</span>
<span class="normal"> 584</span>
<span class="normal"> 585</span>
<span class="normal"> 586</span>
<span class="normal"> 587</span>
<span class="normal"> 588</span>
<span class="normal"> 589</span>
<span class="normal"> 590</span>
<span class="normal"> 591</span>
<span class="normal"> 592</span>
<span class="normal"> 593</span>
<span class="normal"> 594</span>
<span class="normal"> 595</span>
<span class="normal"> 596</span>
<span class="normal"> 597</span>
<span class="normal"> 598</span>
<span class="normal"> 599</span>
<span class="normal"> 600</span>
<span class="normal"> 601</span>
<span class="normal"> 602</span>
<span class="normal"> 603</span>
<span class="normal"> 604</span>
<span class="normal"> 605</span>
<span class="normal"> 606</span>
<span class="normal"> 607</span>
<span class="normal"> 608</span>
<span class="normal"> 609</span>
<span class="normal"> 610</span>
<span class="normal"> 611</span>
<span class="normal"> 612</span>
<span class="normal"> 613</span>
<span class="normal"> 614</span>
<span class="normal"> 615</span>
<span class="normal"> 616</span>
<span class="normal"> 617</span>
<span class="normal"> 618</span>
<span class="normal"> 619</span>
<span class="normal"> 620</span>
<span class="normal"> 621</span>
<span class="normal"> 622</span>
<span class="normal"> 623</span>
<span class="normal"> 624</span>
<span class="normal"> 625</span>
<span class="normal"> 626</span>
<span class="normal"> 627</span>
<span class="normal"> 628</span>
<span class="normal"> 629</span>
<span class="normal"> 630</span>
<span class="normal"> 631</span>
<span class="normal"> 632</span>
<span class="normal"> 633</span>
<span class="normal"> 634</span>
<span class="normal"> 635</span>
<span class="normal"> 636</span>
<span class="normal"> 637</span>
<span class="normal"> 638</span>
<span class="normal"> 639</span>
<span class="normal"> 640</span>
<span class="normal"> 641</span>
<span class="normal"> 642</span>
<span class="normal"> 643</span>
<span class="normal"> 644</span>
<span class="normal"> 645</span>
<span class="normal"> 646</span>
<span class="normal"> 647</span>
<span class="normal"> 648</span>
<span class="normal"> 649</span>
<span class="normal"> 650</span>
<span class="normal"> 651</span>
<span class="normal"> 652</span>
<span class="normal"> 653</span>
<span class="normal"> 654</span>
<span class="normal"> 655</span>
<span class="normal"> 656</span>
<span class="normal"> 657</span>
<span class="normal"> 658</span>
<span class="normal"> 659</span>
<span class="normal"> 660</span>
<span class="normal"> 661</span>
<span class="normal"> 662</span>
<span class="normal"> 663</span>
<span class="normal"> 664</span>
<span class="normal"> 665</span>
<span class="normal"> 666</span>
<span class="normal"> 667</span>
<span class="normal"> 668</span>
<span class="normal"> 669</span>
<span class="normal"> 670</span>
<span class="normal"> 671</span>
<span class="normal"> 672</span>
<span class="normal"> 673</span>
<span class="normal"> 674</span>
<span class="normal"> 675</span>
<span class="normal"> 676</span>
<span class="normal"> 677</span>
<span class="normal"> 678</span>
<span class="normal"> 679</span>
<span class="normal"> 680</span>
<span class="normal"> 681</span>
<span class="normal"> 682</span>
<span class="normal"> 683</span>
<span class="normal"> 684</span>
<span class="normal"> 685</span>
<span class="normal"> 686</span>
<span class="normal"> 687</span>
<span class="normal"> 688</span>
<span class="normal"> 689</span>
<span class="normal"> 690</span>
<span class="normal"> 691</span>
<span class="normal"> 692</span>
<span class="normal"> 693</span>
<span class="normal"> 694</span>
<span class="normal"> 695</span>
<span class="normal"> 696</span>
<span class="normal"> 697</span>
<span class="normal"> 698</span>
<span class="normal"> 699</span>
<span class="normal"> 700</span>
<span class="normal"> 701</span>
<span class="normal"> 702</span>
<span class="normal"> 703</span>
<span class="normal"> 704</span>
<span class="normal"> 705</span>
<span class="normal"> 706</span>
<span class="normal"> 707</span>
<span class="normal"> 708</span>
<span class="normal"> 709</span>
<span class="normal"> 710</span>
<span class="normal"> 711</span>
<span class="normal"> 712</span>
<span class="normal"> 713</span>
<span class="normal"> 714</span>
<span class="normal"> 715</span>
<span class="normal"> 716</span>
<span class="normal"> 717</span>
<span class="normal"> 718</span>
<span class="normal"> 719</span>
<span class="normal"> 720</span>
<span class="normal"> 721</span>
<span class="normal"> 722</span>
<span class="normal"> 723</span>
<span class="normal"> 724</span>
<span class="normal"> 725</span>
<span class="normal"> 726</span>
<span class="normal"> 727</span>
<span class="normal"> 728</span>
<span class="normal"> 729</span>
<span class="normal"> 730</span>
<span class="normal"> 731</span>
<span class="normal"> 732</span>
<span class="normal"> 733</span>
<span class="normal"> 734</span>
<span class="normal"> 735</span>
<span class="normal"> 736</span>
<span class="normal"> 737</span>
<span class="normal"> 738</span>
<span class="normal"> 739</span>
<span class="normal"> 740</span>
<span class="normal"> 741</span>
<span class="normal"> 742</span>
<span class="normal"> 743</span>
<span class="normal"> 744</span>
<span class="normal"> 745</span>
<span class="normal"> 746</span>
<span class="normal"> 747</span>
<span class="normal"> 748</span>
<span class="normal"> 749</span>
<span class="normal"> 750</span>
<span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span>
<span class="normal">1675</span>
<span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span>
<span class="normal">1697</span>
<span class="normal">1698</span>
<span class="normal">1699</span>
<span class="normal">1700</span>
<span class="normal">1701</span>
<span class="normal">1702</span>
<span class="normal">1703</span>
<span class="normal">1704</span>
<span class="normal">1705</span>
<span class="normal">1706</span>
<span class="normal">1707</span>
<span class="normal">1708</span>
<span class="normal">1709</span>
<span class="normal">1710</span>
<span class="normal">1711</span>
<span class="normal">1712</span>
<span class="normal">1713</span>
<span class="normal">1714</span>
<span class="normal">1715</span>
<span class="normal">1716</span>
<span class="normal">1717</span>
<span class="normal">1718</span>
<span class="normal">1719</span>
<span class="normal">1720</span>
<span class="normal">1721</span>
<span class="normal">1722</span>
<span class="normal">1723</span>
<span class="normal">1724</span>
<span class="normal">1725</span>
<span class="normal">1726</span>
<span class="normal">1727</span>
<span class="normal">1728</span>
<span class="normal">1729</span>
<span class="normal">1730</span>
<span class="normal">1731</span>
<span class="normal">1732</span>
<span class="normal">1733</span>
<span class="normal">1734</span>
<span class="normal">1735</span>
<span class="normal">1736</span>
<span class="normal">1737</span>
<span class="normal">1738</span>
<span class="normal">1739</span>
<span class="normal">1740</span>
<span class="normal">1741</span>
<span class="normal">1742</span>
<span class="normal">1743</span>
<span class="normal">1744</span>
<span class="normal">1745</span>
<span class="normal">1746</span>
<span class="normal">1747</span>
<span class="normal">1748</span>
<span class="normal">1749</span>
<span class="normal">1750</span>
<span class="normal">1751</span>
<span class="normal">1752</span>
<span class="normal">1753</span>
<span class="normal">1754</span>
<span class="normal">1755</span>
<span class="normal">1756</span>
<span class="normal">1757</span>
<span class="normal">1758</span>
<span class="normal">1759</span>
<span class="normal">1760</span>
<span class="normal">1761</span>
<span class="normal">1762</span>
<span class="normal">1763</span>
<span class="normal">1764</span>
<span class="normal">1765</span>
<span class="normal">1766</span>
<span class="normal">1767</span>
<span class="normal">1768</span>
<span class="normal">1769</span>
<span class="normal">1770</span>
<span class="normal">1771</span>
<span class="normal">1772</span>
<span class="normal">1773</span>
<span class="normal">1774</span>
<span class="normal">1775</span>
<span class="normal">1776</span>
<span class="normal">1777</span>
<span class="normal">1778</span>
<span class="normal">1779</span>
<span class="normal">1780</span>
<span class="normal">1781</span>
<span class="normal">1782</span>
<span class="normal">1783</span>
<span class="normal">1784</span>
<span class="normal">1785</span>
<span class="normal">1786</span>
<span class="normal">1787</span>
<span class="normal">1788</span>
<span class="normal">1789</span>
<span class="normal">1790</span>
<span class="normal">1791</span>
<span class="normal">1792</span>
<span class="normal">1793</span>
<span class="normal">1794</span>
<span class="normal">1795</span>
<span class="normal">1796</span>
<span class="normal">1797</span>
<span class="normal">1798</span>
<span class="normal">1799</span>
<span class="normal">1800</span>
<span class="normal">1801</span>
<span class="normal">1802</span>
<span class="normal">1803</span>
<span class="normal">1804</span>
<span class="normal">1805</span>
<span class="normal">1806</span>
<span class="normal">1807</span>
<span class="normal">1808</span>
<span class="normal">1809</span>
<span class="normal">1810</span>
<span class="normal">1811</span>
<span class="normal">1812</span>
<span class="normal">1813</span>
<span class="normal">1814</span>
<span class="normal">1815</span>
<span class="normal">1816</span>
<span class="normal">1817</span>
<span class="normal">1818</span>
<span class="normal">1819</span>
<span class="normal">1820</span>
<span class="normal">1821</span>
<span class="normal">1822</span>
<span class="normal">1823</span>
<span class="normal">1824</span>
<span class="normal">1825</span>
<span class="normal">1826</span>
<span class="normal">1827</span>
<span class="normal">1828</span>
<span class="normal">1829</span>
<span class="normal">1830</span>
<span class="normal">1831</span>
<span class="normal">1832</span>
<span class="normal">1833</span>
<span class="normal">1834</span>
<span class="normal">1835</span>
<span class="normal">1836</span>
<span class="normal">1837</span>
<span class="normal">1838</span>
<span class="normal">1839</span>
<span class="normal">1840</span>
<span class="normal">1841</span>
<span class="normal">1842</span>
<span class="normal">1843</span>
<span class="normal">1844</span>
<span class="normal">1845</span>
<span class="normal">1846</span>
<span class="normal">1847</span>
<span class="normal">1848</span>
<span class="normal">1849</span>
<span class="normal">1850</span>
<span class="normal">1851</span>
<span class="normal">1852</span>
<span class="normal">1853</span>
<span class="normal">1854</span>
<span class="normal">1855</span>
<span class="normal">1856</span>
<span class="normal">1857</span>
<span class="normal">1858</span>
<span class="normal">1859</span>
<span class="normal">1860</span>
<span class="normal">1861</span>
<span class="normal">1862</span>
<span class="normal">1863</span>
<span class="normal">1864</span>
<span class="normal">1865</span>
<span class="normal">1866</span>
<span class="normal">1867</span>
<span class="normal">1868</span>
<span class="normal">1869</span>
<span class="normal">1870</span>
<span class="normal">1871</span>
<span class="normal">1872</span>
<span class="normal">1873</span>
<span class="normal">1874</span>
<span class="normal">1875</span>
<span class="normal">1876</span>
<span class="normal">1877</span>
<span class="normal">1878</span>
<span class="normal">1879</span>
<span class="normal">1880</span>
<span class="normal">1881</span>
<span class="normal">1882</span>
<span class="normal">1883</span>
<span class="normal">1884</span>
<span class="normal">1885</span>
<span class="normal">1886</span>
<span class="normal">1887</span>
<span class="normal">1888</span>
<span class="normal">1889</span>
<span class="normal">1890</span>
<span class="normal">1891</span>
<span class="normal">1892</span>
<span class="normal">1893</span>
<span class="normal">1894</span>
<span class="normal">1895</span>
<span class="normal">1896</span>
<span class="normal">1897</span>
<span class="normal">1898</span>
<span class="normal">1899</span>
<span class="normal">1900</span>
<span class="normal">1901</span>
<span class="normal">1902</span>
<span class="normal">1903</span>
<span class="normal">1904</span>
<span class="normal">1905</span>
<span class="normal">1906</span>
<span class="normal">1907</span>
<span class="normal">1908</span>
<span class="normal">1909</span>
<span class="normal">1910</span>
<span class="normal">1911</span>
<span class="normal">1912</span>
<span class="normal">1913</span>
<span class="normal">1914</span>
<span class="normal">1915</span>
<span class="normal">1916</span>
<span class="normal">1917</span>
<span class="normal">1918</span>
<span class="normal">1919</span>
<span class="normal">1920</span>
<span class="normal">1921</span>
<span class="normal">1922</span>
<span class="normal">1923</span>
<span class="normal">1924</span>
<span class="normal">1925</span>
<span class="normal">1926</span>
<span class="normal">1927</span>
<span class="normal">1928</span>
<span class="normal">1929</span>
<span class="normal">1930</span>
<span class="normal">1931</span>
<span class="normal">1932</span>
<span class="normal">1933</span>
<span class="normal">1934</span>
<span class="normal">1935</span>
<span class="normal">1936</span>
<span class="normal">1937</span>
<span class="normal">1938</span>
<span class="normal">1939</span>
<span class="normal">1940</span>
<span class="normal">1941</span>
<span class="normal">1942</span>
<span class="normal">1943</span>
<span class="normal">1944</span>
<span class="normal">1945</span>
<span class="normal">1946</span>
<span class="normal">1947</span>
<span class="normal">1948</span>
<span class="normal">1949</span>
<span class="normal">1950</span>
<span class="normal">1951</span>
<span class="normal">1952</span>
<span class="normal">1953</span>
<span class="normal">1954</span>
<span class="normal">1955</span>
<span class="normal">1956</span>
<span class="normal">1957</span>
<span class="normal">1958</span>
<span class="normal">1959</span>
<span class="normal">1960</span>
<span class="normal">1961</span>
<span class="normal">1962</span>
<span class="normal">1963</span>
<span class="normal">1964</span>
<span class="normal">1965</span>
<span class="normal">1966</span>
<span class="normal">1967</span>
<span class="normal">1968</span>
<span class="normal">1969</span>
<span class="normal">1970</span>
<span class="normal">1971</span>
<span class="normal">1972</span>
<span class="normal">1973</span>
<span class="normal">1974</span>
<span class="normal">1975</span>
<span class="normal">1976</span>
<span class="normal">1977</span>
<span class="normal">1978</span>
<span class="normal">1979</span>
<span class="normal">1980</span>
<span class="normal">1981</span>
<span class="normal">1982</span>
<span class="normal">1983</span>
<span class="normal">1984</span>
<span class="normal">1985</span>
<span class="normal">1986</span>
<span class="normal">1987</span>
<span class="normal">1988</span>
<span class="normal">1989</span>
<span class="normal">1990</span>
<span class="normal">1991</span>
<span class="normal">1992</span>
<span class="normal">1993</span>
<span class="normal">1994</span>
<span class="normal">1995</span>
<span class="normal">1996</span>
<span class="normal">1997</span>
<span class="normal">1998</span>
<span class="normal">1999</span>
<span class="normal">2000</span>
<span class="normal">2001</span>
<span class="normal">2002</span>
<span class="normal">2003</span>
<span class="normal">2004</span>
<span class="normal">2005</span>
<span class="normal">2006</span>
<span class="normal">2007</span>
<span class="normal">2008</span>
<span class="normal">2009</span>
<span class="normal">2010</span>
<span class="normal">2011</span>
<span class="normal">2012</span>
<span class="normal">2013</span>
<span class="normal">2014</span>
<span class="normal">2015</span>
<span class="normal">2016</span>
<span class="normal">2017</span>
<span class="normal">2018</span>
<span class="normal">2019</span>
<span class="normal">2020</span>
<span class="normal">2021</span>
<span class="normal">2022</span>
<span class="normal">2023</span>
<span class="normal">2024</span>
<span class="normal">2025</span>
<span class="normal">2026</span>
<span class="normal">2027</span>
<span class="normal">2028</span>
<span class="normal">2029</span>
<span class="normal">2030</span>
<span class="normal">2031</span>
<span class="normal">2032</span>
<span class="normal">2033</span>
<span class="normal">2034</span>
<span class="normal">2035</span>
<span class="normal">2036</span>
<span class="normal">2037</span>
<span class="normal">2038</span>
<span class="normal">2039</span>
<span class="normal">2040</span>
<span class="normal">2041</span>
<span class="normal">2042</span>
<span class="normal">2043</span>
<span class="normal">2044</span>
<span class="normal">2045</span>
<span class="normal">2046</span>
<span class="normal">2047</span>
<span class="normal">2048</span>
<span class="normal">2049</span>
<span class="normal">2050</span>
<span class="normal">2051</span>
<span class="normal">2052</span>
<span class="normal">2053</span>
<span class="normal">2054</span>
<span class="normal">2055</span>
<span class="normal">2056</span>
<span class="normal">2057</span>
<span class="normal">2058</span>
<span class="normal">2059</span>
<span class="normal">2060</span>
<span class="normal">2061</span>
<span class="normal">2062</span>
<span class="normal">2063</span>
<span class="normal">2064</span>
<span class="normal">2065</span>
<span class="normal">2066</span>
<span class="normal">2067</span>
<span class="normal">2068</span>
<span class="normal">2069</span>
<span class="normal">2070</span>
<span class="normal">2071</span>
<span class="normal">2072</span>
<span class="normal">2073</span>
<span class="normal">2074</span>
<span class="normal">2075</span>
<span class="normal">2076</span>
<span class="normal">2077</span>
<span class="normal">2078</span>
<span class="normal">2079</span>
<span class="normal">2080</span>
<span class="normal">2081</span>
<span class="normal">2082</span>
<span class="normal">2083</span>
<span class="normal">2084</span>
<span class="normal">2085</span>
<span class="normal">2086</span>
<span class="normal">2087</span>
<span class="normal">2088</span>
<span class="normal">2089</span>
<span class="normal">2090</span>
<span class="normal">2091</span>
<span class="normal">2092</span>
<span class="normal">2093</span>
<span class="normal">2094</span>
<span class="normal">2095</span>
<span class="normal">2096</span>
<span class="normal">2097</span>
<span class="normal">2098</span>
<span class="normal">2099</span>
<span class="normal">2100</span>
<span class="normal">2101</span>
<span class="normal">2102</span>
<span class="normal">2103</span>
<span class="normal">2104</span>
<span class="normal">2105</span>
<span class="normal">2106</span>
<span class="normal">2107</span>
<span class="normal">2108</span>
<span class="normal">2109</span>
<span class="normal">2110</span>
<span class="normal">2111</span>
<span class="normal">2112</span>
<span class="normal">2113</span>
<span class="normal">2114</span>
<span class="normal">2115</span>
<span class="normal">2116</span>
<span class="normal">2117</span>
<span class="normal">2118</span>
<span class="normal">2119</span>
<span class="normal">2120</span>
<span class="normal">2121</span>
<span class="normal">2122</span>
<span class="normal">2123</span>
<span class="normal">2124</span>
<span class="normal">2125</span>
<span class="normal">2126</span>
<span class="normal">2127</span>
<span class="normal">2128</span>
<span class="normal">2129</span>
<span class="normal">2130</span>
<span class="normal">2131</span>
<span class="normal">2132</span>
<span class="normal">2133</span>
<span class="normal">2134</span>
<span class="normal">2135</span>
<span class="normal">2136</span>
<span class="normal">2137</span>
<span class="normal">2138</span>
<span class="normal">2139</span>
<span class="normal">2140</span>
<span class="normal">2141</span>
<span class="normal">2142</span>
<span class="normal">2143</span>
<span class="normal">2144</span>
<span class="normal">2145</span>
<span class="normal">2146</span>
<span class="normal">2147</span>
<span class="normal">2148</span>
<span class="normal">2149</span>
<span class="normal">2150</span>
<span class="normal">2151</span>
<span class="normal">2152</span>
<span class="normal">2153</span>
<span class="normal">2154</span>
<span class="normal">2155</span>
<span class="normal">2156</span>
<span class="normal">2157</span>
<span class="normal">2158</span>
<span class="normal">2159</span>
<span class="normal">2160</span>
<span class="normal">2161</span>
<span class="normal">2162</span>
<span class="normal">2163</span>
<span class="normal">2164</span>
<span class="normal">2165</span>
<span class="normal">2166</span>
<span class="normal">2167</span>
<span class="normal">2168</span>
<span class="normal">2169</span>
<span class="normal">2170</span>
<span class="normal">2171</span>
<span class="normal">2172</span>
<span class="normal">2173</span>
<span class="normal">2174</span>
<span class="normal">2175</span>
<span class="normal">2176</span>
<span class="normal">2177</span>
<span class="normal">2178</span>
<span class="normal">2179</span>
<span class="normal">2180</span>
<span class="normal">2181</span>
<span class="normal">2182</span>
<span class="normal">2183</span>
<span class="normal">2184</span>
<span class="normal">2185</span>
<span class="normal">2186</span>
<span class="normal">2187</span>
<span class="normal">2188</span>
<span class="normal">2189</span>
<span class="normal">2190</span>
<span class="normal">2191</span>
<span class="normal">2192</span>
<span class="normal">2193</span>
<span class="normal">2194</span>
<span class="normal">2195</span>
<span class="normal">2196</span>
<span class="normal">2197</span>
<span class="normal">2198</span>
<span class="normal">2199</span>
<span class="normal">2200</span>
<span class="normal">2201</span>
<span class="normal">2202</span>
<span class="normal">2203</span>
<span class="normal">2204</span>
<span class="normal">2205</span>
<span class="normal">2206</span>
<span class="normal">2207</span>
<span class="normal">2208</span>
<span class="normal">2209</span>
<span class="normal">2210</span>
<span class="normal">2211</span>
<span class="normal">2212</span>
<span class="normal">2213</span>
<span class="normal">2214</span>
<span class="normal">2215</span>
<span class="normal">2216</span>
<span class="normal">2217</span>
<span class="normal">2218</span>
<span class="normal">2219</span>
<span class="normal">2220</span>
<span class="normal">2221</span>
<span class="normal">2222</span>
<span class="normal">2223</span>
<span class="normal">2224</span>
<span class="normal">2225</span>
<span class="normal">2226</span>
<span class="normal">2227</span>
<span class="normal">2228</span>
<span class="normal">2229</span>
<span class="normal">2230</span>
<span class="normal">2231</span>
<span class="normal">2232</span>
<span class="normal">2233</span>
<span class="normal">2234</span>
<span class="normal">2235</span>
<span class="normal">2236</span>
<span class="normal">2237</span>
<span class="normal">2238</span>
<span class="normal">2239</span>
<span class="normal">2240</span>
<span class="normal">2241</span>
<span class="normal">2242</span>
<span class="normal">2243</span>
<span class="normal">2244</span>
<span class="normal">2245</span>
<span class="normal">2246</span>
<span class="normal">2247</span>
<span class="normal">2248</span>
<span class="normal">2249</span>
<span class="normal">2250</span>
<span class="normal">2251</span>
<span class="normal">2252</span>
<span class="normal">2253</span>
<span class="normal">2254</span>
<span class="normal">2255</span>
<span class="normal">2256</span>
<span class="normal">2257</span>
<span class="normal">2258</span>
<span class="normal">2259</span>
<span class="normal">2260</span>
<span class="normal">2261</span>
<span class="normal">2262</span>
<span class="normal">2263</span>
<span class="normal">2264</span>
<span class="normal">2265</span>
<span class="normal">2266</span>
<span class="normal">2267</span>
<span class="normal">2268</span>
<span class="normal">2269</span>
<span class="normal">2270</span>
<span class="normal">2271</span>
<span class="normal">2272</span>
<span class="normal">2273</span>
<span class="normal">2274</span>
<span class="normal">2275</span>
<span class="normal">2276</span>
<span class="normal">2277</span>
<span class="normal">2278</span>
<span class="normal">2279</span>
<span class="normal">2280</span>
<span class="normal">2281</span>
<span class="normal">2282</span>
<span class="normal">2283</span>
<span class="normal">2284</span>
<span class="normal">2285</span>
<span class="normal">2286</span>
<span class="normal">2287</span>
<span class="normal">2288</span>
<span class="normal">2289</span>
<span class="normal">2290</span>
<span class="normal">2291</span>
<span class="normal">2292</span>
<span class="normal">2293</span>
<span class="normal">2294</span>
<span class="normal">2295</span>
<span class="normal">2296</span>
<span class="normal">2297</span>
<span class="normal">2298</span>
<span class="normal">2299</span>
<span class="normal">2300</span>
<span class="normal">2301</span>
<span class="normal">2302</span>
<span class="normal">2303</span>
<span class="normal">2304</span>
<span class="normal">2305</span>
<span class="normal">2306</span>
<span class="normal">2307</span>
<span class="normal">2308</span>
<span class="normal">2309</span>
<span class="normal">2310</span>
<span class="normal">2311</span>
<span class="normal">2312</span>
<span class="normal">2313</span>
<span class="normal">2314</span>
<span class="normal">2315</span>
<span class="normal">2316</span>
<span class="normal">2317</span>
<span class="normal">2318</span>
<span class="normal">2319</span>
<span class="normal">2320</span>
<span class="normal">2321</span>
<span class="normal">2322</span>
<span class="normal">2323</span>
<span class="normal">2324</span>
<span class="normal">2325</span>
<span class="normal">2326</span>
<span class="normal">2327</span>
<span class="normal">2328</span>
<span class="normal">2329</span>
<span class="normal">2330</span>
<span class="normal">2331</span>
<span class="normal">2332</span>
<span class="normal">2333</span>
<span class="normal">2334</span>
<span class="normal">2335</span>
<span class="normal">2336</span>
<span class="normal">2337</span>
<span class="normal">2338</span>
<span class="normal">2339</span>
<span class="normal">2340</span>
<span class="normal">2341</span>
<span class="normal">2342</span>
<span class="normal">2343</span>
<span class="normal">2344</span>
<span class="normal">2345</span>
<span class="normal">2346</span>
<span class="normal">2347</span>
<span class="normal">2348</span>
<span class="normal">2349</span>
<span class="normal">2350</span>
<span class="normal">2351</span>
<span class="normal">2352</span>
<span class="normal">2353</span>
<span class="normal">2354</span>
<span class="normal">2355</span>
<span class="normal">2356</span>
<span class="normal">2357</span>
<span class="normal">2358</span>
<span class="normal">2359</span>
<span class="normal">2360</span>
<span class="normal">2361</span>
<span class="normal">2362</span>
<span class="normal">2363</span>
<span class="normal">2364</span>
<span class="normal">2365</span>
<span class="normal">2366</span>
<span class="normal">2367</span>
<span class="normal">2368</span>
<span class="normal">2369</span>
<span class="normal">2370</span>
<span class="normal">2371</span>
<span class="normal">2372</span>
<span class="normal">2373</span>
<span class="normal">2374</span>
<span class="normal">2375</span>
<span class="normal">2376</span>
<span class="normal">2377</span>
<span class="normal">2378</span>
<span class="normal">2379</span>
<span class="normal">2380</span>
<span class="normal">2381</span>
<span class="normal">2382</span>
<span class="normal">2383</span>
<span class="normal">2384</span>
<span class="normal">2385</span>
<span class="normal">2386</span>
<span class="normal">2387</span>
<span class="normal">2388</span>
<span class="normal">2389</span>
<span class="normal">2390</span>
<span class="normal">2391</span>
<span class="normal">2392</span>
<span class="normal">2393</span>
<span class="normal">2394</span>
<span class="normal">2395</span>
<span class="normal">2396</span>
<span class="normal">2397</span>
<span class="normal">2398</span>
<span class="normal">2399</span>
<span class="normal">2400</span>
<span class="normal">2401</span>
<span class="normal">2402</span>
<span class="normal">2403</span>
<span class="normal">2404</span>
<span class="normal">2405</span>
<span class="normal">2406</span>
<span class="normal">2407</span>
<span class="normal">2408</span>
<span class="normal">2409</span>
<span class="normal">2410</span>
<span class="normal">2411</span>
<span class="normal">2412</span>
<span class="normal">2413</span>
<span class="normal">2414</span>
<span class="normal">2415</span>
<span class="normal">2416</span>
<span class="normal">2417</span>
<span class="normal">2418</span>
<span class="normal">2419</span>
<span class="normal">2420</span>
<span class="normal">2421</span>
<span class="normal">2422</span>
<span class="normal">2423</span>
<span class="normal">2424</span>
<span class="normal">2425</span>
<span class="normal">2426</span>
<span class="normal">2427</span>
<span class="normal">2428</span>
<span class="normal">2429</span>
<span class="normal">2430</span>
<span class="normal">2431</span>
<span class="normal">2432</span>
<span class="normal">2433</span>
<span class="normal">2434</span>
<span class="normal">2435</span>
<span class="normal">2436</span>
<span class="normal">2437</span>
<span class="normal">2438</span>
<span class="normal">2439</span>
<span class="normal">2440</span>
<span class="normal">2441</span>
<span class="normal">2442</span>
<span class="normal">2443</span>
<span class="normal">2444</span>
<span class="normal">2445</span>
<span class="normal">2446</span>
<span class="normal">2447</span>
<span class="normal">2448</span>
<span class="normal">2449</span>
<span class="normal">2450</span>
<span class="normal">2451</span>
<span class="normal">2452</span>
<span class="normal">2453</span>
<span class="normal">2454</span>
<span class="normal">2455</span>
<span class="normal">2456</span>
<span class="normal">2457</span>
<span class="normal">2458</span>
<span class="normal">2459</span>
<span class="normal">2460</span>
<span class="normal">2461</span>
<span class="normal">2462</span>
<span class="normal">2463</span>
<span class="normal">2464</span>
<span class="normal">2465</span>
<span class="normal">2466</span>
<span class="normal">2467</span>
<span class="normal">2468</span>
<span class="normal">2469</span>
<span class="normal">2470</span>
<span class="normal">2471</span>
<span class="normal">2472</span>
<span class="normal">2473</span>
<span class="normal">2474</span>
<span class="normal">2475</span>
<span class="normal">2476</span>
<span class="normal">2477</span>
<span class="normal">2478</span>
<span class="normal">2479</span>
<span class="normal">2480</span>
<span class="normal">2481</span>
<span class="normal">2482</span>
<span class="normal">2483</span>
<span class="normal">2484</span>
<span class="normal">2485</span>
<span class="normal">2486</span>
<span class="normal">2487</span>
<span class="normal">2488</span>
<span class="normal">2489</span>
<span class="normal">2490</span>
<span class="normal">2491</span>
<span class="normal">2492</span>
<span class="normal">2493</span>
<span class="normal">2494</span>
<span class="normal">2495</span>
<span class="normal">2496</span>
<span class="normal">2497</span>
<span class="normal">2498</span>
<span class="normal">2499</span>
<span class="normal">2500</span>
<span class="normal">2501</span>
<span class="normal">2502</span>
<span class="normal">2503</span>
<span class="normal">2504</span>
<span class="normal">2505</span>
<span class="normal">2506</span>
<span class="normal">2507</span>
<span class="normal">2508</span>
<span class="normal">2509</span>
<span class="normal">2510</span>
<span class="normal">2511</span>
<span class="normal">2512</span>
<span class="normal">2513</span>
<span class="normal">2514</span>
<span class="normal">2515</span>
<span class="normal">2516</span>
<span class="normal">2517</span>
<span class="normal">2518</span>
<span class="normal">2519</span>
<span class="normal">2520</span>
<span class="normal">2521</span>
<span class="normal">2522</span>
<span class="normal">2523</span>
<span class="normal">2524</span>
<span class="normal">2525</span>
<span class="normal">2526</span>
<span class="normal">2527</span>
<span class="normal">2528</span>
<span class="normal">2529</span>
<span class="normal">2530</span>
<span class="normal">2531</span>
<span class="normal">2532</span>
<span class="normal">2533</span>
<span class="normal">2534</span>
<span class="normal">2535</span>
<span class="normal">2536</span>
<span class="normal">2537</span>
<span class="normal">2538</span>
<span class="normal">2539</span>
<span class="normal">2540</span>
<span class="normal">2541</span>
<span class="normal">2542</span>
<span class="normal">2543</span>
<span class="normal">2544</span>
<span class="normal">2545</span>
<span class="normal">2546</span>
<span class="normal">2547</span>
<span class="normal">2548</span>
<span class="normal">2549</span>
<span class="normal">2550</span>
<span class="normal">2551</span>
<span class="normal">2552</span>
<span class="normal">2553</span>
<span class="normal">2554</span>
<span class="normal">2555</span>
<span class="normal">2556</span>
<span class="normal">2557</span>
<span class="normal">2558</span>
<span class="normal">2559</span>
<span class="normal">2560</span>
<span class="normal">2561</span>
<span class="normal">2562</span>
<span class="normal">2563</span>
<span class="normal">2564</span>
<span class="normal">2565</span>
<span class="normal">2566</span>
<span class="normal">2567</span>
<span class="normal">2568</span>
<span class="normal">2569</span>
<span class="normal">2570</span>
<span class="normal">2571</span>
<span class="normal">2572</span>
<span class="normal">2573</span>
<span class="normal">2574</span>
<span class="normal">2575</span>
<span class="normal">2576</span>
<span class="normal">2577</span>
<span class="normal">2578</span>
<span class="normal">2579</span>
<span class="normal">2580</span>
<span class="normal">2581</span>
<span class="normal">2582</span>
<span class="normal">2583</span>
<span class="normal">2584</span>
<span class="normal">2585</span>
<span class="normal">2586</span>
<span class="normal">2587</span>
<span class="normal">2588</span>
<span class="normal">2589</span>
<span class="normal">2590</span>
<span class="normal">2591</span>
<span class="normal">2592</span>
<span class="normal">2593</span>
<span class="normal">2594</span>
<span class="normal">2595</span>
<span class="normal">2596</span>
<span class="normal">2597</span>
<span class="normal">2598</span>
<span class="normal">2599</span>
<span class="normal">2600</span>
<span class="normal">2601</span>
<span class="normal">2602</span>
<span class="normal">2603</span>
<span class="normal">2604</span>
<span class="normal">2605</span>
<span class="normal">2606</span>
<span class="normal">2607</span>
<span class="normal">2608</span>
<span class="normal">2609</span>
<span class="normal">2610</span>
<span class="normal">2611</span>
<span class="normal">2612</span>
<span class="normal">2613</span>
<span class="normal">2614</span>
<span class="normal">2615</span>
<span class="normal">2616</span>
<span class="normal">2617</span>
<span class="normal">2618</span>
<span class="normal">2619</span>
<span class="normal">2620</span>
<span class="normal">2621</span>
<span class="normal">2622</span>
<span class="normal">2623</span>
<span class="normal">2624</span>
<span class="normal">2625</span>
<span class="normal">2626</span>
<span class="normal">2627</span>
<span class="normal">2628</span>
<span class="normal">2629</span>
<span class="normal">2630</span>
<span class="normal">2631</span>
<span class="normal">2632</span>
<span class="normal">2633</span>
<span class="normal">2634</span>
<span class="normal">2635</span>
<span class="normal">2636</span>
<span class="normal">2637</span>
<span class="normal">2638</span>
<span class="normal">2639</span>
<span class="normal">2640</span>
<span class="normal">2641</span>
<span class="normal">2642</span>
<span class="normal">2643</span>
<span class="normal">2644</span>
<span class="normal">2645</span>
<span class="normal">2646</span>
<span class="normal">2647</span>
<span class="normal">2648</span>
<span class="normal">2649</span>
<span class="normal">2650</span>
<span class="normal">2651</span>
<span class="normal">2652</span>
<span class="normal">2653</span>
<span class="normal">2654</span>
<span class="normal">2655</span>
<span class="normal">2656</span>
<span class="normal">2657</span>
<span class="normal">2658</span>
<span class="normal">2659</span>
<span class="normal">2660</span>
<span class="normal">2661</span>
<span class="normal">2662</span>
<span class="normal">2663</span>
<span class="normal">2664</span>
<span class="normal">2665</span>
<span class="normal">2666</span>
<span class="normal">2667</span>
<span class="normal">2668</span>
<span class="normal">2669</span>
<span class="normal">2670</span>
<span class="normal">2671</span>
<span class="normal">2672</span>
<span class="normal">2673</span>
<span class="normal">2674</span>
<span class="normal">2675</span>
<span class="normal">2676</span>
<span class="normal">2677</span>
<span class="normal">2678</span>
<span class="normal">2679</span>
<span class="normal">2680</span>
<span class="normal">2681</span>
<span class="normal">2682</span>
<span class="normal">2683</span>
<span class="normal">2684</span>
<span class="normal">2685</span>
<span class="normal">2686</span>
<span class="normal">2687</span>
<span class="normal">2688</span>
<span class="normal">2689</span>
<span class="normal">2690</span>
<span class="normal">2691</span>
<span class="normal">2692</span>
<span class="normal">2693</span>
<span class="normal">2694</span>
<span class="normal">2695</span>
<span class="normal">2696</span>
<span class="normal">2697</span>
<span class="normal">2698</span>
<span class="normal">2699</span>
<span class="normal">2700</span>
<span class="normal">2701</span>
<span class="normal">2702</span>
<span class="normal">2703</span>
<span class="normal">2704</span>
<span class="normal">2705</span>
<span class="normal">2706</span>
<span class="normal">2707</span>
<span class="normal">2708</span>
<span class="normal">2709</span>
<span class="normal">2710</span>
<span class="normal">2711</span>
<span class="normal">2712</span>
<span class="normal">2713</span>
<span class="normal">2714</span>
<span class="normal">2715</span>
<span class="normal">2716</span>
<span class="normal">2717</span>
<span class="normal">2718</span>
<span class="normal">2719</span>
<span class="normal">2720</span>
<span class="normal">2721</span>
<span class="normal">2722</span>
<span class="normal">2723</span>
<span class="normal">2724</span>
<span class="normal">2725</span>
<span class="normal">2726</span>
<span class="normal">2727</span>
<span class="normal">2728</span>
<span class="normal">2729</span>
<span class="normal">2730</span>
<span class="normal">2731</span>
<span class="normal">2732</span>
<span class="normal">2733</span>
<span class="normal">2734</span>
<span class="normal">2735</span>
<span class="normal">2736</span>
<span class="normal">2737</span>
<span class="normal">2738</span>
<span class="normal">2739</span>
<span class="normal">2740</span>
<span class="normal">2741</span>
<span class="normal">2742</span>
<span class="normal">2743</span>
<span class="normal">2744</span>
<span class="normal">2745</span>
<span class="normal">2746</span>
<span class="normal">2747</span>
<span class="normal">2748</span>
<span class="normal">2749</span>
<span class="normal">2750</span>
<span class="normal">2751</span>
<span class="normal">2752</span>
<span class="normal">2753</span>
<span class="normal">2754</span>
<span class="normal">2755</span>
<span class="normal">2756</span>
<span class="normal">2757</span>
<span class="normal">2758</span>
<span class="normal">2759</span>
<span class="normal">2760</span>
<span class="normal">2761</span>
<span class="normal">2762</span>
<span class="normal">2763</span>
<span class="normal">2764</span>
<span class="normal">2765</span>
<span class="normal">2766</span>
<span class="normal">2767</span>
<span class="normal">2768</span>
<span class="normal">2769</span>
<span class="normal">2770</span>
<span class="normal">2771</span>
<span class="normal">2772</span>
<span class="normal">2773</span>
<span class="normal">2774</span>
<span class="normal">2775</span>
<span class="normal">2776</span>
<span class="normal">2777</span>
<span class="normal">2778</span>
<span class="normal">2779</span>
<span class="normal">2780</span>
<span class="normal">2781</span>
<span class="normal">2782</span>
<span class="normal">2783</span>
<span class="normal">2784</span>
<span class="normal">2785</span>
<span class="normal">2786</span>
<span class="normal">2787</span>
<span class="normal">2788</span>
<span class="normal">2789</span>
<span class="normal">2790</span>
<span class="normal">2791</span>
<span class="normal">2792</span>
<span class="normal">2793</span>
<span class="normal">2794</span>
<span class="normal">2795</span>
<span class="normal">2796</span>
<span class="normal">2797</span>
<span class="normal">2798</span>
<span class="normal">2799</span>
<span class="normal">2800</span>
<span class="normal">2801</span>
<span class="normal">2802</span>
<span class="normal">2803</span>
<span class="normal">2804</span>
<span class="normal">2805</span>
<span class="normal">2806</span>
<span class="normal">2807</span>
<span class="normal">2808</span>
<span class="normal">2809</span>
<span class="normal">2810</span>
<span class="normal">2811</span>
<span class="normal">2812</span>
<span class="normal">2813</span>
<span class="normal">2814</span>
<span class="normal">2815</span>
<span class="normal">2816</span>
<span class="normal">2817</span>
<span class="normal">2818</span>
<span class="normal">2819</span>
<span class="normal">2820</span>
<span class="normal">2821</span>
<span class="normal">2822</span>
<span class="normal">2823</span>
<span class="normal">2824</span>
<span class="normal">2825</span>
<span class="normal">2826</span>
<span class="normal">2827</span>
<span class="normal">2828</span>
<span class="normal">2829</span>
<span class="normal">2830</span>
<span class="normal">2831</span>
<span class="normal">2832</span>
<span class="normal">2833</span>
<span class="normal">2834</span>
<span class="normal">2835</span>
<span class="normal">2836</span>
<span class="normal">2837</span>
<span class="normal">2838</span>
<span class="normal">2839</span>
<span class="normal">2840</span>
<span class="normal">2841</span>
<span class="normal">2842</span>
<span class="normal">2843</span>
<span class="normal">2844</span>
<span class="normal">2845</span>
<span class="normal">2846</span>
<span class="normal">2847</span>
<span class="normal">2848</span>
<span class="normal">2849</span>
<span class="normal">2850</span>
<span class="normal">2851</span>
<span class="normal">2852</span>
<span class="normal">2853</span>
<span class="normal">2854</span>
<span class="normal">2855</span>
<span class="normal">2856</span>
<span class="normal">2857</span>
<span class="normal">2858</span>
<span class="normal">2859</span>
<span class="normal">2860</span>
<span class="normal">2861</span>
<span class="normal">2862</span>
<span class="normal">2863</span>
<span class="normal">2864</span>
<span class="normal">2865</span>
<span class="normal">2866</span>
<span class="normal">2867</span>
<span class="normal">2868</span>
<span class="normal">2869</span>
<span class="normal">2870</span>
<span class="normal">2871</span>
<span class="normal">2872</span>
<span class="normal">2873</span>
<span class="normal">2874</span>
<span class="normal">2875</span>
<span class="normal">2876</span>
<span class="normal">2877</span>
<span class="normal">2878</span>
<span class="normal">2879</span>
<span class="normal">2880</span>
<span class="normal">2881</span>
<span class="normal">2882</span>
<span class="normal">2883</span>
<span class="normal">2884</span>
<span class="normal">2885</span>
<span class="normal">2886</span>
<span class="normal">2887</span>
<span class="normal">2888</span>
<span class="normal">2889</span>
<span class="normal">2890</span>
<span class="normal">2891</span>
<span class="normal">2892</span>
<span class="normal">2893</span>
<span class="normal">2894</span>
<span class="normal">2895</span>
<span class="normal">2896</span>
<span class="normal">2897</span>
<span class="normal">2898</span>
<span class="normal">2899</span>
<span class="normal">2900</span>
<span class="normal">2901</span>
<span class="normal">2902</span>
<span class="normal">2903</span>
<span class="normal">2904</span>
<span class="normal">2905</span>
<span class="normal">2906</span>
<span class="normal">2907</span>
<span class="normal">2908</span>
<span class="normal">2909</span>
<span class="normal">2910</span>
<span class="normal">2911</span>
<span class="normal">2912</span>
<span class="normal">2913</span>
<span class="normal">2914</span>
<span class="normal">2915</span>
<span class="normal">2916</span>
<span class="normal">2917</span>
<span class="normal">2918</span>
<span class="normal">2919</span>
<span class="normal">2920</span>
<span class="normal">2921</span>
<span class="normal">2922</span>
<span class="normal">2923</span>
<span class="normal">2924</span>
<span class="normal">2925</span>
<span class="normal">2926</span>
<span class="normal">2927</span>
<span class="normal">2928</span>
<span class="normal">2929</span>
<span class="normal">2930</span>
<span class="normal">2931</span>
<span class="normal">2932</span>
<span class="normal">2933</span>
<span class="normal">2934</span>
<span class="normal">2935</span>
<span class="normal">2936</span>
<span class="normal">2937</span>
<span class="normal">2938</span>
<span class="normal">2939</span>
<span class="normal">2940</span>
<span class="normal">2941</span>
<span class="normal">2942</span>
<span class="normal">2943</span>
<span class="normal">2944</span>
<span class="normal">2945</span>
<span class="normal">2946</span>
<span class="normal">2947</span>
<span class="normal">2948</span>
<span class="normal">2949</span>
<span class="normal">2950</span>
<span class="normal">2951</span>
<span class="normal">2952</span>
<span class="normal">2953</span>
<span class="normal">2954</span>
<span class="normal">2955</span>
<span class="normal">2956</span>
<span class="normal">2957</span>
<span class="normal">2958</span>
<span class="normal">2959</span>
<span class="normal">2960</span>
<span class="normal">2961</span>
<span class="normal">2962</span>
<span class="normal">2963</span>
<span class="normal">2964</span>
<span class="normal">2965</span>
<span class="normal">2966</span>
<span class="normal">2967</span>
<span class="normal">2968</span>
<span class="normal">2969</span>
<span class="normal">2970</span>
<span class="normal">2971</span>
<span class="normal">2972</span>
<span class="normal">2973</span>
<span class="normal">2974</span>
<span class="normal">2975</span>
<span class="normal">2976</span>
<span class="normal">2977</span>
<span class="normal">2978</span>
<span class="normal">2979</span>
<span class="normal">2980</span>
<span class="normal">2981</span>
<span class="normal">2982</span>
<span class="normal">2983</span>
<span class="normal">2984</span>
<span class="normal">2985</span>
<span class="normal">2986</span>
<span class="normal">2987</span>
<span class="normal">2988</span>
<span class="normal">2989</span>
<span class="normal">2990</span>
<span class="normal">2991</span>
<span class="normal">2992</span>
<span class="normal">2993</span>
<span class="normal">2994</span>
<span class="normal">2995</span>
<span class="normal">2996</span>
<span class="normal">2997</span>
<span class="normal">2998</span>
<span class="normal">2999</span>
<span class="normal">3000</span>
<span class="normal">3001</span>
<span class="normal">3002</span>
<span class="normal">3003</span>
<span class="normal">3004</span>
<span class="normal">3005</span>
<span class="normal">3006</span>
<span class="normal">3007</span>
<span class="normal">3008</span>
<span class="normal">3009</span>
<span class="normal">3010</span>
<span class="normal">3011</span>
<span class="normal">3012</span>
<span class="normal">3013</span>
<span class="normal">3014</span>
<span class="normal">3015</span>
<span class="normal">3016</span>
<span class="normal">3017</span>
<span class="normal">3018</span>
<span class="normal">3019</span>
<span class="normal">3020</span>
<span class="normal">3021</span>
<span class="normal">3022</span>
<span class="normal">3023</span>
<span class="normal">3024</span>
<span class="normal">3025</span>
<span class="normal">3026</span>
<span class="normal">3027</span>
<span class="normal">3028</span>
<span class="normal">3029</span>
<span class="normal">3030</span>
<span class="normal">3031</span>
<span class="normal">3032</span>
<span class="normal">3033</span>
<span class="normal">3034</span>
<span class="normal">3035</span>
<span class="normal">3036</span>
<span class="normal">3037</span>
<span class="normal">3038</span>
<span class="normal">3039</span>
<span class="normal">3040</span>
<span class="normal">3041</span>
<span class="normal">3042</span>
<span class="normal">3043</span>
<span class="normal">3044</span>
<span class="normal">3045</span>
<span class="normal">3046</span>
<span class="normal">3047</span>
<span class="normal">3048</span>
<span class="normal">3049</span>
<span class="normal">3050</span>
<span class="normal">3051</span>
<span class="normal">3052</span>
<span class="normal">3053</span>
<span class="normal">3054</span>
<span class="normal">3055</span>
<span class="normal">3056</span>
<span class="normal">3057</span>
<span class="normal">3058</span>
<span class="normal">3059</span>
<span class="normal">3060</span>
<span class="normal">3061</span>
<span class="normal">3062</span>
<span class="normal">3063</span>
<span class="normal">3064</span>
<span class="normal">3065</span>
<span class="normal">3066</span>
<span class="normal">3067</span>
<span class="normal">3068</span>
<span class="normal">3069</span>
<span class="normal">3070</span>
<span class="normal">3071</span>
<span class="normal">3072</span>
<span class="normal">3073</span>
<span class="normal">3074</span>
<span class="normal">3075</span>
<span class="normal">3076</span>
<span class="normal">3077</span>
<span class="normal">3078</span>
<span class="normal">3079</span>
<span class="normal">3080</span>
<span class="normal">3081</span>
<span class="normal">3082</span>
<span class="normal">3083</span>
<span class="normal">3084</span>
<span class="normal">3085</span>
<span class="normal">3086</span>
<span class="normal">3087</span>
<span class="normal">3088</span>
<span class="normal">3089</span>
<span class="normal">3090</span>
<span class="normal">3091</span>
<span class="normal">3092</span>
<span class="normal">3093</span>
<span class="normal">3094</span>
<span class="normal">3095</span>
<span class="normal">3096</span>
<span class="normal">3097</span>
<span class="normal">3098</span>
<span class="normal">3099</span>
<span class="normal">3100</span>
<span class="normal">3101</span>
<span class="normal">3102</span>
<span class="normal">3103</span>
<span class="normal">3104</span>
<span class="normal">3105</span>
<span class="normal">3106</span>
<span class="normal">3107</span>
<span class="normal">3108</span>
<span class="normal">3109</span>
<span class="normal">3110</span>
<span class="normal">3111</span>
<span class="normal">3112</span>
<span class="normal">3113</span>
<span class="normal">3114</span>
<span class="normal">3115</span>
<span class="normal">3116</span>
<span class="normal">3117</span>
<span class="normal">3118</span>
<span class="normal">3119</span>
<span class="normal">3120</span>
<span class="normal">3121</span>
<span class="normal">3122</span>
<span class="normal">3123</span>
<span class="normal">3124</span>
<span class="normal">3125</span>
<span class="normal">3126</span>
<span class="normal">3127</span>
<span class="normal">3128</span>
<span class="normal">3129</span>
<span class="normal">3130</span>
<span class="normal">3131</span>
<span class="normal">3132</span>
<span class="normal">3133</span>
<span class="normal">3134</span>
<span class="normal">3135</span>
<span class="normal">3136</span>
<span class="normal">3137</span>
<span class="normal">3138</span>
<span class="normal">3139</span>
<span class="normal">3140</span>
<span class="normal">3141</span>
<span class="normal">3142</span>
<span class="normal">3143</span>
<span class="normal">3144</span>
<span class="normal">3145</span>
<span class="normal">3146</span>
<span class="normal">3147</span>
<span class="normal">3148</span>
<span class="normal">3149</span>
<span class="normal">3150</span>
<span class="normal">3151</span>
<span class="normal">3152</span>
<span class="normal">3153</span>
<span class="normal">3154</span>
<span class="normal">3155</span>
<span class="normal">3156</span>
<span class="normal">3157</span>
<span class="normal">3158</span>
<span class="normal">3159</span>
<span class="normal">3160</span>
<span class="normal">3161</span>
<span class="normal">3162</span>
<span class="normal">3163</span>
<span class="normal">3164</span>
<span class="normal">3165</span>
<span class="normal">3166</span>
<span class="normal">3167</span>
<span class="normal">3168</span>
<span class="normal">3169</span>
<span class="normal">3170</span>
<span class="normal">3171</span>
<span class="normal">3172</span>
<span class="normal">3173</span>
<span class="normal">3174</span>
<span class="normal">3175</span>
<span class="normal">3176</span>
<span class="normal">3177</span>
<span class="normal">3178</span>
<span class="normal">3179</span>
<span class="normal">3180</span>
<span class="normal">3181</span>
<span class="normal">3182</span>
<span class="normal">3183</span>
<span class="normal">3184</span>
<span class="normal">3185</span>
<span class="normal">3186</span>
<span class="normal">3187</span>
<span class="normal">3188</span>
<span class="normal">3189</span>
<span class="normal">3190</span>
<span class="normal">3191</span>
<span class="normal">3192</span>
<span class="normal">3193</span>
<span class="normal">3194</span>
<span class="normal">3195</span>
<span class="normal">3196</span>
<span class="normal">3197</span>
<span class="normal">3198</span>
<span class="normal">3199</span>
<span class="normal">3200</span>
<span class="normal">3201</span>
<span class="normal">3202</span>
<span class="normal">3203</span>
<span class="normal">3204</span>
<span class="normal">3205</span>
<span class="normal">3206</span>
<span class="normal">3207</span>
<span class="normal">3208</span>
<span class="normal">3209</span>
<span class="normal">3210</span>
<span class="normal">3211</span>
<span class="normal">3212</span>
<span class="normal">3213</span>
<span class="normal">3214</span>
<span class="normal">3215</span>
<span class="normal">3216</span>
<span class="normal">3217</span>
<span class="normal">3218</span>
<span class="normal">3219</span>
<span class="normal">3220</span>
<span class="normal">3221</span>
<span class="normal">3222</span>
<span class="normal">3223</span>
<span class="normal">3224</span>
<span class="normal">3225</span>
<span class="normal">3226</span>
<span class="normal">3227</span>
<span class="normal">3228</span>
<span class="normal">3229</span>
<span class="normal">3230</span>
<span class="normal">3231</span>
<span class="normal">3232</span>
<span class="normal">3233</span>
<span class="normal">3234</span>
<span class="normal">3235</span>
<span class="normal">3236</span>
<span class="normal">3237</span>
<span class="normal">3238</span>
<span class="normal">3239</span>
<span class="normal">3240</span>
<span class="normal">3241</span>
<span class="normal">3242</span>
<span class="normal">3243</span>
<span class="normal">3244</span>
<span class="normal">3245</span>
<span class="normal">3246</span>
<span class="normal">3247</span>
<span class="normal">3248</span>
<span class="normal">3249</span>
<span class="normal">3250</span>
<span class="normal">3251</span>
<span class="normal">3252</span>
<span class="normal">3253</span>
<span class="normal">3254</span>
<span class="normal">3255</span>
<span class="normal">3256</span>
<span class="normal">3257</span>
<span class="normal">3258</span>
<span class="normal">3259</span>
<span class="normal">3260</span>
<span class="normal">3261</span>
<span class="normal">3262</span>
<span class="normal">3263</span>
<span class="normal">3264</span>
<span class="normal">3265</span>
<span class="normal">3266</span>
<span class="normal">3267</span>
<span class="normal">3268</span>
<span class="normal">3269</span>
<span class="normal">3270</span>
<span class="normal">3271</span>
<span class="normal">3272</span>
<span class="normal">3273</span>
<span class="normal">3274</span>
<span class="normal">3275</span>
<span class="normal">3276</span>
<span class="normal">3277</span>
<span class="normal">3278</span>
<span class="normal">3279</span>
<span class="normal">3280</span>
<span class="normal">3281</span>
<span class="normal">3282</span>
<span class="normal">3283</span>
<span class="normal">3284</span>
<span class="normal">3285</span>
<span class="normal">3286</span>
<span class="normal">3287</span>
<span class="normal">3288</span>
<span class="normal">3289</span>
<span class="normal">3290</span>
<span class="normal">3291</span>
<span class="normal">3292</span>
<span class="normal">3293</span>
<span class="normal">3294</span>
<span class="normal">3295</span>
<span class="normal">3296</span>
<span class="normal">3297</span>
<span class="normal">3298</span>
<span class="normal">3299</span>
<span class="normal">3300</span>
<span class="normal">3301</span>
<span class="normal">3302</span>
<span class="normal">3303</span>
<span class="normal">3304</span>
<span class="normal">3305</span>
<span class="normal">3306</span>
<span class="normal">3307</span>
<span class="normal">3308</span>
<span class="normal">3309</span>
<span class="normal">3310</span>
<span class="normal">3311</span>
<span class="normal">3312</span>
<span class="normal">3313</span>
<span class="normal">3314</span>
<span class="normal">3315</span>
<span class="normal">3316</span>
<span class="normal">3317</span>
<span class="normal">3318</span>
<span class="normal">3319</span>
<span class="normal">3320</span>
<span class="normal">3321</span>
<span class="normal">3322</span>
<span class="normal">3323</span>
<span class="normal">3324</span>
<span class="normal">3325</span>
<span class="normal">3326</span>
<span class="normal">3327</span>
<span class="normal">3328</span>
<span class="normal">3329</span>
<span class="normal">3330</span>
<span class="normal">3331</span>
<span class="normal">3332</span>
<span class="normal">3333</span>
<span class="normal">3334</span>
<span class="normal">3335</span>
<span class="normal">3336</span>
<span class="normal">3337</span>
<span class="normal">3338</span>
<span class="normal">3339</span>
<span class="normal">3340</span>
<span class="normal">3341</span>
<span class="normal">3342</span>
<span class="normal">3343</span>
<span class="normal">3344</span>
<span class="normal">3345</span>
<span class="normal">3346</span>
<span class="normal">3347</span>
<span class="normal">3348</span>
<span class="normal">3349</span>
<span class="normal">3350</span>
<span class="normal">3351</span>
<span class="normal">3352</span>
<span class="normal">3353</span>
<span class="normal">3354</span>
<span class="normal">3355</span>
<span class="normal">3356</span>
<span class="normal">3357</span>
<span class="normal">3358</span>
<span class="normal">3359</span>
<span class="normal">3360</span>
<span class="normal">3361</span>
<span class="normal">3362</span>
<span class="normal">3363</span>
<span class="normal">3364</span>
<span class="normal">3365</span>
<span class="normal">3366</span>
<span class="normal">3367</span>
<span class="normal">3368</span>
<span class="normal">3369</span>
<span class="normal">3370</span>
<span class="normal">3371</span>
<span class="normal">3372</span>
<span class="normal">3373</span>
<span class="normal">3374</span>
<span class="normal">3375</span>
<span class="normal">3376</span>
<span class="normal">3377</span>
<span class="normal">3378</span>
<span class="normal">3379</span>
<span class="normal">3380</span>
<span class="normal">3381</span>
<span class="normal">3382</span>
<span class="normal">3383</span>
<span class="normal">3384</span>
<span class="normal">3385</span>
<span class="normal">3386</span>
<span class="normal">3387</span>
<span class="normal">3388</span>
<span class="normal">3389</span>
<span class="normal">3390</span>
<span class="normal">3391</span>
<span class="normal">3392</span>
<span class="normal">3393</span>
<span class="normal">3394</span>
<span class="normal">3395</span>
<span class="normal">3396</span>
<span class="normal">3397</span>
<span class="normal">3398</span>
<span class="normal">3399</span>
<span class="normal">3400</span>
<span class="normal">3401</span>
<span class="normal">3402</span>
<span class="normal">3403</span>
<span class="normal">3404</span>
<span class="normal">3405</span>
<span class="normal">3406</span>
<span class="normal">3407</span>
<span class="normal">3408</span>
<span class="normal">3409</span>
<span class="normal">3410</span>
<span class="normal">3411</span>
<span class="normal">3412</span>
<span class="normal">3413</span>
<span class="normal">3414</span>
<span class="normal">3415</span>
<span class="normal">3416</span>
<span class="normal">3417</span>
<span class="normal">3418</span>
<span class="normal">3419</span>
<span class="normal">3420</span>
<span class="normal">3421</span>
<span class="normal">3422</span>
<span class="normal">3423</span>
<span class="normal">3424</span>
<span class="normal">3425</span>
<span class="normal">3426</span>
<span class="normal">3427</span>
<span class="normal">3428</span>
<span class="normal">3429</span>
<span class="normal">3430</span>
<span class="normal">3431</span>
<span class="normal">3432</span>
<span class="normal">3433</span>
<span class="normal">3434</span>
<span class="normal">3435</span>
<span class="normal">3436</span>
<span class="normal">3437</span>
<span class="normal">3438</span>
<span class="normal">3439</span>
<span class="normal">3440</span>
<span class="normal">3441</span>
<span class="normal">3442</span>
<span class="normal">3443</span>
<span class="normal">3444</span>
<span class="normal">3445</span>
<span class="normal">3446</span>
<span class="normal">3447</span>
<span class="normal">3448</span>
<span class="normal">3449</span>
<span class="normal">3450</span>
<span class="normal">3451</span>
<span class="normal">3452</span>
<span class="normal">3453</span>
<span class="normal">3454</span>
<span class="normal">3455</span>
<span class="normal">3456</span>
<span class="normal">3457</span>
<span class="normal">3458</span>
<span class="normal">3459</span>
<span class="normal">3460</span>
<span class="normal">3461</span>
<span class="normal">3462</span>
<span class="normal">3463</span>
<span class="normal">3464</span>
<span class="normal">3465</span>
<span class="normal">3466</span>
<span class="normal">3467</span>
<span class="normal">3468</span>
<span class="normal">3469</span>
<span class="normal">3470</span>
<span class="normal">3471</span>
<span class="normal">3472</span>
<span class="normal">3473</span>
<span class="normal">3474</span>
<span class="normal">3475</span>
<span class="normal">3476</span>
<span class="normal">3477</span>
<span class="normal">3478</span>
<span class="normal">3479</span>
<span class="normal">3480</span>
<span class="normal">3481</span>
<span class="normal">3482</span>
<span class="normal">3483</span>
<span class="normal">3484</span>
<span class="normal">3485</span>
<span class="normal">3486</span>
<span class="normal">3487</span>
<span class="normal">3488</span>
<span class="normal">3489</span>
<span class="normal">3490</span>
<span class="normal">3491</span>
<span class="normal">3492</span>
<span class="normal">3493</span>
<span class="normal">3494</span>
<span class="normal">3495</span>
<span class="normal">3496</span>
<span class="normal">3497</span>
<span class="normal">3498</span>
<span class="normal">3499</span>
<span class="normal">3500</span>
<span class="normal">3501</span>
<span class="normal">3502</span>
<span class="normal">3503</span>
<span class="normal">3504</span>
<span class="normal">3505</span>
<span class="normal">3506</span>
<span class="normal">3507</span>
<span class="normal">3508</span>
<span class="normal">3509</span>
<span class="normal">3510</span>
<span class="normal">3511</span>
<span class="normal">3512</span>
<span class="normal">3513</span>
<span class="normal">3514</span>
<span class="normal">3515</span>
<span class="normal">3516</span>
<span class="normal">3517</span>
<span class="normal">3518</span>
<span class="normal">3519</span>
<span class="normal">3520</span>
<span class="normal">3521</span>
<span class="normal">3522</span>
<span class="normal">3523</span>
<span class="normal">3524</span>
<span class="normal">3525</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">RoadwayNetwork</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Representation of a Roadway Network.</span>

<span class="sd">    Typical usage example:</span>

<span class="sd">    ```py</span>
<span class="sd">    net = RoadwayNetwork.read(</span>
<span class="sd">        link_file=MY_LINK_FILE,</span>
<span class="sd">        node_file=MY_NODE_FILE,</span>
<span class="sd">        shape_file=MY_SHAPE_FILE,</span>
<span class="sd">    )</span>
<span class="sd">    my_selection = {</span>
<span class="sd">        &quot;link&quot;: [{&quot;name&quot;: [&quot;I 35E&quot;]}],</span>
<span class="sd">        &quot;A&quot;: {&quot;osm_node_id&quot;: &quot;961117623&quot;},  # start searching for segments at A</span>
<span class="sd">        &quot;B&quot;: {&quot;osm_node_id&quot;: &quot;2564047368&quot;},</span>
<span class="sd">    }</span>
<span class="sd">    net.select_roadway_features(my_selection)</span>

<span class="sd">    my_change = [</span>
<span class="sd">        {</span>
<span class="sd">            &#39;property&#39;: &#39;lanes&#39;,</span>
<span class="sd">            &#39;existing&#39;: 1,</span>
<span class="sd">            &#39;set&#39;: 2,</span>
<span class="sd">        },</span>
<span class="sd">        {</span>
<span class="sd">            &#39;property&#39;: &#39;drive_access&#39;,</span>
<span class="sd">            &#39;set&#39;: 0,</span>
<span class="sd">        },</span>
<span class="sd">    ]</span>

<span class="sd">    my_net.apply_roadway_feature_change(</span>
<span class="sd">        my_net.select_roadway_features(my_selection),</span>
<span class="sd">        my_change</span>
<span class="sd">    )</span>

<span class="sd">        net = create_managed_lane_network(net)</span>
<span class="sd">        net.is_network_connected(mode=&quot;drive&quot;, nodes=self.m_nodes_df, links=self.m_links_df)</span>
<span class="sd">        _, disconnected_nodes = net.assess_connectivity(</span>
<span class="sd">            mode=&quot;walk&quot;,</span>
<span class="sd">            ignore_end_nodes=True,</span>
<span class="sd">            nodes=self.m_nodes_df,</span>
<span class="sd">            links=self.m_links_df</span>
<span class="sd">        )</span>
<span class="sd">        net.write(filename=my_out_prefix, path=my_dir, for_model = True)</span>
<span class="sd">    ```</span>

<span class="sd">    Attributes:</span>
<span class="sd">        nodes_df (GeoDataFrame): node data</span>

<span class="sd">        links_df (GeoDataFrame): link data, including start and end</span>
<span class="sd">            nodes and associated shape</span>

<span class="sd">        shapes_df (GeoDataFrame): detailed shape data</span>

<span class="sd">        selections (dict): dictionary storing selections in case they are made repeatedly</span>

<span class="sd">        BOOL_PROPERTIES (list): list of properties which should be coerced to booleans</span>

<span class="sd">        STR_PROPERTIES (list): list of properties which should be coerced to strings</span>

<span class="sd">        INT_PROPERTIES (list): list of properties which should be coerced to integers</span>

<span class="sd">        CRS (str): coordinate reference system in PROJ4 format.</span>
<span class="sd">            See https://proj.org/operations/projections/index.html#</span>

<span class="sd">        ESPG (int): integer representing coordinate system https://epsg.io/</span>

<span class="sd">        NODE_FOREIGN_KEY_TO_LINK (str): column in `nodes_df` associated with the</span>
<span class="sd">            LINK_FOREIGN_KEY</span>

<span class="sd">        LINK_FOREIGN_KEY_TO_NODE (list(str)): list of columns in `links_df` that</span>
<span class="sd">            represent the NODE_FOREIGN_KEY</span>

<span class="sd">        UNIQUE_LINK_KEY (str): column that is a unique key for links</span>

<span class="sd">        UNIQUE_NODE_KEY (str): column that is a unique key for nodes</span>

<span class="sd">        UNIQUE_SHAPE_KEY (str): column that is a unique shape key</span>

<span class="sd">        UNIQUE_MODEL_LINK_IDENTIFIERS (list(str)): list of all unique</span>
<span class="sd">            identifiers for links, including the UNIQUE_LINK_KEY</span>

<span class="sd">        EXPLICIT_LINK_IDENTIFIERS (list(str)): list of identifiers which are explicit enough</span>
<span class="sd">            to use in project selection by themselves. Includes UNIQUE_MODEL_LINK_IDENFIERS as</span>
<span class="sd">            well as some identifiers which may be split across model links such as osm_link_id.</span>

<span class="sd">        UNIQUE_NODE_IDENTIFIERS (list(str)): list of all unique identifiers</span>
<span class="sd">            for nodes, including the UNIQUE_NODE_KEY</span>

<span class="sd">        SEARCH_BREADTH (int): initial number of links from name-based</span>
<span class="sd">            selection that are traveresed before trying another shortest</span>
<span class="sd">            path when searching for paths between A and B node</span>

<span class="sd">        MAX_SEARCH_BREADTH (int): maximum number of links traversed between</span>
<span class="sd">            links that match the searched name when searching for paths</span>
<span class="sd">            between A and B node</span>

<span class="sd">        SP_WEIGHT_FACTOR (Union(int, float)): penalty assigned for each</span>
<span class="sd">            degree of distance between a link and a link with the searched-for</span>
<span class="sd">            name when searching for paths between A and B node</span>

<span class="sd">        MANAGED_LANES_TO_NODE_ID_SCALAR (int): scalar value added to</span>
<span class="sd">            the general purpose lanes&#39; `model_node_id` when creating</span>
<span class="sd">            an associated node for a parallel managed lane</span>

<span class="sd">        MANAGED_LANES_TO_LINK_ID_SCALAR (int): scalar value added to</span>
<span class="sd">            the general purpose lanes&#39; `model_link_id` when creating</span>
<span class="sd">            an associated link for a parallel managed lane</span>

<span class="sd">        MANAGED_LANES_REQUIRED_ATTRIBUTES (list(str)): list of attributes</span>
<span class="sd">            that must be provided in managed lanes</span>

<span class="sd">        KEEP_SAME_ATTRIBUTES_ML_AND_GP (list(str)): list of attributes</span>
<span class="sd">            to copy from a general purpose lane to managed lane</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># CRS = &quot;+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs&quot;</span>
    <span class="n">CRS</span> <span class="o">=</span> <span class="mi">4326</span>  <span class="c1"># &quot;EPSG:4326&quot;</span>

    <span class="n">NODE_FOREIGN_KEY_TO_LINK</span> <span class="o">=</span> <span class="s2">&quot;model_node_id&quot;</span>
    <span class="n">LINK_FOREIGN_KEY_TO_NODE</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">]</span>
    <span class="n">LINK_FOREIGN_KEY_TO_SHAPE</span> <span class="o">=</span> <span class="s2">&quot;shape_id&quot;</span>

    <span class="n">SEARCH_BREADTH</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">MAX_SEARCH_BREADTH</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">SP_WEIGHT_FACTOR</span> <span class="o">=</span> <span class="mi">100</span>

    <span class="n">UNIQUE_LINK_KEY</span> <span class="o">=</span> <span class="s2">&quot;model_link_id&quot;</span>
    <span class="n">UNIQUE_NODE_KEY</span> <span class="o">=</span> <span class="s2">&quot;model_node_id&quot;</span>
    <span class="n">UNIQUE_SHAPE_KEY</span> <span class="o">=</span> <span class="s2">&quot;shape_id&quot;</span>

    <span class="n">UNIQUE_MODEL_LINK_IDENTIFIERS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;model_link_id&quot;</span><span class="p">]</span>
    <span class="n">EXPLICIT_LINK_IDENTIFIERS</span> <span class="o">=</span> <span class="n">UNIQUE_MODEL_LINK_IDENTIFIERS</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;osm_link_id&quot;</span><span class="p">]</span>
    <span class="n">UNIQUE_NODE_IDENTIFIERS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;model_node_id&quot;</span><span class="p">,</span> <span class="s2">&quot;osm_node_id&quot;</span><span class="p">]</span>

    <span class="n">BOOL_PROPERTIES</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;rail_only&quot;</span><span class="p">,</span>
        <span class="s2">&quot;bus_only&quot;</span><span class="p">,</span>
        <span class="s2">&quot;drive_access&quot;</span><span class="p">,</span>
        <span class="s2">&quot;bike_access&quot;</span><span class="p">,</span>
        <span class="s2">&quot;walk_access&quot;</span><span class="p">,</span>
        <span class="s2">&quot;truck_access&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">STR_PROPERTIES</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;osm_link_id&quot;</span><span class="p">,</span>
        <span class="s2">&quot;osm_node_id&quot;</span><span class="p">,</span>
        <span class="s2">&quot;shape_id&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">INT_PROPERTIES</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;model_link_id&quot;</span><span class="p">,</span> <span class="s2">&quot;model_node_id&quot;</span><span class="p">,</span> <span class="s2">&quot;lanes&quot;</span><span class="p">,</span> <span class="s2">&quot;ML_lanes&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">]</span>

    <span class="n">GEOMETRY_PROPERTIES</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">]</span>

    <span class="n">MIN_LINK_REQUIRED_PROPS_DEFAULT</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;name&quot;</span><span class="p">,</span>
        <span class="s2">&quot;A&quot;</span><span class="p">,</span>
        <span class="s2">&quot;B&quot;</span><span class="p">,</span>
        <span class="s2">&quot;roadway&quot;</span><span class="p">,</span>
        <span class="s2">&quot;model_link_id&quot;</span><span class="p">,</span>
        <span class="s2">&quot;lanes&quot;</span><span class="p">,</span>
        <span class="s2">&quot;bus_only&quot;</span><span class="p">,</span>
        <span class="s2">&quot;rail_only&quot;</span><span class="p">,</span>
        <span class="s2">&quot;drive_access&quot;</span><span class="p">,</span>
        <span class="s2">&quot;walk_access&quot;</span><span class="p">,</span>
        <span class="s2">&quot;bike_access&quot;</span><span class="p">,</span>
        <span class="s2">&quot;locationReferences&quot;</span><span class="p">,</span>
        <span class="s2">&quot;geometry&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">MIN_NODE_REQUIRED_PROPS_DEFAULT</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;model_node_id&quot;</span><span class="p">,</span>
        <span class="s2">&quot;transit_node&quot;</span><span class="p">,</span>
        <span class="s2">&quot;drive_node&quot;</span><span class="p">,</span>
        <span class="s2">&quot;walk_node&quot;</span><span class="p">,</span>
        <span class="s2">&quot;bike_node&quot;</span><span class="p">,</span>
        <span class="s2">&quot;geometry&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">MANAGED_LANES_REQUIRED_ATTRIBUTES</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;A&quot;</span><span class="p">,</span>
        <span class="s2">&quot;B&quot;</span><span class="p">,</span>
        <span class="s2">&quot;model_link_id&quot;</span><span class="p">,</span>
        <span class="s2">&quot;locationReferences&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">KEEP_SAME_ATTRIBUTES_ML_AND_GP</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;distance&quot;</span><span class="p">,</span>
        <span class="s2">&quot;bike_access&quot;</span><span class="p">,</span>
        <span class="s2">&quot;drive_access&quot;</span><span class="p">,</span>
        <span class="s2">&quot;transit_access&quot;</span><span class="p">,</span>
        <span class="s2">&quot;walk_access&quot;</span><span class="p">,</span>
        <span class="s2">&quot;maxspeed&quot;</span><span class="p">,</span>
        <span class="s2">&quot;name&quot;</span><span class="p">,</span>
        <span class="s2">&quot;oneway&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ref&quot;</span><span class="p">,</span>
        <span class="s2">&quot;roadway&quot;</span><span class="p">,</span>
        <span class="s2">&quot;length&quot;</span><span class="p">,</span>
        <span class="s2">&quot;segment_id&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">MANAGED_LANES_SCALAR</span> <span class="o">=</span> <span class="mi">500000</span>

    <span class="n">MODES_TO_NETWORK_LINK_VARIABLES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;drive&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;drive_access&quot;</span><span class="p">],</span>
        <span class="s2">&quot;bus&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;bus_only&quot;</span><span class="p">,</span> <span class="s2">&quot;drive_access&quot;</span><span class="p">],</span>
        <span class="s2">&quot;rail&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;rail_only&quot;</span><span class="p">],</span>
        <span class="s2">&quot;transit&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;bus_only&quot;</span><span class="p">,</span> <span class="s2">&quot;rail_only&quot;</span><span class="p">,</span> <span class="s2">&quot;drive_access&quot;</span><span class="p">],</span>
        <span class="s2">&quot;walk&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;walk_access&quot;</span><span class="p">],</span>
        <span class="s2">&quot;bike&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;bike_access&quot;</span><span class="p">],</span>
    <span class="p">}</span>

    <span class="n">MODES_TO_NETWORK_NODE_VARIABLES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;drive&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;drive_node&quot;</span><span class="p">],</span>
        <span class="s2">&quot;rail&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;rail_only&quot;</span><span class="p">,</span> <span class="s2">&quot;drive_node&quot;</span><span class="p">],</span>
        <span class="s2">&quot;bus&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;bus_only&quot;</span><span class="p">,</span> <span class="s2">&quot;drive_node&quot;</span><span class="p">],</span>
        <span class="s2">&quot;transit&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;bus_only&quot;</span><span class="p">,</span> <span class="s2">&quot;rail_only&quot;</span><span class="p">,</span> <span class="s2">&quot;drive_node&quot;</span><span class="p">],</span>
        <span class="s2">&quot;walk&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;walk_node&quot;</span><span class="p">],</span>
        <span class="s2">&quot;bike&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;bike_node&quot;</span><span class="p">],</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodes</span><span class="p">:</span> <span class="n">GeoDataFrame</span><span class="p">,</span> <span class="n">links</span><span class="p">:</span> <span class="n">GeoDataFrame</span><span class="p">,</span> <span class="n">shapes</span><span class="p">:</span> <span class="n">GeoDataFrame</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">validate_object_types</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">links</span><span class="p">,</span> <span class="n">shapes</span><span class="p">):</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;RoadwayNetwork: Invalid constructor data type&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span> <span class="o">=</span> <span class="n">nodes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span> <span class="o">=</span> <span class="n">links</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shapes_df</span> <span class="o">=</span> <span class="n">shapes</span>

        <span class="c1"># Model network</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_nodes_df</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_links_df</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_shapes_df</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">link_file</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node_file</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shape_file</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Add non-required fields if they aren&#39;t there.</span>
        <span class="c1"># for field, default_value in RoadwayNetwork.OPTIONAL_FIELDS:</span>
        <span class="c1">#    if field not in self.links_df.columns:</span>
        <span class="c1">#        self.links_df[field] = default_value</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_uniqueness</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;IDs in network not unique&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selections</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span>
        <span class="n">link_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">node_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">shape_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">fast</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RoadwayNetwork</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads a network from the roadway network standard</span>
<span class="sd">        Validates that it conforms to the schema</span>

<span class="sd">        args:</span>
<span class="sd">            link_file: full path to the link file</span>
<span class="sd">            node_file: full path to the node file</span>
<span class="sd">            shape_file: full path to the shape file</span>
<span class="sd">            fast: boolean that will skip validation to speed up read time</span>

<span class="sd">        Returns: a RoadwayNetwork instance</span>

<span class="sd">        .. todo:: Turn off fast=True as default</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="p">(</span><span class="n">link_file</span><span class="p">,</span> <span class="n">node_file</span><span class="p">,</span> <span class="n">shape_file</span><span class="p">):</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Specified file doesn&#39;t exist at: </span><span class="si">{</span><span class="n">fn</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">fast</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span>
                <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">validate_node_schema</span><span class="p">(</span><span class="n">node_file</span><span class="p">)</span>
                <span class="ow">and</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">validate_link_schema</span><span class="p">(</span><span class="n">link_file</span><span class="p">)</span>
                <span class="ow">and</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">validate_shape_schema</span><span class="p">(</span><span class="n">shape_file</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;RoadwayNetwork: Data doesn&#39;t conform to schema&quot;</span><span class="p">)</span>

        <span class="n">links_df</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">read_links</span><span class="p">(</span><span class="n">link_file</span><span class="p">)</span>
        <span class="n">nodes_df</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">read_nodes</span><span class="p">(</span><span class="n">node_file</span><span class="p">)</span>
        <span class="n">shapes_df</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">read_shapes</span><span class="p">(</span><span class="n">shape_file</span><span class="p">)</span>

        <span class="n">roadway_network</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="p">(</span>
            <span class="n">nodes</span><span class="o">=</span><span class="n">nodes_df</span><span class="p">,</span> <span class="n">links</span><span class="o">=</span><span class="n">links_df</span><span class="p">,</span> <span class="n">shapes</span><span class="o">=</span><span class="n">shapes_df</span>
        <span class="p">)</span>

        <span class="n">roadway_network</span><span class="o">.</span><span class="n">link_file</span> <span class="o">=</span> <span class="n">link_file</span>
        <span class="n">roadway_network</span><span class="o">.</span><span class="n">node_file</span> <span class="o">=</span> <span class="n">node_file</span>
        <span class="n">roadway_network</span><span class="o">.</span><span class="n">shape_file</span> <span class="o">=</span> <span class="n">shape_file</span>

        <span class="k">return</span> <span class="n">roadway_network</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">coerce_types</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">cols</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Coerces types to bool, str and int which might default to other types based on values.</span>

<span class="sd">        Uses BOOL_PROPERTIES, INT_PROPERTIES and STR_PROPERTIES.</span>

<span class="sd">        Args:</span>
<span class="sd">            df: Dataframe to coerce type of</span>
<span class="sd">            cols: optional list of fields to check and coerce. Defaults to all fields.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: Dataframe with types coerced</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">cols</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cols</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span>

        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">BOOL_PROPERTIES</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">cols</span><span class="p">)):</span>
            <span class="n">df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">STR_PROPERTIES</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">cols</span><span class="p">)):</span>
            <span class="n">df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">INT_PROPERTIES</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">cols</span><span class="p">)):</span>
            <span class="n">df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">read_links</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reads links and returns a geodataframe of links.</span>

<span class="sd">        Args:</span>
<span class="sd">            filename (str): file to read links in from.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reading links from </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">link_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Read link file.&quot;</span><span class="p">)</span>
        <span class="n">link_properties</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">link_json</span><span class="p">)</span>
        <span class="n">link_geometries</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">line_string_from_location_references</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="s2">&quot;locationReferences&quot;</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">link_json</span>
        <span class="p">]</span>
        <span class="n">links_df</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">link_properties</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="n">link_geometries</span><span class="p">)</span>
        <span class="n">links_df</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">CRS</span>
        <span class="n">links_df</span><span class="o">.</span><span class="n">gdf_name</span> <span class="o">=</span> <span class="s2">&quot;network_links&quot;</span>

        <span class="n">links_df</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">coerce_types</span><span class="p">(</span><span class="n">links_df</span><span class="p">)</span>

        <span class="n">links_df</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_LINK_KEY</span> <span class="o">+</span> <span class="s2">&quot;_idx&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">links_df</span><span class="p">[</span>
            <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_LINK_KEY</span>
        <span class="p">]</span>
        <span class="n">links_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_LINK_KEY</span> <span class="o">+</span> <span class="s2">&quot;_idx&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Read </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">links_df</span><span class="p">)</span><span class="si">}</span><span class="s2"> links.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">links_df</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">read_nodes</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reads nodes and returns a geodataframe of nodes.</span>

<span class="sd">        Args:</span>
<span class="sd">            filename (str): file to read nodes in from.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># geopandas uses fiona OGR drivers, which doesn&#39;t let you have</span>
        <span class="c1"># a list as a property type. Therefore, must read in node_properties</span>
        <span class="c1"># separately in a vanilla dataframe and then convert to geopandas</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reading nodes from </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">node_geojson</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Read nodes file.&quot;</span><span class="p">)</span>
        <span class="n">node_properties</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">[</span><span class="n">g</span><span class="p">[</span><span class="s2">&quot;properties&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">node_geojson</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">]]</span>
        <span class="p">)</span>
        <span class="n">node_geometries</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">Point</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">][</span><span class="s2">&quot;coordinates&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">node_geojson</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">]</span>
        <span class="p">]</span>

        <span class="n">nodes_df</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">node_properties</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="n">node_geometries</span><span class="p">)</span>

        <span class="n">nodes_df</span><span class="o">.</span><span class="n">gdf_name</span> <span class="o">=</span> <span class="s2">&quot;network_nodes&quot;</span>

        <span class="c1"># set a copy of the  foreign key to be the index so that the</span>
        <span class="c1"># variable itself remains queryiable</span>
        <span class="c1">## TODO this should be more elegant</span>
        <span class="n">nodes_df</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span> <span class="o">+</span> <span class="s2">&quot;_idx&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodes_df</span><span class="p">[</span>
            <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span>
        <span class="p">]</span>
        <span class="n">nodes_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span> <span class="o">+</span> <span class="s2">&quot;_idx&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">nodes_df</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">CRS</span>
        <span class="n">nodes_df</span><span class="p">[</span><span class="s2">&quot;X&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodes_df</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">g</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
        <span class="n">nodes_df</span><span class="p">[</span><span class="s2">&quot;Y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodes_df</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">g</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>

        <span class="n">nodes_df</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">coerce_types</span><span class="p">(</span><span class="n">nodes_df</span><span class="p">)</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Read </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">nodes_df</span><span class="p">)</span><span class="si">}</span><span class="s2"> nodes.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">nodes_df</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">read_shapes</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reads shapes and returns a geodataframe of shapes.</span>

<span class="sd">        Also:</span>
<span class="sd">        - drops records without geometry or id</span>
<span class="sd">        - sets CRS to RoadwayNetwork.CRS</span>

<span class="sd">        Args:</span>
<span class="sd">            filename (str): file to read shapes in from.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reading shapes from </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="n">shapes_df</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">shapes_df</span><span class="o">.</span><span class="n">gdf_name</span> <span class="o">=</span> <span class="s2">&quot;network_shapes&quot;</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Read shapes file.&quot;</span><span class="p">)</span>
        <span class="n">shapes_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">shapes_df</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">CRS</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Read </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">shapes_df</span><span class="p">)</span><span class="si">}</span><span class="s2"> shapes.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">shapes_df</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes a network in the roadway network standard</span>

<span class="sd">        args:</span>
<span class="sd">            path: the path were the output will be saved</span>
<span class="sd">            filename: the name prefix of the roadway files that will be generated</span>
<span class="sd">            model: determines if shoudl write model network with separated managed lanes,</span>
<span class="sd">                or standard wrangler network. Defaults to False.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Path [</span><span class="si">%s</span><span class="s2">] doesn&#39;t exist; creating.&quot;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
            <span class="n">links_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">filename</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="s2">&quot;link.json&quot;</span><span class="p">)</span>
            <span class="n">nodes_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">filename</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="s2">&quot;node.geojson&quot;</span><span class="p">)</span>
            <span class="n">shapes_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">filename</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="s2">&quot;shape.geojson&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">links_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;link.json&quot;</span><span class="p">)</span>
            <span class="n">nodes_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;node.geojson&quot;</span><span class="p">)</span>
            <span class="n">shapes_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;shape.geojson&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">model</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">.roadway</span> <span class="kn">import</span> <span class="n">create_managed_lane_network</span>

            <span class="n">net</span> <span class="o">=</span> <span class="n">create_managed_lane_network</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">links_df</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">m_links_df</span>
            <span class="n">nodes_df</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">m_nodes_df</span>
            <span class="n">shapes_df</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">m_shapes_df</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">links_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span>
            <span class="n">nodes_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span>
            <span class="n">shapes_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapes_df</span>

        <span class="c1"># Make sure types are correct</span>
        <span class="n">nodes_df</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">coerce_types</span><span class="p">(</span><span class="n">nodes_df</span><span class="p">)</span>
        <span class="n">links_df</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">coerce_types</span><span class="p">(</span><span class="n">links_df</span><span class="p">)</span>

        <span class="n">link_property_columns</span> <span class="o">=</span> <span class="n">links_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">link_property_columns</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;geometry&quot;</span><span class="p">)</span>
        <span class="n">links_json</span> <span class="o">=</span> <span class="n">links_df_to_json</span><span class="p">(</span><span class="n">links_df</span><span class="p">,</span> <span class="n">link_property_columns</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">links_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">links_json</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

        <span class="c1"># geopandas wont let you write to geojson because</span>
        <span class="c1"># it uses fiona, which doesn&#39;t accept a list as one of the properties</span>
        <span class="c1"># so need to convert the df to geojson manually first</span>
        <span class="n">property_columns</span> <span class="o">=</span> <span class="n">nodes_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">property_columns</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;geometry&quot;</span><span class="p">)</span>

        <span class="n">nodes_geojson</span> <span class="o">=</span> <span class="n">point_df_to_geojson</span><span class="p">(</span><span class="n">nodes_df</span><span class="p">,</span> <span class="n">property_columns</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">nodes_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nodes_geojson</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

        <span class="n">shapes_df</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">shapes_file</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="s2">&quot;GeoJSON&quot;</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">roadway_net_to_gdf</span><span class="p">(</span><span class="n">roadway_net</span><span class="p">:</span> <span class="n">RoadwayNetwork</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Turn the roadway network into a GeoDataFrame</span>
<span class="sd">        args:</span>
<span class="sd">            roadway_net: the roadway network to export</span>

<span class="sd">        returns: shapes dataframe</span>

<span class="sd">        .. todo:: Make this much more sophisticated, for example attach link info to shapes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">roadway_net</span><span class="o">.</span><span class="n">shapes_df</span>

    <span class="k">def</span> <span class="nf">validate_uniqueness</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Confirms that the unique identifiers are met.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_MODEL_LINK_IDENTIFIERS</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Network doesn&#39;t contain unique link identifier: </span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">is_unique</span><span class="p">:</span>
                <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Unique identifier </span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2"> is not unique in network links&quot;</span>
                <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">LINK_FOREIGN_KEY_TO_NODE</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Network doesn&#39;t contain link foreign key identifier: </span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">link_foreign_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">LINK_FOREIGN_KEY_TO_NODE</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="nb">str</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">link_foreign_key</span><span class="o">.</span><span class="n">is_unique</span><span class="p">:</span>
            <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Foreign key: </span><span class="si">{</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">LINK_FOREIGN_KEY_TO_NODE</span><span class="si">}</span><span class="s2"> is not unique in network links&quot;</span>

            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_IDENTIFIERS</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Network doesn&#39;t contain unique node identifier: </span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">is_unique</span><span class="p">:</span>
                <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Unique identifier </span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2"> is not unique in network nodes&quot;</span>
                <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">NODE_FOREIGN_KEY_TO_LINK</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Network doesn&#39;t contain node foreign key identifier: </span><span class="si">{</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">NODE_FOREIGN_KEY_TO_LINK</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">NODE_FOREIGN_KEY_TO_LINK</span><span class="p">]</span><span class="o">.</span><span class="n">is_unique</span><span class="p">:</span>
            <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Foreign key: </span><span class="si">{</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">NODE_FOREIGN_KEY_TO_LINK</span><span class="si">}</span><span class="s2"> is not unique in network nodes&quot;</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_SHAPE_KEY</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapes_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Network doesn&#39;t contain unique shape id: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_SHAPE_KEY</span>
            <span class="p">)</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapes_df</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_SHAPE_KEY</span><span class="p">]</span><span class="o">.</span><span class="n">is_unique</span><span class="p">:</span>
            <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Unique key: </span><span class="si">{}</span><span class="s2"> is not unique in network shapes&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_SHAPE_KEY</span>
            <span class="p">)</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">valid</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">validate_object_types</span><span class="p">(</span>
        <span class="n">nodes</span><span class="p">:</span> <span class="n">GeoDataFrame</span><span class="p">,</span> <span class="n">links</span><span class="p">:</span> <span class="n">GeoDataFrame</span><span class="p">,</span> <span class="n">shapes</span><span class="p">:</span> <span class="n">GeoDataFrame</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determines if the roadway network is being built with the right object types.</span>
<span class="sd">        Does not validate schemas.</span>

<span class="sd">        Args:</span>
<span class="sd">            nodes: nodes geodataframe</span>
<span class="sd">            links: link geodataframe</span>
<span class="sd">            shapes: shape geodataframe</span>

<span class="sd">        Returns: boolean</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">errors</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">GeoDataFrame</span><span class="p">):</span>
            <span class="n">error_message</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;Incompatible nodes type:</span><span class="si">{}</span><span class="s2">. Must provide a GeoDataFrame.  &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="nb">type</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">links</span><span class="p">,</span> <span class="n">GeoDataFrame</span><span class="p">):</span>
            <span class="n">error_message</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;Incompatible links type:</span><span class="si">{}</span><span class="s2">. Must provide a GeoDataFrame.  &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="nb">type</span><span class="p">(</span><span class="n">links</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shapes</span><span class="p">,</span> <span class="n">GeoDataFrame</span><span class="p">):</span>
            <span class="n">error_message</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;Incompatible shapes type:</span><span class="si">{}</span><span class="s2">. Must provide a GeoDataFrame.  &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="nb">type</span><span class="p">(</span><span class="n">shapes</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">errors</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">validate_node_schema</span><span class="p">(</span>
        <span class="n">node_file</span><span class="p">,</span> <span class="n">schema_location</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;roadway_network_node.json&quot;</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate roadway network data node schema and output a boolean</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">schema_location</span><span class="p">):</span>
            <span class="n">base_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span> <span class="s2">&quot;schemas&quot;</span>
            <span class="p">)</span>
            <span class="n">schema_location</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_path</span><span class="p">,</span> <span class="n">schema_location</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">schema_location</span><span class="p">)</span> <span class="k">as</span> <span class="n">schema_json_file</span><span class="p">:</span>
            <span class="n">schema</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">schema_json_file</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">node_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">node_json_file</span><span class="p">:</span>
            <span class="n">json_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">node_json_file</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">validate</span><span class="p">(</span><span class="n">json_data</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed Node schema validation: Validation Error&quot;</span><span class="p">)</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Node File Loc:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node_file</span><span class="p">))</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Node Schema Loc:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">schema_location</span><span class="p">))</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">exc</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>

        <span class="k">except</span> <span class="n">SchemaError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Invalid Node Schema&quot;</span><span class="p">)</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Node Schema Loc:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">schema_location</span><span class="p">))</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">exc</span><span class="o">.</span><span class="n">message</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>

        <span class="k">return</span> <span class="kc">False</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">validate_link_schema</span><span class="p">(</span>
        <span class="n">link_file</span><span class="p">,</span> <span class="n">schema_location</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;roadway_network_link.json&quot;</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate roadway network data link schema and output a boolean</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">schema_location</span><span class="p">):</span>
            <span class="n">base_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span> <span class="s2">&quot;schemas&quot;</span>
            <span class="p">)</span>
            <span class="n">schema_location</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_path</span><span class="p">,</span> <span class="n">schema_location</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">schema_location</span><span class="p">)</span> <span class="k">as</span> <span class="n">schema_json_file</span><span class="p">:</span>
            <span class="n">schema</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">schema_json_file</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">link_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">link_json_file</span><span class="p">:</span>
            <span class="n">json_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">link_json_file</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">validate</span><span class="p">(</span><span class="n">json_data</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed Link schema validation: Validation Error&quot;</span><span class="p">)</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Link File Loc:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">link_file</span><span class="p">))</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Path:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">exc</span><span class="o">.</span><span class="n">path</span><span class="p">))</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">exc</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>

        <span class="k">except</span> <span class="n">SchemaError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Invalid Link Schema&quot;</span><span class="p">)</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Link Schema Loc: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">schema_location</span><span class="p">))</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">exc</span><span class="o">.</span><span class="n">message</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>

        <span class="k">return</span> <span class="kc">False</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">validate_shape_schema</span><span class="p">(</span>
        <span class="n">shape_file</span><span class="p">,</span> <span class="n">schema_location</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;roadway_network_shape.json&quot;</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate roadway network data shape schema and output a boolean</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">schema_location</span><span class="p">):</span>
            <span class="n">base_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span> <span class="s2">&quot;schemas&quot;</span>
            <span class="p">)</span>
            <span class="n">schema_location</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_path</span><span class="p">,</span> <span class="n">schema_location</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">schema_location</span><span class="p">)</span> <span class="k">as</span> <span class="n">schema_json_file</span><span class="p">:</span>
            <span class="n">schema</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">schema_json_file</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">shape_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">shape_json_file</span><span class="p">:</span>
            <span class="n">json_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">shape_json_file</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">validate</span><span class="p">(</span><span class="n">json_data</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed Shape schema validation: Validation Error&quot;</span><span class="p">)</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Shape File Loc:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">shape_file</span><span class="p">))</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Path:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">exc</span><span class="o">.</span><span class="n">path</span><span class="p">))</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">exc</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>

        <span class="k">except</span> <span class="n">SchemaError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Invalid Shape Schema&quot;</span><span class="p">)</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Shape Schema Loc: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">schema_location</span><span class="p">))</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">exc</span><span class="o">.</span><span class="n">message</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>

        <span class="k">return</span> <span class="kc">False</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">num_managed_lane_links</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;managed&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="p">[</span><span class="s2">&quot;managed&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_validate_link_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selection</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validates that link selection is complete/valid for given network.</span>

<span class="sd">        Checks:</span>
<span class="sd">        1. selection properties for links, a, and b are in links_df</span>
<span class="sd">        2. either a unique ID or name + A &amp; B are specified</span>

<span class="sd">        If selection for links is &quot;all&quot; it is assumed valid.</span>

<span class="sd">        Args:</span>
<span class="sd">            selection (dict): selection dictionary</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if link selection is valid and complete.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">selection</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;links&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="n">valid</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">_link_selection_props</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">selection</span><span class="p">[</span><span class="s2">&quot;links&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>

        <span class="n">_missing_link_props</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">_link_selection_props</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">_missing_link_props</span><span class="p">:</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Link selection contains properties not found in the link dataframe:</span><span class="se">\n\</span>
<span class="s2">                </span><span class="si">{</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_missing_link_props</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">_link_explicit_link_id</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span>
            <span class="nb">set</span><span class="p">(</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">EXPLICIT_LINK_IDENTIFIERS</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span>
                <span class="nb">set</span><span class="p">(</span><span class="n">_link_selection_props</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="c1"># if don&#39;t have an explicit link id, then require A and B nodes</span>
        <span class="n">_has_alternate_link_id</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">selection</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">),</span>
                <span class="n">selection</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">),</span>
                <span class="nb">any</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">selection</span><span class="p">[</span><span class="s2">&quot;links&quot;</span><span class="p">]]),</span>
            <span class="p">]</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">_link_explicit_link_id</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">_has_alternate_link_id</span><span class="p">:</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s2">&quot;Link selection does not contain unique link ID or alternate A and B nodes + &#39;name&#39;.&quot;</span>
            <span class="p">)</span>
            <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">_node_selection_props</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="nb">set</span><span class="p">(</span>
                <span class="nb">list</span><span class="p">(</span><span class="n">selection</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">selection</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">_missing_node_props</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">_node_selection_props</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">_missing_node_props</span><span class="p">:</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Node selection contains properties not found in the node dataframe:</span><span class="se">\n\</span>
<span class="s2">                </span><span class="si">{</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_missing_node_props</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">valid</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Link Selection is not valid for network.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_validate_node_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selection</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validates that node selection is complete/valid for given network.</span>

<span class="sd">        Checks:</span>
<span class="sd">        1. selection properties for nodes are in nodes_df</span>
<span class="sd">        2. Nodes identified by an explicit or implicit unique ID. A warning is given for using</span>
<span class="sd">            a property as an identifier which isn&#39;t explicitly unique.</span>

<span class="sd">        If selection for nodes is &quot;all&quot; it is assumed valid.</span>

<span class="sd">        Args:</span>
<span class="sd">            selection (dict): Project Card selection dictionary</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool:True if node selection is valid and complete.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">selection</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nodse&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="n">_node_selection_props</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">selection</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>

        <span class="n">_missing_node_props</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">_node_selection_props</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">_missing_node_props</span><span class="p">:</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Node selection contains properties not found in the node dataframe:</span><span class="se">\n\</span>
<span class="s2">                </span><span class="si">{</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_missing_node_props</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">_has_explicit_unique_node_id</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span>
            <span class="nb">set</span><span class="p">(</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_IDENTIFIERS</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span>
                <span class="nb">set</span><span class="p">(</span><span class="n">_node_selection_props</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">_has_explicit_unique_node_id</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">[</span><span class="n">_node_selection_props</span><span class="p">]</span><span class="o">.</span><span class="n">get_value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Link selection does not contain an explicit unique link ID: </span><span class="se">\</span>
<span class="s2">                        </span><span class="si">{</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_IDENTIFIERS</span><span class="si">}</span><span class="s2">, </span><span class="se">\</span>
<span class="s2">                        but has properties which sufficiently select a single node. </span><span class="se">\</span>
<span class="s2">                        This selection may not work on other networks.&quot;</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="s2">&quot;Link selection does not contain unique link ID or alternate A and B nodes + &#39;name&#39;.&quot;</span>
                <span class="p">)</span>
                <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">valid</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Node Selection is not valid for network.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">validate_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selection</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Evaluate whetther the selection dictionary contains the</span>
<span class="sd">        minimum required values.</span>

<span class="sd">        Args:</span>
<span class="sd">            selection: selection dictionary to be evaluated</span>

<span class="sd">        Returns: boolean value as to whether the selection dictonary is valid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">selection</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;links&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_link_selection</span><span class="p">(</span><span class="n">selection</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">selection</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nodes&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_node_selection</span><span class="p">(</span><span class="n">selection</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Project Card Selection requires either &#39;links&#39; or &#39;nodes&#39; : </span><span class="se">\</span>
<span class="s2">                Selection provided: </span><span class="si">{</span><span class="n">selection</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">orig_dest_nodes_foreign_key</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">selection</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">node_foreign_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the foreign key id (whatever is used in the u and v</span>
<span class="sd">        variables in the links file) for the AB nodes as a tuple.</span>

<span class="sd">        Args:</span>
<span class="sd">            selection : selection dictionary with A and B keys</span>
<span class="sd">            node_foreign_key: variable name for whatever is used by the u and v variable</span>
<span class="sd">            in the links_df file.  If nothing is specified, assume whatever</span>
<span class="sd">            default is (usually osm_node_id)</span>

<span class="sd">        Returns: tuple of (A_id, B_id)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">node_foreign_key</span><span class="p">:</span>
            <span class="n">node_foreign_key</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">NODE_FOREIGN_KEY_TO_LINK</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">selection</span><span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="p">(</span><span class="s2">&quot;Selection A node dictionary should be of length 1&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">selection</span><span class="p">[</span><span class="s2">&quot;B&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="p">(</span><span class="s2">&quot;Selection B node dictionary should be of length 1&quot;</span><span class="p">)</span>

        <span class="n">A_node_key</span><span class="p">,</span> <span class="n">A_id</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">selection</span><span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
        <span class="n">B_node_key</span><span class="p">,</span> <span class="n">B_id</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">selection</span><span class="p">[</span><span class="s2">&quot;B&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>

        <span class="k">if</span> <span class="n">A_node_key</span> <span class="o">!=</span> <span class="n">node_foreign_key</span><span class="p">:</span>
            <span class="n">A_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">[</span><span class="n">A_node_key</span><span class="p">]</span> <span class="o">==</span> <span class="n">A_id</span><span class="p">][</span>
                <span class="n">node_foreign_key</span>
            <span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">B_node_key</span> <span class="o">!=</span> <span class="n">node_foreign_key</span><span class="p">:</span>
            <span class="n">B_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">[</span><span class="n">B_node_key</span><span class="p">]</span> <span class="o">==</span> <span class="n">B_id</span><span class="p">][</span>
                <span class="n">node_foreign_key</span>
            <span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">A_id</span><span class="p">,</span> <span class="n">B_id</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">ox_graph</span><span class="p">(</span><span class="n">nodes_df</span><span class="p">:</span> <span class="n">GeoDataFrame</span><span class="p">,</span> <span class="n">links_df</span><span class="p">:</span> <span class="n">GeoDataFrame</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        create an osmnx-flavored network graph</span>

<span class="sd">        osmnx doesn&#39;t like values that are arrays, so remove the variables</span>
<span class="sd">        that have arrays.  osmnx also requires that certain variables</span>
<span class="sd">        be filled in, so do that too.</span>

<span class="sd">        Args:</span>
<span class="sd">            nodes_df : GeoDataFrame of nodes</span>
<span class="sd">            links_df : GeoDataFrame of links</span>

<span class="sd">        Returns: a networkx multidigraph</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;starting ox_graph()&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;inboundReferenceIds&quot;</span> <span class="ow">in</span> <span class="n">nodes_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">graph_nodes</span> <span class="o">=</span> <span class="n">nodes_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span>
                <span class="p">[</span><span class="s2">&quot;inboundReferenceIds&quot;</span><span class="p">,</span> <span class="s2">&quot;outboundReferenceIds&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">graph_nodes</span> <span class="o">=</span> <span class="n">nodes_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">graph_nodes</span><span class="o">.</span><span class="n">gdf_name</span> <span class="o">=</span> <span class="s2">&quot;network_nodes&quot;</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;GRAPH NODES: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">graph_nodes</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
        <span class="n">graph_nodes</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">graph_nodes</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span><span class="p">]</span>

        <span class="n">graph_nodes</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">graph_nodes</span><span class="p">[</span><span class="s2">&quot;X&quot;</span><span class="p">]</span>
        <span class="n">graph_nodes</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">graph_nodes</span><span class="p">[</span><span class="s2">&quot;Y&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="s2">&quot;osm_link_id&quot;</span> <span class="ow">in</span> <span class="n">links_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">graph_links</span> <span class="o">=</span> <span class="n">links_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span>
                <span class="p">[</span><span class="s2">&quot;osm_link_id&quot;</span><span class="p">,</span> <span class="s2">&quot;locationReferences&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">graph_links</span> <span class="o">=</span> <span class="n">links_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;locationReferences&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># have to change this over into u,v b/c this is what osm-nx is expecting</span>
        <span class="n">graph_links</span><span class="p">[</span><span class="s2">&quot;u&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">graph_links</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">LINK_FOREIGN_KEY_TO_NODE</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">graph_links</span><span class="p">[</span><span class="s2">&quot;v&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">graph_links</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">LINK_FOREIGN_KEY_TO_NODE</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">graph_links</span><span class="p">[</span><span class="s2">&quot;key&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">graph_links</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_LINK_KEY</span><span class="p">]</span>

        <span class="c1"># Per osmnx u,v,key should be a multi-index;</span>
        <span class="c1">#     https://osmnx.readthedocs.io/en/stable/osmnx.html#osmnx.utils_graph.graph_from_gdfs</span>
        <span class="c1"># However - if the index is set before hand in osmnx version &lt;1.0 then it fails</span>
        <span class="c1">#     on the set_index line *within* osmnx.utils_graph.graph_from_gdfs():</span>
        <span class="c1">#           `for (u, v, k), row in gdf_edges.set_index([&quot;u&quot;, &quot;v&quot;, &quot;key&quot;]).iterrows():`</span>

        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">ox</span><span class="o">.</span><span class="n">__version__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">graph_links</span> <span class="o">=</span> <span class="n">graph_links</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;u&quot;</span><span class="p">,</span> <span class="s2">&quot;v&quot;</span><span class="p">,</span> <span class="s2">&quot;key&quot;</span><span class="p">],</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;starting ox.gdfs_to_graph()&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">G</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">graph_from_gdfs</span><span class="p">(</span><span class="n">graph_nodes</span><span class="p">,</span> <span class="n">graph_links</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">attr_error</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">attr_error</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="o">==</span> <span class="s2">&quot;module &#39;osmnx&#39; has no attribute &#39;graph_from_gdfs&#39;&quot;</span>
            <span class="p">):</span>
                <span class="c1"># This is the only exception for which we have a workaround</span>
                <span class="c1"># Does this still work given the u,v,key multi-indexing?</span>
                <span class="c1">#</span>
                <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="s2">&quot;Please upgrade your OSMNX package. For now, using deprecated</span><span class="se">\</span>
<span class="s2">                         osmnx.gdfs_to_graph because osmnx.graph_from_gdfs not found&quot;</span>
                <span class="p">)</span>
                <span class="n">G</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">gdfs_to_graph</span><span class="p">(</span><span class="n">graph_nodes</span><span class="p">,</span> <span class="n">graph_links</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># for other AttributeErrors, raise further</span>
                <span class="k">raise</span> <span class="n">attr_error</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># for other Exceptions, raise further</span>
            <span class="k">raise</span> <span class="n">e</span>

        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;finished ox.gdfs_to_graph()&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">G</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">selection_has_unique_link_id</span><span class="p">(</span><span class="n">selection_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            selection_dictionary: Dictionary representation of selection</span>
<span class="sd">                of roadway features, containing a &quot;links&quot; key.</span>

<span class="sd">        Returns: A boolean indicating if the selection dictionary contains</span>
<span class="sd">            a required unique link id.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">selection_keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">li</span> <span class="ow">in</span> <span class="n">selection_dict</span><span class="p">[</span><span class="s2">&quot;links&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">li</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span>
            <span class="nb">set</span><span class="p">(</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_MODEL_LINK_IDENTIFIERS</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span>
                <span class="nb">set</span><span class="p">(</span><span class="n">selection_keys</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">build_selection_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selection_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selections are stored by a hash of the selection dictionary.</span>

<span class="sd">        Args:</span>
<span class="sd">            selection_dictonary: Selection Dictionary</span>

<span class="sd">        Returns: Hex code for hash</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;selection_dict&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_fk_nodes</span><span class="p">(</span><span class="n">_links</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find the nodes for the candidate links.&quot;&quot;&quot;</span>
        <span class="n">_n</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="nb">set</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">i</span>
                    <span class="k">for</span> <span class="n">fk</span> <span class="ow">in</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">LINK_FOREIGN_KEY_TO_NODE</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">_links</span><span class="p">[</span><span class="n">fk</span><span class="p">])</span>
                <span class="p">]</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="c1"># WranglerLogger.debug(&quot;Node foreign key list: {}&quot;.format(_n))</span>
        <span class="k">return</span> <span class="n">_n</span>

    <span class="k">def</span> <span class="nf">shortest_path</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">graph_links_df</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span>
        <span class="n">O_id</span><span class="p">,</span>
        <span class="n">D_id</span><span class="p">,</span>
        <span class="n">nodes_df</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">weight_column</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;i&quot;</span><span class="p">,</span>
        <span class="n">weight_factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Args:</span>
<span class="sd">            graph_links_df:</span>
<span class="sd">            O_id: foreign key for start node</span>
<span class="sd">            D_id: foreign key for end node</span>
<span class="sd">            nodes_df: optional nodes df, otherwise will use network instance</span>
<span class="sd">            weight_column: column to use as a weight, defaults to &quot;i&quot;</span>
<span class="sd">            weight_factor: any additional weighting to multiply the weight column by, defaults</span>
<span class="sd">                to RoadwayNetwork.SP_WEIGHT_FACTOR</span>

<span class="sd">        Returns: tuple with length of four</span>
<span class="sd">        - Boolean if shortest path found</span>
<span class="sd">        - nx Directed graph of graph links</span>
<span class="sd">        - route of shortest path nodes as List</span>
<span class="sd">        - links in shortest path selected from links_df</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Calculating shortest path from </span><span class="si">{</span><span class="n">O_id</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">D_id</span><span class="si">}</span><span class="s2"> using </span><span class="si">{</span><span class="n">weight_column</span><span class="si">}</span><span class="s2"> as </span><span class="se">\</span>
<span class="s2">                weight with a factor of </span><span class="si">{</span><span class="n">weight_factor</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Prep Graph Links</span>
        <span class="k">if</span> <span class="n">weight_column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">graph_links_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> not in graph_links_df so adding and initializing to 1.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">weight_column</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">graph_links_df</span><span class="p">[</span><span class="n">weight_column</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">graph_links_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;weight&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span>
            <span class="n">graph_links_df</span><span class="p">[</span><span class="n">weight_column</span><span class="p">]</span> <span class="o">*</span> <span class="n">weight_factor</span>
        <span class="p">)</span>

        <span class="c1"># Select Graph Nodes</span>
        <span class="n">node_list_foreign_keys</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">_get_fk_nodes</span><span class="p">(</span><span class="n">graph_links_df</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">O_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">node_list_foreign_keys</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;O_id: </span><span class="si">{}</span><span class="s2"> not in Graph for finding shortest Path&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">O_id</span><span class="p">)</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">D_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">node_list_foreign_keys</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;D_id: </span><span class="si">{}</span><span class="s2"> not in Graph for finding shortest Path&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">D_id</span><span class="p">)</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">nodes_df</span><span class="p">:</span>
            <span class="n">nodes_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span>
        <span class="n">graph_nodes_df</span> <span class="o">=</span> <span class="n">nodes_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">node_list_foreign_keys</span><span class="p">]</span>

        <span class="c1"># Create Graph</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Creating network graph&quot;</span><span class="p">)</span>
        <span class="n">G</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">ox_graph</span><span class="p">(</span><span class="n">graph_nodes_df</span><span class="p">,</span> <span class="n">graph_links_df</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">sp_route</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">shortest_path</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">O_id</span><span class="p">,</span> <span class="n">D_id</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s2">&quot;weight&quot;</span><span class="p">)</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Shortest path successfully routed&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">nx</span><span class="o">.</span><span class="n">NetworkXNoPath</span><span class="p">:</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;No SP from </span><span class="si">{}</span><span class="s2"> to </span><span class="si">{}</span><span class="s2"> Found.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">O_id</span><span class="p">,</span> <span class="n">D_id</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">graph_links_df</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

        <span class="n">sp_links</span> <span class="o">=</span> <span class="n">graph_links_df</span><span class="p">[</span>
            <span class="n">graph_links_df</span><span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">sp_route</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">graph_links_df</span><span class="p">[</span><span class="s2">&quot;B&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">sp_route</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">graph_links_df</span><span class="p">,</span> <span class="n">sp_route</span><span class="p">,</span> <span class="n">sp_links</span>

    <span class="k">def</span> <span class="nf">path_search</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">candidate_links_df</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span>
        <span class="n">O_id</span><span class="p">,</span>
        <span class="n">D_id</span><span class="p">,</span>
        <span class="n">weight_column</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;i&quot;</span><span class="p">,</span>
        <span class="n">weight_factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Args:</span>
<span class="sd">            candidate_links: selection of links geodataframe with links likely to be part of path</span>
<span class="sd">            O_id: origin node foreigh key ID</span>
<span class="sd">            D_id: destination node foreigh key ID</span>
<span class="sd">            weight_column: column to use for weight of shortest path. Defaults to &quot;i&quot; (iteration)</span>
<span class="sd">            weight_factor: optional weight to multiply the weight column by when finding</span>
<span class="sd">                the shortest path</span>

<span class="sd">        Returns</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">_add_breadth</span><span class="p">(</span>
            <span class="n">_candidate_links_df</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span>
            <span class="n">_nodes_df</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span>
            <span class="n">_links_df</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span>
            <span class="n">i</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Add outbound and inbound reference IDs to candidate links</span>
<span class="sd">            from existing nodes</span>

<span class="sd">            Args:</span>
<span class="sd">                _candidate_links_df : df with the links from the previous iteration</span>
<span class="sd">                _nodes_df : df of all nodes in the full network</span>
<span class="sd">                _links_df : df of all links in the full network</span>
<span class="sd">                i : iteration of adding breadth</span>

<span class="sd">            Returns:</span>
<span class="sd">                candidate_links : GeoDataFrame</span>
<span class="sd">                    updated df with one more degree of added breadth</span>

<span class="sd">                node_list_foreign_keys : list of foreign key ids for nodes in the updated</span>
<span class="sd">                    candidate links to test if the A and B nodes are in there.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;-Adding Breadth-&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">i</span><span class="p">:</span>
                <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;i not specified in _add_breadth, using 1&quot;</span><span class="p">)</span>
                <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="n">_candidate_nodes_df</span> <span class="o">=</span> <span class="n">_nodes_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">_get_fk_nodes</span><span class="p">(</span><span class="n">_candidate_links_df</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Candidate Nodes: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">_candidate_nodes_df</span><span class="p">)))</span>

            <span class="c1"># Identify links to add based on outbound and inbound links from nodes</span>
            <span class="n">_links_shstRefId_to_add</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="nb">set</span><span class="p">(</span>
                    <span class="nb">sum</span><span class="p">(</span><span class="n">_candidate_nodes_df</span><span class="p">[</span><span class="s2">&quot;outboundReferenceIds&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="p">[])</span>
                    <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="n">_candidate_nodes_df</span><span class="p">[</span><span class="s2">&quot;inboundReferenceIds&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="p">[])</span>
                <span class="p">)</span>
                <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">_candidate_links_df</span><span class="p">[</span><span class="s2">&quot;shstReferenceId&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
                <span class="o">-</span> <span class="nb">set</span><span class="p">([</span><span class="s2">&quot;&quot;</span><span class="p">])</span>
            <span class="p">)</span>
            <span class="n">_links_to_add_df</span> <span class="o">=</span> <span class="n">_links_df</span><span class="p">[</span>
                <span class="n">_links_df</span><span class="o">.</span><span class="n">shstReferenceId</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">_links_shstRefId_to_add</span><span class="p">)</span>
            <span class="p">]</span>

            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Adding </span><span class="si">{}</span><span class="s2"> links.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_links_to_add_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

            <span class="c1"># Add information about what iteration the link was added in</span>
            <span class="n">_links_df</span><span class="p">[</span><span class="n">_links_df</span><span class="o">.</span><span class="n">model_link_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">_links_shstRefId_to_add</span><span class="p">)][</span><span class="s2">&quot;i&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>

            <span class="c1"># Append links and update node list</span>
            <span class="n">_candidate_links_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">_candidate_links_df</span><span class="p">,</span> <span class="n">_links_to_add_df</span><span class="p">])</span>
            <span class="n">_node_list_foreign_keys</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">_get_fk_nodes</span><span class="p">(</span><span class="n">_candidate_links_df</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">_candidate_links_df</span><span class="p">,</span> <span class="n">_node_list_foreign_keys</span>

        <span class="c1"># -----------------------------------</span>
        <span class="c1"># Set search breadth to zero + set max</span>
        <span class="c1"># -----------------------------------</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">max_i</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">SEARCH_BREADTH</span>
        <span class="c1"># -----------------------------------</span>
        <span class="c1"># Add links to the graph until</span>
        <span class="c1">#   (i) the A and B nodes are in the</span>
        <span class="c1">#       foreign key list</span>
        <span class="c1">#          - OR -</span>
        <span class="c1">#   (ii) reach maximum search breadth</span>
        <span class="c1"># -----------------------------------</span>
        <span class="n">node_list_foreign_keys</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">_get_fk_nodes</span><span class="p">(</span><span class="n">candidate_links_df</span><span class="p">)</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Initial set of nodes: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node_list_foreign_keys</span><span class="p">))</span>
        <span class="k">while</span> <span class="p">(</span>
            <span class="n">O_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">node_list_foreign_keys</span> <span class="ow">or</span> <span class="n">D_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">node_list_foreign_keys</span>
        <span class="p">)</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">max_i</span><span class="p">:</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s2">&quot;Adding breadth - i: </span><span class="si">{}</span><span class="s2">, Max i: </span><span class="si">{}</span><span class="s2">] - </span><span class="si">{}</span><span class="s2"> and </span><span class="si">{}</span><span class="s2"> not found in node list.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">i</span><span class="p">,</span> <span class="n">max_i</span><span class="p">,</span> <span class="n">O_id</span><span class="p">,</span> <span class="n">D_id</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">candidate_links_df</span><span class="p">,</span> <span class="n">node_list_foreign_keys</span> <span class="o">=</span> <span class="n">_add_breadth</span><span class="p">(</span>
                <span class="n">candidate_links_df</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="n">i</span>
            <span class="p">)</span>
        <span class="c1"># -----------------------------------</span>
        <span class="c1">#  Once have A and B in graph,</span>
        <span class="c1">#  Try calculating shortest path</span>
        <span class="c1"># -----------------------------------</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;calculating shortest path from graph&quot;</span><span class="p">)</span>
        <span class="p">(</span>
            <span class="n">sp_found</span><span class="p">,</span>
            <span class="n">graph</span><span class="p">,</span>
            <span class="n">candidate_links_df</span><span class="p">,</span>
            <span class="n">shortest_path_route</span><span class="p">,</span>
            <span class="n">shortest_path_links</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shortest_path</span><span class="p">(</span><span class="n">candidate_links_df</span><span class="p">,</span> <span class="n">O_id</span><span class="p">,</span> <span class="n">D_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sp_found</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">graph</span><span class="p">,</span> <span class="n">candidate_links_df</span><span class="p">,</span> <span class="n">shortest_path_route</span><span class="p">,</span> <span class="n">shortest_path_links</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">sp_found</span><span class="p">:</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s2">&quot;No shortest path found with breadth of </span><span class="si">{i}</span><span class="s2">, trying greater breadth until SP </span><span class="se">\</span>
<span class="s2">                    found or max breadth </span><span class="si">{max_i}</span><span class="s2"> reached.&quot;</span>
            <span class="p">)</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">sp_found</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">MAX_SEARCH_BREADTH</span><span class="p">:</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s2">&quot;Adding breadth, with shortest path iteration. i: </span><span class="si">{}</span><span class="s2"> Max i: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">i</span><span class="p">,</span> <span class="n">max_i</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">candidate_links_df</span><span class="p">,</span> <span class="n">node_list_foreign_keys</span> <span class="o">=</span> <span class="n">_add_breadth</span><span class="p">(</span>
                <span class="n">candidate_links_df</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="n">i</span>
            <span class="p">)</span>
            <span class="p">(</span>
                <span class="n">sp_found</span><span class="p">,</span>
                <span class="n">graph</span><span class="p">,</span>
                <span class="n">candidate_links_df</span><span class="p">,</span>
                <span class="n">route</span><span class="p">,</span>
                <span class="n">shortest_path_links</span><span class="p">,</span>
            <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shortest_path</span><span class="p">(</span><span class="n">candidate_links_df</span><span class="p">,</span> <span class="n">O_id</span><span class="p">,</span> <span class="n">D_id</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">sp_found</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">graph</span><span class="p">,</span> <span class="n">candidate_links_df</span><span class="p">,</span> <span class="n">route</span><span class="p">,</span> <span class="n">shortest_path_links</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">sp_found</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Couldn&#39;t find path from </span><span class="si">{}</span><span class="s2"> to </span><span class="si">{}</span><span class="s2"> after adding </span><span class="si">{}</span><span class="s2"> links in breadth&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">O_id</span><span class="p">,</span> <span class="n">D_id</span><span class="p">,</span> <span class="n">i</span>
            <span class="p">)</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">NoPathFound</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">select_roadway_features</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">selection</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">search_mode</span><span class="o">=</span><span class="s2">&quot;drive&quot;</span><span class="p">,</span> <span class="n">force_search</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects roadway features that satisfy selection criteria</span>

<span class="sd">        Example usage:</span>
<span class="sd">            net.select_roadway_features(</span>
<span class="sd">              selection = [ {</span>
<span class="sd">                #   a match condition for the from node using osm,</span>
<span class="sd">                #   shared streets, or model node number</span>
<span class="sd">                &#39;from&#39;: {&#39;osm_model_link_id&#39;: &#39;1234&#39;},</span>
<span class="sd">                #   a match for the to-node..</span>
<span class="sd">                &#39;to&#39;: {&#39;shstid&#39;: &#39;4321&#39;},</span>
<span class="sd">                #   a regex or match for facility condition</span>
<span class="sd">                #   could be # of lanes, facility type, etc.</span>
<span class="sd">                &#39;facility&#39;: {&#39;name&#39;:&#39;Main St&#39;},</span>
<span class="sd">                }, ... ])</span>

<span class="sd">        Args:</span>
<span class="sd">            selection : dictionary with keys for:</span>
<span class="sd">                 A - from node</span>
<span class="sd">                 B - to node</span>
<span class="sd">                 link - which includes at least a variable for `name` or &#39;all&#39; if all selected</span>
<span class="sd">            search_mode: will be overridden if &#39;link&#39;:&#39;all&#39;</span>

<span class="sd">        Returns: a list of indices for the selected links or nodes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;validating selection&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validate_selection</span><span class="p">(</span><span class="n">selection</span><span class="p">)</span>

        <span class="c1"># create a unique key for the selection so that we can cache it</span>
        <span class="n">sel_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_selection_key</span><span class="p">(</span><span class="n">selection</span><span class="p">)</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Selection Key: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sel_key</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">[</span><span class="n">sel_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;selection_found&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>

        <span class="k">if</span> <span class="s2">&quot;links&quot;</span> <span class="ow">in</span> <span class="n">selection</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_roadway_link_features</span><span class="p">(</span>
                <span class="n">selection</span><span class="p">,</span>
                <span class="n">sel_key</span><span class="p">,</span>
                <span class="n">force_search</span><span class="o">=</span><span class="n">force_search</span><span class="p">,</span>
                <span class="n">search_mode</span><span class="o">=</span><span class="n">search_mode</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;nodes&quot;</span> <span class="ow">in</span> <span class="n">selection</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_node_features</span><span class="p">(</span>
                <span class="n">selection</span><span class="p">,</span>
                <span class="n">sel_key</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid selection type. Must be either &#39;links&#39; or &#39;nodes&#39;.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">select_node_features</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">selection</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">sel_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Select Node Features.</span>

<span class="sd">        Args:</span>
<span class="sd">            selection (dict): selection dictionary from project card.</span>
<span class="sd">            sel_key (str): key to store selection in self.selections under.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of indices for selected nodes in self.nodes_df</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Selecting nodes.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">selection</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nodes&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="n">sel_query</span> <span class="o">=</span> <span class="n">ProjectCard</span><span class="o">.</span><span class="n">build_selection_query</span><span class="p">(</span>
            <span class="n">selection</span><span class="o">=</span><span class="n">selection</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;nodes&quot;</span><span class="p">,</span>
            <span class="n">unique_ids</span><span class="o">=</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_IDENTIFIERS</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Selecting node features:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sel_query</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">[</span><span class="n">sel_key</span><span class="p">][</span><span class="s2">&quot;selected_nodes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
            <span class="n">sel_query</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;python&quot;</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">[</span><span class="n">sel_key</span><span class="p">][</span><span class="s2">&quot;selected_nodes&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">[</span><span class="n">sel_key</span><span class="p">][</span><span class="s2">&quot;selection_found&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No nodes found for selection: </span><span class="si">{</span><span class="n">selection</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">[</span><span class="n">sel_key</span><span class="p">][</span><span class="s2">&quot;selected_nodes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">select_roadway_link_features</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">selection</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">sel_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">force_search</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">search_mode</span><span class="o">=</span><span class="s2">&quot;drive&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;_summary_</span>

<span class="sd">        Args:</span>
<span class="sd">            selection (dict): _description_</span>
<span class="sd">            sel_key: selection key hash to store selection in</span>
<span class="sd">            force_search (bool, optional): _description_. Defaults to False.</span>
<span class="sd">            search_mode (str, optional): _description_. Defaults to &quot;drive&quot;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of indices for selected links in self.links_df</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Selecting links.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">selection</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;links&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="c1"># if this selection has been found before, return the previously selected links</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sel_key</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;selection_found&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="ow">and</span> <span class="ow">not</span> <span class="n">force_search</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">[</span><span class="n">sel_key</span><span class="p">][</span><span class="s2">&quot;selected_links&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="n">unique_model_link_identifer_in_selection</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">selection_has_unique_link_id</span><span class="p">(</span><span class="n">selection</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">unique_model_link_identifer_in_selection</span><span class="p">:</span>
            <span class="n">A_id</span><span class="p">,</span> <span class="n">B_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">orig_dest_nodes_foreign_key</span><span class="p">(</span><span class="n">selection</span><span class="p">)</span>
        <span class="c1"># identify candidate links which match the initial query</span>
        <span class="c1"># assign them as iteration = 0</span>
        <span class="c1"># subsequent iterations that didn&#39;t match the query will be</span>
        <span class="c1"># assigned a heigher weight in the shortest path</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Building selection query&quot;</span><span class="p">)</span>
        <span class="c1"># build a selection query based on the selection dictionary</span>

        <span class="n">sel_query</span> <span class="o">=</span> <span class="n">ProjectCard</span><span class="o">.</span><span class="n">build_selection_query</span><span class="p">(</span>
            <span class="n">selection</span><span class="o">=</span><span class="n">selection</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;links&quot;</span><span class="p">,</span>
            <span class="n">unique_ids</span><span class="o">=</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_MODEL_LINK_IDENTIFIERS</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">MODES_TO_NETWORK_LINK_VARIABLES</span><span class="p">[</span><span class="n">search_mode</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Selecting link features:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sel_query</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">[</span><span class="n">sel_key</span><span class="p">][</span><span class="s2">&quot;candidate_links&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
            <span class="n">sel_query</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;python&quot;</span>
        <span class="p">)</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Completed query&quot;</span><span class="p">)</span>
        <span class="n">candidate_links</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">[</span><span class="n">sel_key</span><span class="p">][</span>
            <span class="s2">&quot;candidate_links&quot;</span>
        <span class="p">]</span>  <span class="c1"># b/c too long to keep that way</span>

        <span class="n">candidate_links</span><span class="p">[</span><span class="s2">&quot;i&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">candidate_links</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">unique_model_link_identifer_in_selection</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;No links found based on unique link identifiers.</span><span class="se">\n</span><span class="s2">Selection Failed.&quot;</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">candidate_links</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s2">&quot;No candidate links in initial search.</span><span class="se">\n</span><span class="s2">Retrying query using &#39;ref&#39; instead of </span><span class="se">\</span>
<span class="s2">                    &#39;name&#39;&quot;</span>
            <span class="p">)</span>
            <span class="c1"># if the query doesn&#39;t come back with something from &#39;name&#39;</span>
            <span class="c1"># try it again with &#39;ref&#39; instead</span>
            <span class="n">selection_has_name_key</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="s2">&quot;name&quot;</span> <span class="ow">in</span> <span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">selection</span><span class="p">[</span><span class="s2">&quot;links&quot;</span><span class="p">])</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">selection_has_name_key</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Not able to complete search using &#39;ref&#39; instead of &#39;name&#39; because &#39;name&#39; </span><span class="se">\</span>
<span class="s2">                    not in search.&quot;</span>
                <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

            <span class="k">if</span> <span class="s2">&quot;ref&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Not able to complete search using &#39;ref&#39; because &#39;ref&#39; not in network.&quot;</span>
                <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Trying selection query replacing &#39;name&#39; with &#39;ref&#39;&quot;</span><span class="p">)</span>
            <span class="n">sel_query</span> <span class="o">=</span> <span class="n">sel_query</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;ref&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">[</span><span class="n">sel_key</span><span class="p">][</span><span class="s2">&quot;candidate_links&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
                <span class="n">sel_query</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;python&quot;</span>
            <span class="p">)</span>
            <span class="n">candidate_links</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">[</span><span class="n">sel_key</span><span class="p">][</span><span class="s2">&quot;candidate_links&quot;</span><span class="p">]</span>

            <span class="n">candidate_links</span><span class="p">[</span><span class="s2">&quot;i&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">candidate_links</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;No candidate links in search using either &#39;name&#39; or &#39;ref&#39; in query.</span><span class="se">\</span>
<span class="s2">                    Selection Failed.&quot;</span>
                <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">unique_model_link_identifer_in_selection</span><span class="p">:</span>
            <span class="c1"># unique identifier exists and no need to go through big search</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">[</span><span class="n">sel_key</span><span class="p">][</span><span class="s2">&quot;selected_links&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">[</span><span class="n">sel_key</span><span class="p">][</span>
                <span class="s2">&quot;candidate_links&quot;</span>
            <span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">[</span><span class="n">sel_key</span><span class="p">][</span><span class="s2">&quot;selection_found&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">[</span><span class="n">sel_key</span><span class="p">][</span><span class="s2">&quot;selected_links&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Not a unique ID selection, conduct search.&quot;</span><span class="p">)</span>
            <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">[</span><span class="n">sel_key</span><span class="p">][</span><span class="s2">&quot;graph&quot;</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">[</span><span class="n">sel_key</span><span class="p">][</span><span class="s2">&quot;candidate_links&quot;</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">[</span><span class="n">sel_key</span><span class="p">][</span><span class="s2">&quot;route&quot;</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">[</span><span class="n">sel_key</span><span class="p">][</span><span class="s2">&quot;links&quot;</span><span class="p">],</span>
            <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_search</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">[</span><span class="n">sel_key</span><span class="p">][</span><span class="s2">&quot;candidate_links&quot;</span><span class="p">],</span>
                <span class="n">A_id</span><span class="p">,</span>
                <span class="n">B_id</span><span class="p">,</span>
                <span class="n">weight_factor</span><span class="o">=</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">SP_WEIGHT_FACTOR</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">selection</span><span class="p">[</span><span class="s2">&quot;links&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">[</span><span class="n">sel_key</span><span class="p">][</span><span class="s2">&quot;selected_links&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">[</span><span class="n">sel_key</span><span class="p">][</span>
                    <span class="s2">&quot;links&quot;</span>
                <span class="p">]</span>

            <span class="c1"># Conduct a &quot;selection on the selection&quot; if have additional requirements to satisfy</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">resel_query</span> <span class="o">=</span> <span class="n">ProjectCard</span><span class="o">.</span><span class="n">build_selection_query</span><span class="p">(</span>
                    <span class="n">selection</span><span class="o">=</span><span class="n">selection</span><span class="p">,</span>
                    <span class="n">unique_ids</span><span class="o">=</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_MODEL_LINK_IDENTIFIERS</span><span class="p">,</span>
                    <span class="n">mode</span><span class="o">=</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">MODES_TO_NETWORK_LINK_VARIABLES</span><span class="p">[</span><span class="n">search_mode</span><span class="p">],</span>
                    <span class="n">ignore</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                <span class="p">)</span>
                <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Reselecting features:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resel_query</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">[</span><span class="n">sel_key</span><span class="p">][</span><span class="s2">&quot;selected_links&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">[</span><span class="n">sel_key</span><span class="p">][</span>
                    <span class="s2">&quot;links&quot;</span>
                <span class="p">]</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">resel_query</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;python&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">[</span><span class="n">sel_key</span><span class="p">][</span><span class="s2">&quot;selected_links&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">[</span><span class="n">sel_key</span><span class="p">][</span><span class="s2">&quot;selection_found&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No links found for selection: </span><span class="si">{</span><span class="n">selection</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">[</span><span class="n">sel_key</span><span class="p">][</span><span class="s2">&quot;selection_found&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">[</span><span class="n">sel_key</span><span class="p">][</span><span class="s2">&quot;selected_links&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">validate_properties</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">properties</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">ignore_existing</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">require_existing_for_change</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If there are change or existing commands, make sure that that</span>
<span class="sd">        property exists in the network.</span>

<span class="sd">        Args:</span>
<span class="sd">            properties : properties dictionary to be evaluated</span>
<span class="sd">            df: links_df or nodes_df or shapes_df to check for compatibility with</span>
<span class="sd">            ignore_existing: If True, will only warn about properties</span>
<span class="sd">                that specify an &quot;existing&quot; value.  If False, will fail.</span>
<span class="sd">            require_existing_for_change: If True, will fail if there isn&#39;t</span>
<span class="sd">                a specified value in theproject card for existing when a</span>
<span class="sd">                change is specified.</span>

<span class="sd">        Returns: boolean value as to whether the properties dictonary is valid.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">valid</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">properties</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;property&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="n">p</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;change&quot;</span><span class="p">):</span>
                <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;&quot;Change&quot; is specified for attribute </span><span class="si">{</span><span class="w"> </span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;property&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">, but doesn</span><span class="se">\&#39;</span><span class="s1">t </span><span class="se">\</span>
<span class="s1">                            exist in base network&#39;</span>
                <span class="p">)</span>
                <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">p</span><span class="p">[</span><span class="s2">&quot;property&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span>
                <span class="ow">and</span> <span class="n">p</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;existing&quot;</span><span class="p">)</span>
                <span class="ow">and</span> <span class="ow">not</span> <span class="n">ignore_existing</span>
            <span class="p">):</span>
                <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;&quot;Existing&quot; is specified for attribute </span><span class="si">{</span><span class="w"> </span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;property&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">, but doesn</span><span class="se">\&#39;</span><span class="s1">t </span><span class="se">\</span>
<span class="s1">                        exist in base network&#39;</span>
                <span class="p">)</span>
                <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;change&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">p</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;existing&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">require_existing_for_change</span><span class="p">:</span>
                    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s1">&#39;&quot;Change&quot; is specified for attribute </span><span class="si">{</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;property&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">, but there </span><span class="se">\</span>
<span class="s1">                            isn</span><span class="se">\&#39;</span><span class="s1">t a value for existing.</span><span class="se">\n</span><span class="s1">To proceed, run with the setting </span><span class="se">\</span>
<span class="s1">                            require_existing_for_change=False&#39;</span>
                    <span class="p">)</span>
                    <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s1">&#39;&quot;Change&quot; is specified for attribute </span><span class="si">{</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;property&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">, but there </span><span class="se">\</span>
<span class="s1">                            isn</span><span class="se">\&#39;</span><span class="s1">t a value for existing&#39;</span>
                    <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">valid</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Property changes are not valid:</span><span class="se">\n</span><span class="s2">  {properties&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">project_card_dictionary</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">_subproject</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;RoadwayNetwork&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Wrapper method to apply a roadway project, returning a new RoadwayNetwork instance.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_card_dictionary: a dictionary of the project card object</span>
<span class="sd">            _subproject: boolean indicating if this is a subproject under a &quot;changes&quot; heading.</span>
<span class="sd">                Defaults to False. Will be set to true with code when necessary.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_subproject</span><span class="p">:</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Applying Project to Roadway Network: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">project_card_dictionary</span><span class="p">[</span><span class="s2">&quot;project&quot;</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">project_card_dictionary</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;changes&quot;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">project_dictionary</span> <span class="ow">in</span> <span class="n">project_card_dictionary</span><span class="p">[</span><span class="s2">&quot;changes&quot;</span><span class="p">]:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">project_dictionary</span><span class="p">,</span> <span class="n">_subproject</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">project_dictionary</span> <span class="o">=</span> <span class="n">project_card_dictionary</span>

        <span class="n">_facility</span> <span class="o">=</span> <span class="n">project_dictionary</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;facility&quot;</span><span class="p">)</span>
        <span class="n">_category</span> <span class="o">=</span> <span class="n">project_dictionary</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">_facility</span><span class="p">:</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Selecting Facility: </span><span class="si">{</span><span class="n">_facility</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">_geometry_type</span> <span class="o">=</span> <span class="nb">list</span><span class="p">({</span><span class="s2">&quot;links&quot;</span><span class="p">,</span> <span class="s2">&quot;nodes&quot;</span><span class="p">}</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">_facility</span><span class="p">)))</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">_geometry_type</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
            <span class="p">),</span> <span class="s2">&quot;Facility must have exactly one of &#39;links&#39; or &#39;nodes&#39;&quot;</span>
            <span class="n">_geometry_type</span> <span class="o">=</span> <span class="n">_geometry_type</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">_df_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_roadway_features</span><span class="p">(</span><span class="n">_facility</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">_category</span> <span class="o">==</span> <span class="s2">&quot;roadway property change&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_roadway_feature_change</span><span class="p">(</span>
                <span class="n">_df_idx</span><span class="p">,</span>
                <span class="n">project_dictionary</span><span class="p">[</span><span class="s2">&quot;properties&quot;</span><span class="p">],</span>
                <span class="n">geometry_type</span><span class="o">=</span><span class="n">_geometry_type</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">_category</span> <span class="o">==</span> <span class="s2">&quot;parallel managed lanes&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_managed_lane_feature_change</span><span class="p">(</span>
                <span class="n">_df_idx</span><span class="p">,</span>
                <span class="n">project_dictionary</span><span class="p">[</span><span class="s2">&quot;properties&quot;</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">_category</span> <span class="o">==</span> <span class="s2">&quot;add new roadway&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_new_roadway_feature_change</span><span class="p">(</span>
                <span class="n">project_dictionary</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;links&quot;</span><span class="p">,</span> <span class="p">[]),</span>
                <span class="n">project_dictionary</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nodes&quot;</span><span class="p">,</span> <span class="p">[]),</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">_category</span> <span class="o">==</span> <span class="s2">&quot;roadway deletion&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">delete_roadway_feature_change</span><span class="p">(</span>
                <span class="n">project_dictionary</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;links&quot;</span><span class="p">,</span> <span class="p">[]),</span>
                <span class="n">project_dictionary</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nodes&quot;</span><span class="p">,</span> <span class="p">[]),</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">_category</span> <span class="o">==</span> <span class="s2">&quot;calculated roadway&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_python_calculation</span><span class="p">(</span>
                <span class="n">project_dictionary</span><span class="p">[</span><span class="s2">&quot;pycode&quot;</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid Project Card Category: </span><span class="si">{</span><span class="n">_category</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">update_node_geometry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">updated_nodes</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds or updates the geometry of the nodes in the network based on XY coordinates.</span>

<span class="sd">        Assumes XY are in self.crs.</span>
<span class="sd">        Also updates the geometry of links and shapes that reference these nodes.</span>

<span class="sd">        Args:</span>
<span class="sd">            updated_nodes: List of nodes to update. Defaults to all nodes.</span>

<span class="sd">        Returns:</span>
<span class="sd">           gpd.GeoDataFrame: nodes geodataframe with updated geometry.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">updated_nodes</span><span class="p">:</span>
            <span class="n">updated_nodes_df</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">updated_nodes</span><span class="p">)</span>
                <span class="p">]</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">updated_nodes_df</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">)</span>
            <span class="n">updated_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">updated_nodes_df</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">25</span><span class="p">:</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Original Nodes:</span><span class="se">\n</span><span class="si">{</span><span class="n">updated_nodes_df</span><span class="p">[[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">]]</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="n">updated_nodes_df</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">updated_nodes_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">point_from_xy</span><span class="p">(</span>
                <span class="n">x</span><span class="p">[</span><span class="s2">&quot;X&quot;</span><span class="p">],</span>
                <span class="n">x</span><span class="p">[</span><span class="s2">&quot;Y&quot;</span><span class="p">],</span>
                <span class="n">xy_crs</span><span class="o">=</span><span class="n">updated_nodes_df</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span>
                <span class="n">point_crs</span><span class="o">=</span><span class="n">updated_nodes_df</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">)</span><span class="si">}</span><span class="s2"> nodes in network before update&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">updated_nodes_df</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">25</span><span class="p">:</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Updated Nodes:</span><span class="se">\n</span><span class="si">{</span><span class="n">updated_nodes_df</span><span class="p">[[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">]]</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="n">updated_nodes_df</span><span class="p">[[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span><span class="p">,</span> <span class="s2">&quot;geometry&quot;</span><span class="p">]]</span>
        <span class="p">)</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">)</span><span class="si">}</span><span class="s2"> nodes in network after update&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">25</span><span class="p">:</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Updated self.nodes_df:</span><span class="se">\n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">[[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">]]</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_update_node_geometry_in_links_shapes</span><span class="p">(</span><span class="n">updated_nodes_df</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">nodes_in_links</span><span class="p">(</span>
        <span class="n">links_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Collection</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a list of nodes that are contained in the links.</span>

<span class="sd">        Args:</span>
<span class="sd">            links_df: Links which to return node list for</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">links_df</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">25</span><span class="p">:</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Links:</span><span class="se">\n</span><span class="si">{</span><span class="n">links_df</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">LINK_FOREIGN_KEY_TO_NODE</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="n">nodes_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="nb">set</span><span class="p">(</span>
                <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">links_df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">LINK_FOREIGN_KEY_TO_NODE</span><span class="p">]</span>
                <span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nodes_list</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">25</span><span class="p">:</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_node_list:</span><span class="se">\n</span><span class="si">{</span><span class="n">nodes_list</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">nodes_list</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">links_with_nodes</span><span class="p">(</span>
        <span class="n">links_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">node_id_list</span><span class="p">:</span> <span class="nb">list</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a links geodataframe which start or end at the nodes in the list.</span>

<span class="sd">        Args:</span>
<span class="sd">            links_df: dataframe of links to search for nodes in</span>
<span class="sd">            node_id_list (list): List of nodes to find links for.  Nodes should be identified</span>
<span class="sd">                by the foreign key - the one that is referenced in LINK_FOREIGN_KEY.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If nodes are equal to all the nodes in the links, return all the links</span>
        <span class="n">_nodes_in_links</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">nodes_in_links</span><span class="p">(</span><span class="n">links_df</span><span class="p">)</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;# Nodes: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">node_id_list</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">Nodes in links:</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">_nodes_in_links</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">node_id_list</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">_nodes_in_links</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">links_df</span>

        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Finding links assocated with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">node_id_list</span><span class="p">)</span><span class="si">}</span><span class="s2"> nodes.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">node_id_list</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">25</span><span class="p">:</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;node_id_list: </span><span class="si">{</span><span class="n">node_id_list</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">_selected_links_df</span> <span class="o">=</span> <span class="n">links_df</span><span class="p">[</span>
            <span class="n">links_df</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span>
                <span class="p">{</span><span class="n">c</span><span class="p">:</span> <span class="n">node_id_list</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">LINK_FOREIGN_KEY_TO_NODE</span><span class="p">}</span>
            <span class="p">)</span>
        <span class="p">]</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Temp Selected </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">_selected_links_df</span><span class="p">)</span><span class="si">}</span><span class="s2"> associated with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">node_id_list</span><span class="p">)</span><span class="si">}</span><span class="s2"> nodes.&quot;</span>
        <span class="p">)</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        _query_parts = [</span>
<span class="sd">            f&quot;{prop} == {str(n)}&quot;</span>
<span class="sd">            for prop in RoadwayNetwork.LINK_FOREIGN_KEY_TO_NODE</span>
<span class="sd">            for n in node_id_list</span>
<span class="sd">        ]</span>

<span class="sd">        _query = &quot; or &quot;.join(_query_parts)</span>
<span class="sd">        _selected_links_df = links_df.query(_query, engine=&quot;python&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Selected </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">_selected_links_df</span><span class="p">)</span><span class="si">}</span><span class="s2"> associated with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">node_id_list</span><span class="p">)</span><span class="si">}</span><span class="s2"> nodes.&quot;</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">_selected_links_df</span>

    <span class="k">def</span> <span class="nf">_update_node_geometry_in_links_shapes</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">updated_nodes_df</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Updates the locationReferences &amp; geometry for given links &amp; shapes for a given node df</span>

<span class="sd">        Should be called by any function that changes a node location.</span>

<span class="sd">        NOTES:</span>
<span class="sd">         - For shapes, this will mutate the geometry of a shape in place for the start and end node</span>
<span class="sd">            ...but not the nodes in-between.  Something to consider...</span>

<span class="sd">        Args:</span>
<span class="sd">            updated_nodes_df: gdf of nodes with updated geometry.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_node_ids</span> <span class="o">=</span> <span class="n">updated_nodes_df</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">NODE_FOREIGN_KEY_TO_LINK</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">updated_links_df</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span>
            <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">links_with_nodes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="p">,</span> <span class="n">_node_ids</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">_shape_ids</span> <span class="o">=</span> <span class="n">updated_links_df</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">LINK_FOREIGN_KEY_TO_SHAPE</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">updated_shapes_df</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shapes_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">shapes_df</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_SHAPE_KEY</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">_shape_ids</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="p">)</span>

        <span class="n">updated_links_df</span><span class="p">[</span><span class="s2">&quot;locationReferences&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_link_locationreferences</span><span class="p">(</span>
            <span class="n">updated_links_df</span>
        <span class="p">)</span>
        <span class="n">updated_links_df</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">updated_links_df</span><span class="p">[</span><span class="s2">&quot;locationReferences&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="n">line_string_from_location_references</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">updated_shapes_df</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_existing_shape_geometry_from_nodes</span><span class="p">(</span>
            <span class="n">updated_shapes_df</span><span class="p">,</span> <span class="n">updated_links_df</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="n">updated_links_df</span><span class="p">[</span>
                <span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_LINK_KEY</span><span class="p">,</span> <span class="s2">&quot;geometry&quot;</span><span class="p">,</span> <span class="s2">&quot;locationReferences&quot;</span><span class="p">]</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shapes_df</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="n">updated_shapes_df</span><span class="p">[[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_SHAPE_KEY</span><span class="p">,</span> <span class="s2">&quot;geometry&quot;</span><span class="p">]]</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_link_locationreferences</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">links_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
        <span class="n">locationreferences_s</span> <span class="o">=</span> <span class="n">links_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">location_reference_from_nodes</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">[</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">NODE_FOREIGN_KEY_TO_LINK</span><span class="p">]</span>
                        <span class="o">==</span> <span class="n">x</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">LINK_FOREIGN_KEY_TO_NODE</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                    <span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">[</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">NODE_FOREIGN_KEY_TO_LINK</span><span class="p">]</span>
                        <span class="o">==</span> <span class="n">x</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">LINK_FOREIGN_KEY_TO_NODE</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
                    <span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span>
                <span class="p">]</span>
            <span class="p">),</span>
            <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">locationreferences_s</span>

    <span class="k">def</span> <span class="nf">_add_link_geometry_from_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">links_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">:</span>
        <span class="n">links_df</span><span class="p">[</span><span class="s2">&quot;locationReferences&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_link_locationreferences</span><span class="p">(</span><span class="n">links_df</span><span class="p">)</span>
        <span class="n">links_df</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">links_df</span><span class="p">[</span><span class="s2">&quot;locationReferences&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="n">line_string_from_location_references</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">links_df</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">links_df</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">links_df</span>

    <span class="k">def</span> <span class="nf">_update_existing_shape_geometry_from_nodes</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">updated_shapes_df</span><span class="p">,</span> <span class="n">updated_links_df</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">:</span>
        <span class="c1"># WranglerLogger.debug(f&quot;updated_shapes_df:\n {updated_shapes_df}&quot;)</span>
        <span class="c1"># update the first and last coordinates for the shape</span>

        <span class="n">_df</span> <span class="o">=</span> <span class="n">updated_shapes_df</span><span class="p">[[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_SHAPE_KEY</span><span class="p">,</span> <span class="s2">&quot;geometry&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
            <span class="n">updated_links_df</span><span class="p">[[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">LINK_FOREIGN_KEY_TO_SHAPE</span><span class="p">,</span> <span class="s2">&quot;geometry&quot;</span><span class="p">]],</span>
            <span class="n">left_on</span><span class="o">=</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_SHAPE_KEY</span><span class="p">,</span>
            <span class="n">right_on</span><span class="o">=</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">LINK_FOREIGN_KEY_TO_SHAPE</span><span class="p">,</span>
            <span class="n">suffixes</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;_old_shape&quot;</span><span class="p">,</span> <span class="s2">&quot;_link&quot;</span><span class="p">],</span>
            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">position</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">_df</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">update_points_in_linestring</span><span class="p">(</span>
                    <span class="n">x</span><span class="p">[</span><span class="s2">&quot;geometry_old_shape&quot;</span><span class="p">],</span>
                    <span class="n">_df</span><span class="p">[</span><span class="s2">&quot;geometry_link&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="n">position</span><span class="p">],</span>
                    <span class="n">position</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">_df</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_create_new_link_geometry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_links_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">:</span>
        <span class="n">new_links_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_link_geometry_from_nodes</span><span class="p">(</span><span class="n">new_links_df</span><span class="p">)</span>
        <span class="n">new_links_df</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_SHAPE_KEY</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_links_df</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="n">create_unique_shape_id</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">new_links_df</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_create_new_shapes_from_links</span><span class="p">(</span><span class="n">links_df</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">:</span>
        <span class="n">new_shapes_df</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span>
            <span class="n">links_df</span><span class="p">[[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_SHAPE_KEY</span><span class="p">,</span> <span class="s2">&quot;geometry&quot;</span><span class="p">]]</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">new_shapes_df</span>

    <span class="k">def</span> <span class="nf">apply_python_calculation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pycode</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;RoadwayNetwork&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Changes roadway network object by executing pycode.</span>

<span class="sd">        Args:</span>
<span class="sd">            net: network to manipulate</span>
<span class="sd">            pycode: python code which changes values in the roadway network object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">exec</span><span class="p">(</span><span class="n">pycode</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">_add_property</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">property_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a property to a dataframe. Infers type from the property_dict &quot;set&quot; value.</span>

<span class="sd">        Args:</span>
<span class="sd">            df: dataframe to add property to</span>
<span class="sd">            property_dict: dictionary of property to add with &quot;set&quot; value.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: dataframe with property added filled with NaN.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adding property: </span><span class="si">{</span><span class="n">property_dict</span><span class="p">[</span><span class="s1">&#39;property&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="n">property_dict</span><span class="p">[</span><span class="s2">&quot;property&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">_update_property</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">existing_facilities_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="nb">property</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;_summary_</span>

<span class="sd">        Args:</span>
<span class="sd">            existing_facilities_df: selected existing facility df</span>
<span class="sd">            property (dict): project property update</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># WranglerLogger.debug(f&quot;property:\n{property}&quot;)</span>
        <span class="c1"># WranglerLogger.debug(f&quot;existing_facilities_df:\n{existing_facilities_df}&quot;)</span>
        <span class="k">if</span> <span class="s2">&quot;existing&quot;</span> <span class="ow">in</span> <span class="nb">property</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="ow">not</span> <span class="n">existing_facilities_df</span><span class="p">[</span><span class="nb">property</span><span class="p">[</span><span class="s2">&quot;property&quot;</span><span class="p">]]</span>
                <span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="nb">property</span><span class="p">[</span><span class="s2">&quot;existing&quot;</span><span class="p">])</span>
                <span class="o">.</span><span class="n">all</span><span class="p">()</span>
            <span class="p">):</span>
                <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;Existing value defined for </span><span class="si">{}</span><span class="s2"> in project card does &quot;</span>
                    <span class="s2">&quot;not match the value in the roadway network for the &quot;</span>
                    <span class="s2">&quot;selected links&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">property</span><span class="p">[</span><span class="s2">&quot;property&quot;</span><span class="p">])</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;set&quot;</span> <span class="ow">in</span> <span class="nb">property</span><span class="p">:</span>
            <span class="n">_updated_series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
                <span class="nb">property</span><span class="p">[</span><span class="s2">&quot;set&quot;</span><span class="p">],</span>
                <span class="n">name</span><span class="o">=</span><span class="nb">property</span><span class="p">[</span><span class="s2">&quot;property&quot;</span><span class="p">],</span>
                <span class="n">index</span><span class="o">=</span><span class="n">existing_facilities_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">elif</span> <span class="s2">&quot;change&quot;</span> <span class="ow">in</span> <span class="nb">property</span><span class="p">:</span>
            <span class="n">_updated_series</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">existing_facilities_df</span><span class="p">[</span><span class="nb">property</span><span class="p">[</span><span class="s2">&quot;property&quot;</span><span class="p">]]</span> <span class="o">+</span> <span class="nb">property</span><span class="p">[</span><span class="s2">&quot;change&quot;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Property: </span><span class="se">\n</span><span class="s2"> </span><span class="si">{</span><span class="nb">property</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;No &#39;set&#39; or &#39;change&#39; specified for property </span><span class="si">{</span><span class="nb">property</span><span class="p">[</span><span class="s1">&#39;property&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="se">\</span>
<span class="s2">                    in Roadway Network Change project card&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">_updated_series</span>

    <span class="k">def</span> <span class="nf">apply_roadway_feature_change</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">df_idx</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
        <span class="n">properties</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">geometry_type</span><span class="o">=</span><span class="s2">&quot;links&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;RoadwayNetwork&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Changes the roadway attributes for the selected features based on the</span>
<span class="sd">        project card information passed</span>

<span class="sd">        Args:</span>
<span class="sd">            df_idx : list</span>
<span class="sd">                lndices of all links or nodes to apply change to</span>
<span class="sd">            properties : list of dictionarys</span>
<span class="sd">                roadway properties to change</span>
<span class="sd">            geometry_type: either &#39;links&#39; or &#39;nodes&#39;. Defaults to &#39;link&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">geometry_type</span> <span class="o">==</span> <span class="s2">&quot;links&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_apply_links_feature_change</span><span class="p">(</span><span class="n">df_idx</span><span class="p">,</span> <span class="n">properties</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">geometry_type</span> <span class="o">==</span> <span class="s2">&quot;nodes&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_apply_nodes_feature_change</span><span class="p">(</span><span class="n">df_idx</span><span class="p">,</span> <span class="n">properties</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;geometry_type must be either &#39;links&#39; or &#39;nodes&#39;&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">_apply_nodes_feature_change</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">node_idx</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
        <span class="n">properties</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;RoadwayNetwork&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Changes the roadway attributes for the selected nodes based on the</span>
<span class="sd">        project card information passed</span>

<span class="sd">        Args:</span>
<span class="sd">            df_idx : list of indices of all links or nodes to apply change to</span>
<span class="sd">            properties : list of dictionarys</span>
<span class="sd">                roadway properties to change</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Updating Nodes&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">validate_properties</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">,</span> <span class="n">properties</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">properties</span><span class="p">:</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;property&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_property</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>

            <span class="n">_updated_nodes_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_property</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">node_idx</span><span class="p">],</span> <span class="n">p</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">_updated_nodes_df</span><span class="p">)</span>

        <span class="n">_property_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;property&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">properties</span><span class="p">]</span>

        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Updated following node properties: </span><span class="se">\</span>
<span class="s2">            </span><span class="si">{</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_property_names</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">_property_names</span> <span class="k">if</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">GEOMETRY_PROPERTIES</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_node_geometry</span><span class="p">(</span><span class="n">node_idx</span><span class="p">)</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Updated node geometry and associated links/shapes.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span>

    <span class="k">def</span> <span class="nf">_apply_links_feature_change</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">link_idx</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
        <span class="n">properties</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;RoadwayNetwork&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Changes the roadway attributes for the selected links based on the</span>
<span class="sd">        project card information passed</span>

<span class="sd">        Args:</span>
<span class="sd">            link_idx : list od indices of all links to apply change to</span>
<span class="sd">            properties : list of dictionarys</span>
<span class="sd">                roadway properties to change</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Updating Links.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">validate_properties</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="p">,</span> <span class="n">properties</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">properties</span><span class="p">:</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;property&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_property</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>

            <span class="n">_updated_links_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_property</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">link_idx</span><span class="p">],</span> <span class="n">p</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">_updated_links_df</span><span class="p">)</span>

        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Updated following link properties: </span><span class="se">\</span>
<span class="s2">            </span><span class="si">{</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;property&#39;</span><span class="p">]</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">properties</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">apply_managed_lane_feature_change</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">link_idx</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
        <span class="n">properties</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;RoadwayNetwork&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Apply the managed lane feature changes to the roadway network</span>

<span class="sd">        Args:</span>
<span class="sd">            link_idx : list of lndices of all links to apply change to</span>
<span class="sd">            properties : list of dictionarys roadway properties to change</span>

<span class="sd">        .. todo:: decide on connectors info when they are more specific in project card</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># add ML flag to relevant links</span>
        <span class="k">if</span> <span class="s2">&quot;managed&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">link_idx</span><span class="p">,</span> <span class="s2">&quot;managed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="p">[</span><span class="s2">&quot;managed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">link_idx</span><span class="p">,</span> <span class="s2">&quot;managed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">properties</span><span class="p">:</span>
            <span class="n">attribute</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;property&quot;</span><span class="p">]</span>
            <span class="n">attr_value</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">link_idx</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;group&quot;</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">attr_value</span> <span class="o">=</span> <span class="p">{}</span>

                    <span class="k">if</span> <span class="s2">&quot;set&quot;</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">attr_value</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;set&quot;</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="s2">&quot;change&quot;</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">attr_value</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">attribute</span><span class="p">]</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;change&quot;</span><span class="p">]</span>
                        <span class="p">)</span>

                    <span class="n">attr_value</span><span class="p">[</span><span class="s2">&quot;timeofday&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

                    <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;group&quot;</span><span class="p">]:</span>
                        <span class="n">category</span> <span class="o">=</span> <span class="n">g</span><span class="p">[</span><span class="s2">&quot;category&quot;</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">tod</span> <span class="ow">in</span> <span class="n">g</span><span class="p">[</span><span class="s2">&quot;timeofday&quot;</span><span class="p">]:</span>
                            <span class="k">if</span> <span class="s2">&quot;set&quot;</span> <span class="ow">in</span> <span class="n">tod</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                                <span class="n">attr_value</span><span class="p">[</span><span class="s2">&quot;timeofday&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                    <span class="p">{</span>
                                        <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="n">category</span><span class="p">,</span>
                                        <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">parse_time_spans_to_secs</span><span class="p">(</span><span class="n">tod</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]),</span>
                                        <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">tod</span><span class="p">[</span><span class="s2">&quot;set&quot;</span><span class="p">],</span>
                                    <span class="p">}</span>
                                <span class="p">)</span>
                            <span class="k">elif</span> <span class="s2">&quot;change&quot;</span> <span class="ow">in</span> <span class="n">tod</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                                <span class="n">attr_value</span><span class="p">[</span><span class="s2">&quot;timeofday&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                    <span class="p">{</span>
                                        <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="n">category</span><span class="p">,</span>
                                        <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">parse_time_spans_to_secs</span><span class="p">(</span><span class="n">tod</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]),</span>
                                        <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">attribute</span><span class="p">]</span>
                                        <span class="o">+</span> <span class="n">tod</span><span class="p">[</span><span class="s2">&quot;change&quot;</span><span class="p">],</span>
                                    <span class="p">}</span>
                                <span class="p">)</span>

                <span class="k">elif</span> <span class="s2">&quot;timeofday&quot;</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">attr_value</span> <span class="o">=</span> <span class="p">{}</span>

                    <span class="k">if</span> <span class="s2">&quot;set&quot;</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">attr_value</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;set&quot;</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="s2">&quot;change&quot;</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">attr_value</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">attribute</span><span class="p">]</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;change&quot;</span><span class="p">]</span>
                        <span class="p">)</span>

                    <span class="n">attr_value</span><span class="p">[</span><span class="s2">&quot;timeofday&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

                    <span class="k">for</span> <span class="n">tod</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;timeofday&quot;</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="s2">&quot;set&quot;</span> <span class="ow">in</span> <span class="n">tod</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                            <span class="n">attr_value</span><span class="p">[</span><span class="s2">&quot;timeofday&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                <span class="p">{</span>
                                    <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">parse_time_spans_to_secs</span><span class="p">(</span><span class="n">tod</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]),</span>
                                    <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">tod</span><span class="p">[</span><span class="s2">&quot;set&quot;</span><span class="p">],</span>
                                <span class="p">}</span>
                            <span class="p">)</span>
                        <span class="k">elif</span> <span class="s2">&quot;change&quot;</span> <span class="ow">in</span> <span class="n">tod</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                            <span class="n">attr_value</span><span class="p">[</span><span class="s2">&quot;timeofday&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                <span class="p">{</span>
                                    <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">parse_time_spans_to_secs</span><span class="p">(</span><span class="n">tod</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]),</span>
                                    <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">attribute</span><span class="p">]</span>
                                    <span class="o">+</span> <span class="n">tod</span><span class="p">[</span><span class="s2">&quot;change&quot;</span><span class="p">],</span>
                                <span class="p">}</span>
                            <span class="p">)</span>
                <span class="k">elif</span> <span class="s2">&quot;set&quot;</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">attr_value</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;set&quot;</span><span class="p">]</span>

                <span class="k">elif</span> <span class="s2">&quot;change&quot;</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">attr_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">attribute</span><span class="p">]</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;change&quot;</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span>
                    <span class="n">attr_value</span><span class="p">,</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span>
                <span class="p">):</span>
                    <span class="c1"># if the attribute already exists</span>
                    <span class="c1"># and the attr value we are trying to set is not numeric</span>
                    <span class="c1"># then change the attribute type to object</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="p">[</span><span class="n">attribute</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="p">[</span><span class="n">attribute</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">attribute</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                    <span class="c1"># if it is a new attribute then initialize with NaN values</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="p">[</span><span class="n">attribute</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NaN&quot;</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">attribute</span><span class="p">]</span> <span class="o">=</span> <span class="n">attr_value</span>

        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">)</span><span class="si">}</span><span class="s2"> Nodes in Network&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">_create_links</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_links</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]):</span>

        <span class="n">new_links_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">new_links</span><span class="p">)</span>

        <span class="n">_idx_c</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_LINK_KEY</span> <span class="o">+</span> <span class="s2">&quot;_idx&quot;</span>
        <span class="n">new_links_df</span><span class="p">[</span><span class="n">_idx_c</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_links_df</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_LINK_KEY</span><span class="p">]</span>
        <span class="n">new_links_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">_idx_c</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">new_links_df</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">coerce_types</span><span class="p">(</span><span class="n">new_links_df</span><span class="p">)</span>

        <span class="n">new_links_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_new_link_geometry</span><span class="p">(</span><span class="n">new_links_df</span><span class="p">)</span>

        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;New Links:</span><span class="se">\n</span><span class="si">{</span><span class="n">new_links_df</span><span class="p">[[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_LINK_KEY</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">]]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_links_valid</span><span class="p">(</span><span class="n">new_links_df</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_links_df</span>

    <span class="k">def</span> <span class="nf">_create_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_nodes</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]):</span>

        <span class="n">new_nodes_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">new_nodes</span><span class="p">)</span>

        <span class="n">_idx_c</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span> <span class="o">+</span> <span class="s2">&quot;_idx&quot;</span>
        <span class="n">new_nodes_df</span><span class="p">[</span><span class="n">_idx_c</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_nodes_df</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span><span class="p">]</span>
        <span class="n">new_nodes_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">_idx_c</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">new_nodes_df</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">coerce_types</span><span class="p">(</span><span class="n">new_nodes_df</span><span class="p">)</span>

        <span class="n">new_nodes_df</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_nodes_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">point_from_xy</span><span class="p">(</span>
                <span class="n">x</span><span class="p">[</span><span class="s2">&quot;X&quot;</span><span class="p">],</span>
                <span class="n">x</span><span class="p">[</span><span class="s2">&quot;Y&quot;</span><span class="p">],</span>
                <span class="n">xy_crs</span><span class="o">=</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">CRS</span><span class="p">,</span>
                <span class="n">point_crs</span><span class="o">=</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">CRS</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">new_nodes_df</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">new_nodes_df</span><span class="p">)</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;New Nodes:</span><span class="se">\n</span><span class="si">{</span><span class="n">new_nodes_df</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_nodes_valid</span><span class="p">(</span><span class="n">new_nodes_df</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_nodes_df</span>

    <span class="k">def</span> <span class="nf">add_new_roadway_feature_change</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">add_links</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">add_nodes</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add the new roadway features defined in the project card.</span>

<span class="sd">        New shapes are also added for the new roadway links.</span>

<span class="sd">        New nodes are added first so that links can refer to any added nodes.</span>

<span class="sd">        args:</span>
<span class="sd">            add_links: list of dictionaries</span>
<span class="sd">            add_nodes: list of dictionaries</span>

<span class="sd">        returns: updated network with new links and nodes and associated geometries</span>

<span class="sd">        .. todo:: validate links and nodes dictionary</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Adding New Roadway Features:</span><span class="se">\n</span><span class="s2">-Links:</span><span class="se">\n</span><span class="si">{</span><span class="n">add_links</span><span class="si">}</span><span class="se">\n</span><span class="s2">-Nodes:</span><span class="se">\n</span><span class="si">{</span><span class="n">add_nodes</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">add_nodes</span><span class="p">:</span>
            <span class="n">_new_nodes_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_nodes</span><span class="p">(</span><span class="n">add_nodes</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">,</span> <span class="n">_new_nodes_df</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">add_links</span><span class="p">:</span>
            <span class="n">_new_links_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_links</span><span class="p">(</span><span class="n">add_links</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="p">,</span> <span class="n">_new_links_df</span><span class="p">])</span>

            <span class="n">_new_shapes_df</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">_create_new_shapes_from_links</span><span class="p">(</span><span class="n">_new_links_df</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shapes_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">shapes_df</span><span class="p">,</span> <span class="n">_new_shapes_df</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">new_nodes_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_nodes_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>

        <span class="c1"># Check to see if same node is already in the network</span>
        <span class="n">_existing_nodes</span> <span class="o">=</span> <span class="n">new_nodes_df</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">NODE_FOREIGN_KEY_TO_LINK</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">has_node</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">_existing_nodes</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Node already exists between nodes:</span><span class="se">\n</span><span class="s2"> </span><span class="si">{</span><span class="n">new_nodes_df</span><span class="p">[</span><span class="n">_existing_nodes</span><span class="p">,</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">NODE_FOREIGN_KEY_TO_LINK</span><span class="p">]</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="c1"># Check to see if there are missing required columns</span>
        <span class="n">_missing_cols</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">c</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">MIN_NODE_REQUIRED_PROPS_DEFAULT</span>
            <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_nodes_df</span><span class="o">.</span><span class="n">columns</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="n">_missing_cols</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Missing required link properties:</span><span class="si">{</span><span class="n">_missing_cols</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="c1"># Check to see if there are missing required values</span>
        <span class="n">_missing_values</span> <span class="o">=</span> <span class="n">new_nodes_df</span><span class="p">[</span>
            <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">MIN_NODE_REQUIRED_PROPS_DEFAULT</span>
        <span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">_missing_values</span><span class="o">.</span><span class="n">any</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Missing values for required node properties:</span><span class="se">\n</span><span class="si">{</span><span class="n">new_nodes_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">_missing_values</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">Warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">new_links_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_links_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Assesses if a set of links are valid for adding to self.links_df.</span>

<span class="sd">        Will produce a ValueError if new_links_df:</span>
<span class="sd">        1. A-B combinations are not unique within new_links_df</span>
<span class="sd">        2. UNIQUE_LINK_KEY is not unique within new_links_df</span>
<span class="sd">        3. A-B combinations overlap with an existing A-B link in self.links_df</span>
<span class="sd">        4. UNIQUE_LINK_KEY overlaps with an existing UNIQUE_LINK_ID in self.links_df</span>
<span class="sd">        5. A and B nodes are not in self.nodes_df</span>
<span class="sd">        6. Doesn&#39;t contain columns for MIN_LINK_REQUIRED_PROPS_DEFAULT</span>

<span class="sd">        Will produce a warning if there are NA values for any MIN_LINK_REQUIRED_PROPS_DEFAULT</span>

<span class="sd">        Args:</span>
<span class="sd">            new_links_df: dataframe of links being considered for addition to self.links_df</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: Returns a True if passes various validation tests.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># A-B combinations are unique within new_links_df</span>
        <span class="n">_new_fk_id</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
            <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">new_links_df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">LINK_FOREIGN_KEY_TO_NODE</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_new_fk_id</span><span class="o">.</span><span class="n">is_unique</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Duplicate ABs in new links.&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="c1"># UNIQUE_LINK_ID is unique within new_links_df</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">new_links_df</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_LINK_KEY</span><span class="p">]</span><span class="o">.</span><span class="n">is_unique</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Duplicate link IDs in new links.&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="c1"># Doesn&#39;t overlap with an existing A-B link in self.links_df</span>
        <span class="n">_existing_links_ab</span> <span class="o">=</span> <span class="n">_new_fk_id</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">has_link</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">_existing_links_ab</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Link already exists between nodes:</span><span class="se">\n</span><span class="s2"> </span><span class="si">{</span><span class="n">_new_fk_id</span><span class="p">[</span><span class="n">_existing_links_ab</span><span class="p">]</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="c1"># Doesn&#39;t overlap with an existing UNIQUE_LINK_ID in self.links_df</span>
        <span class="n">_ids</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_LINK_KEY</span><span class="p">],</span>
                <span class="n">new_links_df</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_LINK_KEY</span><span class="p">],</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_ids</span><span class="o">.</span><span class="n">is_unique</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Link ID already exists:</span><span class="se">\n</span><span class="si">{</span><span class="n">_ids</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">_ids</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()]</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="c1"># A and B nodes are in self.nodes_df</span>
        <span class="k">for</span> <span class="n">fk_prop</span> <span class="ow">in</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">LINK_FOREIGN_KEY_TO_NODE</span><span class="p">:</span>
            <span class="n">_has_node</span> <span class="o">=</span> <span class="n">new_links_df</span><span class="p">[</span><span class="n">fk_prop</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">has_node</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_has_node</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">25</span><span class="p">:</span>
                    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;self.nodes_df:</span><span class="se">\n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;New link specifies non existant node </span><span class="si">{</span><span class="n">fk_prop</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">new_links_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">_has_node</span><span class="p">,</span><span class="n">fk_prop</span><span class="p">]</span><span class="si">}</span><span class="s2">.&quot;</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="c1"># Check to see if there are missing required columns</span>
        <span class="n">_missing_cols</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">c</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">MIN_LINK_REQUIRED_PROPS_DEFAULT</span>
            <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_links_df</span><span class="o">.</span><span class="n">columns</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="n">_missing_cols</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Missing required link properties:</span><span class="si">{</span><span class="n">_missing_cols</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="c1"># Check to see if there are missing required values</span>
        <span class="n">_missing_values</span> <span class="o">=</span> <span class="n">new_links_df</span><span class="p">[</span>
            <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">MIN_LINK_REQUIRED_PROPS_DEFAULT</span>
        <span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">_missing_values</span><span class="o">.</span><span class="n">any</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Missing values for required link properties:</span><span class="se">\n</span><span class="si">{</span><span class="n">new_links_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">_missing_values</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">Warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">has_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unique_node_id</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Queries if network has node based on RoadwayNetwork.UNIQUE_NODE_KEY.</span>

<span class="sd">        Args:</span>
<span class="sd">            unique_node_id (_type_): value of RoadwayNetwork.UNIQUE_NODE_KEY</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">has_node</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="n">unique_node_id</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">has_node</span>

    <span class="k">def</span> <span class="nf">has_link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">link_key_values</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns true if network has link based values corresponding with LINK_FOREIGN_KEY_TO_NODE properties.</span>

<span class="sd">        Args:</span>
<span class="sd">            link_key_values: Tuple of values corresponding with RoadwayNetwork.LINK_FOREIGN_KEY_TO_ ODE properties.</span>
<span class="sd">                If LINK_FOREIGN_KEY_TO_NODE is (&quot;A&quot;,&quot;B&quot;), then (1,2) references the link of A=1 and B=2.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_query_parts</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2"> == </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">LINK_FOREIGN_KEY_TO_NODE</span><span class="p">,</span> <span class="n">link_key_values</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">_query</span> <span class="o">=</span> <span class="s2">&quot; and &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_query_parts</span><span class="p">)</span>
        <span class="n">_links</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">_query</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;python&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">_links</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_shapes_without_links</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns shape ids that don&#39;t have associated links.&quot;&quot;&quot;</span>

        <span class="n">_ids_in_shapes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_SHAPE_KEY</span><span class="p">]</span>
        <span class="n">_ids_in_links</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">LINK_FOREIGN_KEY_TO_SHAPE</span><span class="p">]</span>

        <span class="n">shapes_missing_links</span> <span class="o">=</span> <span class="n">_ids_in_shapes</span><span class="p">[</span><span class="o">~</span><span class="n">_ids_in_shapes</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">_ids_in_links</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">shapes_missing_links</span>

    <span class="k">def</span> <span class="nf">delete_links</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">del_links</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">ignore_missing</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete the roadway links based on del_links dictionary selecting links by properties.</span>

<span class="sd">        Also deletes shapes which no longer have links associated with them.</span>

<span class="sd">        Args:</span>
<span class="sd">            del_links: Dictionary identified shapes to delete by properties.  Links will be selected</span>
<span class="sd">                if *any* of the properties are equal to *any* of the values.</span>
<span class="sd">            ignore_missing: If True, will only warn if try to delete a links that isn&#39;t in network.</span>
<span class="sd">                If False, it will fail on missing links. Defaults to True.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># if RoadwayNetwork.UNIQUE_LINK_ID is used to select, flag links that weren&#39;t in network.</span>
        <span class="k">if</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_LINK_KEY</span> <span class="ow">in</span> <span class="n">del_links</span><span class="p">:</span>
            <span class="n">_del_link_ids</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">del_links</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_LINK_KEY</span><span class="p">])</span>
            <span class="n">_missing_links</span> <span class="o">=</span> <span class="n">_del_link_ids</span><span class="p">[</span>
                <span class="o">~</span><span class="n">_del_link_ids</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_LINK_KEY</span><span class="p">])</span>
            <span class="p">]</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Following links cannot be deleted because they are not in the network: </span><span class="si">{</span><span class="n">_missing_links</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">_missing_links</span><span class="p">)</span> <span class="ow">and</span> <span class="n">ignore_missing</span><span class="p">:</span>
                <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">_missing_links</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">_del_links_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">del_links</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_del_links_mask</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No links found matching criteria to delete.&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Deleting following links:</span><span class="se">\n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">_del_links_mask</span><span class="p">][[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="s1">&#39;model_link_id&#39;</span><span class="p">]]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">_del_links_mask</span><span class="p">]</span>

        <span class="c1"># Delete shapes which no longer have links associated with them</span>
        <span class="n">_shapes_without_links</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shapes_without_links</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">_shapes_without_links</span><span class="p">):</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Shapes without links:</span><span class="se">\n</span><span class="s2"> </span><span class="si">{</span><span class="n">_shapes_without_links</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shapes_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapes_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">_shapes_without_links</span><span class="p">]</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;self.shapes_df reduced to:</span><span class="se">\n</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">shapes_df</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">delete_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">del_nodes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">ignore_missing</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete the roadway nodes based on del_nodes dictionary selecting nodes by properties.</span>

<span class="sd">        Will fail if try to delete node that is currently being used by a link.</span>

<span class="sd">        Args:</span>
<span class="sd">            del_nodes : Dictionary identified nodes to delete by properties.  Nodes will be selected</span>
<span class="sd">                if *any* of the properties are equal to *any* of the values.</span>
<span class="sd">            ignore_missing: If True, will only warn if try to delete a node that isn&#39;t in network.</span>
<span class="sd">                If False, it will fail on missing nodes. Defaults to True.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_del_nodes_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">del_nodes</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">_del_nodes_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">_del_nodes_mask</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">_del_nodes_mask</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No nodes found matching criteria to delete.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Deleting Nodes:</span><span class="se">\n</span><span class="si">{</span><span class="n">_del_nodes_df</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># Check if node used in an existing link</span>
        <span class="n">_links_with_nodes</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">links_with_nodes</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="p">,</span>
            <span class="n">_del_nodes_df</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">NODE_FOREIGN_KEY_TO_LINK</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">_links_with_nodes</span><span class="p">):</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Node deletion failed because being used in following links:</span><span class="se">\n</span><span class="si">{</span><span class="n">_links_with_nodes</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">LINK_FOREIGN_KEY_TO_NODE</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span>

        <span class="c1"># Check if node is in network</span>
        <span class="k">if</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span> <span class="ow">in</span> <span class="n">del_nodes</span><span class="p">:</span>
            <span class="n">_del_node_ids</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">del_nodes</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span><span class="p">])</span>
            <span class="n">_missing_nodes</span> <span class="o">=</span> <span class="n">_del_node_ids</span><span class="p">[</span>
                <span class="o">~</span><span class="n">_del_node_ids</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span><span class="p">])</span>
            <span class="p">]</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Following nodes cannot be deleted because they are not in the network: </span><span class="si">{</span><span class="n">_missing_nodes</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">_missing_nodes</span><span class="p">)</span> <span class="ow">and</span> <span class="n">ignore_missing</span><span class="p">:</span>
                <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">_missing_nodes</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">_del_nodes_mask</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">delete_roadway_feature_change</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">del_links</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">del_nodes</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ignore_missing</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;RoadwayNetwork&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete the roadway links or nodes defined in the project card.</span>

<span class="sd">        Corresponding shapes to the deleted links are also deleted if they are not used elsewhere.</span>

<span class="sd">        Args:</span>
<span class="sd">            del_links : dictionary of identified links to delete</span>
<span class="sd">            del_nodes : dictionary of identified nodes to delete</span>
<span class="sd">            ignore_missing: bool</span>
<span class="sd">                If True, will only warn about links/nodes that are missing from</span>
<span class="sd">                network but specified to &quot;delete&quot; in project card</span>
<span class="sd">                If False, will fail.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Deleting Roadway Features:</span><span class="se">\n</span><span class="s2">-Links:</span><span class="se">\n</span><span class="si">{</span><span class="n">del_links</span><span class="si">}</span><span class="se">\n</span><span class="s2">-Nodes:</span><span class="se">\n</span><span class="si">{</span><span class="n">del_nodes</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">del_links</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delete_links</span><span class="p">(</span><span class="n">del_links</span><span class="p">,</span> <span class="n">ignore_missing</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">del_nodes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delete_nodes</span><span class="p">(</span><span class="n">del_nodes</span><span class="p">,</span> <span class="n">ignore_missing</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">get_property_by_time_period_and_group</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="nb">property</span><span class="p">,</span> <span class="n">time_period</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a series for the properties with a specific group or time period.</span>

<span class="sd">        args</span>
<span class="sd">        ------</span>
<span class="sd">        property: str</span>
<span class="sd">          the variable that you want from network</span>
<span class="sd">        time_period: list(str)</span>
<span class="sd">          the time period that you are querying for</span>
<span class="sd">          i.e. [&#39;16:00&#39;, &#39;19:00&#39;]</span>
<span class="sd">        category: str or list(str)(Optional)</span>
<span class="sd">          the group category</span>
<span class="sd">          i.e. &quot;sov&quot;</span>

<span class="sd">          or</span>

<span class="sd">          list of group categories in order of search, i.e.</span>
<span class="sd">          [&quot;hov3&quot;,&quot;hov2&quot;]</span>

<span class="sd">        returns</span>
<span class="sd">        --------</span>
<span class="sd">        pandas series</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">_get_property</span><span class="p">(</span>
            <span class="n">v</span><span class="p">,</span>
            <span class="n">time_spans</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">category</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">return_partial_match</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">partial_match_minutes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">60</span><span class="p">,</span>
        <span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">            .. todo:: return the time period with the largest overlap</span>

<span class="sd">            &quot;&quot;&quot;</span>

            <span class="k">if</span> <span class="n">category</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">time_spans</span><span class="p">:</span>
                <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Shouldn&#39;t have a category group without time spans&quot;</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Shouldn&#39;t have a category group without time spans&quot;</span><span class="p">)</span>

            <span class="c1"># simple case</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">v</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">category</span><span class="p">:</span>
                <span class="n">category</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">category</span> <span class="o">=</span> <span class="p">[</span><span class="n">category</span><span class="p">]</span>
            <span class="n">search_cats</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">category</span><span class="p">]</span>

            <span class="c1"># if no time or group specified, but it is a complex link situation</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">time_spans</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;default&quot;</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">return</span> <span class="n">v</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;variable: </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Variable </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2"> is more complex in network than query&quot;</span>
                    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;timeofday&quot;</span><span class="p">):</span>
                <span class="n">categories</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">tg</span> <span class="ow">in</span> <span class="n">v</span><span class="p">[</span><span class="s2">&quot;timeofday&quot;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="p">(</span><span class="n">time_spans</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">tg</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                        <span class="ow">and</span> <span class="p">(</span><span class="n">time_spans</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">tg</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                        <span class="ow">and</span> <span class="p">(</span><span class="n">time_spans</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">time_spans</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="p">):</span>
                        <span class="k">if</span> <span class="n">tg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">):</span>
                            <span class="n">categories</span> <span class="o">+=</span> <span class="n">tg</span><span class="p">[</span><span class="s2">&quot;category&quot;</span><span class="p">]</span>
                            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">search_cats</span><span class="p">:</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CAT:&quot;</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">tg</span><span class="p">[</span><span class="s2">&quot;category&quot;</span><span class="p">])</span>
                                <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">tg</span><span class="p">[</span><span class="s2">&quot;category&quot;</span><span class="p">]:</span>
                                    <span class="c1"># print(&quot;Var:&quot;, v)</span>
                                    <span class="c1"># print(</span>
                                    <span class="c1">#    &quot;RETURNING:&quot;, time_spans, category, tg[&quot;value&quot;]</span>
                                    <span class="c1"># )</span>
                                    <span class="k">return</span> <span class="n">tg</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="c1"># print(&quot;Var:&quot;, v)</span>
                            <span class="c1"># print(&quot;RETURNING:&quot;, time_spans, category, tg[&quot;value&quot;])</span>
                            <span class="k">return</span> <span class="n">tg</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>

                    <span class="k">if</span> <span class="p">(</span>
                        <span class="p">(</span><span class="n">time_spans</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">tg</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                        <span class="ow">and</span> <span class="p">(</span><span class="n">time_spans</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">tg</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                        <span class="ow">and</span> <span class="p">(</span><span class="n">time_spans</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">time_spans</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="ow">and</span> <span class="p">(</span><span class="n">tg</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">tg</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                    <span class="p">):</span>
                        <span class="k">if</span> <span class="n">tg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">):</span>
                            <span class="n">categories</span> <span class="o">+=</span> <span class="n">tg</span><span class="p">[</span><span class="s2">&quot;category&quot;</span><span class="p">]</span>
                            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">search_cats</span><span class="p">:</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CAT:&quot;</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">tg</span><span class="p">[</span><span class="s2">&quot;category&quot;</span><span class="p">])</span>
                                <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">tg</span><span class="p">[</span><span class="s2">&quot;category&quot;</span><span class="p">]:</span>
                                    <span class="c1"># print(&quot;Var:&quot;, v)</span>
                                    <span class="c1"># print(</span>
                                    <span class="c1">#    &quot;RETURNING:&quot;, time_spans, category, tg[&quot;value&quot;]</span>
                                    <span class="c1"># )</span>
                                    <span class="k">return</span> <span class="n">tg</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="c1"># print(&quot;Var:&quot;, v)</span>
                            <span class="c1"># print(&quot;RETURNING:&quot;, time_spans, category, tg[&quot;value&quot;])</span>
                            <span class="k">return</span> <span class="n">tg</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>

                    <span class="c1"># if there isn&#39;t a fully matched time period, see if there is an overlapping</span>
                    <span class="c1"># one right now just return the first overlapping ones</span>
                    <span class="c1"># TODO return the time period with the largest overlap</span>

                    <span class="k">if</span> <span class="p">(</span>
                        <span class="p">(</span><span class="n">time_spans</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">tg</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                        <span class="ow">and</span> <span class="p">(</span><span class="n">time_spans</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">tg</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                    <span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
                        <span class="p">(</span><span class="n">time_spans</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">tg</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                        <span class="ow">and</span> <span class="p">(</span><span class="n">time_spans</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">tg</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                    <span class="p">):</span>
                        <span class="n">overlap_minutes</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
                            <span class="mi">0</span><span class="p">,</span>
                            <span class="nb">min</span><span class="p">(</span><span class="n">tg</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">time_spans</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                            <span class="o">-</span> <span class="nb">max</span><span class="p">(</span><span class="n">time_spans</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tg</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span>
                        <span class="p">)</span>
                        <span class="c1"># print(&quot;OLM&quot;,overlap_minutes)</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">return_partial_match</span> <span class="ow">and</span> <span class="n">overlap_minutes</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                                <span class="sa">f</span><span class="s2">&quot;Couldn&#39;t find time period consistent with </span><span class="si">{</span><span class="n">time_spans</span><span class="si">}</span><span class="s2">, but </span><span class="se">\</span>
<span class="s2">                                    found a partial match: </span><span class="si">{</span><span class="n">tg</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">. Consider allowing </span><span class="se">\</span>
<span class="s2">                                    partial matches using &#39;return_partial_match&#39; keyword or </span><span class="se">\</span>
<span class="s2">                                    updating query.&quot;</span>
                            <span class="p">)</span>
                        <span class="k">elif</span> <span class="p">(</span>
                            <span class="n">overlap_minutes</span> <span class="o">&lt;</span> <span class="n">partial_match_minutes</span>
                            <span class="ow">and</span> <span class="n">overlap_minutes</span> <span class="o">&gt;</span> <span class="mi">0</span>
                        <span class="p">):</span>
                            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                                <span class="sa">f</span><span class="s2">&quot;Time period: </span><span class="si">{</span><span class="n">time_spans</span><span class="si">}</span><span class="s2"> overlapped less than the minimum number </span><span class="se">\</span>
<span class="s2">                                of minutes (</span><span class="si">{</span><span class="n">overlap_minutes</span><span class="si">}</span><span class="s2">&lt;</span><span class="si">{</span><span class="n">partial_match_minutes</span><span class="si">}</span><span class="s2">) to be </span><span class="se">\</span>
<span class="s2">                                considered a match with time period in network: </span><span class="si">{</span><span class="n">tg</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.&quot;</span>
                            <span class="p">)</span>
                        <span class="k">elif</span> <span class="n">overlap_minutes</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                                <span class="sa">f</span><span class="s2">&quot;Returning a partial time period match. Time period: </span><span class="si">{</span><span class="n">time_spans</span><span class="si">}</span><span class="se">\</span>
<span class="s2">                                overlapped the minimum number of minutes (</span><span class="si">{</span><span class="n">overlap_minutes</span><span class="si">}</span><span class="s2">&gt;=</span><span class="se">\</span>
<span class="s2">                                </span><span class="si">{</span><span class="n">partial_match_minutes</span><span class="si">}</span><span class="s2">) to be considered a match with time period</span><span class="se">\</span>
<span class="s2">                                 in network: </span><span class="si">{</span><span class="n">tg</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.&quot;</span>
                            <span class="p">)</span>
                            <span class="k">if</span> <span class="n">tg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">):</span>
                                <span class="n">categories</span> <span class="o">+=</span> <span class="n">tg</span><span class="p">[</span><span class="s2">&quot;category&quot;</span><span class="p">]</span>
                                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">search_cats</span><span class="p">:</span>
                                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CAT:&quot;</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">tg</span><span class="p">[</span><span class="s2">&quot;category&quot;</span><span class="p">])</span>
                                    <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">tg</span><span class="p">[</span><span class="s2">&quot;category&quot;</span><span class="p">]:</span>
                                        <span class="c1"># print(&quot;Var:&quot;, v)</span>
                                        <span class="c1"># print(</span>
                                        <span class="c1">#    &quot;RETURNING:&quot;,</span>
                                        <span class="c1">#    time_spans,</span>
                                        <span class="c1">#    category,</span>
                                        <span class="c1">#    tg[&quot;value&quot;],</span>
                                        <span class="c1"># )</span>
                                        <span class="k">return</span> <span class="n">tg</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="c1"># print(&quot;Var:&quot;, v)</span>
                                <span class="c1"># print(&quot;RETURNING:&quot;, time_spans, category, tg[&quot;value&quot;])</span>
                                <span class="k">return</span> <span class="n">tg</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>

<span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                WranglerLogger.debug(</span>
<span class="sd">                    &quot;\nCouldn&#39;t find time period for {}, returning default&quot;.format(</span>
<span class="sd">                        str(time_spans)</span>
<span class="sd">                    )</span>
<span class="sd">                )</span>
<span class="sd">                &quot;&quot;&quot;</span>
                <span class="k">if</span> <span class="s2">&quot;default&quot;</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="c1"># print(&quot;Var:&quot;, v)</span>
                    <span class="c1"># print(&quot;RETURNING:&quot;, time_spans, v[&quot;default&quot;])</span>
                    <span class="k">return</span> <span class="n">v</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># print(&quot;Var:&quot;, v)</span>
                    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Can&#39;t find default; must specify a category in </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="nb">str</span><span class="p">(</span><span class="n">categories</span><span class="p">)</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;Can&#39;t find default, must specify a category in: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="nb">str</span><span class="p">(</span><span class="n">categories</span><span class="p">)</span>
                        <span class="p">)</span>
                    <span class="p">)</span>

        <span class="n">time_spans</span> <span class="o">=</span> <span class="n">parse_time_spans_to_secs</span><span class="p">(</span><span class="n">time_period</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="p">[</span><span class="nb">property</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="n">_get_property</span><span class="p">,</span> <span class="n">time_spans</span><span class="o">=</span><span class="n">time_spans</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="n">category</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_nodes_from_link</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">links_df</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span> <span class="n">link_pos</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">node_key_field</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a basic list of node entries from links, their geometry, and a position.</span>

<span class="sd">        TODO: Does not currently fill in additional values used in nodes.</span>

<span class="sd">        Args:</span>
<span class="sd">            links_df (gpd.GeoDataFrame): subset of self.links_df or similar which needs nodes created</span>
<span class="sd">            link_pos (int): Position within geometry collection to use for geometry</span>
<span class="sd">            node_key_field (str): field name to use for generating index and node key</span>

<span class="sd">        Returns:</span>
<span class="sd">            gpd.GeoDataFrame: _description_</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">nodes_df</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span>
            <span class="n">links_df</span><span class="p">[[</span><span class="n">node_key_field</span><span class="p">,</span> <span class="s2">&quot;geometry&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="c1"># WranglerLogger.debug(f&quot;ct1: nodes_df:\n{nodes_df}&quot;)</span>
        <span class="n">nodes_df</span> <span class="o">=</span> <span class="n">nodes_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
            <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">node_key_field</span><span class="p">:</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="c1"># WranglerLogger.debug(f&quot;ct2: nodes_df:\n{nodes_df}&quot;)</span>
        <span class="n">nodes_df</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodes_df</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="n">get_point_geometry_from_linestring</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">link_pos</span>
        <span class="p">)</span>
        <span class="n">nodes_df</span><span class="p">[</span><span class="s2">&quot;X&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodes_df</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">x</span>
        <span class="n">nodes_df</span><span class="p">[</span><span class="s2">&quot;Y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodes_df</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">y</span>
        <span class="n">nodes_df</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span> <span class="o">+</span> <span class="s2">&quot;_idx&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodes_df</span><span class="p">[</span>
            <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span>
        <span class="p">]</span>
        <span class="n">nodes_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span> <span class="o">+</span> <span class="s2">&quot;_idx&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># WranglerLogger.debug(f&quot;ct3: nodes_df:\n{nodes_df}&quot;)</span>
        <span class="k">return</span> <span class="n">nodes_df</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_modal_links_nodes</span><span class="p">(</span>
        <span class="n">links_df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">nodes_df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">modes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">DataFrame</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns nodes and link dataframes for specific mode.</span>

<span class="sd">        Args:</span>
<span class="sd">            links_df: DataFrame of standard network links</span>
<span class="sd">            nodes_df: DataFrame of standard network nodes</span>
<span class="sd">            modes: list of the modes of the network to be kept, must be in</span>
<span class="sd">                `drive`,`transit`,`rail`,`bus`,`walk`, `bike`.</span>
<span class="sd">                For example, if bike and walk are selected, both bike and walk links will be kept.</span>

<span class="sd">        Returns: tuple of DataFrames for links, nodes filtered by mode</span>

<span class="sd">        .. todo:: Right now we don&#39;t filter the nodes because transit-only</span>
<span class="sd">        links with walk access are not marked as having walk access</span>
<span class="sd">        Issue discussed in https://github.com/wsp-sag/network_wrangler/issues/145</span>
<span class="sd">        modal_nodes_df = nodes_df[nodes_df[mode_node_variable] == 1]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="n">modes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">MODES_TO_NETWORK_LINK_VARIABLES</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;mode value should be one of </span><span class="si">{}</span><span class="s2">, got </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="nb">list</span><span class="p">(</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">MODES_TO_NETWORK_LINK_VARIABLES</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
                    <span class="n">mode</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">mode_link_variables</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="nb">set</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">mode</span>
                    <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="n">modes</span>
                    <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">MODES_TO_NETWORK_LINK_VARIABLES</span><span class="p">[</span><span class="n">mode</span><span class="p">]</span>
                <span class="p">]</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">mode_node_variables</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="nb">set</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">mode</span>
                    <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="n">modes</span>
                    <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">MODES_TO_NETWORK_NODE_VARIABLES</span><span class="p">[</span><span class="n">mode</span><span class="p">]</span>
                <span class="p">]</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">mode_link_variables</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">links_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span><span class="si">{</span><span class="nb">set</span><span class="p">(</span><span class="n">mode_link_variables</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">set</span><span class="p">(</span><span class="n">links_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span><span class="s2"> not in provided links_df </span><span class="se">\</span>
<span class="s2">                list of columns. Available columns are:</span>
<span class="s2">                </span><span class="si">{</span><span class="n">links_df</span><span class="o">.</span><span class="n">columns</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">mode_node_variables</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">nodes_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span><span class="si">{</span><span class="nb">set</span><span class="p">(</span><span class="n">mode_node_variables</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">set</span><span class="p">(</span><span class="n">nodes_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span><span class="s2"> not in provided nodes_df </span><span class="se">\</span>
<span class="s2">                list of columns. Available columns are:</span>
<span class="s2">                </span><span class="si">{</span><span class="n">nodes_df</span><span class="o">.</span><span class="n">columns</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">modal_links_df</span> <span class="o">=</span> <span class="n">links_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">links_df</span><span class="p">[</span><span class="n">mode_link_variables</span><span class="p">]</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>

        <span class="c1"># TODO right now we don&#39;t filter the nodes because transit-only</span>
        <span class="c1"># links with walk access are not marked as having walk access</span>
        <span class="c1"># Issue discussed in https://github.com/wsp-sag/network_wrangler/issues/145</span>
        <span class="c1"># modal_nodes_df = nodes_df[nodes_df[mode_node_variable] == 1]</span>
        <span class="n">modal_nodes_df</span> <span class="o">=</span> <span class="n">nodes_df</span>

        <span class="k">return</span> <span class="n">modal_links_df</span><span class="p">,</span> <span class="n">modal_nodes_df</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_modal_graph</span><span class="p">(</span><span class="n">links_df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">nodes_df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Determines if the network graph is &quot;strongly&quot; connected</span>
<span class="sd">        A graph is strongly connected if each vertex is reachable from every other vertex.</span>

<span class="sd">        Args:</span>
<span class="sd">            links_df: DataFrame of standard network links</span>
<span class="sd">            nodes_df: DataFrame of standard network nodes</span>
<span class="sd">            mode: mode of the network, one of `drive`,`transit`,</span>
<span class="sd">                `walk`, `bike`</span>

<span class="sd">        Returns: networkx: osmnx: DiGraph  of network</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">MODES_TO_NETWORK_LINK_VARIABLES</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;mode value should be one of </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="nb">list</span><span class="p">(</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">MODES_TO_NETWORK_LINK_VARIABLES</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="p">)</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">_links_df</span><span class="p">,</span> <span class="n">_nodes_df</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">get_modal_links_nodes</span><span class="p">(</span>
            <span class="n">links_df</span><span class="p">,</span>
            <span class="n">nodes_df</span><span class="p">,</span>
            <span class="n">modes</span><span class="o">=</span><span class="p">[</span><span class="n">mode</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">G</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">ox_graph</span><span class="p">(</span><span class="n">_nodes_df</span><span class="p">,</span> <span class="n">_links_df</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">G</span>

    <span class="k">def</span> <span class="nf">is_network_connected</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">links_df</span><span class="p">:</span> <span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">nodes_df</span><span class="p">:</span> <span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determines if the network graph is &quot;strongly&quot; connected</span>
<span class="sd">        A graph is strongly connected if each vertex is reachable from every other vertex.</span>

<span class="sd">        Args:</span>
<span class="sd">            mode:  mode of the network, one of `drive`,`transit`,</span>
<span class="sd">                `walk`, `bike`</span>
<span class="sd">            links_df: DataFrame of standard network links</span>
<span class="sd">            nodes_df: DataFrame of standard network nodes</span>

<span class="sd">        Returns: boolean</span>

<span class="sd">        .. todo:: Consider caching graphs if they take a long time.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">_nodes_df</span> <span class="o">=</span> <span class="n">nodes_df</span> <span class="k">if</span> <span class="n">nodes_df</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span>
        <span class="n">_links_df</span> <span class="o">=</span> <span class="n">links_df</span> <span class="k">if</span> <span class="n">links_df</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span>

        <span class="k">if</span> <span class="n">mode</span><span class="p">:</span>
            <span class="n">_links_df</span><span class="p">,</span> <span class="n">_nodes_df</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">get_modal_links_nodes</span><span class="p">(</span>
                <span class="n">_links_df</span><span class="p">,</span>
                <span class="n">_nodes_df</span><span class="p">,</span>
                <span class="n">modes</span><span class="o">=</span><span class="p">[</span><span class="n">mode</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Assessing connectivity without a mode</span><span class="se">\</span>
<span class="s2">                specified. This may have limited value in interpretation.</span><span class="se">\</span>
<span class="s2">                To add mode specificity, add the keyword `mode =` to calling</span><span class="se">\</span>
<span class="s2">                this method&quot;</span>
            <span class="p">)</span>

        <span class="c1"># TODO: consider caching graphs if they start to take forever</span>
        <span class="c1">#      and we are calling them more than once.</span>
        <span class="n">G</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">ox_graph</span><span class="p">(</span><span class="n">_nodes_df</span><span class="p">,</span> <span class="n">_links_df</span><span class="p">)</span>
        <span class="n">is_connected</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">is_strongly_connected</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">is_connected</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">add_incident_link_data_to_nodes</span><span class="p">(</span>
        <span class="n">links_df</span><span class="p">:</span> <span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">nodes_df</span><span class="p">:</span> <span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">link_variables</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add data from links going to/from nodes to node.</span>

<span class="sd">        Args:</span>
<span class="sd">            links_df: if specified, will assess connectivity of this</span>
<span class="sd">                links list rather than self.links_df</span>
<span class="sd">            nodes_df: if specified, will assess connectivity of this</span>
<span class="sd">                nodes list rather than self.nodes_df</span>
<span class="sd">            link_variables: list of columns in links dataframe to add to incident nodes</span>

<span class="sd">        Returns:</span>
<span class="sd">            nodes DataFrame with link data where length is N*number of links going in/out</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Adding following link data to nodes: &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">())</span>

        <span class="n">_link_vals_to_nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">link_variables</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">links_df</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">link_variables</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_link_vals_to_nodes</span><span class="p">:</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Following columns not in links_df and wont be added to nodes: </span><span class="si">{}</span><span class="s2"> &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">link_variables</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">_link_vals_to_nodes</span><span class="p">))</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="n">_nodes_from_links_A</span> <span class="o">=</span> <span class="n">nodes_df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
            <span class="n">links_df</span><span class="p">[[</span><span class="s2">&quot;A&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">_link_vals_to_nodes</span><span class="p">],</span>
            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;outer&quot;</span><span class="p">,</span>
            <span class="n">left_on</span><span class="o">=</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span><span class="p">,</span>
            <span class="n">right_on</span><span class="o">=</span><span class="s2">&quot;A&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">_nodes_from_links_B</span> <span class="o">=</span> <span class="n">nodes_df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
            <span class="n">links_df</span><span class="p">[[</span><span class="s2">&quot;B&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">_link_vals_to_nodes</span><span class="p">],</span>
            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;outer&quot;</span><span class="p">,</span>
            <span class="n">left_on</span><span class="o">=</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span><span class="p">,</span>
            <span class="n">right_on</span><span class="o">=</span><span class="s2">&quot;B&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">_nodes_from_links_ab</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">_nodes_from_links_A</span><span class="p">,</span> <span class="n">_nodes_from_links_B</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">_nodes_from_links_ab</span>

    <span class="k">def</span> <span class="nf">identify_segment_endpoints</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">links_df</span><span class="p">:</span> <span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">nodes_df</span><span class="p">:</span> <span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">min_connecting_links</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
        <span class="n">min_distance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_link_deviation</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Args:</span>
<span class="sd">            mode:  list of modes of the network, one of `drive`,`transit`,</span>
<span class="sd">                `walk`, `bike`</span>
<span class="sd">            links_df: if specified, will assess connectivity of this</span>
<span class="sd">                links list rather than self.links_df</span>
<span class="sd">            nodes_df: if specified, will assess connectivity of this</span>
<span class="sd">                nodes list rather than self.nodes_df</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">SEGMENT_IDENTIFIERS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;ref&quot;</span><span class="p">]</span>

        <span class="n">NAME_PER_NODE</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="n">REF_PER_NODE</span> <span class="o">=</span> <span class="mi">2</span>

        <span class="n">_nodes_df</span> <span class="o">=</span> <span class="n">nodes_df</span> <span class="k">if</span> <span class="n">nodes_df</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span>
        <span class="n">_links_df</span> <span class="o">=</span> <span class="n">links_df</span> <span class="k">if</span> <span class="n">links_df</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span>

        <span class="k">if</span> <span class="n">mode</span><span class="p">:</span>
            <span class="n">_links_df</span><span class="p">,</span> <span class="n">_nodes_df</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">get_modal_links_nodes</span><span class="p">(</span>
                <span class="n">_links_df</span><span class="p">,</span>
                <span class="n">_nodes_df</span><span class="p">,</span>
                <span class="n">modes</span><span class="o">=</span><span class="p">[</span><span class="n">mode</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Assessing connectivity without a mode</span><span class="se">\</span>
<span class="s2">                specified. This may have limited value in interpretation.</span><span class="se">\</span>
<span class="s2">                To add mode specificity, add the keyword `mode =` to calling</span><span class="se">\</span>
<span class="s2">                this method&quot;</span>
            <span class="p">)</span>

        <span class="n">_nodes_df</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">add_incident_link_data_to_nodes</span><span class="p">(</span>
            <span class="n">links_df</span><span class="o">=</span><span class="n">_links_df</span><span class="p">,</span>
            <span class="n">nodes_df</span><span class="o">=</span><span class="n">_nodes_df</span><span class="p">,</span>
            <span class="n">link_variables</span><span class="o">=</span><span class="n">SEGMENT_IDENTIFIERS</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;distance&quot;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Node/Link table elements: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">_nodes_df</span><span class="p">)))</span>

        <span class="c1"># Screen out segments that have blank name AND refs</span>
        <span class="n">_nodes_df</span> <span class="o">=</span> <span class="n">_nodes_df</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^\s*$&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span>
            <span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;ref&quot;</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;Node/Link table elements after dropping empty name AND ref : </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">_nodes_df</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Screen out segments that aren&#39;t likely to be long enough</span>
        <span class="c1"># Minus 1 in case ref or name is missing on an intermediate link</span>
        <span class="n">_min_ref_in_table</span> <span class="o">=</span> <span class="n">REF_PER_NODE</span> <span class="o">*</span> <span class="p">(</span><span class="n">min_connecting_links</span> <span class="o">-</span> <span class="n">max_link_deviation</span><span class="p">)</span>
        <span class="n">_min_name_in_table</span> <span class="o">=</span> <span class="n">NAME_PER_NODE</span> <span class="o">*</span> <span class="p">(</span><span class="n">min_connecting_links</span> <span class="o">-</span> <span class="n">max_link_deviation</span><span class="p">)</span>

        <span class="n">_nodes_df</span><span class="p">[</span><span class="s2">&quot;ref_freq&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_nodes_df</span><span class="p">[</span><span class="s2">&quot;ref&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">_nodes_df</span><span class="p">[</span><span class="s2">&quot;ref&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>
        <span class="n">_nodes_df</span><span class="p">[</span><span class="s2">&quot;name_freq&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_nodes_df</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">_nodes_df</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>

        <span class="n">_nodes_df</span> <span class="o">=</span> <span class="n">_nodes_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="p">(</span><span class="n">_nodes_df</span><span class="p">[</span><span class="s2">&quot;ref_freq&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">_min_ref_in_table</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">_nodes_df</span><span class="p">[</span><span class="s2">&quot;name_freq&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">_min_name_in_table</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;Node/Link table has n = </span><span class="si">{}</span><span class="s2"> after screening segments for min length:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">_nodes_df</span><span class="p">),</span>
                <span class="n">_nodes_df</span><span class="p">[</span>
                    <span class="p">[</span>
                        <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span><span class="p">,</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;ref&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;distance&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;ref_freq&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;name_freq&quot;</span><span class="p">,</span>
                    <span class="p">]</span>
                <span class="p">],</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="c1"># ----------------------------------------</span>
        <span class="c1"># Find nodes that are likely endpoints</span>
        <span class="c1"># ----------------------------------------</span>

        <span class="c1"># - Likely have one incident link and one outgoing link</span>
        <span class="n">_max_ref_endpoints</span> <span class="o">=</span> <span class="n">REF_PER_NODE</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">_max_name_endpoints</span> <span class="o">=</span> <span class="n">NAME_PER_NODE</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="c1"># - Attach frequency  of node/ref</span>
        <span class="n">_nodes_df</span> <span class="o">=</span> <span class="n">_nodes_df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
            <span class="n">_nodes_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span><span class="p">,</span> <span class="s2">&quot;ref&quot;</span><span class="p">])</span>
            <span class="o">.</span><span class="n">size</span><span class="p">()</span>
            <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">&quot;ref_N_freq&quot;</span><span class="p">),</span>
            <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span><span class="p">,</span> <span class="s2">&quot;ref&quot;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="c1"># WranglerLogger.debug(&quot;_ref_count+_nodes:\n{}&quot;.format(_nodes_df[[&quot;model_node_id&quot;,&quot;ref&quot;,&quot;name&quot;,&quot;ref_N_freq&quot;]]))</span>
        <span class="c1"># - Attach frequency  of node/name</span>
        <span class="n">_nodes_df</span> <span class="o">=</span> <span class="n">_nodes_df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
            <span class="n">_nodes_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">])</span>
            <span class="o">.</span><span class="n">size</span><span class="p">()</span>
            <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">&quot;name_N_freq&quot;</span><span class="p">),</span>
            <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="c1"># WranglerLogger.debug(&quot;_name_count+_nodes:\n{}&quot;.format(_nodes_df[[&quot;model_node_id&quot;,&quot;ref&quot;,&quot;name&quot;,&quot;name_N_freq&quot;]]))</span>

        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;Possible segment endpoints:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">_nodes_df</span><span class="p">[</span>
                    <span class="p">[</span>
                        <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span><span class="p">,</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;ref&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;distance&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;ref_N_freq&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;name_N_freq&quot;</span><span class="p">,</span>
                    <span class="p">]</span>
                <span class="p">]</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="c1"># - Filter possible endpoint list based on node/name node/ref frequency</span>
        <span class="n">_nodes_df</span> <span class="o">=</span> <span class="n">_nodes_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="p">(</span><span class="n">_nodes_df</span><span class="p">[</span><span class="s2">&quot;ref_N_freq&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">_max_ref_endpoints</span><span class="p">)</span>
            <span class="o">|</span> <span class="p">(</span><span class="n">_nodes_df</span><span class="p">[</span><span class="s2">&quot;name_N_freq&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">_max_name_endpoints</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> Likely segment endpoints with req_ref&lt;= </span><span class="si">{}</span><span class="s2"> or freq_name&lt;=</span><span class="si">{}</span><span class="s2"> </span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">_nodes_df</span><span class="p">),</span>
                <span class="n">_max_ref_endpoints</span><span class="p">,</span>
                <span class="n">_max_name_endpoints</span><span class="p">,</span>
                <span class="n">_nodes_df</span><span class="p">[</span>
                    <span class="p">[</span>
                        <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span><span class="p">,</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;ref&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;ref_N_freq&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;name_N_freq&quot;</span><span class="p">,</span>
                    <span class="p">]</span>
                <span class="p">],</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="c1"># ----------------------------------------</span>
        <span class="c1"># Assign a segment id</span>
        <span class="c1"># ----------------------------------------</span>
        <span class="n">_nodes_df</span><span class="p">[</span><span class="s2">&quot;segment_id&quot;</span><span class="p">],</span> <span class="n">_segments</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">factorize</span><span class="p">(</span>
            <span class="n">_nodes_df</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="n">_nodes_df</span><span class="o">.</span><span class="n">ref</span>
        <span class="p">)</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> Segments:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">_segments</span><span class="p">),</span> <span class="n">_segments</span><span class="p">))</span>

        <span class="c1"># ----------------------------------------</span>
        <span class="c1"># Drop segments without at least two nodes</span>
        <span class="c1"># ----------------------------------------</span>

        <span class="c1"># https://stackoverflow.com/questions/13446480/python-pandas-remove-entries-based-on-the-number-of-occurrences</span>
        <span class="n">_nodes_df</span> <span class="o">=</span> <span class="n">_nodes_df</span><span class="p">[</span>
            <span class="n">_nodes_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;segment_id&quot;</span><span class="p">,</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span><span class="p">])[</span>
                <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span>
            <span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="nb">len</span><span class="p">)</span>
            <span class="o">&gt;</span> <span class="mi">1</span>
        <span class="p">]</span>

        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> Segments with at least nodes:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">_nodes_df</span><span class="p">),</span>
                <span class="n">_nodes_df</span><span class="p">[</span>
                    <span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;ref&quot;</span><span class="p">,</span> <span class="s2">&quot;segment_id&quot;</span><span class="p">]</span>
                <span class="p">],</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># ----------------------------------------</span>
        <span class="c1"># For segments with more than two nodes, find farthest apart pairs</span>
        <span class="c1"># ----------------------------------------</span>

        <span class="k">def</span> <span class="nf">_max_segment_distance</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
            <span class="n">_segment_nodes</span> <span class="o">=</span> <span class="n">_nodes_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">_nodes_df</span><span class="p">[</span><span class="s2">&quot;segment_id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;segment_id&quot;</span><span class="p">]]</span>
            <span class="n">dist</span> <span class="o">=</span> <span class="n">_segment_nodes</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">geometry</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">dist</span><span class="o">.</span><span class="n">dropna</span><span class="p">())</span>

        <span class="n">_nodes_df</span><span class="p">[</span><span class="s2">&quot;seg_distance&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_nodes_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">_max_segment_distance</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">_nodes_df</span> <span class="o">=</span> <span class="n">_nodes_df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
            <span class="n">_nodes_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;segment_id&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">seg_distance</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="nb">max</span><span class="p">)</span>
            <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">&quot;max_seg_distance&quot;</span><span class="p">),</span>
            <span class="n">on</span><span class="o">=</span><span class="s2">&quot;segment_id&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">_nodes_df</span> <span class="o">=</span> <span class="n">_nodes_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="p">(</span><span class="n">_nodes_df</span><span class="p">[</span><span class="s2">&quot;max_seg_distance&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">_nodes_df</span><span class="p">[</span><span class="s2">&quot;seg_distance&quot;</span><span class="p">])</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">_nodes_df</span><span class="p">[</span><span class="s2">&quot;seg_distance&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span><span class="p">,</span> <span class="s2">&quot;segment_id&quot;</span><span class="p">])</span>

        <span class="c1"># ----------------------------------------</span>
        <span class="c1"># Reassign segment id for final segments</span>
        <span class="c1"># ----------------------------------------</span>
        <span class="n">_nodes_df</span><span class="p">[</span><span class="s2">&quot;segment_id&quot;</span><span class="p">],</span> <span class="n">_segments</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">factorize</span><span class="p">(</span>
            <span class="n">_nodes_df</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="n">_nodes_df</span><span class="o">.</span><span class="n">ref</span>
        <span class="p">)</span>

        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> Segments:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">_segments</span><span class="p">),</span>
                <span class="n">_nodes_df</span><span class="p">[</span>
                    <span class="p">[</span>
                        <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span><span class="p">,</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;ref&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;segment_id&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;seg_distance&quot;</span><span class="p">,</span>
                    <span class="p">]</span>
                <span class="p">],</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">_nodes_df</span><span class="p">[</span>
            <span class="p">[</span><span class="s2">&quot;segment_id&quot;</span><span class="p">,</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span><span class="p">,</span> <span class="s2">&quot;geometry&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;ref&quot;</span><span class="p">]</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="nf">identify_segment</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">O_id</span><span class="p">,</span>
        <span class="n">D_id</span><span class="p">,</span>
        <span class="n">selection_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
        <span class="n">mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">nodes_df</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">links_df</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            endpoints: list of length of two unique keys of nodes making up endpoints of segment</span>
<span class="sd">            selection_dict: dictionary of link variables to select candidate links from, otherwise</span>
<span class="sd">                will create a graph of ALL links which will be both a RAM hog and could result in</span>
<span class="sd">                odd shortest paths.</span>
<span class="sd">            segment_variables: list of variables to keep</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_nodes_df</span> <span class="o">=</span> <span class="n">nodes_df</span> <span class="k">if</span> <span class="n">nodes_df</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span>
        <span class="n">_links_df</span> <span class="o">=</span> <span class="n">links_df</span> <span class="k">if</span> <span class="n">links_df</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span>

        <span class="k">if</span> <span class="n">mode</span><span class="p">:</span>
            <span class="n">_links_df</span><span class="p">,</span> <span class="n">_nodes_df</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">get_modal_links_nodes</span><span class="p">(</span>
                <span class="n">_links_df</span><span class="p">,</span>
                <span class="n">_nodes_df</span><span class="p">,</span>
                <span class="n">modes</span><span class="o">=</span><span class="p">[</span><span class="n">mode</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Assessing connectivity without a mode</span><span class="se">\</span>
<span class="s2">                specified. This may have limited value in interpretation.</span><span class="se">\</span>
<span class="s2">                To add mode specificity, add the keyword `mode =` to calling</span><span class="se">\</span>
<span class="s2">                this method&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">selection_dict</span><span class="p">:</span>
            <span class="n">_query</span> <span class="o">=</span> <span class="s2">&quot; or &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2"> == </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">selection_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
            <span class="p">)</span>
            <span class="n">_candidate_links</span> <span class="o">=</span> <span class="n">_links_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">_query</span><span class="p">)</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s2">&quot;Found </span><span class="si">{}</span><span class="s2"> candidate links from </span><span class="si">{}</span><span class="s2"> total links using following query:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="nb">len</span><span class="p">(</span><span class="n">_candidate_links</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">_links_df</span><span class="p">),</span> <span class="n">_query</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_candidate_links</span> <span class="o">=</span> <span class="n">_links_df</span>

            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Not pre-selecting links using selection_dict can use up a lot of RAM and </span><span class="se">\</span>
<span class="s2">                    also result in odd segment paths.&quot;</span>
            <span class="p">)</span>

        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;_candidate links for segment: </span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">_candidate_links</span><span class="p">[[</span><span class="s2">&quot;u&quot;</span><span class="p">,</span> <span class="s2">&quot;v&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;ref&quot;</span><span class="p">]]</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">candidate_links</span><span class="p">,</span> <span class="n">sp_route</span><span class="p">,</span> <span class="n">sp_links</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_search</span><span class="p">(</span>
                <span class="n">_candidate_links</span><span class="p">,</span> <span class="n">O_id</span><span class="p">,</span> <span class="n">D_id</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">NoPathFound</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Route not found from </span><span class="si">{}</span><span class="s2"> to </span><span class="si">{}</span><span class="s2"> using selection candidates </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">O_id</span><span class="p">,</span> <span class="n">D_id</span><span class="p">,</span> <span class="n">selection_dict</span>
            <span class="p">)</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">sp_links</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">sp_links</span>

    <span class="k">def</span> <span class="nf">assess_connectivity</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">ignore_end_nodes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">links_df</span><span class="p">:</span> <span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">nodes_df</span><span class="p">:</span> <span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a network graph and list of disconnected subgraphs</span>
<span class="sd">        as described by a list of their member nodes.</span>

<span class="sd">        Args:</span>
<span class="sd">            mode:  list of modes of the network, one of `drive`,`transit`,</span>
<span class="sd">                `walk`, `bike`</span>
<span class="sd">            ignore_end_nodes: if True, ignores stray singleton nodes</span>
<span class="sd">            links_df: if specified, will assess connectivity of this</span>
<span class="sd">                links list rather than self.links_df</span>
<span class="sd">            nodes_df: if specified, will assess connectivity of this</span>
<span class="sd">                nodes list rather than self.nodes_df</span>

<span class="sd">        Returns: Tuple of</span>
<span class="sd">            Network Graph (osmnx flavored networkX DiGraph)</span>
<span class="sd">            List of disconnected subgraphs described by the list of their</span>
<span class="sd">                member nodes (as described by their `model_node_id`)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_nodes_df</span> <span class="o">=</span> <span class="n">nodes_df</span> <span class="k">if</span> <span class="n">nodes_df</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span>
        <span class="n">_links_df</span> <span class="o">=</span> <span class="n">links_df</span> <span class="k">if</span> <span class="n">links_df</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span>

        <span class="k">if</span> <span class="n">mode</span><span class="p">:</span>
            <span class="n">_links_df</span><span class="p">,</span> <span class="n">_nodes_df</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">get_modal_links_nodes</span><span class="p">(</span>
                <span class="n">_links_df</span><span class="p">,</span>
                <span class="n">_nodes_df</span><span class="p">,</span>
                <span class="n">modes</span><span class="o">=</span><span class="p">[</span><span class="n">mode</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Assessing connectivity without a mode</span><span class="se">\</span>
<span class="s2">                specified. This may have limited value in interpretation.</span><span class="se">\</span>
<span class="s2">                To add mode specificity, add the keyword `mode =` to calling</span><span class="se">\</span>
<span class="s2">                this method&quot;</span>
            <span class="p">)</span>

        <span class="n">G</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">ox_graph</span><span class="p">(</span><span class="n">_nodes_df</span><span class="p">,</span> <span class="n">_links_df</span><span class="p">)</span>

        <span class="n">sub_graph_nodes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">strongly_connected_components</span><span class="p">(</span><span class="n">G</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="nb">len</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="c1"># sorted on decreasing length, dropping the main sub-graph</span>
        <span class="n">disconnected_sub_graph_nodes</span> <span class="o">=</span> <span class="n">sub_graph_nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="c1"># dropping the sub-graphs with only 1 node</span>
        <span class="k">if</span> <span class="n">ignore_end_nodes</span><span class="p">:</span>
            <span class="n">disconnected_sub_graph_nodes</span> <span class="o">=</span> <span class="p">[</span>
                <span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">disconnected_sub_graph_nodes</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>
            <span class="p">]</span>

        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> for disconnected networks for mode = </span><span class="si">{}</span><span class="s2">:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span><span class="p">,</span>
                <span class="n">mode</span><span class="p">,</span>
                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">disconnected_sub_graph_nodes</span><span class="p">))),</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">G</span><span class="p">,</span> <span class="n">disconnected_sub_graph_nodes</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">network_connection_plot</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">disconnected_subgraph_nodes</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot a graph to check for network connection.</span>

<span class="sd">        Args:</span>
<span class="sd">            G: OSMNX flavored networkX graph.</span>
<span class="sd">            disconnected_subgraph_nodes: List of disconnected subgraphs described by the list</span>
<span class="sd">                of their member nodes (as described by their `model_node_id`).</span>

<span class="sd">        returns: fig, ax : tuple</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">colors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">disconnected_subgraph_nodes</span><span class="p">)):</span>
            <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;#</span><span class="si">%06X</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mh">0xFFFFFF</span><span class="p">))</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">plot_graph</span><span class="p">(</span>
            <span class="n">G</span><span class="p">,</span>
            <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">),</span>
            <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">close</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">edge_color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">edge_alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
            <span class="n">node_color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">node_alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
            <span class="n">node_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">nodes</span> <span class="ow">in</span> <span class="n">disconnected_subgraph_nodes</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
                <span class="n">size</span> <span class="o">=</span> <span class="mi">100</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s2">&quot;X&quot;</span><span class="p">],</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s2">&quot;Y&quot;</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>

    <span class="k">def</span> <span class="nf">selection_map</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">selected_link_idx</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
        <span class="n">A</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">B</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">candidate_link_idx</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Shows which links are selected for roadway property change or parallel</span>
<span class="sd">        managed lanes category of roadway projects.</span>

<span class="sd">        Args:</span>
<span class="sd">            selected_links_idx: list of selected link indices</span>
<span class="sd">            candidate_links_idx: optional list of candidate link indices to also include in map</span>
<span class="sd">            A: optional foreign key of starting node of a route selection</span>
<span class="sd">            B: optional foreign key of ending node of a route selection</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;Selected Links: </span><span class="si">{}</span><span class="se">\n</span><span class="s2">Candidate Links: </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">selected_link_idx</span><span class="p">,</span> <span class="n">candidate_link_idx</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="n">graph_link_idx</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">selected_link_idx</span> <span class="o">+</span> <span class="n">candidate_link_idx</span><span class="p">))</span>
        <span class="n">graph_links</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">graph_link_idx</span><span class="p">]</span>

        <span class="n">node_list_foreign_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="nb">set</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">i</span>
                    <span class="k">for</span> <span class="n">fk</span> <span class="ow">in</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">LINK_FOREIGN_KEY_TO_NODE</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">graph_links</span><span class="p">[</span><span class="n">fk</span><span class="p">])</span>
                <span class="p">]</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="n">graph_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">node_list_foreign_keys</span><span class="p">]</span>

        <span class="n">G</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">ox_graph</span><span class="p">(</span><span class="n">graph_nodes</span><span class="p">,</span> <span class="n">graph_links</span><span class="p">)</span>

        <span class="c1"># base map plot with whole graph</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">plot_graph_folium</span><span class="p">(</span>
            <span class="n">G</span><span class="p">,</span> <span class="n">edge_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tiles</span><span class="o">=</span><span class="s2">&quot;cartodbpositron&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="s2">&quot;300px&quot;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="s2">&quot;250px&quot;</span>
        <span class="p">)</span>

        <span class="c1"># plot selection</span>
        <span class="n">selected_links</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">selected_link_idx</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">selected_links</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">pl</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">folium</span><span class="o">.</span><span class="n">_make_folium_polyline</span><span class="p">(</span>
                <span class="n">geom</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">],</span>
                <span class="n">edge</span><span class="o">=</span><span class="n">row</span><span class="p">,</span>
                <span class="n">edge_color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>
                <span class="n">edge_width</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                <span class="n">edge_opacity</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">pl</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

        <span class="c1"># if have A and B node add them to base map</span>
        <span class="k">def</span> <span class="nf">_folium_node</span><span class="p">(</span><span class="n">node_row</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
            <span class="n">node_marker</span> <span class="o">=</span> <span class="n">folium</span><span class="o">.</span><span class="n">Marker</span><span class="p">(</span>
                <span class="n">location</span><span class="o">=</span><span class="p">[</span><span class="n">node_row</span><span class="p">[</span><span class="s2">&quot;Y&quot;</span><span class="p">],</span> <span class="n">node_row</span><span class="p">[</span><span class="s2">&quot;X&quot;</span><span class="p">]],</span>
                <span class="n">icon</span><span class="o">=</span><span class="n">folium</span><span class="o">.</span><span class="n">Icon</span><span class="p">(</span><span class="n">icon</span><span class="o">=</span><span class="n">icon</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">node_marker</span>

        <span class="k">if</span> <span class="n">A</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;A: </span><span class="si">{</span><span class="n">A</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">A</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="c1"># WranglerLogger.debug(msg)</span>
            <span class="n">_folium_node</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span><span class="p">]</span> <span class="o">==</span> <span class="n">A</span><span class="p">],</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span>
                <span class="n">icon</span><span class="o">=</span><span class="s2">&quot;play&quot;</span><span class="p">,</span>
            <span class="p">)</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">B</span><span class="p">:</span>
            <span class="n">_folium_node</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span><span class="p">]</span> <span class="o">==</span> <span class="n">B</span><span class="p">],</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
                <span class="n">icon</span><span class="o">=</span><span class="s2">&quot;star&quot;</span><span class="p">,</span>
            <span class="p">)</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">m</span>

    <span class="k">def</span> <span class="nf">deletion_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">links</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">nodes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Shows which links and nodes are deleted from the roadway network</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">links</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">links</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">deleted_links</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">val</span><span class="p">)]</span>

                <span class="n">node_list_foreign_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                    <span class="nb">set</span><span class="p">(</span>
                        <span class="p">[</span>
                            <span class="n">i</span>
                            <span class="k">for</span> <span class="n">fk</span> <span class="ow">in</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">LINK_FOREIGN_KEY_TO_NODE</span>
                            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">deleted_links</span><span class="p">[</span><span class="n">fk</span><span class="p">])</span>
                        <span class="p">]</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="n">candidate_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">node_list_foreign_keys</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">deleted_links</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">nodes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">nodes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">deleted_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">val</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">deleted_nodes</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">G</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">ox_graph</span><span class="p">(</span><span class="n">candidate_nodes</span><span class="p">,</span> <span class="n">deleted_links</span><span class="p">)</span>

        <span class="n">m</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">plot_graph_folium</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">edge_color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">tiles</span><span class="o">=</span><span class="s2">&quot;cartodbpositron&quot;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">_folium_node</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
            <span class="n">node_circle</span> <span class="o">=</span> <span class="n">folium</span><span class="o">.</span><span class="n">Circle</span><span class="p">(</span>
                <span class="n">location</span><span class="o">=</span><span class="p">[</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;Y&quot;</span><span class="p">],</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;X&quot;</span><span class="p">]],</span>
                <span class="n">radius</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                <span class="n">fill_opacity</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">node_circle</span>

        <span class="k">if</span> <span class="n">deleted_nodes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">deleted_nodes</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                <span class="n">_folium_node</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">m</span>

    <span class="k">def</span> <span class="nf">addition_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">links</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">nodes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Shows which links and nodes are added to the roadway network</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">links</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">link_ids</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">links</span><span class="p">:</span>
                <span class="n">link_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">link</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_LINK_KEY</span><span class="p">))</span>

            <span class="n">added_links</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_LINK_KEY</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">link_ids</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="n">node_list_foreign_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="nb">set</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="n">i</span>
                        <span class="k">for</span> <span class="n">fk</span> <span class="ow">in</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">LINK_FOREIGN_KEY_TO_NODE</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">added_links</span><span class="p">[</span><span class="n">fk</span><span class="p">])</span>
                    <span class="p">]</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">candidate_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">node_list_foreign_keys</span><span class="p">]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">nodes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">node_ids</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
                <span class="n">node_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span><span class="p">))</span>

            <span class="n">added_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">node_ids</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">added_nodes</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">G</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">ox_graph</span><span class="p">(</span><span class="n">candidate_nodes</span><span class="p">,</span> <span class="n">added_links</span><span class="p">)</span>

        <span class="n">m</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">plot_graph_folium</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">edge_color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">tiles</span><span class="o">=</span><span class="s2">&quot;cartodbpositron&quot;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">_folium_node</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
            <span class="n">node_circle</span> <span class="o">=</span> <span class="n">folium</span><span class="o">.</span><span class="n">Circle</span><span class="p">(</span>
                <span class="n">location</span><span class="o">=</span><span class="p">[</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;Y&quot;</span><span class="p">],</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;X&quot;</span><span class="p">]],</span>
                <span class="n">radius</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                <span class="n">fill_opacity</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">node_circle</span>

        <span class="k">if</span> <span class="n">added_nodes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">added_nodes</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                <span class="n">_folium_node</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">m</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h4 id="network_wrangler.roadwaynetwork.RoadwayNetwork.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">links</span><span class="p">,</span> <span class="n">shapes</span><span class="p">)</span></code>

<a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.__init__" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Constructor</p>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/roadwaynetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodes</span><span class="p">:</span> <span class="n">GeoDataFrame</span><span class="p">,</span> <span class="n">links</span><span class="p">:</span> <span class="n">GeoDataFrame</span><span class="p">,</span> <span class="n">shapes</span><span class="p">:</span> <span class="n">GeoDataFrame</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Constructor</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">validate_object_types</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">links</span><span class="p">,</span> <span class="n">shapes</span><span class="p">):</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;RoadwayNetwork: Invalid constructor data type&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span> <span class="o">=</span> <span class="n">nodes</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span> <span class="o">=</span> <span class="n">links</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">shapes_df</span> <span class="o">=</span> <span class="n">shapes</span>

    <span class="c1"># Model network</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">m_nodes_df</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">m_links_df</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">m_shapes_df</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">link_file</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">node_file</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">shape_file</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Add non-required fields if they aren&#39;t there.</span>
    <span class="c1"># for field, default_value in RoadwayNetwork.OPTIONAL_FIELDS:</span>
    <span class="c1">#    if field not in self.links_df.columns:</span>
    <span class="c1">#        self.links_df[field] = default_value</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_uniqueness</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;IDs in network not unique&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">selections</span> <span class="o">=</span> <span class="p">{}</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.roadwaynetwork.RoadwayNetwork.add_incident_link_data_to_nodes" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_incident_link_data_to_nodes</span><span class="p">(</span><span class="n">links_df</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nodes_df</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">link_variables</span><span class="o">=</span><span class="p">[])</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.add_incident_link_data_to_nodes" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Add data from links going to/from nodes to node.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>links_df</code></td>
          <td>
                <code><span title="pandas.core.frame.DataFrame">DataFrame</span></code>
          </td>
          <td><p>if specified, will assess connectivity of this
links list rather than self.links_df</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>nodes_df</code></td>
          <td>
                <code><span title="pandas.core.frame.DataFrame">DataFrame</span></code>
          </td>
          <td><p>if specified, will assess connectivity of this
nodes list rather than self.nodes_df</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>link_variables</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>list of columns in links dataframe to add to incident nodes</p></td>
          <td>
                <code>[]</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="pandas.core.frame.DataFrame">DataFrame</span></code>
          </td>
          <td><p>nodes DataFrame with link data where length is N*number of links going in/out</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/roadwaynetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2895</span>
<span class="normal">2896</span>
<span class="normal">2897</span>
<span class="normal">2898</span>
<span class="normal">2899</span>
<span class="normal">2900</span>
<span class="normal">2901</span>
<span class="normal">2902</span>
<span class="normal">2903</span>
<span class="normal">2904</span>
<span class="normal">2905</span>
<span class="normal">2906</span>
<span class="normal">2907</span>
<span class="normal">2908</span>
<span class="normal">2909</span>
<span class="normal">2910</span>
<span class="normal">2911</span>
<span class="normal">2912</span>
<span class="normal">2913</span>
<span class="normal">2914</span>
<span class="normal">2915</span>
<span class="normal">2916</span>
<span class="normal">2917</span>
<span class="normal">2918</span>
<span class="normal">2919</span>
<span class="normal">2920</span>
<span class="normal">2921</span>
<span class="normal">2922</span>
<span class="normal">2923</span>
<span class="normal">2924</span>
<span class="normal">2925</span>
<span class="normal">2926</span>
<span class="normal">2927</span>
<span class="normal">2928</span>
<span class="normal">2929</span>
<span class="normal">2930</span>
<span class="normal">2931</span>
<span class="normal">2932</span>
<span class="normal">2933</span>
<span class="normal">2934</span>
<span class="normal">2935</span>
<span class="normal">2936</span>
<span class="normal">2937</span>
<span class="normal">2938</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">add_incident_link_data_to_nodes</span><span class="p">(</span>
    <span class="n">links_df</span><span class="p">:</span> <span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">nodes_df</span><span class="p">:</span> <span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">link_variables</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add data from links going to/from nodes to node.</span>

<span class="sd">    Args:</span>
<span class="sd">        links_df: if specified, will assess connectivity of this</span>
<span class="sd">            links list rather than self.links_df</span>
<span class="sd">        nodes_df: if specified, will assess connectivity of this</span>
<span class="sd">            nodes list rather than self.nodes_df</span>
<span class="sd">        link_variables: list of columns in links dataframe to add to incident nodes</span>

<span class="sd">    Returns:</span>
<span class="sd">        nodes DataFrame with link data where length is N*number of links going in/out</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Adding following link data to nodes: &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">())</span>

    <span class="n">_link_vals_to_nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">link_variables</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">links_df</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">link_variables</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_link_vals_to_nodes</span><span class="p">:</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s2">&quot;Following columns not in links_df and wont be added to nodes: </span><span class="si">{}</span><span class="s2"> &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">link_variables</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">_link_vals_to_nodes</span><span class="p">))</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="n">_nodes_from_links_A</span> <span class="o">=</span> <span class="n">nodes_df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
        <span class="n">links_df</span><span class="p">[[</span><span class="s2">&quot;A&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">_link_vals_to_nodes</span><span class="p">],</span>
        <span class="n">how</span><span class="o">=</span><span class="s2">&quot;outer&quot;</span><span class="p">,</span>
        <span class="n">left_on</span><span class="o">=</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span><span class="p">,</span>
        <span class="n">right_on</span><span class="o">=</span><span class="s2">&quot;A&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">_nodes_from_links_B</span> <span class="o">=</span> <span class="n">nodes_df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
        <span class="n">links_df</span><span class="p">[[</span><span class="s2">&quot;B&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">_link_vals_to_nodes</span><span class="p">],</span>
        <span class="n">how</span><span class="o">=</span><span class="s2">&quot;outer&quot;</span><span class="p">,</span>
        <span class="n">left_on</span><span class="o">=</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span><span class="p">,</span>
        <span class="n">right_on</span><span class="o">=</span><span class="s2">&quot;B&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">_nodes_from_links_ab</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">_nodes_from_links_A</span><span class="p">,</span> <span class="n">_nodes_from_links_B</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">_nodes_from_links_ab</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.roadwaynetwork.RoadwayNetwork.add_new_roadway_feature_change" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_new_roadway_feature_change</span><span class="p">(</span><span class="n">add_links</span><span class="o">=</span><span class="p">[],</span> <span class="n">add_nodes</span><span class="o">=</span><span class="p">[])</span></code>

<a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.add_new_roadway_feature_change" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Add the new roadway features defined in the project card.</p>
<p>New shapes are also added for the new roadway links.</p>
<p>New nodes are added first so that links can refer to any added nodes.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>add_links</code></td>
          <td>
                <code><span title="typing.Collection">Collection</span>[dict]</code>
          </td>
          <td><p>list of dictionaries</p></td>
          <td>
                <code>[]</code>
          </td>
        </tr>
        <tr>
          <td><code>add_nodes</code></td>
          <td>
                <code><span title="typing.Collection">Collection</span>[dict]</code>
          </td>
          <td><p>list of dictionaries</p></td>
          <td>
                <code>[]</code>
          </td>
        </tr>
    </tbody>
  </table>
      <p>.. todo:: validate links and nodes dictionary</p>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/roadwaynetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2224</span>
<span class="normal">2225</span>
<span class="normal">2226</span>
<span class="normal">2227</span>
<span class="normal">2228</span>
<span class="normal">2229</span>
<span class="normal">2230</span>
<span class="normal">2231</span>
<span class="normal">2232</span>
<span class="normal">2233</span>
<span class="normal">2234</span>
<span class="normal">2235</span>
<span class="normal">2236</span>
<span class="normal">2237</span>
<span class="normal">2238</span>
<span class="normal">2239</span>
<span class="normal">2240</span>
<span class="normal">2241</span>
<span class="normal">2242</span>
<span class="normal">2243</span>
<span class="normal">2244</span>
<span class="normal">2245</span>
<span class="normal">2246</span>
<span class="normal">2247</span>
<span class="normal">2248</span>
<span class="normal">2249</span>
<span class="normal">2250</span>
<span class="normal">2251</span>
<span class="normal">2252</span>
<span class="normal">2253</span>
<span class="normal">2254</span>
<span class="normal">2255</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_new_roadway_feature_change</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">add_links</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">add_nodes</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add the new roadway features defined in the project card.</span>

<span class="sd">    New shapes are also added for the new roadway links.</span>

<span class="sd">    New nodes are added first so that links can refer to any added nodes.</span>

<span class="sd">    args:</span>
<span class="sd">        add_links: list of dictionaries</span>
<span class="sd">        add_nodes: list of dictionaries</span>

<span class="sd">    returns: updated network with new links and nodes and associated geometries</span>

<span class="sd">    .. todo:: validate links and nodes dictionary</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Adding New Roadway Features:</span><span class="se">\n</span><span class="s2">-Links:</span><span class="se">\n</span><span class="si">{</span><span class="n">add_links</span><span class="si">}</span><span class="se">\n</span><span class="s2">-Nodes:</span><span class="se">\n</span><span class="si">{</span><span class="n">add_nodes</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">add_nodes</span><span class="p">:</span>
        <span class="n">_new_nodes_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_nodes</span><span class="p">(</span><span class="n">add_nodes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">,</span> <span class="n">_new_nodes_df</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">add_links</span><span class="p">:</span>
        <span class="n">_new_links_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_links</span><span class="p">(</span><span class="n">add_links</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="p">,</span> <span class="n">_new_links_df</span><span class="p">])</span>

        <span class="n">_new_shapes_df</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">_create_new_shapes_from_links</span><span class="p">(</span><span class="n">_new_links_df</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shapes_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">shapes_df</span><span class="p">,</span> <span class="n">_new_shapes_df</span><span class="p">])</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.roadwaynetwork.RoadwayNetwork.addition_map" class="doc doc-heading">
<code class="highlight language-python"><span class="n">addition_map</span><span class="p">(</span><span class="n">links</span><span class="p">,</span> <span class="n">nodes</span><span class="p">)</span></code>

<a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.addition_map" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Shows which links and nodes are added to the roadway network</p>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/roadwaynetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3469</span>
<span class="normal">3470</span>
<span class="normal">3471</span>
<span class="normal">3472</span>
<span class="normal">3473</span>
<span class="normal">3474</span>
<span class="normal">3475</span>
<span class="normal">3476</span>
<span class="normal">3477</span>
<span class="normal">3478</span>
<span class="normal">3479</span>
<span class="normal">3480</span>
<span class="normal">3481</span>
<span class="normal">3482</span>
<span class="normal">3483</span>
<span class="normal">3484</span>
<span class="normal">3485</span>
<span class="normal">3486</span>
<span class="normal">3487</span>
<span class="normal">3488</span>
<span class="normal">3489</span>
<span class="normal">3490</span>
<span class="normal">3491</span>
<span class="normal">3492</span>
<span class="normal">3493</span>
<span class="normal">3494</span>
<span class="normal">3495</span>
<span class="normal">3496</span>
<span class="normal">3497</span>
<span class="normal">3498</span>
<span class="normal">3499</span>
<span class="normal">3500</span>
<span class="normal">3501</span>
<span class="normal">3502</span>
<span class="normal">3503</span>
<span class="normal">3504</span>
<span class="normal">3505</span>
<span class="normal">3506</span>
<span class="normal">3507</span>
<span class="normal">3508</span>
<span class="normal">3509</span>
<span class="normal">3510</span>
<span class="normal">3511</span>
<span class="normal">3512</span>
<span class="normal">3513</span>
<span class="normal">3514</span>
<span class="normal">3515</span>
<span class="normal">3516</span>
<span class="normal">3517</span>
<span class="normal">3518</span>
<span class="normal">3519</span>
<span class="normal">3520</span>
<span class="normal">3521</span>
<span class="normal">3522</span>
<span class="normal">3523</span>
<span class="normal">3524</span>
<span class="normal">3525</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">addition_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">links</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">nodes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Shows which links and nodes are added to the roadway network</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">links</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">link_ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">links</span><span class="p">:</span>
            <span class="n">link_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">link</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_LINK_KEY</span><span class="p">))</span>

        <span class="n">added_links</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_LINK_KEY</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">link_ids</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">node_list_foreign_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="nb">set</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">i</span>
                    <span class="k">for</span> <span class="n">fk</span> <span class="ow">in</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">LINK_FOREIGN_KEY_TO_NODE</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">added_links</span><span class="p">[</span><span class="n">fk</span><span class="p">])</span>
                <span class="p">]</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">candidate_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">node_list_foreign_keys</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">nodes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">node_ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
            <span class="n">node_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span><span class="p">))</span>

        <span class="n">added_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">node_ids</span><span class="p">)</span>
        <span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">added_nodes</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">G</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">ox_graph</span><span class="p">(</span><span class="n">candidate_nodes</span><span class="p">,</span> <span class="n">added_links</span><span class="p">)</span>

    <span class="n">m</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">plot_graph_folium</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">edge_color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">tiles</span><span class="o">=</span><span class="s2">&quot;cartodbpositron&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_folium_node</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="n">node_circle</span> <span class="o">=</span> <span class="n">folium</span><span class="o">.</span><span class="n">Circle</span><span class="p">(</span>
            <span class="n">location</span><span class="o">=</span><span class="p">[</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;Y&quot;</span><span class="p">],</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;X&quot;</span><span class="p">]],</span>
            <span class="n">radius</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
            <span class="n">fill_opacity</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">node_circle</span>

    <span class="k">if</span> <span class="n">added_nodes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">added_nodes</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">_folium_node</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">m</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.roadwaynetwork.RoadwayNetwork.apply" class="doc doc-heading">
<code class="highlight language-python"><span class="n">apply</span><span class="p">(</span><span class="n">project_card_dictionary</span><span class="p">,</span> <span class="n">_subproject</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.apply" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Wrapper method to apply a roadway project, returning a new RoadwayNetwork instance.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>project_card_dictionary</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>a dictionary of the project card object</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>_subproject</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>boolean indicating if this is a subproject under a &ldquo;changes&rdquo; heading.
Defaults to False. Will be set to true with code when necessary.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/roadwaynetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">apply</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">project_card_dictionary</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">_subproject</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;RoadwayNetwork&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wrapper method to apply a roadway project, returning a new RoadwayNetwork instance.</span>

<span class="sd">    Args:</span>
<span class="sd">        project_card_dictionary: a dictionary of the project card object</span>
<span class="sd">        _subproject: boolean indicating if this is a subproject under a &quot;changes&quot; heading.</span>
<span class="sd">            Defaults to False. Will be set to true with code when necessary.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">_subproject</span><span class="p">:</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Applying Project to Roadway Network: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">project_card_dictionary</span><span class="p">[</span><span class="s2">&quot;project&quot;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">project_card_dictionary</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;changes&quot;</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">project_dictionary</span> <span class="ow">in</span> <span class="n">project_card_dictionary</span><span class="p">[</span><span class="s2">&quot;changes&quot;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">project_dictionary</span><span class="p">,</span> <span class="n">_subproject</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">project_dictionary</span> <span class="o">=</span> <span class="n">project_card_dictionary</span>

    <span class="n">_facility</span> <span class="o">=</span> <span class="n">project_dictionary</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;facility&quot;</span><span class="p">)</span>
    <span class="n">_category</span> <span class="o">=</span> <span class="n">project_dictionary</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">_facility</span><span class="p">:</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Selecting Facility: </span><span class="si">{</span><span class="n">_facility</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">_geometry_type</span> <span class="o">=</span> <span class="nb">list</span><span class="p">({</span><span class="s2">&quot;links&quot;</span><span class="p">,</span> <span class="s2">&quot;nodes&quot;</span><span class="p">}</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">_facility</span><span class="p">)))</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">_geometry_type</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="p">),</span> <span class="s2">&quot;Facility must have exactly one of &#39;links&#39; or &#39;nodes&#39;&quot;</span>
        <span class="n">_geometry_type</span> <span class="o">=</span> <span class="n">_geometry_type</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">_df_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_roadway_features</span><span class="p">(</span><span class="n">_facility</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">_category</span> <span class="o">==</span> <span class="s2">&quot;roadway property change&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_roadway_feature_change</span><span class="p">(</span>
            <span class="n">_df_idx</span><span class="p">,</span>
            <span class="n">project_dictionary</span><span class="p">[</span><span class="s2">&quot;properties&quot;</span><span class="p">],</span>
            <span class="n">geometry_type</span><span class="o">=</span><span class="n">_geometry_type</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">_category</span> <span class="o">==</span> <span class="s2">&quot;parallel managed lanes&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_managed_lane_feature_change</span><span class="p">(</span>
            <span class="n">_df_idx</span><span class="p">,</span>
            <span class="n">project_dictionary</span><span class="p">[</span><span class="s2">&quot;properties&quot;</span><span class="p">],</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">_category</span> <span class="o">==</span> <span class="s2">&quot;add new roadway&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_new_roadway_feature_change</span><span class="p">(</span>
            <span class="n">project_dictionary</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;links&quot;</span><span class="p">,</span> <span class="p">[]),</span>
            <span class="n">project_dictionary</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nodes&quot;</span><span class="p">,</span> <span class="p">[]),</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">_category</span> <span class="o">==</span> <span class="s2">&quot;roadway deletion&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">delete_roadway_feature_change</span><span class="p">(</span>
            <span class="n">project_dictionary</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;links&quot;</span><span class="p">,</span> <span class="p">[]),</span>
            <span class="n">project_dictionary</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nodes&quot;</span><span class="p">,</span> <span class="p">[]),</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">_category</span> <span class="o">==</span> <span class="s2">&quot;calculated roadway&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_python_calculation</span><span class="p">(</span>
            <span class="n">project_dictionary</span><span class="p">[</span><span class="s2">&quot;pycode&quot;</span><span class="p">],</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid Project Card Category: </span><span class="si">{</span><span class="n">_category</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.roadwaynetwork.RoadwayNetwork.apply_managed_lane_feature_change" class="doc doc-heading">
<code class="highlight language-python"><span class="n">apply_managed_lane_feature_change</span><span class="p">(</span><span class="n">link_idx</span><span class="p">,</span> <span class="n">properties</span><span class="p">)</span></code>

<a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.apply_managed_lane_feature_change" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Apply the managed lane feature changes to the roadway network</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>link_idx</code></td>
          <td>
          </td>
          <td><p>list of lndices of all links to apply change to</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>properties</code></td>
          <td>
          </td>
          <td><p>list of dictionarys roadway properties to change</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>
      <p>.. todo:: decide on connectors info when they are more specific in project card</p>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/roadwaynetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2070</span>
<span class="normal">2071</span>
<span class="normal">2072</span>
<span class="normal">2073</span>
<span class="normal">2074</span>
<span class="normal">2075</span>
<span class="normal">2076</span>
<span class="normal">2077</span>
<span class="normal">2078</span>
<span class="normal">2079</span>
<span class="normal">2080</span>
<span class="normal">2081</span>
<span class="normal">2082</span>
<span class="normal">2083</span>
<span class="normal">2084</span>
<span class="normal">2085</span>
<span class="normal">2086</span>
<span class="normal">2087</span>
<span class="normal">2088</span>
<span class="normal">2089</span>
<span class="normal">2090</span>
<span class="normal">2091</span>
<span class="normal">2092</span>
<span class="normal">2093</span>
<span class="normal">2094</span>
<span class="normal">2095</span>
<span class="normal">2096</span>
<span class="normal">2097</span>
<span class="normal">2098</span>
<span class="normal">2099</span>
<span class="normal">2100</span>
<span class="normal">2101</span>
<span class="normal">2102</span>
<span class="normal">2103</span>
<span class="normal">2104</span>
<span class="normal">2105</span>
<span class="normal">2106</span>
<span class="normal">2107</span>
<span class="normal">2108</span>
<span class="normal">2109</span>
<span class="normal">2110</span>
<span class="normal">2111</span>
<span class="normal">2112</span>
<span class="normal">2113</span>
<span class="normal">2114</span>
<span class="normal">2115</span>
<span class="normal">2116</span>
<span class="normal">2117</span>
<span class="normal">2118</span>
<span class="normal">2119</span>
<span class="normal">2120</span>
<span class="normal">2121</span>
<span class="normal">2122</span>
<span class="normal">2123</span>
<span class="normal">2124</span>
<span class="normal">2125</span>
<span class="normal">2126</span>
<span class="normal">2127</span>
<span class="normal">2128</span>
<span class="normal">2129</span>
<span class="normal">2130</span>
<span class="normal">2131</span>
<span class="normal">2132</span>
<span class="normal">2133</span>
<span class="normal">2134</span>
<span class="normal">2135</span>
<span class="normal">2136</span>
<span class="normal">2137</span>
<span class="normal">2138</span>
<span class="normal">2139</span>
<span class="normal">2140</span>
<span class="normal">2141</span>
<span class="normal">2142</span>
<span class="normal">2143</span>
<span class="normal">2144</span>
<span class="normal">2145</span>
<span class="normal">2146</span>
<span class="normal">2147</span>
<span class="normal">2148</span>
<span class="normal">2149</span>
<span class="normal">2150</span>
<span class="normal">2151</span>
<span class="normal">2152</span>
<span class="normal">2153</span>
<span class="normal">2154</span>
<span class="normal">2155</span>
<span class="normal">2156</span>
<span class="normal">2157</span>
<span class="normal">2158</span>
<span class="normal">2159</span>
<span class="normal">2160</span>
<span class="normal">2161</span>
<span class="normal">2162</span>
<span class="normal">2163</span>
<span class="normal">2164</span>
<span class="normal">2165</span>
<span class="normal">2166</span>
<span class="normal">2167</span>
<span class="normal">2168</span>
<span class="normal">2169</span>
<span class="normal">2170</span>
<span class="normal">2171</span>
<span class="normal">2172</span>
<span class="normal">2173</span>
<span class="normal">2174</span>
<span class="normal">2175</span>
<span class="normal">2176</span>
<span class="normal">2177</span>
<span class="normal">2178</span>
<span class="normal">2179</span>
<span class="normal">2180</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">apply_managed_lane_feature_change</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">link_idx</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
    <span class="n">properties</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;RoadwayNetwork&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Apply the managed lane feature changes to the roadway network</span>

<span class="sd">    Args:</span>
<span class="sd">        link_idx : list of lndices of all links to apply change to</span>
<span class="sd">        properties : list of dictionarys roadway properties to change</span>

<span class="sd">    .. todo:: decide on connectors info when they are more specific in project card</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># add ML flag to relevant links</span>
    <span class="k">if</span> <span class="s2">&quot;managed&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">link_idx</span><span class="p">,</span> <span class="s2">&quot;managed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="p">[</span><span class="s2">&quot;managed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">link_idx</span><span class="p">,</span> <span class="s2">&quot;managed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">properties</span><span class="p">:</span>
        <span class="n">attribute</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;property&quot;</span><span class="p">]</span>
        <span class="n">attr_value</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">link_idx</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;group&quot;</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">attr_value</span> <span class="o">=</span> <span class="p">{}</span>

                <span class="k">if</span> <span class="s2">&quot;set&quot;</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">attr_value</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;set&quot;</span><span class="p">]</span>
                <span class="k">elif</span> <span class="s2">&quot;change&quot;</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">attr_value</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">attribute</span><span class="p">]</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;change&quot;</span><span class="p">]</span>
                    <span class="p">)</span>

                <span class="n">attr_value</span><span class="p">[</span><span class="s2">&quot;timeofday&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;group&quot;</span><span class="p">]:</span>
                    <span class="n">category</span> <span class="o">=</span> <span class="n">g</span><span class="p">[</span><span class="s2">&quot;category&quot;</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">tod</span> <span class="ow">in</span> <span class="n">g</span><span class="p">[</span><span class="s2">&quot;timeofday&quot;</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="s2">&quot;set&quot;</span> <span class="ow">in</span> <span class="n">tod</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                            <span class="n">attr_value</span><span class="p">[</span><span class="s2">&quot;timeofday&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                <span class="p">{</span>
                                    <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="n">category</span><span class="p">,</span>
                                    <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">parse_time_spans_to_secs</span><span class="p">(</span><span class="n">tod</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]),</span>
                                    <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">tod</span><span class="p">[</span><span class="s2">&quot;set&quot;</span><span class="p">],</span>
                                <span class="p">}</span>
                            <span class="p">)</span>
                        <span class="k">elif</span> <span class="s2">&quot;change&quot;</span> <span class="ow">in</span> <span class="n">tod</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                            <span class="n">attr_value</span><span class="p">[</span><span class="s2">&quot;timeofday&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                <span class="p">{</span>
                                    <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="n">category</span><span class="p">,</span>
                                    <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">parse_time_spans_to_secs</span><span class="p">(</span><span class="n">tod</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]),</span>
                                    <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">attribute</span><span class="p">]</span>
                                    <span class="o">+</span> <span class="n">tod</span><span class="p">[</span><span class="s2">&quot;change&quot;</span><span class="p">],</span>
                                <span class="p">}</span>
                            <span class="p">)</span>

            <span class="k">elif</span> <span class="s2">&quot;timeofday&quot;</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">attr_value</span> <span class="o">=</span> <span class="p">{}</span>

                <span class="k">if</span> <span class="s2">&quot;set&quot;</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">attr_value</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;set&quot;</span><span class="p">]</span>
                <span class="k">elif</span> <span class="s2">&quot;change&quot;</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">attr_value</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">attribute</span><span class="p">]</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;change&quot;</span><span class="p">]</span>
                    <span class="p">)</span>

                <span class="n">attr_value</span><span class="p">[</span><span class="s2">&quot;timeofday&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="k">for</span> <span class="n">tod</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;timeofday&quot;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="s2">&quot;set&quot;</span> <span class="ow">in</span> <span class="n">tod</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">attr_value</span><span class="p">[</span><span class="s2">&quot;timeofday&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="p">{</span>
                                <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">parse_time_spans_to_secs</span><span class="p">(</span><span class="n">tod</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]),</span>
                                <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">tod</span><span class="p">[</span><span class="s2">&quot;set&quot;</span><span class="p">],</span>
                            <span class="p">}</span>
                        <span class="p">)</span>
                    <span class="k">elif</span> <span class="s2">&quot;change&quot;</span> <span class="ow">in</span> <span class="n">tod</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">attr_value</span><span class="p">[</span><span class="s2">&quot;timeofday&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="p">{</span>
                                <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">parse_time_spans_to_secs</span><span class="p">(</span><span class="n">tod</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]),</span>
                                <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">attribute</span><span class="p">]</span>
                                <span class="o">+</span> <span class="n">tod</span><span class="p">[</span><span class="s2">&quot;change&quot;</span><span class="p">],</span>
                            <span class="p">}</span>
                        <span class="p">)</span>
            <span class="k">elif</span> <span class="s2">&quot;set&quot;</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">attr_value</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;set&quot;</span><span class="p">]</span>

            <span class="k">elif</span> <span class="s2">&quot;change&quot;</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">attr_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">attribute</span><span class="p">]</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;change&quot;</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span>
                <span class="n">attr_value</span><span class="p">,</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span>
            <span class="p">):</span>
                <span class="c1"># if the attribute already exists</span>
                <span class="c1"># and the attr value we are trying to set is not numeric</span>
                <span class="c1"># then change the attribute type to object</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="p">[</span><span class="n">attribute</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="p">[</span><span class="n">attribute</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">attribute</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="c1"># if it is a new attribute then initialize with NaN values</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="p">[</span><span class="n">attribute</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NaN&quot;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">attribute</span><span class="p">]</span> <span class="o">=</span> <span class="n">attr_value</span>

    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">)</span><span class="si">}</span><span class="s2"> Nodes in Network&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.roadwaynetwork.RoadwayNetwork.apply_python_calculation" class="doc doc-heading">
<code class="highlight language-python"><span class="n">apply_python_calculation</span><span class="p">(</span><span class="n">pycode</span><span class="p">)</span></code>

<a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.apply_python_calculation" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Changes roadway network object by executing pycode.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>net</code></td>
          <td>
          </td>
          <td><p>network to manipulate</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>pycode</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>python code which changes values in the roadway network object</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/roadwaynetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1911</span>
<span class="normal">1912</span>
<span class="normal">1913</span>
<span class="normal">1914</span>
<span class="normal">1915</span>
<span class="normal">1916</span>
<span class="normal">1917</span>
<span class="normal">1918</span>
<span class="normal">1919</span>
<span class="normal">1920</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">apply_python_calculation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pycode</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;RoadwayNetwork&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Changes roadway network object by executing pycode.</span>

<span class="sd">    Args:</span>
<span class="sd">        net: network to manipulate</span>
<span class="sd">        pycode: python code which changes values in the roadway network object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">exec</span><span class="p">(</span><span class="n">pycode</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.roadwaynetwork.RoadwayNetwork.apply_roadway_feature_change" class="doc doc-heading">
<code class="highlight language-python"><span class="n">apply_roadway_feature_change</span><span class="p">(</span><span class="n">df_idx</span><span class="p">,</span> <span class="n">properties</span><span class="p">,</span> <span class="n">geometry_type</span><span class="o">=</span><span class="s1">&#39;links&#39;</span><span class="p">)</span></code>

<a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.apply_roadway_feature_change" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Changes the roadway attributes for the selected features based on the
project card information passed</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>df_idx</code></td>
          <td>
          </td>
          <td><p>list
lndices of all links or nodes to apply change to</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>properties</code></td>
          <td>
          </td>
          <td><p>list of dictionarys
roadway properties to change</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>geometry_type</code></td>
          <td>
          </td>
          <td><p>either &lsquo;links&rsquo; or &lsquo;nodes&rsquo;. Defaults to &lsquo;link&rsquo;</p></td>
          <td>
                <code>&#39;links&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/roadwaynetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1977</span>
<span class="normal">1978</span>
<span class="normal">1979</span>
<span class="normal">1980</span>
<span class="normal">1981</span>
<span class="normal">1982</span>
<span class="normal">1983</span>
<span class="normal">1984</span>
<span class="normal">1985</span>
<span class="normal">1986</span>
<span class="normal">1987</span>
<span class="normal">1988</span>
<span class="normal">1989</span>
<span class="normal">1990</span>
<span class="normal">1991</span>
<span class="normal">1992</span>
<span class="normal">1993</span>
<span class="normal">1994</span>
<span class="normal">1995</span>
<span class="normal">1996</span>
<span class="normal">1997</span>
<span class="normal">1998</span>
<span class="normal">1999</span>
<span class="normal">2000</span>
<span class="normal">2001</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">apply_roadway_feature_change</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">df_idx</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
    <span class="n">properties</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">geometry_type</span><span class="o">=</span><span class="s2">&quot;links&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;RoadwayNetwork&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Changes the roadway attributes for the selected features based on the</span>
<span class="sd">    project card information passed</span>

<span class="sd">    Args:</span>
<span class="sd">        df_idx : list</span>
<span class="sd">            lndices of all links or nodes to apply change to</span>
<span class="sd">        properties : list of dictionarys</span>
<span class="sd">            roadway properties to change</span>
<span class="sd">        geometry_type: either &#39;links&#39; or &#39;nodes&#39;. Defaults to &#39;link&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">geometry_type</span> <span class="o">==</span> <span class="s2">&quot;links&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_apply_links_feature_change</span><span class="p">(</span><span class="n">df_idx</span><span class="p">,</span> <span class="n">properties</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">geometry_type</span> <span class="o">==</span> <span class="s2">&quot;nodes&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_apply_nodes_feature_change</span><span class="p">(</span><span class="n">df_idx</span><span class="p">,</span> <span class="n">properties</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;geometry_type must be either &#39;links&#39; or &#39;nodes&#39;&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.roadwaynetwork.RoadwayNetwork.assess_connectivity" class="doc doc-heading">
<code class="highlight language-python"><span class="n">assess_connectivity</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">ignore_end_nodes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">links_df</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nodes_df</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.assess_connectivity" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Returns a network graph and list of disconnected subgraphs
as described by a list of their member nodes.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>mode</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>list of modes of the network, one of <code>drive</code>,<code>transit</code>,
<code>walk</code>, <code>bike</code></p></td>
          <td>
                <code>&#39;&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>ignore_end_nodes</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>if True, ignores stray singleton nodes</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>links_df</code></td>
          <td>
                <code><span title="pandas.core.frame.DataFrame">DataFrame</span></code>
          </td>
          <td><p>if specified, will assess connectivity of this
links list rather than self.links_df</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>nodes_df</code></td>
          <td>
                <code><span title="pandas.core.frame.DataFrame">DataFrame</span></code>
          </td>
          <td><p>if specified, will assess connectivity of this
nodes list rather than self.nodes_df</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Tuple of</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td><p>Network Graph (osmnx flavored networkX DiGraph)</p></td>
        </tr>
        <tr>
          <td>
          </td>
          <td><p>List of disconnected subgraphs described by the list of their
member nodes (as described by their <code>model_node_id</code>)</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/roadwaynetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3235</span>
<span class="normal">3236</span>
<span class="normal">3237</span>
<span class="normal">3238</span>
<span class="normal">3239</span>
<span class="normal">3240</span>
<span class="normal">3241</span>
<span class="normal">3242</span>
<span class="normal">3243</span>
<span class="normal">3244</span>
<span class="normal">3245</span>
<span class="normal">3246</span>
<span class="normal">3247</span>
<span class="normal">3248</span>
<span class="normal">3249</span>
<span class="normal">3250</span>
<span class="normal">3251</span>
<span class="normal">3252</span>
<span class="normal">3253</span>
<span class="normal">3254</span>
<span class="normal">3255</span>
<span class="normal">3256</span>
<span class="normal">3257</span>
<span class="normal">3258</span>
<span class="normal">3259</span>
<span class="normal">3260</span>
<span class="normal">3261</span>
<span class="normal">3262</span>
<span class="normal">3263</span>
<span class="normal">3264</span>
<span class="normal">3265</span>
<span class="normal">3266</span>
<span class="normal">3267</span>
<span class="normal">3268</span>
<span class="normal">3269</span>
<span class="normal">3270</span>
<span class="normal">3271</span>
<span class="normal">3272</span>
<span class="normal">3273</span>
<span class="normal">3274</span>
<span class="normal">3275</span>
<span class="normal">3276</span>
<span class="normal">3277</span>
<span class="normal">3278</span>
<span class="normal">3279</span>
<span class="normal">3280</span>
<span class="normal">3281</span>
<span class="normal">3282</span>
<span class="normal">3283</span>
<span class="normal">3284</span>
<span class="normal">3285</span>
<span class="normal">3286</span>
<span class="normal">3287</span>
<span class="normal">3288</span>
<span class="normal">3289</span>
<span class="normal">3290</span>
<span class="normal">3291</span>
<span class="normal">3292</span>
<span class="normal">3293</span>
<span class="normal">3294</span>
<span class="normal">3295</span>
<span class="normal">3296</span>
<span class="normal">3297</span>
<span class="normal">3298</span>
<span class="normal">3299</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">assess_connectivity</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">ignore_end_nodes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">links_df</span><span class="p">:</span> <span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">nodes_df</span><span class="p">:</span> <span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a network graph and list of disconnected subgraphs</span>
<span class="sd">    as described by a list of their member nodes.</span>

<span class="sd">    Args:</span>
<span class="sd">        mode:  list of modes of the network, one of `drive`,`transit`,</span>
<span class="sd">            `walk`, `bike`</span>
<span class="sd">        ignore_end_nodes: if True, ignores stray singleton nodes</span>
<span class="sd">        links_df: if specified, will assess connectivity of this</span>
<span class="sd">            links list rather than self.links_df</span>
<span class="sd">        nodes_df: if specified, will assess connectivity of this</span>
<span class="sd">            nodes list rather than self.nodes_df</span>

<span class="sd">    Returns: Tuple of</span>
<span class="sd">        Network Graph (osmnx flavored networkX DiGraph)</span>
<span class="sd">        List of disconnected subgraphs described by the list of their</span>
<span class="sd">            member nodes (as described by their `model_node_id`)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_nodes_df</span> <span class="o">=</span> <span class="n">nodes_df</span> <span class="k">if</span> <span class="n">nodes_df</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span>
    <span class="n">_links_df</span> <span class="o">=</span> <span class="n">links_df</span> <span class="k">if</span> <span class="n">links_df</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span>

    <span class="k">if</span> <span class="n">mode</span><span class="p">:</span>
        <span class="n">_links_df</span><span class="p">,</span> <span class="n">_nodes_df</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">get_modal_links_nodes</span><span class="p">(</span>
            <span class="n">_links_df</span><span class="p">,</span>
            <span class="n">_nodes_df</span><span class="p">,</span>
            <span class="n">modes</span><span class="o">=</span><span class="p">[</span><span class="n">mode</span><span class="p">],</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s2">&quot;Assessing connectivity without a mode</span><span class="se">\</span>
<span class="s2">            specified. This may have limited value in interpretation.</span><span class="se">\</span>
<span class="s2">            To add mode specificity, add the keyword `mode =` to calling</span><span class="se">\</span>
<span class="s2">            this method&quot;</span>
        <span class="p">)</span>

    <span class="n">G</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">ox_graph</span><span class="p">(</span><span class="n">_nodes_df</span><span class="p">,</span> <span class="n">_links_df</span><span class="p">)</span>

    <span class="n">sub_graph_nodes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">strongly_connected_components</span><span class="p">(</span><span class="n">G</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="nb">len</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="c1"># sorted on decreasing length, dropping the main sub-graph</span>
    <span class="n">disconnected_sub_graph_nodes</span> <span class="o">=</span> <span class="n">sub_graph_nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

    <span class="c1"># dropping the sub-graphs with only 1 node</span>
    <span class="k">if</span> <span class="n">ignore_end_nodes</span><span class="p">:</span>
        <span class="n">disconnected_sub_graph_nodes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">disconnected_sub_graph_nodes</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>
        <span class="p">]</span>

    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> for disconnected networks for mode = </span><span class="si">{}</span><span class="s2">:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span><span class="p">,</span>
            <span class="n">mode</span><span class="p">,</span>
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">disconnected_sub_graph_nodes</span><span class="p">))),</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">G</span><span class="p">,</span> <span class="n">disconnected_sub_graph_nodes</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.roadwaynetwork.RoadwayNetwork.build_selection_key" class="doc doc-heading">
<code class="highlight language-python"><span class="n">build_selection_key</span><span class="p">(</span><span class="n">selection_dict</span><span class="p">)</span></code>

<a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.build_selection_key" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Selections are stored by a hash of the selection dictionary.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>selection_dictonary</code></td>
          <td>
          </td>
          <td><p>Selection Dictionary</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/roadwaynetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">build_selection_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selection_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Selections are stored by a hash of the selection dictionary.</span>

<span class="sd">    Args:</span>
<span class="sd">        selection_dictonary: Selection Dictionary</span>

<span class="sd">    Returns: Hex code for hash</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;selection_dict&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.roadwaynetwork.RoadwayNetwork.coerce_types" class="doc doc-heading">
<code class="highlight language-python"><span class="n">coerce_types</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.coerce_types" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Coerces types to bool, str and int which might default to other types based on values.</p>
<p>Uses BOOL_PROPERTIES, INT_PROPERTIES and STR_PROPERTIES.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>df</code></td>
          <td>
                <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td><p>Dataframe to coerce type of</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>cols</code></td>
          <td>
                <code><span title="typing.Collection">Collection</span>[str]</code>
          </td>
          <td><p>optional list of fields to check and coerce. Defaults to all fields.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td><p>pd.DataFrame: Dataframe with types coerced</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/roadwaynetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">coerce_types</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">cols</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Coerces types to bool, str and int which might default to other types based on values.</span>

<span class="sd">    Uses BOOL_PROPERTIES, INT_PROPERTIES and STR_PROPERTIES.</span>

<span class="sd">    Args:</span>
<span class="sd">        df: Dataframe to coerce type of</span>
<span class="sd">        cols: optional list of fields to check and coerce. Defaults to all fields.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: Dataframe with types coerced</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">cols</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span>

    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">BOOL_PROPERTIES</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">cols</span><span class="p">)):</span>
        <span class="n">df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">STR_PROPERTIES</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">cols</span><span class="p">)):</span>
        <span class="n">df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">INT_PROPERTIES</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">cols</span><span class="p">)):</span>
        <span class="n">df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.roadwaynetwork.RoadwayNetwork.delete_links" class="doc doc-heading">
<code class="highlight language-python"><span class="n">delete_links</span><span class="p">(</span><span class="n">del_links</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">ignore_missing</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.delete_links" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Delete the roadway links based on del_links dictionary selecting links by properties.</p>
<p>Also deletes shapes which no longer have links associated with them.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>del_links</code></td>
          <td>
          </td>
          <td><p>Dictionary identified shapes to delete by properties.  Links will be selected
if <em>any</em> of the properties are equal to <em>any</em> of the values.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>ignore_missing</code></td>
          <td>
          </td>
          <td><p>If True, will only warn if try to delete a links that isn&rsquo;t in network.
If False, it will fail on missing links. Defaults to True.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/roadwaynetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2404</span>
<span class="normal">2405</span>
<span class="normal">2406</span>
<span class="normal">2407</span>
<span class="normal">2408</span>
<span class="normal">2409</span>
<span class="normal">2410</span>
<span class="normal">2411</span>
<span class="normal">2412</span>
<span class="normal">2413</span>
<span class="normal">2414</span>
<span class="normal">2415</span>
<span class="normal">2416</span>
<span class="normal">2417</span>
<span class="normal">2418</span>
<span class="normal">2419</span>
<span class="normal">2420</span>
<span class="normal">2421</span>
<span class="normal">2422</span>
<span class="normal">2423</span>
<span class="normal">2424</span>
<span class="normal">2425</span>
<span class="normal">2426</span>
<span class="normal">2427</span>
<span class="normal">2428</span>
<span class="normal">2429</span>
<span class="normal">2430</span>
<span class="normal">2431</span>
<span class="normal">2432</span>
<span class="normal">2433</span>
<span class="normal">2434</span>
<span class="normal">2435</span>
<span class="normal">2436</span>
<span class="normal">2437</span>
<span class="normal">2438</span>
<span class="normal">2439</span>
<span class="normal">2440</span>
<span class="normal">2441</span>
<span class="normal">2442</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">delete_links</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">del_links</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">ignore_missing</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Delete the roadway links based on del_links dictionary selecting links by properties.</span>

<span class="sd">    Also deletes shapes which no longer have links associated with them.</span>

<span class="sd">    Args:</span>
<span class="sd">        del_links: Dictionary identified shapes to delete by properties.  Links will be selected</span>
<span class="sd">            if *any* of the properties are equal to *any* of the values.</span>
<span class="sd">        ignore_missing: If True, will only warn if try to delete a links that isn&#39;t in network.</span>
<span class="sd">            If False, it will fail on missing links. Defaults to True.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># if RoadwayNetwork.UNIQUE_LINK_ID is used to select, flag links that weren&#39;t in network.</span>
    <span class="k">if</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_LINK_KEY</span> <span class="ow">in</span> <span class="n">del_links</span><span class="p">:</span>
        <span class="n">_del_link_ids</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">del_links</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_LINK_KEY</span><span class="p">])</span>
        <span class="n">_missing_links</span> <span class="o">=</span> <span class="n">_del_link_ids</span><span class="p">[</span>
            <span class="o">~</span><span class="n">_del_link_ids</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_LINK_KEY</span><span class="p">])</span>
        <span class="p">]</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Following links cannot be deleted because they are not in the network: </span><span class="si">{</span><span class="n">_missing_links</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">_missing_links</span><span class="p">)</span> <span class="ow">and</span> <span class="n">ignore_missing</span><span class="p">:</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">_missing_links</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="n">_del_links_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">del_links</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">_del_links_mask</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No links found matching criteria to delete.&quot;</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Deleting following links:</span><span class="se">\n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">_del_links_mask</span><span class="p">][[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="s1">&#39;model_link_id&#39;</span><span class="p">]]</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">_del_links_mask</span><span class="p">]</span>

    <span class="c1"># Delete shapes which no longer have links associated with them</span>
    <span class="n">_shapes_without_links</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shapes_without_links</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">_shapes_without_links</span><span class="p">):</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Shapes without links:</span><span class="se">\n</span><span class="s2"> </span><span class="si">{</span><span class="n">_shapes_without_links</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shapes_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapes_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">_shapes_without_links</span><span class="p">]</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;self.shapes_df reduced to:</span><span class="se">\n</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">shapes_df</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.roadwaynetwork.RoadwayNetwork.delete_nodes" class="doc doc-heading">
<code class="highlight language-python"><span class="n">delete_nodes</span><span class="p">(</span><span class="n">del_nodes</span><span class="p">,</span> <span class="n">ignore_missing</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.delete_nodes" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Delete the roadway nodes based on del_nodes dictionary selecting nodes by properties.</p>
<p>Will fail if try to delete node that is currently being used by a link.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>del_nodes</code></td>
          <td>
          </td>
          <td><p>Dictionary identified nodes to delete by properties.  Nodes will be selected
if <em>any</em> of the properties are equal to <em>any</em> of the values.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>ignore_missing</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>If True, will only warn if try to delete a node that isn&rsquo;t in network.
If False, it will fail on missing nodes. Defaults to True.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/roadwaynetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2444</span>
<span class="normal">2445</span>
<span class="normal">2446</span>
<span class="normal">2447</span>
<span class="normal">2448</span>
<span class="normal">2449</span>
<span class="normal">2450</span>
<span class="normal">2451</span>
<span class="normal">2452</span>
<span class="normal">2453</span>
<span class="normal">2454</span>
<span class="normal">2455</span>
<span class="normal">2456</span>
<span class="normal">2457</span>
<span class="normal">2458</span>
<span class="normal">2459</span>
<span class="normal">2460</span>
<span class="normal">2461</span>
<span class="normal">2462</span>
<span class="normal">2463</span>
<span class="normal">2464</span>
<span class="normal">2465</span>
<span class="normal">2466</span>
<span class="normal">2467</span>
<span class="normal">2468</span>
<span class="normal">2469</span>
<span class="normal">2470</span>
<span class="normal">2471</span>
<span class="normal">2472</span>
<span class="normal">2473</span>
<span class="normal">2474</span>
<span class="normal">2475</span>
<span class="normal">2476</span>
<span class="normal">2477</span>
<span class="normal">2478</span>
<span class="normal">2479</span>
<span class="normal">2480</span>
<span class="normal">2481</span>
<span class="normal">2482</span>
<span class="normal">2483</span>
<span class="normal">2484</span>
<span class="normal">2485</span>
<span class="normal">2486</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">delete_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">del_nodes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">ignore_missing</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Delete the roadway nodes based on del_nodes dictionary selecting nodes by properties.</span>

<span class="sd">    Will fail if try to delete node that is currently being used by a link.</span>

<span class="sd">    Args:</span>
<span class="sd">        del_nodes : Dictionary identified nodes to delete by properties.  Nodes will be selected</span>
<span class="sd">            if *any* of the properties are equal to *any* of the values.</span>
<span class="sd">        ignore_missing: If True, will only warn if try to delete a node that isn&#39;t in network.</span>
<span class="sd">            If False, it will fail on missing nodes. Defaults to True.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_del_nodes_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">del_nodes</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">_del_nodes_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">_del_nodes_mask</span><span class="p">]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">_del_nodes_mask</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No nodes found matching criteria to delete.&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Deleting Nodes:</span><span class="se">\n</span><span class="si">{</span><span class="n">_del_nodes_df</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># Check if node used in an existing link</span>
    <span class="n">_links_with_nodes</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">links_with_nodes</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="p">,</span>
        <span class="n">_del_nodes_df</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">NODE_FOREIGN_KEY_TO_LINK</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">_links_with_nodes</span><span class="p">):</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Node deletion failed because being used in following links:</span><span class="se">\n</span><span class="si">{</span><span class="n">_links_with_nodes</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">LINK_FOREIGN_KEY_TO_NODE</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span>

    <span class="c1"># Check if node is in network</span>
    <span class="k">if</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span> <span class="ow">in</span> <span class="n">del_nodes</span><span class="p">:</span>
        <span class="n">_del_node_ids</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">del_nodes</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span><span class="p">])</span>
        <span class="n">_missing_nodes</span> <span class="o">=</span> <span class="n">_del_node_ids</span><span class="p">[</span>
            <span class="o">~</span><span class="n">_del_node_ids</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span><span class="p">])</span>
        <span class="p">]</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Following nodes cannot be deleted because they are not in the network: </span><span class="si">{</span><span class="n">_missing_nodes</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">_missing_nodes</span><span class="p">)</span> <span class="ow">and</span> <span class="n">ignore_missing</span><span class="p">:</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">_missing_nodes</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">_del_nodes_mask</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.roadwaynetwork.RoadwayNetwork.delete_roadway_feature_change" class="doc doc-heading">
<code class="highlight language-python"><span class="n">delete_roadway_feature_change</span><span class="p">(</span><span class="n">del_links</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">del_nodes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ignore_missing</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.delete_roadway_feature_change" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Delete the roadway links or nodes defined in the project card.</p>
<p>Corresponding shapes to the deleted links are also deleted if they are not used elsewhere.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>del_links</code></td>
          <td>
          </td>
          <td><p>dictionary of identified links to delete</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>del_nodes</code></td>
          <td>
          </td>
          <td><p>dictionary of identified nodes to delete</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>ignore_missing</code></td>
          <td>
          </td>
          <td><p>bool
If True, will only warn about links/nodes that are missing from
network but specified to &ldquo;delete&rdquo; in project card
If False, will fail.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/roadwaynetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2488</span>
<span class="normal">2489</span>
<span class="normal">2490</span>
<span class="normal">2491</span>
<span class="normal">2492</span>
<span class="normal">2493</span>
<span class="normal">2494</span>
<span class="normal">2495</span>
<span class="normal">2496</span>
<span class="normal">2497</span>
<span class="normal">2498</span>
<span class="normal">2499</span>
<span class="normal">2500</span>
<span class="normal">2501</span>
<span class="normal">2502</span>
<span class="normal">2503</span>
<span class="normal">2504</span>
<span class="normal">2505</span>
<span class="normal">2506</span>
<span class="normal">2507</span>
<span class="normal">2508</span>
<span class="normal">2509</span>
<span class="normal">2510</span>
<span class="normal">2511</span>
<span class="normal">2512</span>
<span class="normal">2513</span>
<span class="normal">2514</span>
<span class="normal">2515</span>
<span class="normal">2516</span>
<span class="normal">2517</span>
<span class="normal">2518</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">delete_roadway_feature_change</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">del_links</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">del_nodes</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ignore_missing</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;RoadwayNetwork&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Delete the roadway links or nodes defined in the project card.</span>

<span class="sd">    Corresponding shapes to the deleted links are also deleted if they are not used elsewhere.</span>

<span class="sd">    Args:</span>
<span class="sd">        del_links : dictionary of identified links to delete</span>
<span class="sd">        del_nodes : dictionary of identified nodes to delete</span>
<span class="sd">        ignore_missing: bool</span>
<span class="sd">            If True, will only warn about links/nodes that are missing from</span>
<span class="sd">            network but specified to &quot;delete&quot; in project card</span>
<span class="sd">            If False, will fail.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Deleting Roadway Features:</span><span class="se">\n</span><span class="s2">-Links:</span><span class="se">\n</span><span class="si">{</span><span class="n">del_links</span><span class="si">}</span><span class="se">\n</span><span class="s2">-Nodes:</span><span class="se">\n</span><span class="si">{</span><span class="n">del_nodes</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">del_links</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete_links</span><span class="p">(</span><span class="n">del_links</span><span class="p">,</span> <span class="n">ignore_missing</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">del_nodes</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete_nodes</span><span class="p">(</span><span class="n">del_nodes</span><span class="p">,</span> <span class="n">ignore_missing</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.roadwaynetwork.RoadwayNetwork.deletion_map" class="doc doc-heading">
<code class="highlight language-python"><span class="n">deletion_map</span><span class="p">(</span><span class="n">links</span><span class="p">,</span> <span class="n">nodes</span><span class="p">)</span></code>

<a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.deletion_map" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Shows which links and nodes are deleted from the roadway network</p>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/roadwaynetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3421</span>
<span class="normal">3422</span>
<span class="normal">3423</span>
<span class="normal">3424</span>
<span class="normal">3425</span>
<span class="normal">3426</span>
<span class="normal">3427</span>
<span class="normal">3428</span>
<span class="normal">3429</span>
<span class="normal">3430</span>
<span class="normal">3431</span>
<span class="normal">3432</span>
<span class="normal">3433</span>
<span class="normal">3434</span>
<span class="normal">3435</span>
<span class="normal">3436</span>
<span class="normal">3437</span>
<span class="normal">3438</span>
<span class="normal">3439</span>
<span class="normal">3440</span>
<span class="normal">3441</span>
<span class="normal">3442</span>
<span class="normal">3443</span>
<span class="normal">3444</span>
<span class="normal">3445</span>
<span class="normal">3446</span>
<span class="normal">3447</span>
<span class="normal">3448</span>
<span class="normal">3449</span>
<span class="normal">3450</span>
<span class="normal">3451</span>
<span class="normal">3452</span>
<span class="normal">3453</span>
<span class="normal">3454</span>
<span class="normal">3455</span>
<span class="normal">3456</span>
<span class="normal">3457</span>
<span class="normal">3458</span>
<span class="normal">3459</span>
<span class="normal">3460</span>
<span class="normal">3461</span>
<span class="normal">3462</span>
<span class="normal">3463</span>
<span class="normal">3464</span>
<span class="normal">3465</span>
<span class="normal">3466</span>
<span class="normal">3467</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">deletion_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">links</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">nodes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Shows which links and nodes are deleted from the roadway network</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">links</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">links</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">deleted_links</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">val</span><span class="p">)]</span>

            <span class="n">node_list_foreign_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="nb">set</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="n">i</span>
                        <span class="k">for</span> <span class="n">fk</span> <span class="ow">in</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">LINK_FOREIGN_KEY_TO_NODE</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">deleted_links</span><span class="p">[</span><span class="n">fk</span><span class="p">])</span>
                    <span class="p">]</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">candidate_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">node_list_foreign_keys</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">deleted_links</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">nodes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">nodes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">deleted_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">val</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">deleted_nodes</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">G</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">ox_graph</span><span class="p">(</span><span class="n">candidate_nodes</span><span class="p">,</span> <span class="n">deleted_links</span><span class="p">)</span>

    <span class="n">m</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">plot_graph_folium</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">edge_color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">tiles</span><span class="o">=</span><span class="s2">&quot;cartodbpositron&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_folium_node</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="n">node_circle</span> <span class="o">=</span> <span class="n">folium</span><span class="o">.</span><span class="n">Circle</span><span class="p">(</span>
            <span class="n">location</span><span class="o">=</span><span class="p">[</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;Y&quot;</span><span class="p">],</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;X&quot;</span><span class="p">]],</span>
            <span class="n">radius</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
            <span class="n">fill_opacity</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">node_circle</span>

    <span class="k">if</span> <span class="n">deleted_nodes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">deleted_nodes</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">_folium_node</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">m</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.roadwaynetwork.RoadwayNetwork.get_modal_graph" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_modal_graph</span><span class="p">(</span><span class="n">links_df</span><span class="p">,</span> <span class="n">nodes_df</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.get_modal_graph" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Determines if the network graph is &ldquo;strongly&rdquo; connected
A graph is strongly connected if each vertex is reachable from every other vertex.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>links_df</code></td>
          <td>
                <code><span title="pandas.core.frame.DataFrame">DataFrame</span></code>
          </td>
          <td><p>DataFrame of standard network links</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>nodes_df</code></td>
          <td>
                <code><span title="pandas.core.frame.DataFrame">DataFrame</span></code>
          </td>
          <td><p>DataFrame of standard network nodes</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>mode</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>mode of the network, one of <code>drive</code>,<code>transit</code>,
<code>walk</code>, <code>bike</code></p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/roadwaynetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2824</span>
<span class="normal">2825</span>
<span class="normal">2826</span>
<span class="normal">2827</span>
<span class="normal">2828</span>
<span class="normal">2829</span>
<span class="normal">2830</span>
<span class="normal">2831</span>
<span class="normal">2832</span>
<span class="normal">2833</span>
<span class="normal">2834</span>
<span class="normal">2835</span>
<span class="normal">2836</span>
<span class="normal">2837</span>
<span class="normal">2838</span>
<span class="normal">2839</span>
<span class="normal">2840</span>
<span class="normal">2841</span>
<span class="normal">2842</span>
<span class="normal">2843</span>
<span class="normal">2844</span>
<span class="normal">2845</span>
<span class="normal">2846</span>
<span class="normal">2847</span>
<span class="normal">2848</span>
<span class="normal">2849</span>
<span class="normal">2850</span>
<span class="normal">2851</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">get_modal_graph</span><span class="p">(</span><span class="n">links_df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">nodes_df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Determines if the network graph is &quot;strongly&quot; connected</span>
<span class="sd">    A graph is strongly connected if each vertex is reachable from every other vertex.</span>

<span class="sd">    Args:</span>
<span class="sd">        links_df: DataFrame of standard network links</span>
<span class="sd">        nodes_df: DataFrame of standard network nodes</span>
<span class="sd">        mode: mode of the network, one of `drive`,`transit`,</span>
<span class="sd">            `walk`, `bike`</span>

<span class="sd">    Returns: networkx: osmnx: DiGraph  of network</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">MODES_TO_NETWORK_LINK_VARIABLES</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;mode value should be one of </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="nb">list</span><span class="p">(</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">MODES_TO_NETWORK_LINK_VARIABLES</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="p">)</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="n">_links_df</span><span class="p">,</span> <span class="n">_nodes_df</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">get_modal_links_nodes</span><span class="p">(</span>
        <span class="n">links_df</span><span class="p">,</span>
        <span class="n">nodes_df</span><span class="p">,</span>
        <span class="n">modes</span><span class="o">=</span><span class="p">[</span><span class="n">mode</span><span class="p">],</span>
    <span class="p">)</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">ox_graph</span><span class="p">(</span><span class="n">_nodes_df</span><span class="p">,</span> <span class="n">_links_df</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">G</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.roadwaynetwork.RoadwayNetwork.get_modal_links_nodes" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_modal_links_nodes</span><span class="p">(</span><span class="n">links_df</span><span class="p">,</span> <span class="n">nodes_df</span><span class="p">,</span> <span class="n">modes</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.get_modal_links_nodes" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Returns nodes and link dataframes for specific mode.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>links_df</code></td>
          <td>
                <code><span title="pandas.core.frame.DataFrame">DataFrame</span></code>
          </td>
          <td><p>DataFrame of standard network links</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>nodes_df</code></td>
          <td>
                <code><span title="pandas.core.frame.DataFrame">DataFrame</span></code>
          </td>
          <td><p>DataFrame of standard network nodes</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>modes</code></td>
          <td>
                <code>list[str]</code>
          </td>
          <td><p>list of the modes of the network to be kept, must be in
<code>drive</code>,<code>transit</code>,<code>rail</code>,<code>bus</code>,<code>walk</code>, <code>bike</code>.
For example, if bike and walk are selected, both bike and walk links will be kept.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>
      <p>.. todo:: Right now we don&rsquo;t filter the nodes because transit-only
links with walk access are not marked as having walk access
Issue discussed in https://github.com/wsp-sag/network_wrangler/issues/145
modal_nodes_df = nodes_df[nodes_df[mode_node_variable] == 1]</p>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/roadwaynetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2754</span>
<span class="normal">2755</span>
<span class="normal">2756</span>
<span class="normal">2757</span>
<span class="normal">2758</span>
<span class="normal">2759</span>
<span class="normal">2760</span>
<span class="normal">2761</span>
<span class="normal">2762</span>
<span class="normal">2763</span>
<span class="normal">2764</span>
<span class="normal">2765</span>
<span class="normal">2766</span>
<span class="normal">2767</span>
<span class="normal">2768</span>
<span class="normal">2769</span>
<span class="normal">2770</span>
<span class="normal">2771</span>
<span class="normal">2772</span>
<span class="normal">2773</span>
<span class="normal">2774</span>
<span class="normal">2775</span>
<span class="normal">2776</span>
<span class="normal">2777</span>
<span class="normal">2778</span>
<span class="normal">2779</span>
<span class="normal">2780</span>
<span class="normal">2781</span>
<span class="normal">2782</span>
<span class="normal">2783</span>
<span class="normal">2784</span>
<span class="normal">2785</span>
<span class="normal">2786</span>
<span class="normal">2787</span>
<span class="normal">2788</span>
<span class="normal">2789</span>
<span class="normal">2790</span>
<span class="normal">2791</span>
<span class="normal">2792</span>
<span class="normal">2793</span>
<span class="normal">2794</span>
<span class="normal">2795</span>
<span class="normal">2796</span>
<span class="normal">2797</span>
<span class="normal">2798</span>
<span class="normal">2799</span>
<span class="normal">2800</span>
<span class="normal">2801</span>
<span class="normal">2802</span>
<span class="normal">2803</span>
<span class="normal">2804</span>
<span class="normal">2805</span>
<span class="normal">2806</span>
<span class="normal">2807</span>
<span class="normal">2808</span>
<span class="normal">2809</span>
<span class="normal">2810</span>
<span class="normal">2811</span>
<span class="normal">2812</span>
<span class="normal">2813</span>
<span class="normal">2814</span>
<span class="normal">2815</span>
<span class="normal">2816</span>
<span class="normal">2817</span>
<span class="normal">2818</span>
<span class="normal">2819</span>
<span class="normal">2820</span>
<span class="normal">2821</span>
<span class="normal">2822</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">get_modal_links_nodes</span><span class="p">(</span>
    <span class="n">links_df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">nodes_df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">modes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">DataFrame</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns nodes and link dataframes for specific mode.</span>

<span class="sd">    Args:</span>
<span class="sd">        links_df: DataFrame of standard network links</span>
<span class="sd">        nodes_df: DataFrame of standard network nodes</span>
<span class="sd">        modes: list of the modes of the network to be kept, must be in</span>
<span class="sd">            `drive`,`transit`,`rail`,`bus`,`walk`, `bike`.</span>
<span class="sd">            For example, if bike and walk are selected, both bike and walk links will be kept.</span>

<span class="sd">    Returns: tuple of DataFrames for links, nodes filtered by mode</span>

<span class="sd">    .. todo:: Right now we don&#39;t filter the nodes because transit-only</span>
<span class="sd">    links with walk access are not marked as having walk access</span>
<span class="sd">    Issue discussed in https://github.com/wsp-sag/network_wrangler/issues/145</span>
<span class="sd">    modal_nodes_df = nodes_df[nodes_df[mode_node_variable] == 1]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="n">modes</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">MODES_TO_NETWORK_LINK_VARIABLES</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;mode value should be one of </span><span class="si">{}</span><span class="s2">, got </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="nb">list</span><span class="p">(</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">MODES_TO_NETWORK_LINK_VARIABLES</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
                <span class="n">mode</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="n">mode_link_variables</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
        <span class="nb">set</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">mode</span>
                <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="n">modes</span>
                <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">MODES_TO_NETWORK_LINK_VARIABLES</span><span class="p">[</span><span class="n">mode</span><span class="p">]</span>
            <span class="p">]</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">mode_node_variables</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
        <span class="nb">set</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">mode</span>
                <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="n">modes</span>
                <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">MODES_TO_NETWORK_NODE_VARIABLES</span><span class="p">[</span><span class="n">mode</span><span class="p">]</span>
            <span class="p">]</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">mode_link_variables</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">links_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span><span class="si">{</span><span class="nb">set</span><span class="p">(</span><span class="n">mode_link_variables</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">set</span><span class="p">(</span><span class="n">links_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span><span class="s2"> not in provided links_df </span><span class="se">\</span>
<span class="s2">            list of columns. Available columns are:</span>
<span class="s2">            </span><span class="si">{</span><span class="n">links_df</span><span class="o">.</span><span class="n">columns</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">mode_node_variables</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">nodes_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span><span class="si">{</span><span class="nb">set</span><span class="p">(</span><span class="n">mode_node_variables</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">set</span><span class="p">(</span><span class="n">nodes_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span><span class="s2"> not in provided nodes_df </span><span class="se">\</span>
<span class="s2">            list of columns. Available columns are:</span>
<span class="s2">            </span><span class="si">{</span><span class="n">nodes_df</span><span class="o">.</span><span class="n">columns</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="n">modal_links_df</span> <span class="o">=</span> <span class="n">links_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">links_df</span><span class="p">[</span><span class="n">mode_link_variables</span><span class="p">]</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>

    <span class="c1"># TODO right now we don&#39;t filter the nodes because transit-only</span>
    <span class="c1"># links with walk access are not marked as having walk access</span>
    <span class="c1"># Issue discussed in https://github.com/wsp-sag/network_wrangler/issues/145</span>
    <span class="c1"># modal_nodes_df = nodes_df[nodes_df[mode_node_variable] == 1]</span>
    <span class="n">modal_nodes_df</span> <span class="o">=</span> <span class="n">nodes_df</span>

    <span class="k">return</span> <span class="n">modal_links_df</span><span class="p">,</span> <span class="n">modal_nodes_df</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.roadwaynetwork.RoadwayNetwork.get_property_by_time_period_and_group" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_property_by_time_period_and_group</span><span class="p">(</span><span class="nb">property</span><span class="p">,</span> <span class="n">time_period</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.get_property_by_time_period_and_group" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Return a series for the properties with a specific group or time period.</p>
<h6 id="network_wrangler.roadwaynetwork.RoadwayNetwork.get_property_by_time_period_and_group--args">args<a class="headerlink" href="#network_wrangler.roadwaynetwork.RoadwayNetwork.get_property_by_time_period_and_group--args" title="Permanent link"> ¶</a></h6>

<details class="property">
  <summary>str</summary>
  <p>the variable that you want from network</p>
</details>
<details class="time_period">
  <summary>list(str)</summary>
  <p>the time period that you are querying for
i.e. [&lsquo;16:00&rsquo;, &lsquo;19:00&rsquo;]</p>
</details>
<details class="category">
  <summary>str or list(str)(Optional)</summary>
  <p>the group category
i.e. &ldquo;sov&rdquo;</p>
<p>or</p>
<p>list of group categories in order of search, i.e.
[&ldquo;hov3&rdquo;,&rdquo;hov2&rdquo;]</p>
</details>      <h6 id="network_wrangler.roadwaynetwork.RoadwayNetwork.get_property_by_time_period_and_group--returns">returns<a class="headerlink" href="#network_wrangler.roadwaynetwork.RoadwayNetwork.get_property_by_time_period_and_group--returns" title="Permanent link"> ¶</a></h6>
<p>pandas series</p>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/roadwaynetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2520</span>
<span class="normal">2521</span>
<span class="normal">2522</span>
<span class="normal">2523</span>
<span class="normal">2524</span>
<span class="normal">2525</span>
<span class="normal">2526</span>
<span class="normal">2527</span>
<span class="normal">2528</span>
<span class="normal">2529</span>
<span class="normal">2530</span>
<span class="normal">2531</span>
<span class="normal">2532</span>
<span class="normal">2533</span>
<span class="normal">2534</span>
<span class="normal">2535</span>
<span class="normal">2536</span>
<span class="normal">2537</span>
<span class="normal">2538</span>
<span class="normal">2539</span>
<span class="normal">2540</span>
<span class="normal">2541</span>
<span class="normal">2542</span>
<span class="normal">2543</span>
<span class="normal">2544</span>
<span class="normal">2545</span>
<span class="normal">2546</span>
<span class="normal">2547</span>
<span class="normal">2548</span>
<span class="normal">2549</span>
<span class="normal">2550</span>
<span class="normal">2551</span>
<span class="normal">2552</span>
<span class="normal">2553</span>
<span class="normal">2554</span>
<span class="normal">2555</span>
<span class="normal">2556</span>
<span class="normal">2557</span>
<span class="normal">2558</span>
<span class="normal">2559</span>
<span class="normal">2560</span>
<span class="normal">2561</span>
<span class="normal">2562</span>
<span class="normal">2563</span>
<span class="normal">2564</span>
<span class="normal">2565</span>
<span class="normal">2566</span>
<span class="normal">2567</span>
<span class="normal">2568</span>
<span class="normal">2569</span>
<span class="normal">2570</span>
<span class="normal">2571</span>
<span class="normal">2572</span>
<span class="normal">2573</span>
<span class="normal">2574</span>
<span class="normal">2575</span>
<span class="normal">2576</span>
<span class="normal">2577</span>
<span class="normal">2578</span>
<span class="normal">2579</span>
<span class="normal">2580</span>
<span class="normal">2581</span>
<span class="normal">2582</span>
<span class="normal">2583</span>
<span class="normal">2584</span>
<span class="normal">2585</span>
<span class="normal">2586</span>
<span class="normal">2587</span>
<span class="normal">2588</span>
<span class="normal">2589</span>
<span class="normal">2590</span>
<span class="normal">2591</span>
<span class="normal">2592</span>
<span class="normal">2593</span>
<span class="normal">2594</span>
<span class="normal">2595</span>
<span class="normal">2596</span>
<span class="normal">2597</span>
<span class="normal">2598</span>
<span class="normal">2599</span>
<span class="normal">2600</span>
<span class="normal">2601</span>
<span class="normal">2602</span>
<span class="normal">2603</span>
<span class="normal">2604</span>
<span class="normal">2605</span>
<span class="normal">2606</span>
<span class="normal">2607</span>
<span class="normal">2608</span>
<span class="normal">2609</span>
<span class="normal">2610</span>
<span class="normal">2611</span>
<span class="normal">2612</span>
<span class="normal">2613</span>
<span class="normal">2614</span>
<span class="normal">2615</span>
<span class="normal">2616</span>
<span class="normal">2617</span>
<span class="normal">2618</span>
<span class="normal">2619</span>
<span class="normal">2620</span>
<span class="normal">2621</span>
<span class="normal">2622</span>
<span class="normal">2623</span>
<span class="normal">2624</span>
<span class="normal">2625</span>
<span class="normal">2626</span>
<span class="normal">2627</span>
<span class="normal">2628</span>
<span class="normal">2629</span>
<span class="normal">2630</span>
<span class="normal">2631</span>
<span class="normal">2632</span>
<span class="normal">2633</span>
<span class="normal">2634</span>
<span class="normal">2635</span>
<span class="normal">2636</span>
<span class="normal">2637</span>
<span class="normal">2638</span>
<span class="normal">2639</span>
<span class="normal">2640</span>
<span class="normal">2641</span>
<span class="normal">2642</span>
<span class="normal">2643</span>
<span class="normal">2644</span>
<span class="normal">2645</span>
<span class="normal">2646</span>
<span class="normal">2647</span>
<span class="normal">2648</span>
<span class="normal">2649</span>
<span class="normal">2650</span>
<span class="normal">2651</span>
<span class="normal">2652</span>
<span class="normal">2653</span>
<span class="normal">2654</span>
<span class="normal">2655</span>
<span class="normal">2656</span>
<span class="normal">2657</span>
<span class="normal">2658</span>
<span class="normal">2659</span>
<span class="normal">2660</span>
<span class="normal">2661</span>
<span class="normal">2662</span>
<span class="normal">2663</span>
<span class="normal">2664</span>
<span class="normal">2665</span>
<span class="normal">2666</span>
<span class="normal">2667</span>
<span class="normal">2668</span>
<span class="normal">2669</span>
<span class="normal">2670</span>
<span class="normal">2671</span>
<span class="normal">2672</span>
<span class="normal">2673</span>
<span class="normal">2674</span>
<span class="normal">2675</span>
<span class="normal">2676</span>
<span class="normal">2677</span>
<span class="normal">2678</span>
<span class="normal">2679</span>
<span class="normal">2680</span>
<span class="normal">2681</span>
<span class="normal">2682</span>
<span class="normal">2683</span>
<span class="normal">2684</span>
<span class="normal">2685</span>
<span class="normal">2686</span>
<span class="normal">2687</span>
<span class="normal">2688</span>
<span class="normal">2689</span>
<span class="normal">2690</span>
<span class="normal">2691</span>
<span class="normal">2692</span>
<span class="normal">2693</span>
<span class="normal">2694</span>
<span class="normal">2695</span>
<span class="normal">2696</span>
<span class="normal">2697</span>
<span class="normal">2698</span>
<span class="normal">2699</span>
<span class="normal">2700</span>
<span class="normal">2701</span>
<span class="normal">2702</span>
<span class="normal">2703</span>
<span class="normal">2704</span>
<span class="normal">2705</span>
<span class="normal">2706</span>
<span class="normal">2707</span>
<span class="normal">2708</span>
<span class="normal">2709</span>
<span class="normal">2710</span>
<span class="normal">2711</span>
<span class="normal">2712</span>
<span class="normal">2713</span>
<span class="normal">2714</span>
<span class="normal">2715</span>
<span class="normal">2716</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_property_by_time_period_and_group</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="nb">property</span><span class="p">,</span> <span class="n">time_period</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="kc">None</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a series for the properties with a specific group or time period.</span>

<span class="sd">    args</span>
<span class="sd">    ------</span>
<span class="sd">    property: str</span>
<span class="sd">      the variable that you want from network</span>
<span class="sd">    time_period: list(str)</span>
<span class="sd">      the time period that you are querying for</span>
<span class="sd">      i.e. [&#39;16:00&#39;, &#39;19:00&#39;]</span>
<span class="sd">    category: str or list(str)(Optional)</span>
<span class="sd">      the group category</span>
<span class="sd">      i.e. &quot;sov&quot;</span>

<span class="sd">      or</span>

<span class="sd">      list of group categories in order of search, i.e.</span>
<span class="sd">      [&quot;hov3&quot;,&quot;hov2&quot;]</span>

<span class="sd">    returns</span>
<span class="sd">    --------</span>
<span class="sd">    pandas series</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_get_property</span><span class="p">(</span>
        <span class="n">v</span><span class="p">,</span>
        <span class="n">time_spans</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">category</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">return_partial_match</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">partial_match_minutes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">60</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        .. todo:: return the time period with the largest overlap</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">category</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">time_spans</span><span class="p">:</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Shouldn&#39;t have a category group without time spans&quot;</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Shouldn&#39;t have a category group without time spans&quot;</span><span class="p">)</span>

        <span class="c1"># simple case</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">v</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">category</span><span class="p">:</span>
            <span class="n">category</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">category</span> <span class="o">=</span> <span class="p">[</span><span class="n">category</span><span class="p">]</span>
        <span class="n">search_cats</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">category</span><span class="p">]</span>

        <span class="c1"># if no time or group specified, but it is a complex link situation</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">time_spans</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;default&quot;</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">v</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;variable: </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Variable </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2"> is more complex in network than query&quot;</span>
                <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;timeofday&quot;</span><span class="p">):</span>
            <span class="n">categories</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">tg</span> <span class="ow">in</span> <span class="n">v</span><span class="p">[</span><span class="s2">&quot;timeofday&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="p">(</span><span class="n">time_spans</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">tg</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                    <span class="ow">and</span> <span class="p">(</span><span class="n">time_spans</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">tg</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                    <span class="ow">and</span> <span class="p">(</span><span class="n">time_spans</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">time_spans</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="p">):</span>
                    <span class="k">if</span> <span class="n">tg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">):</span>
                        <span class="n">categories</span> <span class="o">+=</span> <span class="n">tg</span><span class="p">[</span><span class="s2">&quot;category&quot;</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">search_cats</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CAT:&quot;</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">tg</span><span class="p">[</span><span class="s2">&quot;category&quot;</span><span class="p">])</span>
                            <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">tg</span><span class="p">[</span><span class="s2">&quot;category&quot;</span><span class="p">]:</span>
                                <span class="c1"># print(&quot;Var:&quot;, v)</span>
                                <span class="c1"># print(</span>
                                <span class="c1">#    &quot;RETURNING:&quot;, time_spans, category, tg[&quot;value&quot;]</span>
                                <span class="c1"># )</span>
                                <span class="k">return</span> <span class="n">tg</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># print(&quot;Var:&quot;, v)</span>
                        <span class="c1"># print(&quot;RETURNING:&quot;, time_spans, category, tg[&quot;value&quot;])</span>
                        <span class="k">return</span> <span class="n">tg</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>

                <span class="k">if</span> <span class="p">(</span>
                    <span class="p">(</span><span class="n">time_spans</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">tg</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                    <span class="ow">and</span> <span class="p">(</span><span class="n">time_spans</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">tg</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                    <span class="ow">and</span> <span class="p">(</span><span class="n">time_spans</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">time_spans</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="ow">and</span> <span class="p">(</span><span class="n">tg</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">tg</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                <span class="p">):</span>
                    <span class="k">if</span> <span class="n">tg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">):</span>
                        <span class="n">categories</span> <span class="o">+=</span> <span class="n">tg</span><span class="p">[</span><span class="s2">&quot;category&quot;</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">search_cats</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CAT:&quot;</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">tg</span><span class="p">[</span><span class="s2">&quot;category&quot;</span><span class="p">])</span>
                            <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">tg</span><span class="p">[</span><span class="s2">&quot;category&quot;</span><span class="p">]:</span>
                                <span class="c1"># print(&quot;Var:&quot;, v)</span>
                                <span class="c1"># print(</span>
                                <span class="c1">#    &quot;RETURNING:&quot;, time_spans, category, tg[&quot;value&quot;]</span>
                                <span class="c1"># )</span>
                                <span class="k">return</span> <span class="n">tg</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># print(&quot;Var:&quot;, v)</span>
                        <span class="c1"># print(&quot;RETURNING:&quot;, time_spans, category, tg[&quot;value&quot;])</span>
                        <span class="k">return</span> <span class="n">tg</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>

                <span class="c1"># if there isn&#39;t a fully matched time period, see if there is an overlapping</span>
                <span class="c1"># one right now just return the first overlapping ones</span>
                <span class="c1"># TODO return the time period with the largest overlap</span>

                <span class="k">if</span> <span class="p">(</span>
                    <span class="p">(</span><span class="n">time_spans</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">tg</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                    <span class="ow">and</span> <span class="p">(</span><span class="n">time_spans</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">tg</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                <span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
                    <span class="p">(</span><span class="n">time_spans</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">tg</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                    <span class="ow">and</span> <span class="p">(</span><span class="n">time_spans</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">tg</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                <span class="p">):</span>
                    <span class="n">overlap_minutes</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
                        <span class="mi">0</span><span class="p">,</span>
                        <span class="nb">min</span><span class="p">(</span><span class="n">tg</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">time_spans</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="o">-</span> <span class="nb">max</span><span class="p">(</span><span class="n">time_spans</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tg</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span>
                    <span class="p">)</span>
                    <span class="c1"># print(&quot;OLM&quot;,overlap_minutes)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">return_partial_match</span> <span class="ow">and</span> <span class="n">overlap_minutes</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Couldn&#39;t find time period consistent with </span><span class="si">{</span><span class="n">time_spans</span><span class="si">}</span><span class="s2">, but </span><span class="se">\</span>
<span class="s2">                                found a partial match: </span><span class="si">{</span><span class="n">tg</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">. Consider allowing </span><span class="se">\</span>
<span class="s2">                                partial matches using &#39;return_partial_match&#39; keyword or </span><span class="se">\</span>
<span class="s2">                                updating query.&quot;</span>
                        <span class="p">)</span>
                    <span class="k">elif</span> <span class="p">(</span>
                        <span class="n">overlap_minutes</span> <span class="o">&lt;</span> <span class="n">partial_match_minutes</span>
                        <span class="ow">and</span> <span class="n">overlap_minutes</span> <span class="o">&gt;</span> <span class="mi">0</span>
                    <span class="p">):</span>
                        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Time period: </span><span class="si">{</span><span class="n">time_spans</span><span class="si">}</span><span class="s2"> overlapped less than the minimum number </span><span class="se">\</span>
<span class="s2">                            of minutes (</span><span class="si">{</span><span class="n">overlap_minutes</span><span class="si">}</span><span class="s2">&lt;</span><span class="si">{</span><span class="n">partial_match_minutes</span><span class="si">}</span><span class="s2">) to be </span><span class="se">\</span>
<span class="s2">                            considered a match with time period in network: </span><span class="si">{</span><span class="n">tg</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.&quot;</span>
                        <span class="p">)</span>
                    <span class="k">elif</span> <span class="n">overlap_minutes</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Returning a partial time period match. Time period: </span><span class="si">{</span><span class="n">time_spans</span><span class="si">}</span><span class="se">\</span>
<span class="s2">                            overlapped the minimum number of minutes (</span><span class="si">{</span><span class="n">overlap_minutes</span><span class="si">}</span><span class="s2">&gt;=</span><span class="se">\</span>
<span class="s2">                            </span><span class="si">{</span><span class="n">partial_match_minutes</span><span class="si">}</span><span class="s2">) to be considered a match with time period</span><span class="se">\</span>
<span class="s2">                             in network: </span><span class="si">{</span><span class="n">tg</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.&quot;</span>
                        <span class="p">)</span>
                        <span class="k">if</span> <span class="n">tg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">):</span>
                            <span class="n">categories</span> <span class="o">+=</span> <span class="n">tg</span><span class="p">[</span><span class="s2">&quot;category&quot;</span><span class="p">]</span>
                            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">search_cats</span><span class="p">:</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CAT:&quot;</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">tg</span><span class="p">[</span><span class="s2">&quot;category&quot;</span><span class="p">])</span>
                                <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">tg</span><span class="p">[</span><span class="s2">&quot;category&quot;</span><span class="p">]:</span>
                                    <span class="c1"># print(&quot;Var:&quot;, v)</span>
                                    <span class="c1"># print(</span>
                                    <span class="c1">#    &quot;RETURNING:&quot;,</span>
                                    <span class="c1">#    time_spans,</span>
                                    <span class="c1">#    category,</span>
                                    <span class="c1">#    tg[&quot;value&quot;],</span>
                                    <span class="c1"># )</span>
                                    <span class="k">return</span> <span class="n">tg</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="c1"># print(&quot;Var:&quot;, v)</span>
                            <span class="c1"># print(&quot;RETURNING:&quot;, time_spans, category, tg[&quot;value&quot;])</span>
                            <span class="k">return</span> <span class="n">tg</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>

<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            WranglerLogger.debug(</span>
<span class="sd">                &quot;\nCouldn&#39;t find time period for {}, returning default&quot;.format(</span>
<span class="sd">                    str(time_spans)</span>
<span class="sd">                )</span>
<span class="sd">            )</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="s2">&quot;default&quot;</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="c1"># print(&quot;Var:&quot;, v)</span>
                <span class="c1"># print(&quot;RETURNING:&quot;, time_spans, v[&quot;default&quot;])</span>
                <span class="k">return</span> <span class="n">v</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># print(&quot;Var:&quot;, v)</span>
                <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Can&#39;t find default; must specify a category in </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">categories</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Can&#39;t find default, must specify a category in: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">categories</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">)</span>

    <span class="n">time_spans</span> <span class="o">=</span> <span class="n">parse_time_spans_to_secs</span><span class="p">(</span><span class="n">time_period</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="p">[</span><span class="nb">property</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="n">_get_property</span><span class="p">,</span> <span class="n">time_spans</span><span class="o">=</span><span class="n">time_spans</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="n">category</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.roadwaynetwork.RoadwayNetwork.has_link" class="doc doc-heading">
<code class="highlight language-python"><span class="n">has_link</span><span class="p">(</span><span class="n">link_key_values</span><span class="p">)</span></code>

<a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.has_link" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Returns true if network has link based values corresponding with LINK_FOREIGN_KEY_TO_NODE properties.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>link_key_values</code></td>
          <td>
                <code>tuple</code>
          </td>
          <td><p>Tuple of values corresponding with RoadwayNetwork.LINK_FOREIGN_KEY_TO_ ODE properties.
If LINK_FOREIGN_KEY_TO_NODE is (&ldquo;A&rdquo;,&rdquo;B&rdquo;), then (1,2) references the link of A=1 and B=2.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/roadwaynetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2379</span>
<span class="normal">2380</span>
<span class="normal">2381</span>
<span class="normal">2382</span>
<span class="normal">2383</span>
<span class="normal">2384</span>
<span class="normal">2385</span>
<span class="normal">2386</span>
<span class="normal">2387</span>
<span class="normal">2388</span>
<span class="normal">2389</span>
<span class="normal">2390</span>
<span class="normal">2391</span>
<span class="normal">2392</span>
<span class="normal">2393</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">has_link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">link_key_values</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns true if network has link based values corresponding with LINK_FOREIGN_KEY_TO_NODE properties.</span>

<span class="sd">    Args:</span>
<span class="sd">        link_key_values: Tuple of values corresponding with RoadwayNetwork.LINK_FOREIGN_KEY_TO_ ODE properties.</span>
<span class="sd">            If LINK_FOREIGN_KEY_TO_NODE is (&quot;A&quot;,&quot;B&quot;), then (1,2) references the link of A=1 and B=2.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_query_parts</span> <span class="o">=</span> <span class="p">[</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2"> == </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">LINK_FOREIGN_KEY_TO_NODE</span><span class="p">,</span> <span class="n">link_key_values</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="n">_query</span> <span class="o">=</span> <span class="s2">&quot; and &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_query_parts</span><span class="p">)</span>
    <span class="n">_links</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">_query</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;python&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">_links</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.roadwaynetwork.RoadwayNetwork.has_node" class="doc doc-heading">
<code class="highlight language-python"><span class="n">has_node</span><span class="p">(</span><span class="n">unique_node_id</span><span class="p">)</span></code>

<a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.has_node" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Queries if network has node based on RoadwayNetwork.UNIQUE_NODE_KEY.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>unique_node_id</code></td>
          <td>
                <code>_type_</code>
          </td>
          <td><p>value of RoadwayNetwork.UNIQUE_NODE_KEY</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/roadwaynetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2366</span>
<span class="normal">2367</span>
<span class="normal">2368</span>
<span class="normal">2369</span>
<span class="normal">2370</span>
<span class="normal">2371</span>
<span class="normal">2372</span>
<span class="normal">2373</span>
<span class="normal">2374</span>
<span class="normal">2375</span>
<span class="normal">2376</span>
<span class="normal">2377</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">has_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unique_node_id</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Queries if network has node based on RoadwayNetwork.UNIQUE_NODE_KEY.</span>

<span class="sd">    Args:</span>
<span class="sd">        unique_node_id (_type_): value of RoadwayNetwork.UNIQUE_NODE_KEY</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">has_node</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="n">unique_node_id</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">has_node</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.roadwaynetwork.RoadwayNetwork.identify_segment" class="doc doc-heading">
<code class="highlight language-python"><span class="n">identify_segment</span><span class="p">(</span><span class="n">O_id</span><span class="p">,</span> <span class="n">D_id</span><span class="p">,</span> <span class="n">selection_dict</span><span class="o">=</span><span class="p">{},</span> <span class="n">mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nodes_df</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">links_df</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.identify_segment" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>endpoints</code></td>
          <td>
          </td>
          <td><p>list of length of two unique keys of nodes making up endpoints of segment</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>selection_dict</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>dictionary of link variables to select candidate links from, otherwise
will create a graph of ALL links which will be both a RAM hog and could result in
odd shortest paths.</p></td>
          <td>
                <code>{}</code>
          </td>
        </tr>
        <tr>
          <td><code>segment_variables</code></td>
          <td>
          </td>
          <td><p>list of variables to keep</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/roadwaynetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3164</span>
<span class="normal">3165</span>
<span class="normal">3166</span>
<span class="normal">3167</span>
<span class="normal">3168</span>
<span class="normal">3169</span>
<span class="normal">3170</span>
<span class="normal">3171</span>
<span class="normal">3172</span>
<span class="normal">3173</span>
<span class="normal">3174</span>
<span class="normal">3175</span>
<span class="normal">3176</span>
<span class="normal">3177</span>
<span class="normal">3178</span>
<span class="normal">3179</span>
<span class="normal">3180</span>
<span class="normal">3181</span>
<span class="normal">3182</span>
<span class="normal">3183</span>
<span class="normal">3184</span>
<span class="normal">3185</span>
<span class="normal">3186</span>
<span class="normal">3187</span>
<span class="normal">3188</span>
<span class="normal">3189</span>
<span class="normal">3190</span>
<span class="normal">3191</span>
<span class="normal">3192</span>
<span class="normal">3193</span>
<span class="normal">3194</span>
<span class="normal">3195</span>
<span class="normal">3196</span>
<span class="normal">3197</span>
<span class="normal">3198</span>
<span class="normal">3199</span>
<span class="normal">3200</span>
<span class="normal">3201</span>
<span class="normal">3202</span>
<span class="normal">3203</span>
<span class="normal">3204</span>
<span class="normal">3205</span>
<span class="normal">3206</span>
<span class="normal">3207</span>
<span class="normal">3208</span>
<span class="normal">3209</span>
<span class="normal">3210</span>
<span class="normal">3211</span>
<span class="normal">3212</span>
<span class="normal">3213</span>
<span class="normal">3214</span>
<span class="normal">3215</span>
<span class="normal">3216</span>
<span class="normal">3217</span>
<span class="normal">3218</span>
<span class="normal">3219</span>
<span class="normal">3220</span>
<span class="normal">3221</span>
<span class="normal">3222</span>
<span class="normal">3223</span>
<span class="normal">3224</span>
<span class="normal">3225</span>
<span class="normal">3226</span>
<span class="normal">3227</span>
<span class="normal">3228</span>
<span class="normal">3229</span>
<span class="normal">3230</span>
<span class="normal">3231</span>
<span class="normal">3232</span>
<span class="normal">3233</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">identify_segment</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">O_id</span><span class="p">,</span>
    <span class="n">D_id</span><span class="p">,</span>
    <span class="n">selection_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
    <span class="n">mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">nodes_df</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">links_df</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        endpoints: list of length of two unique keys of nodes making up endpoints of segment</span>
<span class="sd">        selection_dict: dictionary of link variables to select candidate links from, otherwise</span>
<span class="sd">            will create a graph of ALL links which will be both a RAM hog and could result in</span>
<span class="sd">            odd shortest paths.</span>
<span class="sd">        segment_variables: list of variables to keep</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_nodes_df</span> <span class="o">=</span> <span class="n">nodes_df</span> <span class="k">if</span> <span class="n">nodes_df</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span>
    <span class="n">_links_df</span> <span class="o">=</span> <span class="n">links_df</span> <span class="k">if</span> <span class="n">links_df</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span>

    <span class="k">if</span> <span class="n">mode</span><span class="p">:</span>
        <span class="n">_links_df</span><span class="p">,</span> <span class="n">_nodes_df</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">get_modal_links_nodes</span><span class="p">(</span>
            <span class="n">_links_df</span><span class="p">,</span>
            <span class="n">_nodes_df</span><span class="p">,</span>
            <span class="n">modes</span><span class="o">=</span><span class="p">[</span><span class="n">mode</span><span class="p">],</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s2">&quot;Assessing connectivity without a mode</span><span class="se">\</span>
<span class="s2">            specified. This may have limited value in interpretation.</span><span class="se">\</span>
<span class="s2">            To add mode specificity, add the keyword `mode =` to calling</span><span class="se">\</span>
<span class="s2">            this method&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">selection_dict</span><span class="p">:</span>
        <span class="n">_query</span> <span class="o">=</span> <span class="s2">&quot; or &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2"> == </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">selection_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
        <span class="p">)</span>
        <span class="n">_candidate_links</span> <span class="o">=</span> <span class="n">_links_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">_query</span><span class="p">)</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;Found </span><span class="si">{}</span><span class="s2"> candidate links from </span><span class="si">{}</span><span class="s2"> total links using following query:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">_candidate_links</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">_links_df</span><span class="p">),</span> <span class="n">_query</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_candidate_links</span> <span class="o">=</span> <span class="n">_links_df</span>

        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s2">&quot;Not pre-selecting links using selection_dict can use up a lot of RAM and </span><span class="se">\</span>
<span class="s2">                also result in odd segment paths.&quot;</span>
        <span class="p">)</span>

    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
        <span class="s2">&quot;_candidate links for segment: </span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">_candidate_links</span><span class="p">[[</span><span class="s2">&quot;u&quot;</span><span class="p">,</span> <span class="s2">&quot;v&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;ref&quot;</span><span class="p">]]</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">candidate_links</span><span class="p">,</span> <span class="n">sp_route</span><span class="p">,</span> <span class="n">sp_links</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_search</span><span class="p">(</span>
            <span class="n">_candidate_links</span><span class="p">,</span> <span class="n">O_id</span><span class="p">,</span> <span class="n">D_id</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="n">NoPathFound</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Route not found from </span><span class="si">{}</span><span class="s2"> to </span><span class="si">{}</span><span class="s2"> using selection candidates </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">O_id</span><span class="p">,</span> <span class="n">D_id</span><span class="p">,</span> <span class="n">selection_dict</span>
        <span class="p">)</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">sp_links</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">sp_links</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.roadwaynetwork.RoadwayNetwork.identify_segment_endpoints" class="doc doc-heading">
<code class="highlight language-python"><span class="n">identify_segment_endpoints</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">links_df</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nodes_df</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">min_connecting_links</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">min_distance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_link_deviation</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></code>

<a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.identify_segment_endpoints" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>mode</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>list of modes of the network, one of <code>drive</code>,<code>transit</code>,
<code>walk</code>, <code>bike</code></p></td>
          <td>
                <code>&#39;&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>links_df</code></td>
          <td>
                <code><span title="pandas.core.frame.DataFrame">DataFrame</span></code>
          </td>
          <td><p>if specified, will assess connectivity of this
links list rather than self.links_df</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>nodes_df</code></td>
          <td>
                <code><span title="pandas.core.frame.DataFrame">DataFrame</span></code>
          </td>
          <td><p>if specified, will assess connectivity of this
nodes list rather than self.nodes_df</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/roadwaynetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2940</span>
<span class="normal">2941</span>
<span class="normal">2942</span>
<span class="normal">2943</span>
<span class="normal">2944</span>
<span class="normal">2945</span>
<span class="normal">2946</span>
<span class="normal">2947</span>
<span class="normal">2948</span>
<span class="normal">2949</span>
<span class="normal">2950</span>
<span class="normal">2951</span>
<span class="normal">2952</span>
<span class="normal">2953</span>
<span class="normal">2954</span>
<span class="normal">2955</span>
<span class="normal">2956</span>
<span class="normal">2957</span>
<span class="normal">2958</span>
<span class="normal">2959</span>
<span class="normal">2960</span>
<span class="normal">2961</span>
<span class="normal">2962</span>
<span class="normal">2963</span>
<span class="normal">2964</span>
<span class="normal">2965</span>
<span class="normal">2966</span>
<span class="normal">2967</span>
<span class="normal">2968</span>
<span class="normal">2969</span>
<span class="normal">2970</span>
<span class="normal">2971</span>
<span class="normal">2972</span>
<span class="normal">2973</span>
<span class="normal">2974</span>
<span class="normal">2975</span>
<span class="normal">2976</span>
<span class="normal">2977</span>
<span class="normal">2978</span>
<span class="normal">2979</span>
<span class="normal">2980</span>
<span class="normal">2981</span>
<span class="normal">2982</span>
<span class="normal">2983</span>
<span class="normal">2984</span>
<span class="normal">2985</span>
<span class="normal">2986</span>
<span class="normal">2987</span>
<span class="normal">2988</span>
<span class="normal">2989</span>
<span class="normal">2990</span>
<span class="normal">2991</span>
<span class="normal">2992</span>
<span class="normal">2993</span>
<span class="normal">2994</span>
<span class="normal">2995</span>
<span class="normal">2996</span>
<span class="normal">2997</span>
<span class="normal">2998</span>
<span class="normal">2999</span>
<span class="normal">3000</span>
<span class="normal">3001</span>
<span class="normal">3002</span>
<span class="normal">3003</span>
<span class="normal">3004</span>
<span class="normal">3005</span>
<span class="normal">3006</span>
<span class="normal">3007</span>
<span class="normal">3008</span>
<span class="normal">3009</span>
<span class="normal">3010</span>
<span class="normal">3011</span>
<span class="normal">3012</span>
<span class="normal">3013</span>
<span class="normal">3014</span>
<span class="normal">3015</span>
<span class="normal">3016</span>
<span class="normal">3017</span>
<span class="normal">3018</span>
<span class="normal">3019</span>
<span class="normal">3020</span>
<span class="normal">3021</span>
<span class="normal">3022</span>
<span class="normal">3023</span>
<span class="normal">3024</span>
<span class="normal">3025</span>
<span class="normal">3026</span>
<span class="normal">3027</span>
<span class="normal">3028</span>
<span class="normal">3029</span>
<span class="normal">3030</span>
<span class="normal">3031</span>
<span class="normal">3032</span>
<span class="normal">3033</span>
<span class="normal">3034</span>
<span class="normal">3035</span>
<span class="normal">3036</span>
<span class="normal">3037</span>
<span class="normal">3038</span>
<span class="normal">3039</span>
<span class="normal">3040</span>
<span class="normal">3041</span>
<span class="normal">3042</span>
<span class="normal">3043</span>
<span class="normal">3044</span>
<span class="normal">3045</span>
<span class="normal">3046</span>
<span class="normal">3047</span>
<span class="normal">3048</span>
<span class="normal">3049</span>
<span class="normal">3050</span>
<span class="normal">3051</span>
<span class="normal">3052</span>
<span class="normal">3053</span>
<span class="normal">3054</span>
<span class="normal">3055</span>
<span class="normal">3056</span>
<span class="normal">3057</span>
<span class="normal">3058</span>
<span class="normal">3059</span>
<span class="normal">3060</span>
<span class="normal">3061</span>
<span class="normal">3062</span>
<span class="normal">3063</span>
<span class="normal">3064</span>
<span class="normal">3065</span>
<span class="normal">3066</span>
<span class="normal">3067</span>
<span class="normal">3068</span>
<span class="normal">3069</span>
<span class="normal">3070</span>
<span class="normal">3071</span>
<span class="normal">3072</span>
<span class="normal">3073</span>
<span class="normal">3074</span>
<span class="normal">3075</span>
<span class="normal">3076</span>
<span class="normal">3077</span>
<span class="normal">3078</span>
<span class="normal">3079</span>
<span class="normal">3080</span>
<span class="normal">3081</span>
<span class="normal">3082</span>
<span class="normal">3083</span>
<span class="normal">3084</span>
<span class="normal">3085</span>
<span class="normal">3086</span>
<span class="normal">3087</span>
<span class="normal">3088</span>
<span class="normal">3089</span>
<span class="normal">3090</span>
<span class="normal">3091</span>
<span class="normal">3092</span>
<span class="normal">3093</span>
<span class="normal">3094</span>
<span class="normal">3095</span>
<span class="normal">3096</span>
<span class="normal">3097</span>
<span class="normal">3098</span>
<span class="normal">3099</span>
<span class="normal">3100</span>
<span class="normal">3101</span>
<span class="normal">3102</span>
<span class="normal">3103</span>
<span class="normal">3104</span>
<span class="normal">3105</span>
<span class="normal">3106</span>
<span class="normal">3107</span>
<span class="normal">3108</span>
<span class="normal">3109</span>
<span class="normal">3110</span>
<span class="normal">3111</span>
<span class="normal">3112</span>
<span class="normal">3113</span>
<span class="normal">3114</span>
<span class="normal">3115</span>
<span class="normal">3116</span>
<span class="normal">3117</span>
<span class="normal">3118</span>
<span class="normal">3119</span>
<span class="normal">3120</span>
<span class="normal">3121</span>
<span class="normal">3122</span>
<span class="normal">3123</span>
<span class="normal">3124</span>
<span class="normal">3125</span>
<span class="normal">3126</span>
<span class="normal">3127</span>
<span class="normal">3128</span>
<span class="normal">3129</span>
<span class="normal">3130</span>
<span class="normal">3131</span>
<span class="normal">3132</span>
<span class="normal">3133</span>
<span class="normal">3134</span>
<span class="normal">3135</span>
<span class="normal">3136</span>
<span class="normal">3137</span>
<span class="normal">3138</span>
<span class="normal">3139</span>
<span class="normal">3140</span>
<span class="normal">3141</span>
<span class="normal">3142</span>
<span class="normal">3143</span>
<span class="normal">3144</span>
<span class="normal">3145</span>
<span class="normal">3146</span>
<span class="normal">3147</span>
<span class="normal">3148</span>
<span class="normal">3149</span>
<span class="normal">3150</span>
<span class="normal">3151</span>
<span class="normal">3152</span>
<span class="normal">3153</span>
<span class="normal">3154</span>
<span class="normal">3155</span>
<span class="normal">3156</span>
<span class="normal">3157</span>
<span class="normal">3158</span>
<span class="normal">3159</span>
<span class="normal">3160</span>
<span class="normal">3161</span>
<span class="normal">3162</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">identify_segment_endpoints</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">links_df</span><span class="p">:</span> <span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">nodes_df</span><span class="p">:</span> <span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">min_connecting_links</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">min_distance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_link_deviation</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Args:</span>
<span class="sd">        mode:  list of modes of the network, one of `drive`,`transit`,</span>
<span class="sd">            `walk`, `bike`</span>
<span class="sd">        links_df: if specified, will assess connectivity of this</span>
<span class="sd">            links list rather than self.links_df</span>
<span class="sd">        nodes_df: if specified, will assess connectivity of this</span>
<span class="sd">            nodes list rather than self.nodes_df</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">SEGMENT_IDENTIFIERS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;ref&quot;</span><span class="p">]</span>

    <span class="n">NAME_PER_NODE</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">REF_PER_NODE</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="n">_nodes_df</span> <span class="o">=</span> <span class="n">nodes_df</span> <span class="k">if</span> <span class="n">nodes_df</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span>
    <span class="n">_links_df</span> <span class="o">=</span> <span class="n">links_df</span> <span class="k">if</span> <span class="n">links_df</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span>

    <span class="k">if</span> <span class="n">mode</span><span class="p">:</span>
        <span class="n">_links_df</span><span class="p">,</span> <span class="n">_nodes_df</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">get_modal_links_nodes</span><span class="p">(</span>
            <span class="n">_links_df</span><span class="p">,</span>
            <span class="n">_nodes_df</span><span class="p">,</span>
            <span class="n">modes</span><span class="o">=</span><span class="p">[</span><span class="n">mode</span><span class="p">],</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s2">&quot;Assessing connectivity without a mode</span><span class="se">\</span>
<span class="s2">            specified. This may have limited value in interpretation.</span><span class="se">\</span>
<span class="s2">            To add mode specificity, add the keyword `mode =` to calling</span><span class="se">\</span>
<span class="s2">            this method&quot;</span>
        <span class="p">)</span>

    <span class="n">_nodes_df</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">add_incident_link_data_to_nodes</span><span class="p">(</span>
        <span class="n">links_df</span><span class="o">=</span><span class="n">_links_df</span><span class="p">,</span>
        <span class="n">nodes_df</span><span class="o">=</span><span class="n">_nodes_df</span><span class="p">,</span>
        <span class="n">link_variables</span><span class="o">=</span><span class="n">SEGMENT_IDENTIFIERS</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;distance&quot;</span><span class="p">],</span>
    <span class="p">)</span>
    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Node/Link table elements: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">_nodes_df</span><span class="p">)))</span>

    <span class="c1"># Screen out segments that have blank name AND refs</span>
    <span class="n">_nodes_df</span> <span class="o">=</span> <span class="n">_nodes_df</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^\s*$&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span>
        <span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;ref&quot;</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
        <span class="s2">&quot;Node/Link table elements after dropping empty name AND ref : </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">_nodes_df</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># Screen out segments that aren&#39;t likely to be long enough</span>
    <span class="c1"># Minus 1 in case ref or name is missing on an intermediate link</span>
    <span class="n">_min_ref_in_table</span> <span class="o">=</span> <span class="n">REF_PER_NODE</span> <span class="o">*</span> <span class="p">(</span><span class="n">min_connecting_links</span> <span class="o">-</span> <span class="n">max_link_deviation</span><span class="p">)</span>
    <span class="n">_min_name_in_table</span> <span class="o">=</span> <span class="n">NAME_PER_NODE</span> <span class="o">*</span> <span class="p">(</span><span class="n">min_connecting_links</span> <span class="o">-</span> <span class="n">max_link_deviation</span><span class="p">)</span>

    <span class="n">_nodes_df</span><span class="p">[</span><span class="s2">&quot;ref_freq&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_nodes_df</span><span class="p">[</span><span class="s2">&quot;ref&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">_nodes_df</span><span class="p">[</span><span class="s2">&quot;ref&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>
    <span class="n">_nodes_df</span><span class="p">[</span><span class="s2">&quot;name_freq&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_nodes_df</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">_nodes_df</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>

    <span class="n">_nodes_df</span> <span class="o">=</span> <span class="n">_nodes_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
        <span class="p">(</span><span class="n">_nodes_df</span><span class="p">[</span><span class="s2">&quot;ref_freq&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">_min_ref_in_table</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">_nodes_df</span><span class="p">[</span><span class="s2">&quot;name_freq&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">_min_name_in_table</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
        <span class="s2">&quot;Node/Link table has n = </span><span class="si">{}</span><span class="s2"> after screening segments for min length:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">_nodes_df</span><span class="p">),</span>
            <span class="n">_nodes_df</span><span class="p">[</span>
                <span class="p">[</span>
                    <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span><span class="p">,</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;ref&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;distance&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;ref_freq&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;name_freq&quot;</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">],</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="c1"># ----------------------------------------</span>
    <span class="c1"># Find nodes that are likely endpoints</span>
    <span class="c1"># ----------------------------------------</span>

    <span class="c1"># - Likely have one incident link and one outgoing link</span>
    <span class="n">_max_ref_endpoints</span> <span class="o">=</span> <span class="n">REF_PER_NODE</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">_max_name_endpoints</span> <span class="o">=</span> <span class="n">NAME_PER_NODE</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="c1"># - Attach frequency  of node/ref</span>
    <span class="n">_nodes_df</span> <span class="o">=</span> <span class="n">_nodes_df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
        <span class="n">_nodes_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span><span class="p">,</span> <span class="s2">&quot;ref&quot;</span><span class="p">])</span>
        <span class="o">.</span><span class="n">size</span><span class="p">()</span>
        <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">&quot;ref_N_freq&quot;</span><span class="p">),</span>
        <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span><span class="p">,</span> <span class="s2">&quot;ref&quot;</span><span class="p">],</span>
    <span class="p">)</span>
    <span class="c1"># WranglerLogger.debug(&quot;_ref_count+_nodes:\n{}&quot;.format(_nodes_df[[&quot;model_node_id&quot;,&quot;ref&quot;,&quot;name&quot;,&quot;ref_N_freq&quot;]]))</span>
    <span class="c1"># - Attach frequency  of node/name</span>
    <span class="n">_nodes_df</span> <span class="o">=</span> <span class="n">_nodes_df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
        <span class="n">_nodes_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">])</span>
        <span class="o">.</span><span class="n">size</span><span class="p">()</span>
        <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">&quot;name_N_freq&quot;</span><span class="p">),</span>
        <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">],</span>
    <span class="p">)</span>
    <span class="c1"># WranglerLogger.debug(&quot;_name_count+_nodes:\n{}&quot;.format(_nodes_df[[&quot;model_node_id&quot;,&quot;ref&quot;,&quot;name&quot;,&quot;name_N_freq&quot;]]))</span>

    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
        <span class="s2">&quot;Possible segment endpoints:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">_nodes_df</span><span class="p">[</span>
                <span class="p">[</span>
                    <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span><span class="p">,</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;ref&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;distance&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;ref_N_freq&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;name_N_freq&quot;</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">]</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="c1"># - Filter possible endpoint list based on node/name node/ref frequency</span>
    <span class="n">_nodes_df</span> <span class="o">=</span> <span class="n">_nodes_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
        <span class="p">(</span><span class="n">_nodes_df</span><span class="p">[</span><span class="s2">&quot;ref_N_freq&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">_max_ref_endpoints</span><span class="p">)</span>
        <span class="o">|</span> <span class="p">(</span><span class="n">_nodes_df</span><span class="p">[</span><span class="s2">&quot;name_N_freq&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">_max_name_endpoints</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
        <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> Likely segment endpoints with req_ref&lt;= </span><span class="si">{}</span><span class="s2"> or freq_name&lt;=</span><span class="si">{}</span><span class="s2"> </span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">_nodes_df</span><span class="p">),</span>
            <span class="n">_max_ref_endpoints</span><span class="p">,</span>
            <span class="n">_max_name_endpoints</span><span class="p">,</span>
            <span class="n">_nodes_df</span><span class="p">[</span>
                <span class="p">[</span>
                    <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span><span class="p">,</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;ref&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;ref_N_freq&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;name_N_freq&quot;</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">],</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="c1"># ----------------------------------------</span>
    <span class="c1"># Assign a segment id</span>
    <span class="c1"># ----------------------------------------</span>
    <span class="n">_nodes_df</span><span class="p">[</span><span class="s2">&quot;segment_id&quot;</span><span class="p">],</span> <span class="n">_segments</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">factorize</span><span class="p">(</span>
        <span class="n">_nodes_df</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="n">_nodes_df</span><span class="o">.</span><span class="n">ref</span>
    <span class="p">)</span>
    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> Segments:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">_segments</span><span class="p">),</span> <span class="n">_segments</span><span class="p">))</span>

    <span class="c1"># ----------------------------------------</span>
    <span class="c1"># Drop segments without at least two nodes</span>
    <span class="c1"># ----------------------------------------</span>

    <span class="c1"># https://stackoverflow.com/questions/13446480/python-pandas-remove-entries-based-on-the-number-of-occurrences</span>
    <span class="n">_nodes_df</span> <span class="o">=</span> <span class="n">_nodes_df</span><span class="p">[</span>
        <span class="n">_nodes_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;segment_id&quot;</span><span class="p">,</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span><span class="p">])[</span>
            <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span>
        <span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="nb">len</span><span class="p">)</span>
        <span class="o">&gt;</span> <span class="mi">1</span>
    <span class="p">]</span>

    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
        <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> Segments with at least nodes:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">_nodes_df</span><span class="p">),</span>
            <span class="n">_nodes_df</span><span class="p">[</span>
                <span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;ref&quot;</span><span class="p">,</span> <span class="s2">&quot;segment_id&quot;</span><span class="p">]</span>
            <span class="p">],</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># ----------------------------------------</span>
    <span class="c1"># For segments with more than two nodes, find farthest apart pairs</span>
    <span class="c1"># ----------------------------------------</span>

    <span class="k">def</span> <span class="nf">_max_segment_distance</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
        <span class="n">_segment_nodes</span> <span class="o">=</span> <span class="n">_nodes_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">_nodes_df</span><span class="p">[</span><span class="s2">&quot;segment_id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;segment_id&quot;</span><span class="p">]]</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="n">_segment_nodes</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">geometry</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">dist</span><span class="o">.</span><span class="n">dropna</span><span class="p">())</span>

    <span class="n">_nodes_df</span><span class="p">[</span><span class="s2">&quot;seg_distance&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_nodes_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">_max_segment_distance</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">_nodes_df</span> <span class="o">=</span> <span class="n">_nodes_df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
        <span class="n">_nodes_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;segment_id&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">seg_distance</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="nb">max</span><span class="p">)</span>
        <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">&quot;max_seg_distance&quot;</span><span class="p">),</span>
        <span class="n">on</span><span class="o">=</span><span class="s2">&quot;segment_id&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">_nodes_df</span> <span class="o">=</span> <span class="n">_nodes_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
        <span class="p">(</span><span class="n">_nodes_df</span><span class="p">[</span><span class="s2">&quot;max_seg_distance&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">_nodes_df</span><span class="p">[</span><span class="s2">&quot;seg_distance&quot;</span><span class="p">])</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">_nodes_df</span><span class="p">[</span><span class="s2">&quot;seg_distance&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span><span class="p">,</span> <span class="s2">&quot;segment_id&quot;</span><span class="p">])</span>

    <span class="c1"># ----------------------------------------</span>
    <span class="c1"># Reassign segment id for final segments</span>
    <span class="c1"># ----------------------------------------</span>
    <span class="n">_nodes_df</span><span class="p">[</span><span class="s2">&quot;segment_id&quot;</span><span class="p">],</span> <span class="n">_segments</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">factorize</span><span class="p">(</span>
        <span class="n">_nodes_df</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="n">_nodes_df</span><span class="o">.</span><span class="n">ref</span>
    <span class="p">)</span>

    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
        <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> Segments:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">_segments</span><span class="p">),</span>
            <span class="n">_nodes_df</span><span class="p">[</span>
                <span class="p">[</span>
                    <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span><span class="p">,</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;ref&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;segment_id&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;seg_distance&quot;</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">],</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">_nodes_df</span><span class="p">[</span>
        <span class="p">[</span><span class="s2">&quot;segment_id&quot;</span><span class="p">,</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span><span class="p">,</span> <span class="s2">&quot;geometry&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;ref&quot;</span><span class="p">]</span>
    <span class="p">]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.roadwaynetwork.RoadwayNetwork.is_network_connected" class="doc doc-heading">
<code class="highlight language-python"><span class="n">is_network_connected</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">links_df</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nodes_df</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.is_network_connected" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Determines if the network graph is &ldquo;strongly&rdquo; connected
A graph is strongly connected if each vertex is reachable from every other vertex.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>mode</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>mode of the network, one of <code>drive</code>,<code>transit</code>,
<code>walk</code>, <code>bike</code></p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>links_df</code></td>
          <td>
                <code><span title="pandas.core.frame.DataFrame">DataFrame</span></code>
          </td>
          <td><p>DataFrame of standard network links</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>nodes_df</code></td>
          <td>
                <code><span title="pandas.core.frame.DataFrame">DataFrame</span></code>
          </td>
          <td><p>DataFrame of standard network nodes</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>
      <p>.. todo:: Consider caching graphs if they take a long time.</p>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/roadwaynetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2853</span>
<span class="normal">2854</span>
<span class="normal">2855</span>
<span class="normal">2856</span>
<span class="normal">2857</span>
<span class="normal">2858</span>
<span class="normal">2859</span>
<span class="normal">2860</span>
<span class="normal">2861</span>
<span class="normal">2862</span>
<span class="normal">2863</span>
<span class="normal">2864</span>
<span class="normal">2865</span>
<span class="normal">2866</span>
<span class="normal">2867</span>
<span class="normal">2868</span>
<span class="normal">2869</span>
<span class="normal">2870</span>
<span class="normal">2871</span>
<span class="normal">2872</span>
<span class="normal">2873</span>
<span class="normal">2874</span>
<span class="normal">2875</span>
<span class="normal">2876</span>
<span class="normal">2877</span>
<span class="normal">2878</span>
<span class="normal">2879</span>
<span class="normal">2880</span>
<span class="normal">2881</span>
<span class="normal">2882</span>
<span class="normal">2883</span>
<span class="normal">2884</span>
<span class="normal">2885</span>
<span class="normal">2886</span>
<span class="normal">2887</span>
<span class="normal">2888</span>
<span class="normal">2889</span>
<span class="normal">2890</span>
<span class="normal">2891</span>
<span class="normal">2892</span>
<span class="normal">2893</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">is_network_connected</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">links_df</span><span class="p">:</span> <span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">nodes_df</span><span class="p">:</span> <span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determines if the network graph is &quot;strongly&quot; connected</span>
<span class="sd">    A graph is strongly connected if each vertex is reachable from every other vertex.</span>

<span class="sd">    Args:</span>
<span class="sd">        mode:  mode of the network, one of `drive`,`transit`,</span>
<span class="sd">            `walk`, `bike`</span>
<span class="sd">        links_df: DataFrame of standard network links</span>
<span class="sd">        nodes_df: DataFrame of standard network nodes</span>

<span class="sd">    Returns: boolean</span>

<span class="sd">    .. todo:: Consider caching graphs if they take a long time.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_nodes_df</span> <span class="o">=</span> <span class="n">nodes_df</span> <span class="k">if</span> <span class="n">nodes_df</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span>
    <span class="n">_links_df</span> <span class="o">=</span> <span class="n">links_df</span> <span class="k">if</span> <span class="n">links_df</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span>

    <span class="k">if</span> <span class="n">mode</span><span class="p">:</span>
        <span class="n">_links_df</span><span class="p">,</span> <span class="n">_nodes_df</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">get_modal_links_nodes</span><span class="p">(</span>
            <span class="n">_links_df</span><span class="p">,</span>
            <span class="n">_nodes_df</span><span class="p">,</span>
            <span class="n">modes</span><span class="o">=</span><span class="p">[</span><span class="n">mode</span><span class="p">],</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Assessing connectivity without a mode</span><span class="se">\</span>
<span class="s2">            specified. This may have limited value in interpretation.</span><span class="se">\</span>
<span class="s2">            To add mode specificity, add the keyword `mode =` to calling</span><span class="se">\</span>
<span class="s2">            this method&quot;</span>
        <span class="p">)</span>

    <span class="c1"># TODO: consider caching graphs if they start to take forever</span>
    <span class="c1">#      and we are calling them more than once.</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">ox_graph</span><span class="p">(</span><span class="n">_nodes_df</span><span class="p">,</span> <span class="n">_links_df</span><span class="p">)</span>
    <span class="n">is_connected</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">is_strongly_connected</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">is_connected</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.roadwaynetwork.RoadwayNetwork.links_with_nodes" class="doc doc-heading">
<code class="highlight language-python"><span class="n">links_with_nodes</span><span class="p">(</span><span class="n">links_df</span><span class="p">,</span> <span class="n">node_id_list</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.links_with_nodes" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Returns a links geodataframe which start or end at the nodes in the list.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>links_df</code></td>
          <td>
                <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td><p>dataframe of links to search for nodes in</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>node_id_list</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>List of nodes to find links for.  Nodes should be identified
by the foreign key - the one that is referenced in LINK_FOREIGN_KEY.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/roadwaynetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1752</span>
<span class="normal">1753</span>
<span class="normal">1754</span>
<span class="normal">1755</span>
<span class="normal">1756</span>
<span class="normal">1757</span>
<span class="normal">1758</span>
<span class="normal">1759</span>
<span class="normal">1760</span>
<span class="normal">1761</span>
<span class="normal">1762</span>
<span class="normal">1763</span>
<span class="normal">1764</span>
<span class="normal">1765</span>
<span class="normal">1766</span>
<span class="normal">1767</span>
<span class="normal">1768</span>
<span class="normal">1769</span>
<span class="normal">1770</span>
<span class="normal">1771</span>
<span class="normal">1772</span>
<span class="normal">1773</span>
<span class="normal">1774</span>
<span class="normal">1775</span>
<span class="normal">1776</span>
<span class="normal">1777</span>
<span class="normal">1778</span>
<span class="normal">1779</span>
<span class="normal">1780</span>
<span class="normal">1781</span>
<span class="normal">1782</span>
<span class="normal">1783</span>
<span class="normal">1784</span>
<span class="normal">1785</span>
<span class="normal">1786</span>
<span class="normal">1787</span>
<span class="normal">1788</span>
<span class="normal">1789</span>
<span class="normal">1790</span>
<span class="normal">1791</span>
<span class="normal">1792</span>
<span class="normal">1793</span>
<span class="normal">1794</span>
<span class="normal">1795</span>
<span class="normal">1796</span>
<span class="normal">1797</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">links_with_nodes</span><span class="p">(</span>
    <span class="n">links_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">node_id_list</span><span class="p">:</span> <span class="nb">list</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a links geodataframe which start or end at the nodes in the list.</span>

<span class="sd">    Args:</span>
<span class="sd">        links_df: dataframe of links to search for nodes in</span>
<span class="sd">        node_id_list (list): List of nodes to find links for.  Nodes should be identified</span>
<span class="sd">            by the foreign key - the one that is referenced in LINK_FOREIGN_KEY.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># If nodes are equal to all the nodes in the links, return all the links</span>
    <span class="n">_nodes_in_links</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">nodes_in_links</span><span class="p">(</span><span class="n">links_df</span><span class="p">)</span>
    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;# Nodes: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">node_id_list</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">Nodes in links:</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">_nodes_in_links</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">node_id_list</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">_nodes_in_links</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">links_df</span>

    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Finding links assocated with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">node_id_list</span><span class="p">)</span><span class="si">}</span><span class="s2"> nodes.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">node_id_list</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">25</span><span class="p">:</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;node_id_list: </span><span class="si">{</span><span class="n">node_id_list</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">_selected_links_df</span> <span class="o">=</span> <span class="n">links_df</span><span class="p">[</span>
        <span class="n">links_df</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span>
            <span class="p">{</span><span class="n">c</span><span class="p">:</span> <span class="n">node_id_list</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">LINK_FOREIGN_KEY_TO_NODE</span><span class="p">}</span>
        <span class="p">)</span>
    <span class="p">]</span>
    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Temp Selected </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">_selected_links_df</span><span class="p">)</span><span class="si">}</span><span class="s2"> associated with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">node_id_list</span><span class="p">)</span><span class="si">}</span><span class="s2"> nodes.&quot;</span>
    <span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    _query_parts = [</span>
<span class="sd">        f&quot;{prop} == {str(n)}&quot;</span>
<span class="sd">        for prop in RoadwayNetwork.LINK_FOREIGN_KEY_TO_NODE</span>
<span class="sd">        for n in node_id_list</span>
<span class="sd">    ]</span>

<span class="sd">    _query = &quot; or &quot;.join(_query_parts)</span>
<span class="sd">    _selected_links_df = links_df.query(_query, engine=&quot;python&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Selected </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">_selected_links_df</span><span class="p">)</span><span class="si">}</span><span class="s2"> associated with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">node_id_list</span><span class="p">)</span><span class="si">}</span><span class="s2"> nodes.&quot;</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">_selected_links_df</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.roadwaynetwork.RoadwayNetwork.network_connection_plot" class="doc doc-heading">
<code class="highlight language-python"><span class="n">network_connection_plot</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">disconnected_subgraph_nodes</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.network_connection_plot" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Plot a graph to check for network connection.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>G</code></td>
          <td>
          </td>
          <td><p>OSMNX flavored networkX graph.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>disconnected_subgraph_nodes</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>List of disconnected subgraphs described by the list
of their member nodes (as described by their <code>model_node_id</code>).</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/roadwaynetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3301</span>
<span class="normal">3302</span>
<span class="normal">3303</span>
<span class="normal">3304</span>
<span class="normal">3305</span>
<span class="normal">3306</span>
<span class="normal">3307</span>
<span class="normal">3308</span>
<span class="normal">3309</span>
<span class="normal">3310</span>
<span class="normal">3311</span>
<span class="normal">3312</span>
<span class="normal">3313</span>
<span class="normal">3314</span>
<span class="normal">3315</span>
<span class="normal">3316</span>
<span class="normal">3317</span>
<span class="normal">3318</span>
<span class="normal">3319</span>
<span class="normal">3320</span>
<span class="normal">3321</span>
<span class="normal">3322</span>
<span class="normal">3323</span>
<span class="normal">3324</span>
<span class="normal">3325</span>
<span class="normal">3326</span>
<span class="normal">3327</span>
<span class="normal">3328</span>
<span class="normal">3329</span>
<span class="normal">3330</span>
<span class="normal">3331</span>
<span class="normal">3332</span>
<span class="normal">3333</span>
<span class="normal">3334</span>
<span class="normal">3335</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">network_connection_plot</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">disconnected_subgraph_nodes</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot a graph to check for network connection.</span>

<span class="sd">    Args:</span>
<span class="sd">        G: OSMNX flavored networkX graph.</span>
<span class="sd">        disconnected_subgraph_nodes: List of disconnected subgraphs described by the list</span>
<span class="sd">            of their member nodes (as described by their `model_node_id`).</span>

<span class="sd">    returns: fig, ax : tuple</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">colors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">disconnected_subgraph_nodes</span><span class="p">)):</span>
        <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;#</span><span class="si">%06X</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mh">0xFFFFFF</span><span class="p">))</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">plot_graph</span><span class="p">(</span>
        <span class="n">G</span><span class="p">,</span>
        <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">),</span>
        <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">close</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">edge_color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
        <span class="n">edge_alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
        <span class="n">node_color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
        <span class="n">node_alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
        <span class="n">node_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">nodes</span> <span class="ow">in</span> <span class="n">disconnected_subgraph_nodes</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
            <span class="n">size</span> <span class="o">=</span> <span class="mi">100</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s2">&quot;X&quot;</span><span class="p">],</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s2">&quot;Y&quot;</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.roadwaynetwork.RoadwayNetwork.new_links_valid" class="doc doc-heading">
<code class="highlight language-python"><span class="n">new_links_valid</span><span class="p">(</span><span class="n">new_links_df</span><span class="p">)</span></code>

<a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.new_links_valid" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Assesses if a set of links are valid for adding to self.links_df.</p>
<p>Will produce a ValueError if new_links_df:
1. A-B combinations are not unique within new_links_df
2. UNIQUE_LINK_KEY is not unique within new_links_df
3. A-B combinations overlap with an existing A-B link in self.links_df
4. UNIQUE_LINK_KEY overlaps with an existing UNIQUE_LINK_ID in self.links_df
5. A and B nodes are not in self.nodes_df
6. Doesn&rsquo;t contain columns for MIN_LINK_REQUIRED_PROPS_DEFAULT</p>
<p>Will produce a warning if there are NA values for any MIN_LINK_REQUIRED_PROPS_DEFAULT</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>new_links_df</code></td>
          <td>
                <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td><p>dataframe of links being considered for addition to self.links_df</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>bool</code></td>          <td>
                <code>bool</code>
          </td>
          <td><p>Returns a True if passes various validation tests.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/roadwaynetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2287</span>
<span class="normal">2288</span>
<span class="normal">2289</span>
<span class="normal">2290</span>
<span class="normal">2291</span>
<span class="normal">2292</span>
<span class="normal">2293</span>
<span class="normal">2294</span>
<span class="normal">2295</span>
<span class="normal">2296</span>
<span class="normal">2297</span>
<span class="normal">2298</span>
<span class="normal">2299</span>
<span class="normal">2300</span>
<span class="normal">2301</span>
<span class="normal">2302</span>
<span class="normal">2303</span>
<span class="normal">2304</span>
<span class="normal">2305</span>
<span class="normal">2306</span>
<span class="normal">2307</span>
<span class="normal">2308</span>
<span class="normal">2309</span>
<span class="normal">2310</span>
<span class="normal">2311</span>
<span class="normal">2312</span>
<span class="normal">2313</span>
<span class="normal">2314</span>
<span class="normal">2315</span>
<span class="normal">2316</span>
<span class="normal">2317</span>
<span class="normal">2318</span>
<span class="normal">2319</span>
<span class="normal">2320</span>
<span class="normal">2321</span>
<span class="normal">2322</span>
<span class="normal">2323</span>
<span class="normal">2324</span>
<span class="normal">2325</span>
<span class="normal">2326</span>
<span class="normal">2327</span>
<span class="normal">2328</span>
<span class="normal">2329</span>
<span class="normal">2330</span>
<span class="normal">2331</span>
<span class="normal">2332</span>
<span class="normal">2333</span>
<span class="normal">2334</span>
<span class="normal">2335</span>
<span class="normal">2336</span>
<span class="normal">2337</span>
<span class="normal">2338</span>
<span class="normal">2339</span>
<span class="normal">2340</span>
<span class="normal">2341</span>
<span class="normal">2342</span>
<span class="normal">2343</span>
<span class="normal">2344</span>
<span class="normal">2345</span>
<span class="normal">2346</span>
<span class="normal">2347</span>
<span class="normal">2348</span>
<span class="normal">2349</span>
<span class="normal">2350</span>
<span class="normal">2351</span>
<span class="normal">2352</span>
<span class="normal">2353</span>
<span class="normal">2354</span>
<span class="normal">2355</span>
<span class="normal">2356</span>
<span class="normal">2357</span>
<span class="normal">2358</span>
<span class="normal">2359</span>
<span class="normal">2360</span>
<span class="normal">2361</span>
<span class="normal">2362</span>
<span class="normal">2363</span>
<span class="normal">2364</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">new_links_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_links_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Assesses if a set of links are valid for adding to self.links_df.</span>

<span class="sd">    Will produce a ValueError if new_links_df:</span>
<span class="sd">    1. A-B combinations are not unique within new_links_df</span>
<span class="sd">    2. UNIQUE_LINK_KEY is not unique within new_links_df</span>
<span class="sd">    3. A-B combinations overlap with an existing A-B link in self.links_df</span>
<span class="sd">    4. UNIQUE_LINK_KEY overlaps with an existing UNIQUE_LINK_ID in self.links_df</span>
<span class="sd">    5. A and B nodes are not in self.nodes_df</span>
<span class="sd">    6. Doesn&#39;t contain columns for MIN_LINK_REQUIRED_PROPS_DEFAULT</span>

<span class="sd">    Will produce a warning if there are NA values for any MIN_LINK_REQUIRED_PROPS_DEFAULT</span>

<span class="sd">    Args:</span>
<span class="sd">        new_links_df: dataframe of links being considered for addition to self.links_df</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: Returns a True if passes various validation tests.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># A-B combinations are unique within new_links_df</span>
    <span class="n">_new_fk_id</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
        <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">new_links_df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">LINK_FOREIGN_KEY_TO_NODE</span><span class="p">])</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">_new_fk_id</span><span class="o">.</span><span class="n">is_unique</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Duplicate ABs in new links.&quot;</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="c1"># UNIQUE_LINK_ID is unique within new_links_df</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">new_links_df</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_LINK_KEY</span><span class="p">]</span><span class="o">.</span><span class="n">is_unique</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Duplicate link IDs in new links.&quot;</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="c1"># Doesn&#39;t overlap with an existing A-B link in self.links_df</span>
    <span class="n">_existing_links_ab</span> <span class="o">=</span> <span class="n">_new_fk_id</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">has_link</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_existing_links_ab</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Link already exists between nodes:</span><span class="se">\n</span><span class="s2"> </span><span class="si">{</span><span class="n">_new_fk_id</span><span class="p">[</span><span class="n">_existing_links_ab</span><span class="p">]</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="c1"># Doesn&#39;t overlap with an existing UNIQUE_LINK_ID in self.links_df</span>
    <span class="n">_ids</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_LINK_KEY</span><span class="p">],</span>
            <span class="n">new_links_df</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_LINK_KEY</span><span class="p">],</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">_ids</span><span class="o">.</span><span class="n">is_unique</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Link ID already exists:</span><span class="se">\n</span><span class="si">{</span><span class="n">_ids</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">_ids</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()]</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="c1"># A and B nodes are in self.nodes_df</span>
    <span class="k">for</span> <span class="n">fk_prop</span> <span class="ow">in</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">LINK_FOREIGN_KEY_TO_NODE</span><span class="p">:</span>
        <span class="n">_has_node</span> <span class="o">=</span> <span class="n">new_links_df</span><span class="p">[</span><span class="n">fk_prop</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">has_node</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_has_node</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">25</span><span class="p">:</span>
                <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;self.nodes_df:</span><span class="se">\n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;New link specifies non existant node </span><span class="si">{</span><span class="n">fk_prop</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">new_links_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">_has_node</span><span class="p">,</span><span class="n">fk_prop</span><span class="p">]</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="c1"># Check to see if there are missing required columns</span>
    <span class="n">_missing_cols</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">c</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">MIN_LINK_REQUIRED_PROPS_DEFAULT</span>
        <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_links_df</span><span class="o">.</span><span class="n">columns</span>
    <span class="p">]</span>
    <span class="k">if</span> <span class="n">_missing_cols</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Missing required link properties:</span><span class="si">{</span><span class="n">_missing_cols</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="c1"># Check to see if there are missing required values</span>
    <span class="n">_missing_values</span> <span class="o">=</span> <span class="n">new_links_df</span><span class="p">[</span>
        <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">MIN_LINK_REQUIRED_PROPS_DEFAULT</span>
    <span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">_missing_values</span><span class="o">.</span><span class="n">any</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Missing values for required link properties:</span><span class="se">\n</span><span class="si">{</span><span class="n">new_links_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">_missing_values</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">Warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.roadwaynetwork.RoadwayNetwork.nodes_in_links" class="doc doc-heading">
<code class="highlight language-python"><span class="n">nodes_in_links</span><span class="p">(</span><span class="n">links_df</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.nodes_in_links" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Returns a list of nodes that are contained in the links.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>links_df</code></td>
          <td>
                <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td><p>Links which to return node list for</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/roadwaynetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1728</span>
<span class="normal">1729</span>
<span class="normal">1730</span>
<span class="normal">1731</span>
<span class="normal">1732</span>
<span class="normal">1733</span>
<span class="normal">1734</span>
<span class="normal">1735</span>
<span class="normal">1736</span>
<span class="normal">1737</span>
<span class="normal">1738</span>
<span class="normal">1739</span>
<span class="normal">1740</span>
<span class="normal">1741</span>
<span class="normal">1742</span>
<span class="normal">1743</span>
<span class="normal">1744</span>
<span class="normal">1745</span>
<span class="normal">1746</span>
<span class="normal">1747</span>
<span class="normal">1748</span>
<span class="normal">1749</span>
<span class="normal">1750</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">nodes_in_links</span><span class="p">(</span>
    <span class="n">links_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Collection</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a list of nodes that are contained in the links.</span>

<span class="sd">    Args:</span>
<span class="sd">        links_df: Links which to return node list for</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">links_df</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">25</span><span class="p">:</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Links:</span><span class="se">\n</span><span class="si">{</span><span class="n">links_df</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">LINK_FOREIGN_KEY_TO_NODE</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
    <span class="n">nodes_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
        <span class="nb">set</span><span class="p">(</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                <span class="p">[</span><span class="n">links_df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">LINK_FOREIGN_KEY_TO_NODE</span><span class="p">]</span>
            <span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nodes_list</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">25</span><span class="p">:</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_node_list:</span><span class="se">\n</span><span class="si">{</span><span class="n">nodes_list</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">nodes_list</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.roadwaynetwork.RoadwayNetwork.orig_dest_nodes_foreign_key" class="doc doc-heading">
<code class="highlight language-python"><span class="n">orig_dest_nodes_foreign_key</span><span class="p">(</span><span class="n">selection</span><span class="p">,</span> <span class="n">node_foreign_key</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></code>

<a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.orig_dest_nodes_foreign_key" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Returns the foreign key id (whatever is used in the u and v
variables in the links file) for the AB nodes as a tuple.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>selection</code></td>
          <td>
          </td>
          <td><p>selection dictionary with A and B keys</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>node_foreign_key</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>variable name for whatever is used by the u and v variable</p></td>
          <td>
                <code>&#39;&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/roadwaynetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">orig_dest_nodes_foreign_key</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">selection</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">node_foreign_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the foreign key id (whatever is used in the u and v</span>
<span class="sd">    variables in the links file) for the AB nodes as a tuple.</span>

<span class="sd">    Args:</span>
<span class="sd">        selection : selection dictionary with A and B keys</span>
<span class="sd">        node_foreign_key: variable name for whatever is used by the u and v variable</span>
<span class="sd">        in the links_df file.  If nothing is specified, assume whatever</span>
<span class="sd">        default is (usually osm_node_id)</span>

<span class="sd">    Returns: tuple of (A_id, B_id)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">node_foreign_key</span><span class="p">:</span>
        <span class="n">node_foreign_key</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">NODE_FOREIGN_KEY_TO_LINK</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">selection</span><span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="p">(</span><span class="s2">&quot;Selection A node dictionary should be of length 1&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">selection</span><span class="p">[</span><span class="s2">&quot;B&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="p">(</span><span class="s2">&quot;Selection B node dictionary should be of length 1&quot;</span><span class="p">)</span>

    <span class="n">A_node_key</span><span class="p">,</span> <span class="n">A_id</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">selection</span><span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
    <span class="n">B_node_key</span><span class="p">,</span> <span class="n">B_id</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">selection</span><span class="p">[</span><span class="s2">&quot;B&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>

    <span class="k">if</span> <span class="n">A_node_key</span> <span class="o">!=</span> <span class="n">node_foreign_key</span><span class="p">:</span>
        <span class="n">A_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">[</span><span class="n">A_node_key</span><span class="p">]</span> <span class="o">==</span> <span class="n">A_id</span><span class="p">][</span>
            <span class="n">node_foreign_key</span>
        <span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">B_node_key</span> <span class="o">!=</span> <span class="n">node_foreign_key</span><span class="p">:</span>
        <span class="n">B_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">[</span><span class="n">B_node_key</span><span class="p">]</span> <span class="o">==</span> <span class="n">B_id</span><span class="p">][</span>
            <span class="n">node_foreign_key</span>
        <span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">A_id</span><span class="p">,</span> <span class="n">B_id</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.roadwaynetwork.RoadwayNetwork.ox_graph" class="doc doc-heading">
<code class="highlight language-python"><span class="n">ox_graph</span><span class="p">(</span><span class="n">nodes_df</span><span class="p">,</span> <span class="n">links_df</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.ox_graph" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>create an osmnx-flavored network graph</p>
<p>osmnx doesn&rsquo;t like values that are arrays, so remove the variables
that have arrays.  osmnx also requires that certain variables
be filled in, so do that too.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>nodes_df</code></td>
          <td>
          </td>
          <td><p>GeoDataFrame of nodes</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>links_df</code></td>
          <td>
          </td>
          <td><p>GeoDataFrame of links</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/roadwaynetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">ox_graph</span><span class="p">(</span><span class="n">nodes_df</span><span class="p">:</span> <span class="n">GeoDataFrame</span><span class="p">,</span> <span class="n">links_df</span><span class="p">:</span> <span class="n">GeoDataFrame</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    create an osmnx-flavored network graph</span>

<span class="sd">    osmnx doesn&#39;t like values that are arrays, so remove the variables</span>
<span class="sd">    that have arrays.  osmnx also requires that certain variables</span>
<span class="sd">    be filled in, so do that too.</span>

<span class="sd">    Args:</span>
<span class="sd">        nodes_df : GeoDataFrame of nodes</span>
<span class="sd">        links_df : GeoDataFrame of links</span>

<span class="sd">    Returns: a networkx multidigraph</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;starting ox_graph()&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;inboundReferenceIds&quot;</span> <span class="ow">in</span> <span class="n">nodes_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">graph_nodes</span> <span class="o">=</span> <span class="n">nodes_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;inboundReferenceIds&quot;</span><span class="p">,</span> <span class="s2">&quot;outboundReferenceIds&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">graph_nodes</span> <span class="o">=</span> <span class="n">nodes_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">graph_nodes</span><span class="o">.</span><span class="n">gdf_name</span> <span class="o">=</span> <span class="s2">&quot;network_nodes&quot;</span>
    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;GRAPH NODES: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">graph_nodes</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
    <span class="n">graph_nodes</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">graph_nodes</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span><span class="p">]</span>

    <span class="n">graph_nodes</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">graph_nodes</span><span class="p">[</span><span class="s2">&quot;X&quot;</span><span class="p">]</span>
    <span class="n">graph_nodes</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">graph_nodes</span><span class="p">[</span><span class="s2">&quot;Y&quot;</span><span class="p">]</span>

    <span class="k">if</span> <span class="s2">&quot;osm_link_id&quot;</span> <span class="ow">in</span> <span class="n">links_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">graph_links</span> <span class="o">=</span> <span class="n">links_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;osm_link_id&quot;</span><span class="p">,</span> <span class="s2">&quot;locationReferences&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">graph_links</span> <span class="o">=</span> <span class="n">links_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;locationReferences&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># have to change this over into u,v b/c this is what osm-nx is expecting</span>
    <span class="n">graph_links</span><span class="p">[</span><span class="s2">&quot;u&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">graph_links</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">LINK_FOREIGN_KEY_TO_NODE</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">graph_links</span><span class="p">[</span><span class="s2">&quot;v&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">graph_links</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">LINK_FOREIGN_KEY_TO_NODE</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
    <span class="n">graph_links</span><span class="p">[</span><span class="s2">&quot;key&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">graph_links</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_LINK_KEY</span><span class="p">]</span>

    <span class="c1"># Per osmnx u,v,key should be a multi-index;</span>
    <span class="c1">#     https://osmnx.readthedocs.io/en/stable/osmnx.html#osmnx.utils_graph.graph_from_gdfs</span>
    <span class="c1"># However - if the index is set before hand in osmnx version &lt;1.0 then it fails</span>
    <span class="c1">#     on the set_index line *within* osmnx.utils_graph.graph_from_gdfs():</span>
    <span class="c1">#           `for (u, v, k), row in gdf_edges.set_index([&quot;u&quot;, &quot;v&quot;, &quot;key&quot;]).iterrows():`</span>

    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">ox</span><span class="o">.</span><span class="n">__version__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">graph_links</span> <span class="o">=</span> <span class="n">graph_links</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;u&quot;</span><span class="p">,</span> <span class="s2">&quot;v&quot;</span><span class="p">,</span> <span class="s2">&quot;key&quot;</span><span class="p">],</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;starting ox.gdfs_to_graph()&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">G</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">graph_from_gdfs</span><span class="p">(</span><span class="n">graph_nodes</span><span class="p">,</span> <span class="n">graph_links</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">attr_error</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">attr_error</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="o">==</span> <span class="s2">&quot;module &#39;osmnx&#39; has no attribute &#39;graph_from_gdfs&#39;&quot;</span>
        <span class="p">):</span>
            <span class="c1"># This is the only exception for which we have a workaround</span>
            <span class="c1"># Does this still work given the u,v,key multi-indexing?</span>
            <span class="c1">#</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;Please upgrade your OSMNX package. For now, using deprecated</span><span class="se">\</span>
<span class="s2">                     osmnx.gdfs_to_graph because osmnx.graph_from_gdfs not found&quot;</span>
            <span class="p">)</span>
            <span class="n">G</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">gdfs_to_graph</span><span class="p">(</span><span class="n">graph_nodes</span><span class="p">,</span> <span class="n">graph_links</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># for other AttributeErrors, raise further</span>
            <span class="k">raise</span> <span class="n">attr_error</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="c1"># for other Exceptions, raise further</span>
        <span class="k">raise</span> <span class="n">e</span>

    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;finished ox.gdfs_to_graph()&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">G</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.roadwaynetwork.RoadwayNetwork.path_search" class="doc doc-heading">
<code class="highlight language-python"><span class="n">path_search</span><span class="p">(</span><span class="n">candidate_links_df</span><span class="p">,</span> <span class="n">O_id</span><span class="p">,</span> <span class="n">D_id</span><span class="p">,</span> <span class="n">weight_column</span><span class="o">=</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="n">weight_factor</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span></code>

<a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.path_search" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>candidate_links</code></td>
          <td>
          </td>
          <td><p>selection of links geodataframe with links likely to be part of path</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>O_id</code></td>
          <td>
          </td>
          <td><p>origin node foreigh key ID</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>D_id</code></td>
          <td>
          </td>
          <td><p>destination node foreigh key ID</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>weight_column</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>column to use for weight of shortest path. Defaults to &ldquo;i&rdquo; (iteration)</p></td>
          <td>
                <code>&#39;i&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>weight_factor</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>optional weight to multiply the weight column by when finding
the shortest path</p></td>
          <td>
                <code>1.0</code>
          </td>
        </tr>
    </tbody>
  </table>
      <p>Returns</p>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/roadwaynetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">path_search</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">candidate_links_df</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span>
    <span class="n">O_id</span><span class="p">,</span>
    <span class="n">D_id</span><span class="p">,</span>
    <span class="n">weight_column</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;i&quot;</span><span class="p">,</span>
    <span class="n">weight_factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Args:</span>
<span class="sd">        candidate_links: selection of links geodataframe with links likely to be part of path</span>
<span class="sd">        O_id: origin node foreigh key ID</span>
<span class="sd">        D_id: destination node foreigh key ID</span>
<span class="sd">        weight_column: column to use for weight of shortest path. Defaults to &quot;i&quot; (iteration)</span>
<span class="sd">        weight_factor: optional weight to multiply the weight column by when finding</span>
<span class="sd">            the shortest path</span>

<span class="sd">    Returns</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_add_breadth</span><span class="p">(</span>
        <span class="n">_candidate_links_df</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span>
        <span class="n">_nodes_df</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span>
        <span class="n">_links_df</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span>
        <span class="n">i</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add outbound and inbound reference IDs to candidate links</span>
<span class="sd">        from existing nodes</span>

<span class="sd">        Args:</span>
<span class="sd">            _candidate_links_df : df with the links from the previous iteration</span>
<span class="sd">            _nodes_df : df of all nodes in the full network</span>
<span class="sd">            _links_df : df of all links in the full network</span>
<span class="sd">            i : iteration of adding breadth</span>

<span class="sd">        Returns:</span>
<span class="sd">            candidate_links : GeoDataFrame</span>
<span class="sd">                updated df with one more degree of added breadth</span>

<span class="sd">            node_list_foreign_keys : list of foreign key ids for nodes in the updated</span>
<span class="sd">                candidate links to test if the A and B nodes are in there.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;-Adding Breadth-&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">i</span><span class="p">:</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;i not specified in _add_breadth, using 1&quot;</span><span class="p">)</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">_candidate_nodes_df</span> <span class="o">=</span> <span class="n">_nodes_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">_get_fk_nodes</span><span class="p">(</span><span class="n">_candidate_links_df</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Candidate Nodes: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">_candidate_nodes_df</span><span class="p">)))</span>

        <span class="c1"># Identify links to add based on outbound and inbound links from nodes</span>
        <span class="n">_links_shstRefId_to_add</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="nb">set</span><span class="p">(</span>
                <span class="nb">sum</span><span class="p">(</span><span class="n">_candidate_nodes_df</span><span class="p">[</span><span class="s2">&quot;outboundReferenceIds&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="p">[])</span>
                <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="n">_candidate_nodes_df</span><span class="p">[</span><span class="s2">&quot;inboundReferenceIds&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="p">[])</span>
            <span class="p">)</span>
            <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">_candidate_links_df</span><span class="p">[</span><span class="s2">&quot;shstReferenceId&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
            <span class="o">-</span> <span class="nb">set</span><span class="p">([</span><span class="s2">&quot;&quot;</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="n">_links_to_add_df</span> <span class="o">=</span> <span class="n">_links_df</span><span class="p">[</span>
            <span class="n">_links_df</span><span class="o">.</span><span class="n">shstReferenceId</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">_links_shstRefId_to_add</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Adding </span><span class="si">{}</span><span class="s2"> links.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_links_to_add_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

        <span class="c1"># Add information about what iteration the link was added in</span>
        <span class="n">_links_df</span><span class="p">[</span><span class="n">_links_df</span><span class="o">.</span><span class="n">model_link_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">_links_shstRefId_to_add</span><span class="p">)][</span><span class="s2">&quot;i&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>

        <span class="c1"># Append links and update node list</span>
        <span class="n">_candidate_links_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">_candidate_links_df</span><span class="p">,</span> <span class="n">_links_to_add_df</span><span class="p">])</span>
        <span class="n">_node_list_foreign_keys</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">_get_fk_nodes</span><span class="p">(</span><span class="n">_candidate_links_df</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">_candidate_links_df</span><span class="p">,</span> <span class="n">_node_list_foreign_keys</span>

    <span class="c1"># -----------------------------------</span>
    <span class="c1"># Set search breadth to zero + set max</span>
    <span class="c1"># -----------------------------------</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">max_i</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">SEARCH_BREADTH</span>
    <span class="c1"># -----------------------------------</span>
    <span class="c1"># Add links to the graph until</span>
    <span class="c1">#   (i) the A and B nodes are in the</span>
    <span class="c1">#       foreign key list</span>
    <span class="c1">#          - OR -</span>
    <span class="c1">#   (ii) reach maximum search breadth</span>
    <span class="c1"># -----------------------------------</span>
    <span class="n">node_list_foreign_keys</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">_get_fk_nodes</span><span class="p">(</span><span class="n">candidate_links_df</span><span class="p">)</span>
    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Initial set of nodes: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node_list_foreign_keys</span><span class="p">))</span>
    <span class="k">while</span> <span class="p">(</span>
        <span class="n">O_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">node_list_foreign_keys</span> <span class="ow">or</span> <span class="n">D_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">node_list_foreign_keys</span>
    <span class="p">)</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">max_i</span><span class="p">:</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;Adding breadth - i: </span><span class="si">{}</span><span class="s2">, Max i: </span><span class="si">{}</span><span class="s2">] - </span><span class="si">{}</span><span class="s2"> and </span><span class="si">{}</span><span class="s2"> not found in node list.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">i</span><span class="p">,</span> <span class="n">max_i</span><span class="p">,</span> <span class="n">O_id</span><span class="p">,</span> <span class="n">D_id</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">candidate_links_df</span><span class="p">,</span> <span class="n">node_list_foreign_keys</span> <span class="o">=</span> <span class="n">_add_breadth</span><span class="p">(</span>
            <span class="n">candidate_links_df</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="n">i</span>
        <span class="p">)</span>
    <span class="c1"># -----------------------------------</span>
    <span class="c1">#  Once have A and B in graph,</span>
    <span class="c1">#  Try calculating shortest path</span>
    <span class="c1"># -----------------------------------</span>
    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;calculating shortest path from graph&quot;</span><span class="p">)</span>
    <span class="p">(</span>
        <span class="n">sp_found</span><span class="p">,</span>
        <span class="n">graph</span><span class="p">,</span>
        <span class="n">candidate_links_df</span><span class="p">,</span>
        <span class="n">shortest_path_route</span><span class="p">,</span>
        <span class="n">shortest_path_links</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shortest_path</span><span class="p">(</span><span class="n">candidate_links_df</span><span class="p">,</span> <span class="n">O_id</span><span class="p">,</span> <span class="n">D_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">sp_found</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">graph</span><span class="p">,</span> <span class="n">candidate_links_df</span><span class="p">,</span> <span class="n">shortest_path_route</span><span class="p">,</span> <span class="n">shortest_path_links</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">sp_found</span><span class="p">:</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;No shortest path found with breadth of </span><span class="si">{i}</span><span class="s2">, trying greater breadth until SP </span><span class="se">\</span>
<span class="s2">                found or max breadth </span><span class="si">{max_i}</span><span class="s2"> reached.&quot;</span>
        <span class="p">)</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">sp_found</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">MAX_SEARCH_BREADTH</span><span class="p">:</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;Adding breadth, with shortest path iteration. i: </span><span class="si">{}</span><span class="s2"> Max i: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">i</span><span class="p">,</span> <span class="n">max_i</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">candidate_links_df</span><span class="p">,</span> <span class="n">node_list_foreign_keys</span> <span class="o">=</span> <span class="n">_add_breadth</span><span class="p">(</span>
            <span class="n">candidate_links_df</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="n">i</span>
        <span class="p">)</span>
        <span class="p">(</span>
            <span class="n">sp_found</span><span class="p">,</span>
            <span class="n">graph</span><span class="p">,</span>
            <span class="n">candidate_links_df</span><span class="p">,</span>
            <span class="n">route</span><span class="p">,</span>
            <span class="n">shortest_path_links</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shortest_path</span><span class="p">(</span><span class="n">candidate_links_df</span><span class="p">,</span> <span class="n">O_id</span><span class="p">,</span> <span class="n">D_id</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">sp_found</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">graph</span><span class="p">,</span> <span class="n">candidate_links_df</span><span class="p">,</span> <span class="n">route</span><span class="p">,</span> <span class="n">shortest_path_links</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">sp_found</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Couldn&#39;t find path from </span><span class="si">{}</span><span class="s2"> to </span><span class="si">{}</span><span class="s2"> after adding </span><span class="si">{}</span><span class="s2"> links in breadth&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">O_id</span><span class="p">,</span> <span class="n">D_id</span><span class="p">,</span> <span class="n">i</span>
        <span class="p">)</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">NoPathFound</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.roadwaynetwork.RoadwayNetwork.read" class="doc doc-heading">
<code class="highlight language-python"><span class="n">read</span><span class="p">(</span><span class="n">link_file</span><span class="p">,</span> <span class="n">node_file</span><span class="p">,</span> <span class="n">shape_file</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.read" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Reads a network from the roadway network standard
Validates that it conforms to the schema</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>link_file</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>full path to the link file</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>node_file</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>full path to the node file</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>shape_file</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>full path to the shape file</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>fast</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>boolean that will skip validation to speed up read time</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
    </tbody>
  </table>
      <p>.. todo:: Turn off fast=True as default</p>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/roadwaynetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">read</span><span class="p">(</span>
    <span class="n">link_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">node_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">shape_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">fast</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RoadwayNetwork</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads a network from the roadway network standard</span>
<span class="sd">    Validates that it conforms to the schema</span>

<span class="sd">    args:</span>
<span class="sd">        link_file: full path to the link file</span>
<span class="sd">        node_file: full path to the node file</span>
<span class="sd">        shape_file: full path to the shape file</span>
<span class="sd">        fast: boolean that will skip validation to speed up read time</span>

<span class="sd">    Returns: a RoadwayNetwork instance</span>

<span class="sd">    .. todo:: Turn off fast=True as default</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="p">(</span><span class="n">link_file</span><span class="p">,</span> <span class="n">node_file</span><span class="p">,</span> <span class="n">shape_file</span><span class="p">):</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Specified file doesn&#39;t exist at: </span><span class="si">{</span><span class="n">fn</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">fast</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span>
            <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">validate_node_schema</span><span class="p">(</span><span class="n">node_file</span><span class="p">)</span>
            <span class="ow">and</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">validate_link_schema</span><span class="p">(</span><span class="n">link_file</span><span class="p">)</span>
            <span class="ow">and</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">validate_shape_schema</span><span class="p">(</span><span class="n">shape_file</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;RoadwayNetwork: Data doesn&#39;t conform to schema&quot;</span><span class="p">)</span>

    <span class="n">links_df</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">read_links</span><span class="p">(</span><span class="n">link_file</span><span class="p">)</span>
    <span class="n">nodes_df</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">read_nodes</span><span class="p">(</span><span class="n">node_file</span><span class="p">)</span>
    <span class="n">shapes_df</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">read_shapes</span><span class="p">(</span><span class="n">shape_file</span><span class="p">)</span>

    <span class="n">roadway_network</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="p">(</span>
        <span class="n">nodes</span><span class="o">=</span><span class="n">nodes_df</span><span class="p">,</span> <span class="n">links</span><span class="o">=</span><span class="n">links_df</span><span class="p">,</span> <span class="n">shapes</span><span class="o">=</span><span class="n">shapes_df</span>
    <span class="p">)</span>

    <span class="n">roadway_network</span><span class="o">.</span><span class="n">link_file</span> <span class="o">=</span> <span class="n">link_file</span>
    <span class="n">roadway_network</span><span class="o">.</span><span class="n">node_file</span> <span class="o">=</span> <span class="n">node_file</span>
    <span class="n">roadway_network</span><span class="o">.</span><span class="n">shape_file</span> <span class="o">=</span> <span class="n">shape_file</span>

    <span class="k">return</span> <span class="n">roadway_network</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.roadwaynetwork.RoadwayNetwork.read_links" class="doc doc-heading">
<code class="highlight language-python"><span class="n">read_links</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.read_links" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Reads links and returns a geodataframe of links.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>filename</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>file to read links in from.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/roadwaynetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">read_links</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reads links and returns a geodataframe of links.</span>

<span class="sd">    Args:</span>
<span class="sd">        filename (str): file to read links in from.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reading links from </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">link_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Read link file.&quot;</span><span class="p">)</span>
    <span class="n">link_properties</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">link_json</span><span class="p">)</span>
    <span class="n">link_geometries</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">line_string_from_location_references</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="s2">&quot;locationReferences&quot;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">link_json</span>
    <span class="p">]</span>
    <span class="n">links_df</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">link_properties</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="n">link_geometries</span><span class="p">)</span>
    <span class="n">links_df</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">CRS</span>
    <span class="n">links_df</span><span class="o">.</span><span class="n">gdf_name</span> <span class="o">=</span> <span class="s2">&quot;network_links&quot;</span>

    <span class="n">links_df</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">coerce_types</span><span class="p">(</span><span class="n">links_df</span><span class="p">)</span>

    <span class="n">links_df</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_LINK_KEY</span> <span class="o">+</span> <span class="s2">&quot;_idx&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">links_df</span><span class="p">[</span>
        <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_LINK_KEY</span>
    <span class="p">]</span>
    <span class="n">links_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_LINK_KEY</span> <span class="o">+</span> <span class="s2">&quot;_idx&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Read </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">links_df</span><span class="p">)</span><span class="si">}</span><span class="s2"> links.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">links_df</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.roadwaynetwork.RoadwayNetwork.read_nodes" class="doc doc-heading">
<code class="highlight language-python"><span class="n">read_nodes</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.read_nodes" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Reads nodes and returns a geodataframe of nodes.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>filename</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>file to read nodes in from.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/roadwaynetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">read_nodes</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reads nodes and returns a geodataframe of nodes.</span>

<span class="sd">    Args:</span>
<span class="sd">        filename (str): file to read nodes in from.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># geopandas uses fiona OGR drivers, which doesn&#39;t let you have</span>
    <span class="c1"># a list as a property type. Therefore, must read in node_properties</span>
    <span class="c1"># separately in a vanilla dataframe and then convert to geopandas</span>
    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reading nodes from </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">node_geojson</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Read nodes file.&quot;</span><span class="p">)</span>
    <span class="n">node_properties</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="p">[</span><span class="n">g</span><span class="p">[</span><span class="s2">&quot;properties&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">node_geojson</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">]]</span>
    <span class="p">)</span>
    <span class="n">node_geometries</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">Point</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">][</span><span class="s2">&quot;coordinates&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">node_geojson</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">]</span>
    <span class="p">]</span>

    <span class="n">nodes_df</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">node_properties</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="n">node_geometries</span><span class="p">)</span>

    <span class="n">nodes_df</span><span class="o">.</span><span class="n">gdf_name</span> <span class="o">=</span> <span class="s2">&quot;network_nodes&quot;</span>

    <span class="c1"># set a copy of the  foreign key to be the index so that the</span>
    <span class="c1"># variable itself remains queryiable</span>
    <span class="c1">## TODO this should be more elegant</span>
    <span class="n">nodes_df</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span> <span class="o">+</span> <span class="s2">&quot;_idx&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodes_df</span><span class="p">[</span>
        <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span>
    <span class="p">]</span>
    <span class="n">nodes_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span> <span class="o">+</span> <span class="s2">&quot;_idx&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">nodes_df</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">CRS</span>
    <span class="n">nodes_df</span><span class="p">[</span><span class="s2">&quot;X&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodes_df</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">g</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
    <span class="n">nodes_df</span><span class="p">[</span><span class="s2">&quot;Y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodes_df</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">g</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>

    <span class="n">nodes_df</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">coerce_types</span><span class="p">(</span><span class="n">nodes_df</span><span class="p">)</span>
    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Read </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">nodes_df</span><span class="p">)</span><span class="si">}</span><span class="s2"> nodes.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">nodes_df</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.roadwaynetwork.RoadwayNetwork.read_shapes" class="doc doc-heading">
<code class="highlight language-python"><span class="n">read_shapes</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.read_shapes" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Reads shapes and returns a geodataframe of shapes.</p>
<p>Also:
- drops records without geometry or id
- sets CRS to RoadwayNetwork.CRS</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>filename</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>file to read shapes in from.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/roadwaynetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">read_shapes</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reads shapes and returns a geodataframe of shapes.</span>

<span class="sd">    Also:</span>
<span class="sd">    - drops records without geometry or id</span>
<span class="sd">    - sets CRS to RoadwayNetwork.CRS</span>

<span class="sd">    Args:</span>
<span class="sd">        filename (str): file to read shapes in from.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reading shapes from </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
    <span class="n">shapes_df</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">shapes_df</span><span class="o">.</span><span class="n">gdf_name</span> <span class="o">=</span> <span class="s2">&quot;network_shapes&quot;</span>
    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Read shapes file.&quot;</span><span class="p">)</span>
    <span class="n">shapes_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">shapes_df</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">CRS</span>
    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Read </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">shapes_df</span><span class="p">)</span><span class="si">}</span><span class="s2"> shapes.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">shapes_df</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.roadwaynetwork.RoadwayNetwork.roadway_net_to_gdf" class="doc doc-heading">
<code class="highlight language-python"><span class="n">roadway_net_to_gdf</span><span class="p">(</span><span class="n">roadway_net</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.roadway_net_to_gdf" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Turn the roadway network into a GeoDataFrame</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>roadway_net</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="network_wrangler.roadwaynetwork.RoadwayNetwork" href="#network_wrangler.RoadwayNetwork">RoadwayNetwork</a></code>
          </td>
          <td><p>the roadway network to export</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>
      <p>.. todo:: Make this much more sophisticated, for example attach link info to shapes</p>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/roadwaynetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">roadway_net_to_gdf</span><span class="p">(</span><span class="n">roadway_net</span><span class="p">:</span> <span class="n">RoadwayNetwork</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Turn the roadway network into a GeoDataFrame</span>
<span class="sd">    args:</span>
<span class="sd">        roadway_net: the roadway network to export</span>

<span class="sd">    returns: shapes dataframe</span>

<span class="sd">    .. todo:: Make this much more sophisticated, for example attach link info to shapes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">roadway_net</span><span class="o">.</span><span class="n">shapes_df</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.roadwaynetwork.RoadwayNetwork.select_node_features" class="doc doc-heading">
<code class="highlight language-python"><span class="n">select_node_features</span><span class="p">(</span><span class="n">selection</span><span class="p">,</span> <span class="n">sel_key</span><span class="p">)</span></code>

<a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.select_node_features" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Select Node Features.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>selection</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>selection dictionary from project card.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>sel_key</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>key to store selection in self.selections under.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>list</code>
          </td>
          <td><p>List of indices for selected nodes in self.nodes_df</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/roadwaynetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">select_node_features</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">selection</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">sel_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Select Node Features.</span>

<span class="sd">    Args:</span>
<span class="sd">        selection (dict): selection dictionary from project card.</span>
<span class="sd">        sel_key (str): key to store selection in self.selections under.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of indices for selected nodes in self.nodes_df</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Selecting nodes.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">selection</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nodes&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="n">sel_query</span> <span class="o">=</span> <span class="n">ProjectCard</span><span class="o">.</span><span class="n">build_selection_query</span><span class="p">(</span>
        <span class="n">selection</span><span class="o">=</span><span class="n">selection</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;nodes&quot;</span><span class="p">,</span>
        <span class="n">unique_ids</span><span class="o">=</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_IDENTIFIERS</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Selecting node features:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sel_query</span><span class="p">))</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">[</span><span class="n">sel_key</span><span class="p">][</span><span class="s2">&quot;selected_nodes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
        <span class="n">sel_query</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;python&quot;</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">[</span><span class="n">sel_key</span><span class="p">][</span><span class="s2">&quot;selected_nodes&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">[</span><span class="n">sel_key</span><span class="p">][</span><span class="s2">&quot;selection_found&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No nodes found for selection: </span><span class="si">{</span><span class="n">selection</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">[</span><span class="n">sel_key</span><span class="p">][</span><span class="s2">&quot;selected_nodes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.roadwaynetwork.RoadwayNetwork.select_roadway_features" class="doc doc-heading">
<code class="highlight language-python"><span class="n">select_roadway_features</span><span class="p">(</span><span class="n">selection</span><span class="p">,</span> <span class="n">search_mode</span><span class="o">=</span><span class="s1">&#39;drive&#39;</span><span class="p">,</span> <span class="n">force_search</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.select_roadway_features" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Selects roadway features that satisfy selection criteria</p>

<details class="example-usage">
  <summary>Example usage</summary>
  <p>net.select_roadway_features(
  selection = [ {
    #   a match condition for the from node using osm,
    #   shared streets, or model node number
    &lsquo;from&rsquo;: {&lsquo;osm_model_link_id&rsquo;: &lsquo;1234&rsquo;},
    #   a match for the to-node..
    &lsquo;to&rsquo;: {&lsquo;shstid&rsquo;: &lsquo;4321&rsquo;},
    #   a regex or match for facility condition
    #   could be # of lanes, facility type, etc.
    &lsquo;facility&rsquo;: {&lsquo;name&rsquo;:&rsquo;Main St&rsquo;},
    }, &hellip; ])</p>
</details>
  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>selection</code></td>
          <td>
          </td>
          <td><p>dictionary with keys for:
 A - from node
 B - to node
 link - which includes at least a variable for <code>name</code> or &lsquo;all&rsquo; if all selected</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>search_mode</code></td>
          <td>
          </td>
          <td><p>will be overridden if &lsquo;link&rsquo;:&rsquo;all&rsquo;</p></td>
          <td>
                <code>&#39;drive&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/roadwaynetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">select_roadway_features</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">selection</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">search_mode</span><span class="o">=</span><span class="s2">&quot;drive&quot;</span><span class="p">,</span> <span class="n">force_search</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Selects roadway features that satisfy selection criteria</span>

<span class="sd">    Example usage:</span>
<span class="sd">        net.select_roadway_features(</span>
<span class="sd">          selection = [ {</span>
<span class="sd">            #   a match condition for the from node using osm,</span>
<span class="sd">            #   shared streets, or model node number</span>
<span class="sd">            &#39;from&#39;: {&#39;osm_model_link_id&#39;: &#39;1234&#39;},</span>
<span class="sd">            #   a match for the to-node..</span>
<span class="sd">            &#39;to&#39;: {&#39;shstid&#39;: &#39;4321&#39;},</span>
<span class="sd">            #   a regex or match for facility condition</span>
<span class="sd">            #   could be # of lanes, facility type, etc.</span>
<span class="sd">            &#39;facility&#39;: {&#39;name&#39;:&#39;Main St&#39;},</span>
<span class="sd">            }, ... ])</span>

<span class="sd">    Args:</span>
<span class="sd">        selection : dictionary with keys for:</span>
<span class="sd">             A - from node</span>
<span class="sd">             B - to node</span>
<span class="sd">             link - which includes at least a variable for `name` or &#39;all&#39; if all selected</span>
<span class="sd">        search_mode: will be overridden if &#39;link&#39;:&#39;all&#39;</span>

<span class="sd">    Returns: a list of indices for the selected links or nodes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;validating selection&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">validate_selection</span><span class="p">(</span><span class="n">selection</span><span class="p">)</span>

    <span class="c1"># create a unique key for the selection so that we can cache it</span>
    <span class="n">sel_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_selection_key</span><span class="p">(</span><span class="n">selection</span><span class="p">)</span>
    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Selection Key: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sel_key</span><span class="p">))</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">[</span><span class="n">sel_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;selection_found&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>

    <span class="k">if</span> <span class="s2">&quot;links&quot;</span> <span class="ow">in</span> <span class="n">selection</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_roadway_link_features</span><span class="p">(</span>
            <span class="n">selection</span><span class="p">,</span>
            <span class="n">sel_key</span><span class="p">,</span>
            <span class="n">force_search</span><span class="o">=</span><span class="n">force_search</span><span class="p">,</span>
            <span class="n">search_mode</span><span class="o">=</span><span class="n">search_mode</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;nodes&quot;</span> <span class="ow">in</span> <span class="n">selection</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_node_features</span><span class="p">(</span>
            <span class="n">selection</span><span class="p">,</span>
            <span class="n">sel_key</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid selection type. Must be either &#39;links&#39; or &#39;nodes&#39;.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.roadwaynetwork.RoadwayNetwork.select_roadway_link_features" class="doc doc-heading">
<code class="highlight language-python"><span class="n">select_roadway_link_features</span><span class="p">(</span><span class="n">selection</span><span class="p">,</span> <span class="n">sel_key</span><span class="p">,</span> <span class="n">force_search</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">search_mode</span><span class="o">=</span><span class="s1">&#39;drive&#39;</span><span class="p">)</span></code>

<a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.select_roadway_link_features" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p><em>summary</em></p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>selection</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p><em>description</em></p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>sel_key</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>selection key hash to store selection in</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>force_search</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p><em>description</em>. Defaults to False.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>search_mode</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p><em>description</em>. Defaults to &ldquo;drive&rdquo;.</p></td>
          <td>
                <code>&#39;drive&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>list</code>
          </td>
          <td><p>List of indices for selected links in self.links_df</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/roadwaynetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">select_roadway_link_features</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">selection</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">sel_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">force_search</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">search_mode</span><span class="o">=</span><span class="s2">&quot;drive&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;_summary_</span>

<span class="sd">    Args:</span>
<span class="sd">        selection (dict): _description_</span>
<span class="sd">        sel_key: selection key hash to store selection in</span>
<span class="sd">        force_search (bool, optional): _description_. Defaults to False.</span>
<span class="sd">        search_mode (str, optional): _description_. Defaults to &quot;drive&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of indices for selected links in self.links_df</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Selecting links.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">selection</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;links&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="c1"># if this selection has been found before, return the previously selected links</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sel_key</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;selection_found&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="ow">and</span> <span class="ow">not</span> <span class="n">force_search</span>
    <span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">[</span><span class="n">sel_key</span><span class="p">][</span><span class="s2">&quot;selected_links&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="n">unique_model_link_identifer_in_selection</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">selection_has_unique_link_id</span><span class="p">(</span><span class="n">selection</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">unique_model_link_identifer_in_selection</span><span class="p">:</span>
        <span class="n">A_id</span><span class="p">,</span> <span class="n">B_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">orig_dest_nodes_foreign_key</span><span class="p">(</span><span class="n">selection</span><span class="p">)</span>
    <span class="c1"># identify candidate links which match the initial query</span>
    <span class="c1"># assign them as iteration = 0</span>
    <span class="c1"># subsequent iterations that didn&#39;t match the query will be</span>
    <span class="c1"># assigned a heigher weight in the shortest path</span>
    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Building selection query&quot;</span><span class="p">)</span>
    <span class="c1"># build a selection query based on the selection dictionary</span>

    <span class="n">sel_query</span> <span class="o">=</span> <span class="n">ProjectCard</span><span class="o">.</span><span class="n">build_selection_query</span><span class="p">(</span>
        <span class="n">selection</span><span class="o">=</span><span class="n">selection</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;links&quot;</span><span class="p">,</span>
        <span class="n">unique_ids</span><span class="o">=</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_MODEL_LINK_IDENTIFIERS</span><span class="p">,</span>
        <span class="n">mode</span><span class="o">=</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">MODES_TO_NETWORK_LINK_VARIABLES</span><span class="p">[</span><span class="n">search_mode</span><span class="p">],</span>
    <span class="p">)</span>
    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Selecting link features:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sel_query</span><span class="p">))</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">[</span><span class="n">sel_key</span><span class="p">][</span><span class="s2">&quot;candidate_links&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
        <span class="n">sel_query</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;python&quot;</span>
    <span class="p">)</span>
    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Completed query&quot;</span><span class="p">)</span>
    <span class="n">candidate_links</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">[</span><span class="n">sel_key</span><span class="p">][</span>
        <span class="s2">&quot;candidate_links&quot;</span>
    <span class="p">]</span>  <span class="c1"># b/c too long to keep that way</span>

    <span class="n">candidate_links</span><span class="p">[</span><span class="s2">&quot;i&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">candidate_links</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">unique_model_link_identifer_in_selection</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;No links found based on unique link identifiers.</span><span class="se">\n</span><span class="s2">Selection Failed.&quot;</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">candidate_links</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;No candidate links in initial search.</span><span class="se">\n</span><span class="s2">Retrying query using &#39;ref&#39; instead of </span><span class="se">\</span>
<span class="s2">                &#39;name&#39;&quot;</span>
        <span class="p">)</span>
        <span class="c1"># if the query doesn&#39;t come back with something from &#39;name&#39;</span>
        <span class="c1"># try it again with &#39;ref&#39; instead</span>
        <span class="n">selection_has_name_key</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="s2">&quot;name&quot;</span> <span class="ow">in</span> <span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">selection</span><span class="p">[</span><span class="s2">&quot;links&quot;</span><span class="p">])</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">selection_has_name_key</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Not able to complete search using &#39;ref&#39; instead of &#39;name&#39; because &#39;name&#39; </span><span class="se">\</span>
<span class="s2">                not in search.&quot;</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;ref&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Not able to complete search using &#39;ref&#39; because &#39;ref&#39; not in network.&quot;</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Trying selection query replacing &#39;name&#39; with &#39;ref&#39;&quot;</span><span class="p">)</span>
        <span class="n">sel_query</span> <span class="o">=</span> <span class="n">sel_query</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;ref&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">[</span><span class="n">sel_key</span><span class="p">][</span><span class="s2">&quot;candidate_links&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
            <span class="n">sel_query</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;python&quot;</span>
        <span class="p">)</span>
        <span class="n">candidate_links</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">[</span><span class="n">sel_key</span><span class="p">][</span><span class="s2">&quot;candidate_links&quot;</span><span class="p">]</span>

        <span class="n">candidate_links</span><span class="p">[</span><span class="s2">&quot;i&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">candidate_links</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;No candidate links in search using either &#39;name&#39; or &#39;ref&#39; in query.</span><span class="se">\</span>
<span class="s2">                Selection Failed.&quot;</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">unique_model_link_identifer_in_selection</span><span class="p">:</span>
        <span class="c1"># unique identifier exists and no need to go through big search</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">[</span><span class="n">sel_key</span><span class="p">][</span><span class="s2">&quot;selected_links&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">[</span><span class="n">sel_key</span><span class="p">][</span>
            <span class="s2">&quot;candidate_links&quot;</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">[</span><span class="n">sel_key</span><span class="p">][</span><span class="s2">&quot;selection_found&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">[</span><span class="n">sel_key</span><span class="p">][</span><span class="s2">&quot;selected_links&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Not a unique ID selection, conduct search.&quot;</span><span class="p">)</span>
        <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">[</span><span class="n">sel_key</span><span class="p">][</span><span class="s2">&quot;graph&quot;</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">[</span><span class="n">sel_key</span><span class="p">][</span><span class="s2">&quot;candidate_links&quot;</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">[</span><span class="n">sel_key</span><span class="p">][</span><span class="s2">&quot;route&quot;</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">[</span><span class="n">sel_key</span><span class="p">][</span><span class="s2">&quot;links&quot;</span><span class="p">],</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_search</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">[</span><span class="n">sel_key</span><span class="p">][</span><span class="s2">&quot;candidate_links&quot;</span><span class="p">],</span>
            <span class="n">A_id</span><span class="p">,</span>
            <span class="n">B_id</span><span class="p">,</span>
            <span class="n">weight_factor</span><span class="o">=</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">SP_WEIGHT_FACTOR</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">selection</span><span class="p">[</span><span class="s2">&quot;links&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">[</span><span class="n">sel_key</span><span class="p">][</span><span class="s2">&quot;selected_links&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">[</span><span class="n">sel_key</span><span class="p">][</span>
                <span class="s2">&quot;links&quot;</span>
            <span class="p">]</span>

        <span class="c1"># Conduct a &quot;selection on the selection&quot; if have additional requirements to satisfy</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">resel_query</span> <span class="o">=</span> <span class="n">ProjectCard</span><span class="o">.</span><span class="n">build_selection_query</span><span class="p">(</span>
                <span class="n">selection</span><span class="o">=</span><span class="n">selection</span><span class="p">,</span>
                <span class="n">unique_ids</span><span class="o">=</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_MODEL_LINK_IDENTIFIERS</span><span class="p">,</span>
                <span class="n">mode</span><span class="o">=</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">MODES_TO_NETWORK_LINK_VARIABLES</span><span class="p">[</span><span class="n">search_mode</span><span class="p">],</span>
                <span class="n">ignore</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
            <span class="p">)</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Reselecting features:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resel_query</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">[</span><span class="n">sel_key</span><span class="p">][</span><span class="s2">&quot;selected_links&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">[</span><span class="n">sel_key</span><span class="p">][</span>
                <span class="s2">&quot;links&quot;</span>
            <span class="p">]</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">resel_query</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;python&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">[</span><span class="n">sel_key</span><span class="p">][</span><span class="s2">&quot;selected_links&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">[</span><span class="n">sel_key</span><span class="p">][</span><span class="s2">&quot;selection_found&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No links found for selection: </span><span class="si">{</span><span class="n">selection</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">[</span><span class="n">sel_key</span><span class="p">][</span><span class="s2">&quot;selection_found&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">[</span><span class="n">sel_key</span><span class="p">][</span><span class="s2">&quot;selected_links&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.roadwaynetwork.RoadwayNetwork.selection_has_unique_link_id" class="doc doc-heading">
<code class="highlight language-python"><span class="n">selection_has_unique_link_id</span><span class="p">(</span><span class="n">selection_dict</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.selection_has_unique_link_id" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>selection_dictionary</code></td>
          <td>
          </td>
          <td><p>Dictionary representation of selection
of roadway features, containing a &ldquo;links&rdquo; key.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>A boolean indicating if the selection dictionary contains</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>bool</code>
          </td>
          <td><p>a required unique link id.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/roadwaynetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">selection_has_unique_link_id</span><span class="p">(</span><span class="n">selection_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        selection_dictionary: Dictionary representation of selection</span>
<span class="sd">            of roadway features, containing a &quot;links&quot; key.</span>

<span class="sd">    Returns: A boolean indicating if the selection dictionary contains</span>
<span class="sd">        a required unique link id.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">selection_keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">li</span> <span class="ow">in</span> <span class="n">selection_dict</span><span class="p">[</span><span class="s2">&quot;links&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">li</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
    <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span>
        <span class="nb">set</span><span class="p">(</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_MODEL_LINK_IDENTIFIERS</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span>
            <span class="nb">set</span><span class="p">(</span><span class="n">selection_keys</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.roadwaynetwork.RoadwayNetwork.selection_map" class="doc doc-heading">
<code class="highlight language-python"><span class="n">selection_map</span><span class="p">(</span><span class="n">selected_link_idx</span><span class="p">,</span> <span class="n">A</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">candidate_link_idx</span><span class="o">=</span><span class="p">[])</span></code>

<a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.selection_map" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Shows which links are selected for roadway property change or parallel
managed lanes category of roadway projects.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>selected_links_idx</code></td>
          <td>
          </td>
          <td><p>list of selected link indices</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>candidate_links_idx</code></td>
          <td>
          </td>
          <td><p>optional list of candidate link indices to also include in map</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>A</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[<span title="typing.Any">Any</span>]</code>
          </td>
          <td><p>optional foreign key of starting node of a route selection</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>B</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[<span title="typing.Any">Any</span>]</code>
          </td>
          <td><p>optional foreign key of ending node of a route selection</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/roadwaynetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3337</span>
<span class="normal">3338</span>
<span class="normal">3339</span>
<span class="normal">3340</span>
<span class="normal">3341</span>
<span class="normal">3342</span>
<span class="normal">3343</span>
<span class="normal">3344</span>
<span class="normal">3345</span>
<span class="normal">3346</span>
<span class="normal">3347</span>
<span class="normal">3348</span>
<span class="normal">3349</span>
<span class="normal">3350</span>
<span class="normal">3351</span>
<span class="normal">3352</span>
<span class="normal">3353</span>
<span class="normal">3354</span>
<span class="normal">3355</span>
<span class="normal">3356</span>
<span class="normal">3357</span>
<span class="normal">3358</span>
<span class="normal">3359</span>
<span class="normal">3360</span>
<span class="normal">3361</span>
<span class="normal">3362</span>
<span class="normal">3363</span>
<span class="normal">3364</span>
<span class="normal">3365</span>
<span class="normal">3366</span>
<span class="normal">3367</span>
<span class="normal">3368</span>
<span class="normal">3369</span>
<span class="normal">3370</span>
<span class="normal">3371</span>
<span class="normal">3372</span>
<span class="normal">3373</span>
<span class="normal">3374</span>
<span class="normal">3375</span>
<span class="normal">3376</span>
<span class="normal">3377</span>
<span class="normal">3378</span>
<span class="normal">3379</span>
<span class="normal">3380</span>
<span class="normal">3381</span>
<span class="normal">3382</span>
<span class="normal">3383</span>
<span class="normal">3384</span>
<span class="normal">3385</span>
<span class="normal">3386</span>
<span class="normal">3387</span>
<span class="normal">3388</span>
<span class="normal">3389</span>
<span class="normal">3390</span>
<span class="normal">3391</span>
<span class="normal">3392</span>
<span class="normal">3393</span>
<span class="normal">3394</span>
<span class="normal">3395</span>
<span class="normal">3396</span>
<span class="normal">3397</span>
<span class="normal">3398</span>
<span class="normal">3399</span>
<span class="normal">3400</span>
<span class="normal">3401</span>
<span class="normal">3402</span>
<span class="normal">3403</span>
<span class="normal">3404</span>
<span class="normal">3405</span>
<span class="normal">3406</span>
<span class="normal">3407</span>
<span class="normal">3408</span>
<span class="normal">3409</span>
<span class="normal">3410</span>
<span class="normal">3411</span>
<span class="normal">3412</span>
<span class="normal">3413</span>
<span class="normal">3414</span>
<span class="normal">3415</span>
<span class="normal">3416</span>
<span class="normal">3417</span>
<span class="normal">3418</span>
<span class="normal">3419</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">selection_map</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">selected_link_idx</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
    <span class="n">A</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">B</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">candidate_link_idx</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Shows which links are selected for roadway property change or parallel</span>
<span class="sd">    managed lanes category of roadway projects.</span>

<span class="sd">    Args:</span>
<span class="sd">        selected_links_idx: list of selected link indices</span>
<span class="sd">        candidate_links_idx: optional list of candidate link indices to also include in map</span>
<span class="sd">        A: optional foreign key of starting node of a route selection</span>
<span class="sd">        B: optional foreign key of ending node of a route selection</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
        <span class="s2">&quot;Selected Links: </span><span class="si">{}</span><span class="se">\n</span><span class="s2">Candidate Links: </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">selected_link_idx</span><span class="p">,</span> <span class="n">candidate_link_idx</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="n">graph_link_idx</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">selected_link_idx</span> <span class="o">+</span> <span class="n">candidate_link_idx</span><span class="p">))</span>
    <span class="n">graph_links</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">graph_link_idx</span><span class="p">]</span>

    <span class="n">node_list_foreign_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
        <span class="nb">set</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">i</span>
                <span class="k">for</span> <span class="n">fk</span> <span class="ow">in</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">LINK_FOREIGN_KEY_TO_NODE</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">graph_links</span><span class="p">[</span><span class="n">fk</span><span class="p">])</span>
            <span class="p">]</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="n">graph_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">node_list_foreign_keys</span><span class="p">]</span>

    <span class="n">G</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">ox_graph</span><span class="p">(</span><span class="n">graph_nodes</span><span class="p">,</span> <span class="n">graph_links</span><span class="p">)</span>

    <span class="c1"># base map plot with whole graph</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">plot_graph_folium</span><span class="p">(</span>
        <span class="n">G</span><span class="p">,</span> <span class="n">edge_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tiles</span><span class="o">=</span><span class="s2">&quot;cartodbpositron&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="s2">&quot;300px&quot;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="s2">&quot;250px&quot;</span>
    <span class="p">)</span>

    <span class="c1"># plot selection</span>
    <span class="n">selected_links</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">selected_link_idx</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">selected_links</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">pl</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">folium</span><span class="o">.</span><span class="n">_make_folium_polyline</span><span class="p">(</span>
            <span class="n">geom</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">],</span>
            <span class="n">edge</span><span class="o">=</span><span class="n">row</span><span class="p">,</span>
            <span class="n">edge_color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>
            <span class="n">edge_width</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
            <span class="n">edge_opacity</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">pl</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

    <span class="c1"># if have A and B node add them to base map</span>
    <span class="k">def</span> <span class="nf">_folium_node</span><span class="p">(</span><span class="n">node_row</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="n">node_marker</span> <span class="o">=</span> <span class="n">folium</span><span class="o">.</span><span class="n">Marker</span><span class="p">(</span>
            <span class="n">location</span><span class="o">=</span><span class="p">[</span><span class="n">node_row</span><span class="p">[</span><span class="s2">&quot;Y&quot;</span><span class="p">],</span> <span class="n">node_row</span><span class="p">[</span><span class="s2">&quot;X&quot;</span><span class="p">]],</span>
            <span class="n">icon</span><span class="o">=</span><span class="n">folium</span><span class="o">.</span><span class="n">Icon</span><span class="p">(</span><span class="n">icon</span><span class="o">=</span><span class="n">icon</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">node_marker</span>

    <span class="k">if</span> <span class="n">A</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;A: </span><span class="si">{</span><span class="n">A</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">A</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="c1"># WranglerLogger.debug(msg)</span>
        <span class="n">_folium_node</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span><span class="p">]</span> <span class="o">==</span> <span class="n">A</span><span class="p">],</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span>
            <span class="n">icon</span><span class="o">=</span><span class="s2">&quot;play&quot;</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">B</span><span class="p">:</span>
        <span class="n">_folium_node</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span><span class="p">]</span> <span class="o">==</span> <span class="n">B</span><span class="p">],</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
            <span class="n">icon</span><span class="o">=</span><span class="s2">&quot;star&quot;</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">m</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.roadwaynetwork.RoadwayNetwork.shortest_path" class="doc doc-heading">
<code class="highlight language-python"><span class="n">shortest_path</span><span class="p">(</span><span class="n">graph_links_df</span><span class="p">,</span> <span class="n">O_id</span><span class="p">,</span> <span class="n">D_id</span><span class="p">,</span> <span class="n">nodes_df</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weight_column</span><span class="o">=</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="n">weight_factor</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span></code>

<a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.shortest_path" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>graph_links_df</code></td>
          <td>
                <code><span title="geopandas">gpd</span>.<span title="geopandas.GeoDataFrame">GeoDataFrame</span></code>
          </td>
          <td></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>O_id</code></td>
          <td>
          </td>
          <td><p>foreign key for start node</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>D_id</code></td>
          <td>
          </td>
          <td><p>foreign key for end node</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>nodes_df</code></td>
          <td>
                <code><span title="geopandas">gpd</span>.<span title="geopandas.GeoDataFrame">GeoDataFrame</span></code>
          </td>
          <td><p>optional nodes df, otherwise will use network instance</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>weight_column</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>column to use as a weight, defaults to &ldquo;i&rdquo;</p></td>
          <td>
                <code>&#39;i&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>weight_factor</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>any additional weighting to multiply the weight column by, defaults
to RoadwayNetwork.SP_WEIGHT_FACTOR</p></td>
          <td>
                <code>1.0</code>
          </td>
        </tr>
    </tbody>
  </table>
      <ul>
<li>Boolean if shortest path found</li>
<li>nx Directed graph of graph links</li>
<li>route of shortest path nodes as List</li>
<li>links in shortest path selected from links_df</li>
</ul>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/roadwaynetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">shortest_path</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">graph_links_df</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span>
    <span class="n">O_id</span><span class="p">,</span>
    <span class="n">D_id</span><span class="p">,</span>
    <span class="n">nodes_df</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">weight_column</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;i&quot;</span><span class="p">,</span>
    <span class="n">weight_factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Args:</span>
<span class="sd">        graph_links_df:</span>
<span class="sd">        O_id: foreign key for start node</span>
<span class="sd">        D_id: foreign key for end node</span>
<span class="sd">        nodes_df: optional nodes df, otherwise will use network instance</span>
<span class="sd">        weight_column: column to use as a weight, defaults to &quot;i&quot;</span>
<span class="sd">        weight_factor: any additional weighting to multiply the weight column by, defaults</span>
<span class="sd">            to RoadwayNetwork.SP_WEIGHT_FACTOR</span>

<span class="sd">    Returns: tuple with length of four</span>
<span class="sd">    - Boolean if shortest path found</span>
<span class="sd">    - nx Directed graph of graph links</span>
<span class="sd">    - route of shortest path nodes as List</span>
<span class="sd">    - links in shortest path selected from links_df</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Calculating shortest path from </span><span class="si">{</span><span class="n">O_id</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">D_id</span><span class="si">}</span><span class="s2"> using </span><span class="si">{</span><span class="n">weight_column</span><span class="si">}</span><span class="s2"> as </span><span class="se">\</span>
<span class="s2">            weight with a factor of </span><span class="si">{</span><span class="n">weight_factor</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Prep Graph Links</span>
    <span class="k">if</span> <span class="n">weight_column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">graph_links_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> not in graph_links_df so adding and initializing to 1.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">weight_column</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">graph_links_df</span><span class="p">[</span><span class="n">weight_column</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">graph_links_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;weight&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span>
        <span class="n">graph_links_df</span><span class="p">[</span><span class="n">weight_column</span><span class="p">]</span> <span class="o">*</span> <span class="n">weight_factor</span>
    <span class="p">)</span>

    <span class="c1"># Select Graph Nodes</span>
    <span class="n">node_list_foreign_keys</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">_get_fk_nodes</span><span class="p">(</span><span class="n">graph_links_df</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">O_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">node_list_foreign_keys</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;O_id: </span><span class="si">{}</span><span class="s2"> not in Graph for finding shortest Path&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">O_id</span><span class="p">)</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">D_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">node_list_foreign_keys</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;D_id: </span><span class="si">{}</span><span class="s2"> not in Graph for finding shortest Path&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">D_id</span><span class="p">)</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">nodes_df</span><span class="p">:</span>
        <span class="n">nodes_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span>
    <span class="n">graph_nodes_df</span> <span class="o">=</span> <span class="n">nodes_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">node_list_foreign_keys</span><span class="p">]</span>

    <span class="c1"># Create Graph</span>
    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Creating network graph&quot;</span><span class="p">)</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">ox_graph</span><span class="p">(</span><span class="n">graph_nodes_df</span><span class="p">,</span> <span class="n">graph_links_df</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">sp_route</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">shortest_path</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">O_id</span><span class="p">,</span> <span class="n">D_id</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s2">&quot;weight&quot;</span><span class="p">)</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Shortest path successfully routed&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">nx</span><span class="o">.</span><span class="n">NetworkXNoPath</span><span class="p">:</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;No SP from </span><span class="si">{}</span><span class="s2"> to </span><span class="si">{}</span><span class="s2"> Found.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">O_id</span><span class="p">,</span> <span class="n">D_id</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">graph_links_df</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

    <span class="n">sp_links</span> <span class="o">=</span> <span class="n">graph_links_df</span><span class="p">[</span>
        <span class="n">graph_links_df</span><span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">sp_route</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">graph_links_df</span><span class="p">[</span><span class="s2">&quot;B&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">sp_route</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">graph_links_df</span><span class="p">,</span> <span class="n">sp_route</span><span class="p">,</span> <span class="n">sp_links</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.roadwaynetwork.RoadwayNetwork.update_node_geometry" class="doc doc-heading">
<code class="highlight language-python"><span class="n">update_node_geometry</span><span class="p">(</span><span class="n">updated_nodes</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.update_node_geometry" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Adds or updates the geometry of the nodes in the network based on XY coordinates.</p>
<p>Assumes XY are in self.crs.
Also updates the geometry of links and shapes that reference these nodes.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>updated_nodes</code></td>
          <td>
                <code><span title="typing.List">List</span></code>
          </td>
          <td><p>List of nodes to update. Defaults to all nodes.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="geopandas">gpd</span>.<span title="geopandas.GeoDataFrame">GeoDataFrame</span></code>
          </td>
          <td><p>gpd.GeoDataFrame: nodes geodataframe with updated geometry.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/roadwaynetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span>
<span class="normal">1697</span>
<span class="normal">1698</span>
<span class="normal">1699</span>
<span class="normal">1700</span>
<span class="normal">1701</span>
<span class="normal">1702</span>
<span class="normal">1703</span>
<span class="normal">1704</span>
<span class="normal">1705</span>
<span class="normal">1706</span>
<span class="normal">1707</span>
<span class="normal">1708</span>
<span class="normal">1709</span>
<span class="normal">1710</span>
<span class="normal">1711</span>
<span class="normal">1712</span>
<span class="normal">1713</span>
<span class="normal">1714</span>
<span class="normal">1715</span>
<span class="normal">1716</span>
<span class="normal">1717</span>
<span class="normal">1718</span>
<span class="normal">1719</span>
<span class="normal">1720</span>
<span class="normal">1721</span>
<span class="normal">1722</span>
<span class="normal">1723</span>
<span class="normal">1724</span>
<span class="normal">1725</span>
<span class="normal">1726</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">update_node_geometry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">updated_nodes</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Adds or updates the geometry of the nodes in the network based on XY coordinates.</span>

<span class="sd">    Assumes XY are in self.crs.</span>
<span class="sd">    Also updates the geometry of links and shapes that reference these nodes.</span>

<span class="sd">    Args:</span>
<span class="sd">        updated_nodes: List of nodes to update. Defaults to all nodes.</span>

<span class="sd">    Returns:</span>
<span class="sd">       gpd.GeoDataFrame: nodes geodataframe with updated geometry.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">updated_nodes</span><span class="p">:</span>
        <span class="n">updated_nodes_df</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">updated_nodes</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">updated_nodes_df</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">)</span>
        <span class="n">updated_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">updated_nodes_df</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">25</span><span class="p">:</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Original Nodes:</span><span class="se">\n</span><span class="si">{</span><span class="n">updated_nodes_df</span><span class="p">[[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">]]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="n">updated_nodes_df</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">updated_nodes_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">point_from_xy</span><span class="p">(</span>
            <span class="n">x</span><span class="p">[</span><span class="s2">&quot;X&quot;</span><span class="p">],</span>
            <span class="n">x</span><span class="p">[</span><span class="s2">&quot;Y&quot;</span><span class="p">],</span>
            <span class="n">xy_crs</span><span class="o">=</span><span class="n">updated_nodes_df</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span>
            <span class="n">point_crs</span><span class="o">=</span><span class="n">updated_nodes_df</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">)</span><span class="si">}</span><span class="s2"> nodes in network before update&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">updated_nodes_df</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">25</span><span class="p">:</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Updated Nodes:</span><span class="se">\n</span><span class="si">{</span><span class="n">updated_nodes_df</span><span class="p">[[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">]]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
        <span class="n">updated_nodes_df</span><span class="p">[[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_KEY</span><span class="p">,</span> <span class="s2">&quot;geometry&quot;</span><span class="p">]]</span>
    <span class="p">)</span>
    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">)</span><span class="si">}</span><span class="s2"> nodes in network after update&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">25</span><span class="p">:</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Updated self.nodes_df:</span><span class="se">\n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">[[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">]]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_update_node_geometry_in_links_shapes</span><span class="p">(</span><span class="n">updated_nodes_df</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.roadwaynetwork.RoadwayNetwork.validate_link_schema" class="doc doc-heading">
<code class="highlight language-python"><span class="n">validate_link_schema</span><span class="p">(</span><span class="n">link_file</span><span class="p">,</span> <span class="n">schema_location</span><span class="o">=</span><span class="s1">&#39;roadway_network_link.json&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.validate_link_schema" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Validate roadway network data link schema and output a boolean</p>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/roadwaynetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">validate_link_schema</span><span class="p">(</span>
    <span class="n">link_file</span><span class="p">,</span> <span class="n">schema_location</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;roadway_network_link.json&quot;</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate roadway network data link schema and output a boolean</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">schema_location</span><span class="p">):</span>
        <span class="n">base_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span> <span class="s2">&quot;schemas&quot;</span>
        <span class="p">)</span>
        <span class="n">schema_location</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_path</span><span class="p">,</span> <span class="n">schema_location</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">schema_location</span><span class="p">)</span> <span class="k">as</span> <span class="n">schema_json_file</span><span class="p">:</span>
        <span class="n">schema</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">schema_json_file</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">link_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">link_json_file</span><span class="p">:</span>
        <span class="n">json_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">link_json_file</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">validate</span><span class="p">(</span><span class="n">json_data</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed Link schema validation: Validation Error&quot;</span><span class="p">)</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Link File Loc:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">link_file</span><span class="p">))</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Path:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">exc</span><span class="o">.</span><span class="n">path</span><span class="p">))</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">exc</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">SchemaError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Invalid Link Schema&quot;</span><span class="p">)</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Link Schema Loc: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">schema_location</span><span class="p">))</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">exc</span><span class="o">.</span><span class="n">message</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>

    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.roadwaynetwork.RoadwayNetwork.validate_node_schema" class="doc doc-heading">
<code class="highlight language-python"><span class="n">validate_node_schema</span><span class="p">(</span><span class="n">node_file</span><span class="p">,</span> <span class="n">schema_location</span><span class="o">=</span><span class="s1">&#39;roadway_network_node.json&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.validate_node_schema" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Validate roadway network data node schema and output a boolean</p>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/roadwaynetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">validate_node_schema</span><span class="p">(</span>
    <span class="n">node_file</span><span class="p">,</span> <span class="n">schema_location</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;roadway_network_node.json&quot;</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate roadway network data node schema and output a boolean</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">schema_location</span><span class="p">):</span>
        <span class="n">base_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span> <span class="s2">&quot;schemas&quot;</span>
        <span class="p">)</span>
        <span class="n">schema_location</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_path</span><span class="p">,</span> <span class="n">schema_location</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">schema_location</span><span class="p">)</span> <span class="k">as</span> <span class="n">schema_json_file</span><span class="p">:</span>
        <span class="n">schema</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">schema_json_file</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">node_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">node_json_file</span><span class="p">:</span>
        <span class="n">json_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">node_json_file</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">validate</span><span class="p">(</span><span class="n">json_data</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed Node schema validation: Validation Error&quot;</span><span class="p">)</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Node File Loc:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node_file</span><span class="p">))</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Node Schema Loc:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">schema_location</span><span class="p">))</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">exc</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">SchemaError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Invalid Node Schema&quot;</span><span class="p">)</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Node Schema Loc:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">schema_location</span><span class="p">))</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">exc</span><span class="o">.</span><span class="n">message</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>

    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.roadwaynetwork.RoadwayNetwork.validate_object_types" class="doc doc-heading">
<code class="highlight language-python"><span class="n">validate_object_types</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">links</span><span class="p">,</span> <span class="n">shapes</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.validate_object_types" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Determines if the roadway network is being built with the right object types.
Does not validate schemas.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>nodes</code></td>
          <td>
                <code><span title="geopandas.geodataframe.GeoDataFrame">GeoDataFrame</span></code>
          </td>
          <td><p>nodes geodataframe</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>links</code></td>
          <td>
                <code><span title="geopandas.geodataframe.GeoDataFrame">GeoDataFrame</span></code>
          </td>
          <td><p>link geodataframe</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>shapes</code></td>
          <td>
                <code><span title="geopandas.geodataframe.GeoDataFrame">GeoDataFrame</span></code>
          </td>
          <td><p>shape geodataframe</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/roadwaynetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">validate_object_types</span><span class="p">(</span>
    <span class="n">nodes</span><span class="p">:</span> <span class="n">GeoDataFrame</span><span class="p">,</span> <span class="n">links</span><span class="p">:</span> <span class="n">GeoDataFrame</span><span class="p">,</span> <span class="n">shapes</span><span class="p">:</span> <span class="n">GeoDataFrame</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determines if the roadway network is being built with the right object types.</span>
<span class="sd">    Does not validate schemas.</span>

<span class="sd">    Args:</span>
<span class="sd">        nodes: nodes geodataframe</span>
<span class="sd">        links: link geodataframe</span>
<span class="sd">        shapes: shape geodataframe</span>

<span class="sd">    Returns: boolean</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">errors</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">GeoDataFrame</span><span class="p">):</span>
        <span class="n">error_message</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Incompatible nodes type:</span><span class="si">{}</span><span class="s2">. Must provide a GeoDataFrame.  &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="nb">type</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">links</span><span class="p">,</span> <span class="n">GeoDataFrame</span><span class="p">):</span>
        <span class="n">error_message</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Incompatible links type:</span><span class="si">{}</span><span class="s2">. Must provide a GeoDataFrame.  &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="nb">type</span><span class="p">(</span><span class="n">links</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shapes</span><span class="p">,</span> <span class="n">GeoDataFrame</span><span class="p">):</span>
        <span class="n">error_message</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Incompatible shapes type:</span><span class="si">{}</span><span class="s2">. Must provide a GeoDataFrame.  &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="nb">type</span><span class="p">(</span><span class="n">shapes</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">errors</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.roadwaynetwork.RoadwayNetwork.validate_properties" class="doc doc-heading">
<code class="highlight language-python"><span class="n">validate_properties</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">properties</span><span class="p">,</span> <span class="n">ignore_existing</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">require_existing_for_change</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.validate_properties" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>If there are change or existing commands, make sure that that
property exists in the network.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>properties</code></td>
          <td>
          </td>
          <td><p>properties dictionary to be evaluated</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>df</code></td>
          <td>
                <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td><p>links_df or nodes_df or shapes_df to check for compatibility with</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>ignore_existing</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>If True, will only warn about properties
that specify an &ldquo;existing&rdquo; value.  If False, will fail.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>require_existing_for_change</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>If True, will fail if there isn&rsquo;t
a specified value in theproject card for existing when a
change is specified.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/roadwaynetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">validate_properties</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">properties</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">ignore_existing</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">require_existing_for_change</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If there are change or existing commands, make sure that that</span>
<span class="sd">    property exists in the network.</span>

<span class="sd">    Args:</span>
<span class="sd">        properties : properties dictionary to be evaluated</span>
<span class="sd">        df: links_df or nodes_df or shapes_df to check for compatibility with</span>
<span class="sd">        ignore_existing: If True, will only warn about properties</span>
<span class="sd">            that specify an &quot;existing&quot; value.  If False, will fail.</span>
<span class="sd">        require_existing_for_change: If True, will fail if there isn&#39;t</span>
<span class="sd">            a specified value in theproject card for existing when a</span>
<span class="sd">            change is specified.</span>

<span class="sd">    Returns: boolean value as to whether the properties dictonary is valid.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">valid</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">properties</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;property&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="n">p</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;change&quot;</span><span class="p">):</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;&quot;Change&quot; is specified for attribute </span><span class="si">{</span><span class="w"> </span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;property&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">, but doesn</span><span class="se">\&#39;</span><span class="s1">t </span><span class="se">\</span>
<span class="s1">                        exist in base network&#39;</span>
            <span class="p">)</span>
            <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">p</span><span class="p">[</span><span class="s2">&quot;property&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span>
            <span class="ow">and</span> <span class="n">p</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;existing&quot;</span><span class="p">)</span>
            <span class="ow">and</span> <span class="ow">not</span> <span class="n">ignore_existing</span>
        <span class="p">):</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;&quot;Existing&quot; is specified for attribute </span><span class="si">{</span><span class="w"> </span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;property&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">, but doesn</span><span class="se">\&#39;</span><span class="s1">t </span><span class="se">\</span>
<span class="s1">                    exist in base network&#39;</span>
            <span class="p">)</span>
            <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;change&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">p</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;existing&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">require_existing_for_change</span><span class="p">:</span>
                <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;&quot;Change&quot; is specified for attribute </span><span class="si">{</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;property&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">, but there </span><span class="se">\</span>
<span class="s1">                        isn</span><span class="se">\&#39;</span><span class="s1">t a value for existing.</span><span class="se">\n</span><span class="s1">To proceed, run with the setting </span><span class="se">\</span>
<span class="s1">                        require_existing_for_change=False&#39;</span>
                <span class="p">)</span>
                <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;&quot;Change&quot; is specified for attribute </span><span class="si">{</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;property&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">, but there </span><span class="se">\</span>
<span class="s1">                        isn</span><span class="se">\&#39;</span><span class="s1">t a value for existing&#39;</span>
                <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">valid</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Property changes are not valid:</span><span class="se">\n</span><span class="s2">  {properties&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.roadwaynetwork.RoadwayNetwork.validate_selection" class="doc doc-heading">
<code class="highlight language-python"><span class="n">validate_selection</span><span class="p">(</span><span class="n">selection</span><span class="p">)</span></code>

<a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.validate_selection" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Evaluate whetther the selection dictionary contains the
minimum required values.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>selection</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>selection dictionary to be evaluated</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/roadwaynetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">validate_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selection</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Evaluate whetther the selection dictionary contains the</span>
<span class="sd">    minimum required values.</span>

<span class="sd">    Args:</span>
<span class="sd">        selection: selection dictionary to be evaluated</span>

<span class="sd">    Returns: boolean value as to whether the selection dictonary is valid.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">selection</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;links&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_link_selection</span><span class="p">(</span><span class="n">selection</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">selection</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nodes&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_node_selection</span><span class="p">(</span><span class="n">selection</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Project Card Selection requires either &#39;links&#39; or &#39;nodes&#39; : </span><span class="se">\</span>
<span class="s2">            Selection provided: </span><span class="si">{</span><span class="n">selection</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.roadwaynetwork.RoadwayNetwork.validate_shape_schema" class="doc doc-heading">
<code class="highlight language-python"><span class="n">validate_shape_schema</span><span class="p">(</span><span class="n">shape_file</span><span class="p">,</span> <span class="n">schema_location</span><span class="o">=</span><span class="s1">&#39;roadway_network_shape.json&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.validate_shape_schema" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Validate roadway network data shape schema and output a boolean</p>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/roadwaynetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">validate_shape_schema</span><span class="p">(</span>
    <span class="n">shape_file</span><span class="p">,</span> <span class="n">schema_location</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;roadway_network_shape.json&quot;</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate roadway network data shape schema and output a boolean</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">schema_location</span><span class="p">):</span>
        <span class="n">base_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span> <span class="s2">&quot;schemas&quot;</span>
        <span class="p">)</span>
        <span class="n">schema_location</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_path</span><span class="p">,</span> <span class="n">schema_location</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">schema_location</span><span class="p">)</span> <span class="k">as</span> <span class="n">schema_json_file</span><span class="p">:</span>
        <span class="n">schema</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">schema_json_file</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">shape_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">shape_json_file</span><span class="p">:</span>
        <span class="n">json_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">shape_json_file</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">validate</span><span class="p">(</span><span class="n">json_data</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed Shape schema validation: Validation Error&quot;</span><span class="p">)</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Shape File Loc:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">shape_file</span><span class="p">))</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Path:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">exc</span><span class="o">.</span><span class="n">path</span><span class="p">))</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">exc</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">SchemaError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Invalid Shape Schema&quot;</span><span class="p">)</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Shape Schema Loc: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">schema_location</span><span class="p">))</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">exc</span><span class="o">.</span><span class="n">message</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>

    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.roadwaynetwork.RoadwayNetwork.validate_uniqueness" class="doc doc-heading">
<code class="highlight language-python"><span class="n">validate_uniqueness</span><span class="p">()</span></code>

<a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.validate_uniqueness" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Confirms that the unique identifiers are met.</p>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/roadwaynetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">validate_uniqueness</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Confirms that the unique identifiers are met.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">valid</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_MODEL_LINK_IDENTIFIERS</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Network doesn&#39;t contain unique link identifier: </span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">is_unique</span><span class="p">:</span>
            <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Unique identifier </span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2"> is not unique in network links&quot;</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">LINK_FOREIGN_KEY_TO_NODE</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Network doesn&#39;t contain link foreign key identifier: </span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="n">link_foreign_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">LINK_FOREIGN_KEY_TO_NODE</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="nb">str</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">link_foreign_key</span><span class="o">.</span><span class="n">is_unique</span><span class="p">:</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Foreign key: </span><span class="si">{</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">LINK_FOREIGN_KEY_TO_NODE</span><span class="si">}</span><span class="s2"> is not unique in network links&quot;</span>

        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_NODE_IDENTIFIERS</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Network doesn&#39;t contain unique node identifier: </span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">is_unique</span><span class="p">:</span>
            <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Unique identifier </span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2"> is not unique in network nodes&quot;</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">NODE_FOREIGN_KEY_TO_LINK</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Network doesn&#39;t contain node foreign key identifier: </span><span class="si">{</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">NODE_FOREIGN_KEY_TO_LINK</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">NODE_FOREIGN_KEY_TO_LINK</span><span class="p">]</span><span class="o">.</span><span class="n">is_unique</span><span class="p">:</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Foreign key: </span><span class="si">{</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">NODE_FOREIGN_KEY_TO_LINK</span><span class="si">}</span><span class="s2"> is not unique in network nodes&quot;</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_SHAPE_KEY</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapes_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Network doesn&#39;t contain unique shape id: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_SHAPE_KEY</span>
        <span class="p">)</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapes_df</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_SHAPE_KEY</span><span class="p">]</span><span class="o">.</span><span class="n">is_unique</span><span class="p">:</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Unique key: </span><span class="si">{}</span><span class="s2"> is not unique in network shapes&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">UNIQUE_SHAPE_KEY</span>
        <span class="p">)</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">valid</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.roadwaynetwork.RoadwayNetwork.write" class="doc doc-heading">
<code class="highlight language-python"><span class="n">write</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#network_wrangler.roadwaynetwork.RoadwayNetwork.write" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Writes a network in the roadway network standard</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>path</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>the path were the output will be saved</p></td>
          <td>
                <code>&#39;.&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>filename</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>the name prefix of the roadway files that will be generated</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>model</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>determines if shoudl write model network with separated managed lanes,
or standard wrangler network. Defaults to False.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/roadwaynetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">write</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span>
    <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">model</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Writes a network in the roadway network standard</span>

<span class="sd">    args:</span>
<span class="sd">        path: the path were the output will be saved</span>
<span class="sd">        filename: the name prefix of the roadway files that will be generated</span>
<span class="sd">        model: determines if shoudl write model network with separated managed lanes,</span>
<span class="sd">            or standard wrangler network. Defaults to False.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Path [</span><span class="si">%s</span><span class="s2">] doesn&#39;t exist; creating.&quot;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
        <span class="n">links_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">filename</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="s2">&quot;link.json&quot;</span><span class="p">)</span>
        <span class="n">nodes_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">filename</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="s2">&quot;node.geojson&quot;</span><span class="p">)</span>
        <span class="n">shapes_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">filename</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="s2">&quot;shape.geojson&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">links_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;link.json&quot;</span><span class="p">)</span>
        <span class="n">nodes_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;node.geojson&quot;</span><span class="p">)</span>
        <span class="n">shapes_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;shape.geojson&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">model</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">.roadway</span> <span class="kn">import</span> <span class="n">create_managed_lane_network</span>

        <span class="n">net</span> <span class="o">=</span> <span class="n">create_managed_lane_network</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">links_df</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">m_links_df</span>
        <span class="n">nodes_df</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">m_nodes_df</span>
        <span class="n">shapes_df</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">m_shapes_df</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">links_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">links_df</span>
        <span class="n">nodes_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_df</span>
        <span class="n">shapes_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapes_df</span>

    <span class="c1"># Make sure types are correct</span>
    <span class="n">nodes_df</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">coerce_types</span><span class="p">(</span><span class="n">nodes_df</span><span class="p">)</span>
    <span class="n">links_df</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">coerce_types</span><span class="p">(</span><span class="n">links_df</span><span class="p">)</span>

    <span class="n">link_property_columns</span> <span class="o">=</span> <span class="n">links_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">link_property_columns</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;geometry&quot;</span><span class="p">)</span>
    <span class="n">links_json</span> <span class="o">=</span> <span class="n">links_df_to_json</span><span class="p">(</span><span class="n">links_df</span><span class="p">,</span> <span class="n">link_property_columns</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">links_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">links_json</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

    <span class="c1"># geopandas wont let you write to geojson because</span>
    <span class="c1"># it uses fiona, which doesn&#39;t accept a list as one of the properties</span>
    <span class="c1"># so need to convert the df to geojson manually first</span>
    <span class="n">property_columns</span> <span class="o">=</span> <span class="n">nodes_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">property_columns</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;geometry&quot;</span><span class="p">)</span>

    <span class="n">nodes_geojson</span> <span class="o">=</span> <span class="n">point_df_to_geojson</span><span class="p">(</span><span class="n">nodes_df</span><span class="p">,</span> <span class="n">property_columns</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">nodes_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nodes_geojson</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

    <span class="n">shapes_df</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">shapes_file</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="s2">&quot;GeoJSON&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="network_wrangler.TransitNetwork" class="doc doc-heading">
        <code>network_wrangler.TransitNetwork</code>


<a href="#network_wrangler.TransitNetwork" class="headerlink" title="Permanent link"> ¶</a></h3>


  <div class="doc doc-contents first">
      <p class="doc doc-class-bases">
        Bases: <code>object</code></p>

  
      <p>Representation of a Transit Network.</p>
<p>Typical usage example:
<div class="language-py highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">network_wrangler</span> <span class="k">as</span> <span class="nn">wr</span>
<span class="n">stpaul</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;/home/jovyan/work/example/stpaul&#39;</span>
<span class="n">tc</span><span class="o">=</span><span class="n">wr</span><span class="o">.</span><span class="n">TransitNetwork</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">stpaul</span><span class="p">)</span>
</code></pre></div></p>

  <p><strong>Attributes:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>feed</code></td>
          <td>
                <code><span title="network_wrangler.transitnetwork.DotDict">DotDict</span></code>
          </td>
          <td><p>Partridge feed mapping dataframes.</p></td>
        </tr>
        <tr>
          <td><code>config</code></td>
          <td>
                <code><span title="networkx">nx</span>.<span title="networkx.DiGraph">DiGraph</span></code>
          </td>
          <td><p>Partridge config</p></td>
        </tr>
        <tr>
          <td><code>road_net</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="network_wrangler.roadwaynetwork.RoadwayNetwork" href="#network_wrangler.RoadwayNetwork">RoadwayNetwork</a></code>
          </td>
          <td><p>Associated roadway network object.</p></td>
        </tr>
        <tr>
          <td><code>graph</code></td>
          <td>
                <code><span title="networkx">nx</span>.<span title="networkx.MultiDiGraph">MultiDiGraph</span></code>
          </td>
          <td><p>Graph for associated roadway network object.</p></td>
        </tr>
        <tr>
          <td><code>feed_path</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Where the feed was read in from.</p></td>
        </tr>
        <tr>
          <td><code>validated_frequencies</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>The frequencies have been validated.</p></td>
        </tr>
        <tr>
          <td><code>validated_road_network_consistency</code></td>
          <td>
          </td>
          <td><p>The network has been validated against
the road network.</p></td>
        </tr>
        <tr>
          <td><code>SHAPES_FOREIGN_KEY</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>foreign key between shapes dataframe and roadway network nodes</p></td>
        </tr>
        <tr>
          <td><code>STOPS_FOREIGN_KEY</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>foreign  key between stops dataframe and roadway network nodes</p></td>
        </tr>
        <tr>
          <td><code>ID_SCALAR</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>scalar value added to create new IDs when necessary.</p></td>
        </tr>
        <tr>
          <td><code>REQUIRED_FILES</code></td>
          <td>
                <code>list[str]</code>
          </td>
          <td><p>list of files that the transit network requires.</p></td>
        </tr>
    </tbody>
  </table>
      <p>.. todo::
  investigate consolidating scalars this with RoadwayNetwork
  consolidate thes foreign key constants into one if possible</p>


        <details class="quote">
          <summary>Source code in <code>network_wrangler/transitnetwork.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  22</span>
<span class="normal">  23</span>
<span class="normal">  24</span>
<span class="normal">  25</span>
<span class="normal">  26</span>
<span class="normal">  27</span>
<span class="normal">  28</span>
<span class="normal">  29</span>
<span class="normal">  30</span>
<span class="normal">  31</span>
<span class="normal">  32</span>
<span class="normal">  33</span>
<span class="normal">  34</span>
<span class="normal">  35</span>
<span class="normal">  36</span>
<span class="normal">  37</span>
<span class="normal">  38</span>
<span class="normal">  39</span>
<span class="normal">  40</span>
<span class="normal">  41</span>
<span class="normal">  42</span>
<span class="normal">  43</span>
<span class="normal">  44</span>
<span class="normal">  45</span>
<span class="normal">  46</span>
<span class="normal">  47</span>
<span class="normal">  48</span>
<span class="normal">  49</span>
<span class="normal">  50</span>
<span class="normal">  51</span>
<span class="normal">  52</span>
<span class="normal">  53</span>
<span class="normal">  54</span>
<span class="normal">  55</span>
<span class="normal">  56</span>
<span class="normal">  57</span>
<span class="normal">  58</span>
<span class="normal">  59</span>
<span class="normal">  60</span>
<span class="normal">  61</span>
<span class="normal">  62</span>
<span class="normal">  63</span>
<span class="normal">  64</span>
<span class="normal">  65</span>
<span class="normal">  66</span>
<span class="normal">  67</span>
<span class="normal">  68</span>
<span class="normal">  69</span>
<span class="normal">  70</span>
<span class="normal">  71</span>
<span class="normal">  72</span>
<span class="normal">  73</span>
<span class="normal">  74</span>
<span class="normal">  75</span>
<span class="normal">  76</span>
<span class="normal">  77</span>
<span class="normal">  78</span>
<span class="normal">  79</span>
<span class="normal">  80</span>
<span class="normal">  81</span>
<span class="normal">  82</span>
<span class="normal">  83</span>
<span class="normal">  84</span>
<span class="normal">  85</span>
<span class="normal">  86</span>
<span class="normal">  87</span>
<span class="normal">  88</span>
<span class="normal">  89</span>
<span class="normal">  90</span>
<span class="normal">  91</span>
<span class="normal">  92</span>
<span class="normal">  93</span>
<span class="normal">  94</span>
<span class="normal">  95</span>
<span class="normal">  96</span>
<span class="normal">  97</span>
<span class="normal">  98</span>
<span class="normal">  99</span>
<span class="normal"> 100</span>
<span class="normal"> 101</span>
<span class="normal"> 102</span>
<span class="normal"> 103</span>
<span class="normal"> 104</span>
<span class="normal"> 105</span>
<span class="normal"> 106</span>
<span class="normal"> 107</span>
<span class="normal"> 108</span>
<span class="normal"> 109</span>
<span class="normal"> 110</span>
<span class="normal"> 111</span>
<span class="normal"> 112</span>
<span class="normal"> 113</span>
<span class="normal"> 114</span>
<span class="normal"> 115</span>
<span class="normal"> 116</span>
<span class="normal"> 117</span>
<span class="normal"> 118</span>
<span class="normal"> 119</span>
<span class="normal"> 120</span>
<span class="normal"> 121</span>
<span class="normal"> 122</span>
<span class="normal"> 123</span>
<span class="normal"> 124</span>
<span class="normal"> 125</span>
<span class="normal"> 126</span>
<span class="normal"> 127</span>
<span class="normal"> 128</span>
<span class="normal"> 129</span>
<span class="normal"> 130</span>
<span class="normal"> 131</span>
<span class="normal"> 132</span>
<span class="normal"> 133</span>
<span class="normal"> 134</span>
<span class="normal"> 135</span>
<span class="normal"> 136</span>
<span class="normal"> 137</span>
<span class="normal"> 138</span>
<span class="normal"> 139</span>
<span class="normal"> 140</span>
<span class="normal"> 141</span>
<span class="normal"> 142</span>
<span class="normal"> 143</span>
<span class="normal"> 144</span>
<span class="normal"> 145</span>
<span class="normal"> 146</span>
<span class="normal"> 147</span>
<span class="normal"> 148</span>
<span class="normal"> 149</span>
<span class="normal"> 150</span>
<span class="normal"> 151</span>
<span class="normal"> 152</span>
<span class="normal"> 153</span>
<span class="normal"> 154</span>
<span class="normal"> 155</span>
<span class="normal"> 156</span>
<span class="normal"> 157</span>
<span class="normal"> 158</span>
<span class="normal"> 159</span>
<span class="normal"> 160</span>
<span class="normal"> 161</span>
<span class="normal"> 162</span>
<span class="normal"> 163</span>
<span class="normal"> 164</span>
<span class="normal"> 165</span>
<span class="normal"> 166</span>
<span class="normal"> 167</span>
<span class="normal"> 168</span>
<span class="normal"> 169</span>
<span class="normal"> 170</span>
<span class="normal"> 171</span>
<span class="normal"> 172</span>
<span class="normal"> 173</span>
<span class="normal"> 174</span>
<span class="normal"> 175</span>
<span class="normal"> 176</span>
<span class="normal"> 177</span>
<span class="normal"> 178</span>
<span class="normal"> 179</span>
<span class="normal"> 180</span>
<span class="normal"> 181</span>
<span class="normal"> 182</span>
<span class="normal"> 183</span>
<span class="normal"> 184</span>
<span class="normal"> 185</span>
<span class="normal"> 186</span>
<span class="normal"> 187</span>
<span class="normal"> 188</span>
<span class="normal"> 189</span>
<span class="normal"> 190</span>
<span class="normal"> 191</span>
<span class="normal"> 192</span>
<span class="normal"> 193</span>
<span class="normal"> 194</span>
<span class="normal"> 195</span>
<span class="normal"> 196</span>
<span class="normal"> 197</span>
<span class="normal"> 198</span>
<span class="normal"> 199</span>
<span class="normal"> 200</span>
<span class="normal"> 201</span>
<span class="normal"> 202</span>
<span class="normal"> 203</span>
<span class="normal"> 204</span>
<span class="normal"> 205</span>
<span class="normal"> 206</span>
<span class="normal"> 207</span>
<span class="normal"> 208</span>
<span class="normal"> 209</span>
<span class="normal"> 210</span>
<span class="normal"> 211</span>
<span class="normal"> 212</span>
<span class="normal"> 213</span>
<span class="normal"> 214</span>
<span class="normal"> 215</span>
<span class="normal"> 216</span>
<span class="normal"> 217</span>
<span class="normal"> 218</span>
<span class="normal"> 219</span>
<span class="normal"> 220</span>
<span class="normal"> 221</span>
<span class="normal"> 222</span>
<span class="normal"> 223</span>
<span class="normal"> 224</span>
<span class="normal"> 225</span>
<span class="normal"> 226</span>
<span class="normal"> 227</span>
<span class="normal"> 228</span>
<span class="normal"> 229</span>
<span class="normal"> 230</span>
<span class="normal"> 231</span>
<span class="normal"> 232</span>
<span class="normal"> 233</span>
<span class="normal"> 234</span>
<span class="normal"> 235</span>
<span class="normal"> 236</span>
<span class="normal"> 237</span>
<span class="normal"> 238</span>
<span class="normal"> 239</span>
<span class="normal"> 240</span>
<span class="normal"> 241</span>
<span class="normal"> 242</span>
<span class="normal"> 243</span>
<span class="normal"> 244</span>
<span class="normal"> 245</span>
<span class="normal"> 246</span>
<span class="normal"> 247</span>
<span class="normal"> 248</span>
<span class="normal"> 249</span>
<span class="normal"> 250</span>
<span class="normal"> 251</span>
<span class="normal"> 252</span>
<span class="normal"> 253</span>
<span class="normal"> 254</span>
<span class="normal"> 255</span>
<span class="normal"> 256</span>
<span class="normal"> 257</span>
<span class="normal"> 258</span>
<span class="normal"> 259</span>
<span class="normal"> 260</span>
<span class="normal"> 261</span>
<span class="normal"> 262</span>
<span class="normal"> 263</span>
<span class="normal"> 264</span>
<span class="normal"> 265</span>
<span class="normal"> 266</span>
<span class="normal"> 267</span>
<span class="normal"> 268</span>
<span class="normal"> 269</span>
<span class="normal"> 270</span>
<span class="normal"> 271</span>
<span class="normal"> 272</span>
<span class="normal"> 273</span>
<span class="normal"> 274</span>
<span class="normal"> 275</span>
<span class="normal"> 276</span>
<span class="normal"> 277</span>
<span class="normal"> 278</span>
<span class="normal"> 279</span>
<span class="normal"> 280</span>
<span class="normal"> 281</span>
<span class="normal"> 282</span>
<span class="normal"> 283</span>
<span class="normal"> 284</span>
<span class="normal"> 285</span>
<span class="normal"> 286</span>
<span class="normal"> 287</span>
<span class="normal"> 288</span>
<span class="normal"> 289</span>
<span class="normal"> 290</span>
<span class="normal"> 291</span>
<span class="normal"> 292</span>
<span class="normal"> 293</span>
<span class="normal"> 294</span>
<span class="normal"> 295</span>
<span class="normal"> 296</span>
<span class="normal"> 297</span>
<span class="normal"> 298</span>
<span class="normal"> 299</span>
<span class="normal"> 300</span>
<span class="normal"> 301</span>
<span class="normal"> 302</span>
<span class="normal"> 303</span>
<span class="normal"> 304</span>
<span class="normal"> 305</span>
<span class="normal"> 306</span>
<span class="normal"> 307</span>
<span class="normal"> 308</span>
<span class="normal"> 309</span>
<span class="normal"> 310</span>
<span class="normal"> 311</span>
<span class="normal"> 312</span>
<span class="normal"> 313</span>
<span class="normal"> 314</span>
<span class="normal"> 315</span>
<span class="normal"> 316</span>
<span class="normal"> 317</span>
<span class="normal"> 318</span>
<span class="normal"> 319</span>
<span class="normal"> 320</span>
<span class="normal"> 321</span>
<span class="normal"> 322</span>
<span class="normal"> 323</span>
<span class="normal"> 324</span>
<span class="normal"> 325</span>
<span class="normal"> 326</span>
<span class="normal"> 327</span>
<span class="normal"> 328</span>
<span class="normal"> 329</span>
<span class="normal"> 330</span>
<span class="normal"> 331</span>
<span class="normal"> 332</span>
<span class="normal"> 333</span>
<span class="normal"> 334</span>
<span class="normal"> 335</span>
<span class="normal"> 336</span>
<span class="normal"> 337</span>
<span class="normal"> 338</span>
<span class="normal"> 339</span>
<span class="normal"> 340</span>
<span class="normal"> 341</span>
<span class="normal"> 342</span>
<span class="normal"> 343</span>
<span class="normal"> 344</span>
<span class="normal"> 345</span>
<span class="normal"> 346</span>
<span class="normal"> 347</span>
<span class="normal"> 348</span>
<span class="normal"> 349</span>
<span class="normal"> 350</span>
<span class="normal"> 351</span>
<span class="normal"> 352</span>
<span class="normal"> 353</span>
<span class="normal"> 354</span>
<span class="normal"> 355</span>
<span class="normal"> 356</span>
<span class="normal"> 357</span>
<span class="normal"> 358</span>
<span class="normal"> 359</span>
<span class="normal"> 360</span>
<span class="normal"> 361</span>
<span class="normal"> 362</span>
<span class="normal"> 363</span>
<span class="normal"> 364</span>
<span class="normal"> 365</span>
<span class="normal"> 366</span>
<span class="normal"> 367</span>
<span class="normal"> 368</span>
<span class="normal"> 369</span>
<span class="normal"> 370</span>
<span class="normal"> 371</span>
<span class="normal"> 372</span>
<span class="normal"> 373</span>
<span class="normal"> 374</span>
<span class="normal"> 375</span>
<span class="normal"> 376</span>
<span class="normal"> 377</span>
<span class="normal"> 378</span>
<span class="normal"> 379</span>
<span class="normal"> 380</span>
<span class="normal"> 381</span>
<span class="normal"> 382</span>
<span class="normal"> 383</span>
<span class="normal"> 384</span>
<span class="normal"> 385</span>
<span class="normal"> 386</span>
<span class="normal"> 387</span>
<span class="normal"> 388</span>
<span class="normal"> 389</span>
<span class="normal"> 390</span>
<span class="normal"> 391</span>
<span class="normal"> 392</span>
<span class="normal"> 393</span>
<span class="normal"> 394</span>
<span class="normal"> 395</span>
<span class="normal"> 396</span>
<span class="normal"> 397</span>
<span class="normal"> 398</span>
<span class="normal"> 399</span>
<span class="normal"> 400</span>
<span class="normal"> 401</span>
<span class="normal"> 402</span>
<span class="normal"> 403</span>
<span class="normal"> 404</span>
<span class="normal"> 405</span>
<span class="normal"> 406</span>
<span class="normal"> 407</span>
<span class="normal"> 408</span>
<span class="normal"> 409</span>
<span class="normal"> 410</span>
<span class="normal"> 411</span>
<span class="normal"> 412</span>
<span class="normal"> 413</span>
<span class="normal"> 414</span>
<span class="normal"> 415</span>
<span class="normal"> 416</span>
<span class="normal"> 417</span>
<span class="normal"> 418</span>
<span class="normal"> 419</span>
<span class="normal"> 420</span>
<span class="normal"> 421</span>
<span class="normal"> 422</span>
<span class="normal"> 423</span>
<span class="normal"> 424</span>
<span class="normal"> 425</span>
<span class="normal"> 426</span>
<span class="normal"> 427</span>
<span class="normal"> 428</span>
<span class="normal"> 429</span>
<span class="normal"> 430</span>
<span class="normal"> 431</span>
<span class="normal"> 432</span>
<span class="normal"> 433</span>
<span class="normal"> 434</span>
<span class="normal"> 435</span>
<span class="normal"> 436</span>
<span class="normal"> 437</span>
<span class="normal"> 438</span>
<span class="normal"> 439</span>
<span class="normal"> 440</span>
<span class="normal"> 441</span>
<span class="normal"> 442</span>
<span class="normal"> 443</span>
<span class="normal"> 444</span>
<span class="normal"> 445</span>
<span class="normal"> 446</span>
<span class="normal"> 447</span>
<span class="normal"> 448</span>
<span class="normal"> 449</span>
<span class="normal"> 450</span>
<span class="normal"> 451</span>
<span class="normal"> 452</span>
<span class="normal"> 453</span>
<span class="normal"> 454</span>
<span class="normal"> 455</span>
<span class="normal"> 456</span>
<span class="normal"> 457</span>
<span class="normal"> 458</span>
<span class="normal"> 459</span>
<span class="normal"> 460</span>
<span class="normal"> 461</span>
<span class="normal"> 462</span>
<span class="normal"> 463</span>
<span class="normal"> 464</span>
<span class="normal"> 465</span>
<span class="normal"> 466</span>
<span class="normal"> 467</span>
<span class="normal"> 468</span>
<span class="normal"> 469</span>
<span class="normal"> 470</span>
<span class="normal"> 471</span>
<span class="normal"> 472</span>
<span class="normal"> 473</span>
<span class="normal"> 474</span>
<span class="normal"> 475</span>
<span class="normal"> 476</span>
<span class="normal"> 477</span>
<span class="normal"> 478</span>
<span class="normal"> 479</span>
<span class="normal"> 480</span>
<span class="normal"> 481</span>
<span class="normal"> 482</span>
<span class="normal"> 483</span>
<span class="normal"> 484</span>
<span class="normal"> 485</span>
<span class="normal"> 486</span>
<span class="normal"> 487</span>
<span class="normal"> 488</span>
<span class="normal"> 489</span>
<span class="normal"> 490</span>
<span class="normal"> 491</span>
<span class="normal"> 492</span>
<span class="normal"> 493</span>
<span class="normal"> 494</span>
<span class="normal"> 495</span>
<span class="normal"> 496</span>
<span class="normal"> 497</span>
<span class="normal"> 498</span>
<span class="normal"> 499</span>
<span class="normal"> 500</span>
<span class="normal"> 501</span>
<span class="normal"> 502</span>
<span class="normal"> 503</span>
<span class="normal"> 504</span>
<span class="normal"> 505</span>
<span class="normal"> 506</span>
<span class="normal"> 507</span>
<span class="normal"> 508</span>
<span class="normal"> 509</span>
<span class="normal"> 510</span>
<span class="normal"> 511</span>
<span class="normal"> 512</span>
<span class="normal"> 513</span>
<span class="normal"> 514</span>
<span class="normal"> 515</span>
<span class="normal"> 516</span>
<span class="normal"> 517</span>
<span class="normal"> 518</span>
<span class="normal"> 519</span>
<span class="normal"> 520</span>
<span class="normal"> 521</span>
<span class="normal"> 522</span>
<span class="normal"> 523</span>
<span class="normal"> 524</span>
<span class="normal"> 525</span>
<span class="normal"> 526</span>
<span class="normal"> 527</span>
<span class="normal"> 528</span>
<span class="normal"> 529</span>
<span class="normal"> 530</span>
<span class="normal"> 531</span>
<span class="normal"> 532</span>
<span class="normal"> 533</span>
<span class="normal"> 534</span>
<span class="normal"> 535</span>
<span class="normal"> 536</span>
<span class="normal"> 537</span>
<span class="normal"> 538</span>
<span class="normal"> 539</span>
<span class="normal"> 540</span>
<span class="normal"> 541</span>
<span class="normal"> 542</span>
<span class="normal"> 543</span>
<span class="normal"> 544</span>
<span class="normal"> 545</span>
<span class="normal"> 546</span>
<span class="normal"> 547</span>
<span class="normal"> 548</span>
<span class="normal"> 549</span>
<span class="normal"> 550</span>
<span class="normal"> 551</span>
<span class="normal"> 552</span>
<span class="normal"> 553</span>
<span class="normal"> 554</span>
<span class="normal"> 555</span>
<span class="normal"> 556</span>
<span class="normal"> 557</span>
<span class="normal"> 558</span>
<span class="normal"> 559</span>
<span class="normal"> 560</span>
<span class="normal"> 561</span>
<span class="normal"> 562</span>
<span class="normal"> 563</span>
<span class="normal"> 564</span>
<span class="normal"> 565</span>
<span class="normal"> 566</span>
<span class="normal"> 567</span>
<span class="normal"> 568</span>
<span class="normal"> 569</span>
<span class="normal"> 570</span>
<span class="normal"> 571</span>
<span class="normal"> 572</span>
<span class="normal"> 573</span>
<span class="normal"> 574</span>
<span class="normal"> 575</span>
<span class="normal"> 576</span>
<span class="normal"> 577</span>
<span class="normal"> 578</span>
<span class="normal"> 579</span>
<span class="normal"> 580</span>
<span class="normal"> 581</span>
<span class="normal"> 582</span>
<span class="normal"> 583</span>
<span class="normal"> 584</span>
<span class="normal"> 585</span>
<span class="normal"> 586</span>
<span class="normal"> 587</span>
<span class="normal"> 588</span>
<span class="normal"> 589</span>
<span class="normal"> 590</span>
<span class="normal"> 591</span>
<span class="normal"> 592</span>
<span class="normal"> 593</span>
<span class="normal"> 594</span>
<span class="normal"> 595</span>
<span class="normal"> 596</span>
<span class="normal"> 597</span>
<span class="normal"> 598</span>
<span class="normal"> 599</span>
<span class="normal"> 600</span>
<span class="normal"> 601</span>
<span class="normal"> 602</span>
<span class="normal"> 603</span>
<span class="normal"> 604</span>
<span class="normal"> 605</span>
<span class="normal"> 606</span>
<span class="normal"> 607</span>
<span class="normal"> 608</span>
<span class="normal"> 609</span>
<span class="normal"> 610</span>
<span class="normal"> 611</span>
<span class="normal"> 612</span>
<span class="normal"> 613</span>
<span class="normal"> 614</span>
<span class="normal"> 615</span>
<span class="normal"> 616</span>
<span class="normal"> 617</span>
<span class="normal"> 618</span>
<span class="normal"> 619</span>
<span class="normal"> 620</span>
<span class="normal"> 621</span>
<span class="normal"> 622</span>
<span class="normal"> 623</span>
<span class="normal"> 624</span>
<span class="normal"> 625</span>
<span class="normal"> 626</span>
<span class="normal"> 627</span>
<span class="normal"> 628</span>
<span class="normal"> 629</span>
<span class="normal"> 630</span>
<span class="normal"> 631</span>
<span class="normal"> 632</span>
<span class="normal"> 633</span>
<span class="normal"> 634</span>
<span class="normal"> 635</span>
<span class="normal"> 636</span>
<span class="normal"> 637</span>
<span class="normal"> 638</span>
<span class="normal"> 639</span>
<span class="normal"> 640</span>
<span class="normal"> 641</span>
<span class="normal"> 642</span>
<span class="normal"> 643</span>
<span class="normal"> 644</span>
<span class="normal"> 645</span>
<span class="normal"> 646</span>
<span class="normal"> 647</span>
<span class="normal"> 648</span>
<span class="normal"> 649</span>
<span class="normal"> 650</span>
<span class="normal"> 651</span>
<span class="normal"> 652</span>
<span class="normal"> 653</span>
<span class="normal"> 654</span>
<span class="normal"> 655</span>
<span class="normal"> 656</span>
<span class="normal"> 657</span>
<span class="normal"> 658</span>
<span class="normal"> 659</span>
<span class="normal"> 660</span>
<span class="normal"> 661</span>
<span class="normal"> 662</span>
<span class="normal"> 663</span>
<span class="normal"> 664</span>
<span class="normal"> 665</span>
<span class="normal"> 666</span>
<span class="normal"> 667</span>
<span class="normal"> 668</span>
<span class="normal"> 669</span>
<span class="normal"> 670</span>
<span class="normal"> 671</span>
<span class="normal"> 672</span>
<span class="normal"> 673</span>
<span class="normal"> 674</span>
<span class="normal"> 675</span>
<span class="normal"> 676</span>
<span class="normal"> 677</span>
<span class="normal"> 678</span>
<span class="normal"> 679</span>
<span class="normal"> 680</span>
<span class="normal"> 681</span>
<span class="normal"> 682</span>
<span class="normal"> 683</span>
<span class="normal"> 684</span>
<span class="normal"> 685</span>
<span class="normal"> 686</span>
<span class="normal"> 687</span>
<span class="normal"> 688</span>
<span class="normal"> 689</span>
<span class="normal"> 690</span>
<span class="normal"> 691</span>
<span class="normal"> 692</span>
<span class="normal"> 693</span>
<span class="normal"> 694</span>
<span class="normal"> 695</span>
<span class="normal"> 696</span>
<span class="normal"> 697</span>
<span class="normal"> 698</span>
<span class="normal"> 699</span>
<span class="normal"> 700</span>
<span class="normal"> 701</span>
<span class="normal"> 702</span>
<span class="normal"> 703</span>
<span class="normal"> 704</span>
<span class="normal"> 705</span>
<span class="normal"> 706</span>
<span class="normal"> 707</span>
<span class="normal"> 708</span>
<span class="normal"> 709</span>
<span class="normal"> 710</span>
<span class="normal"> 711</span>
<span class="normal"> 712</span>
<span class="normal"> 713</span>
<span class="normal"> 714</span>
<span class="normal"> 715</span>
<span class="normal"> 716</span>
<span class="normal"> 717</span>
<span class="normal"> 718</span>
<span class="normal"> 719</span>
<span class="normal"> 720</span>
<span class="normal"> 721</span>
<span class="normal"> 722</span>
<span class="normal"> 723</span>
<span class="normal"> 724</span>
<span class="normal"> 725</span>
<span class="normal"> 726</span>
<span class="normal"> 727</span>
<span class="normal"> 728</span>
<span class="normal"> 729</span>
<span class="normal"> 730</span>
<span class="normal"> 731</span>
<span class="normal"> 732</span>
<span class="normal"> 733</span>
<span class="normal"> 734</span>
<span class="normal"> 735</span>
<span class="normal"> 736</span>
<span class="normal"> 737</span>
<span class="normal"> 738</span>
<span class="normal"> 739</span>
<span class="normal"> 740</span>
<span class="normal"> 741</span>
<span class="normal"> 742</span>
<span class="normal"> 743</span>
<span class="normal"> 744</span>
<span class="normal"> 745</span>
<span class="normal"> 746</span>
<span class="normal"> 747</span>
<span class="normal"> 748</span>
<span class="normal"> 749</span>
<span class="normal"> 750</span>
<span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TransitNetwork</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Representation of a Transit Network.</span>

<span class="sd">    Typical usage example:</span>
<span class="sd">    ``` py</span>
<span class="sd">    import network_wrangler as wr</span>
<span class="sd">    stpaul = r&#39;/home/jovyan/work/example/stpaul&#39;</span>
<span class="sd">    tc=wr.TransitNetwork.read(path=stpaul)</span>
<span class="sd">    ```</span>

<span class="sd">    Attributes:</span>
<span class="sd">        feed (DotDict): Partridge feed mapping dataframes.</span>
<span class="sd">        config (nx.DiGraph): Partridge config</span>
<span class="sd">        road_net (RoadwayNetwork): Associated roadway network object.</span>
<span class="sd">        graph (nx.MultiDiGraph): Graph for associated roadway network object.</span>
<span class="sd">        feed_path (str): Where the feed was read in from.</span>
<span class="sd">        validated_frequencies (bool): The frequencies have been validated.</span>
<span class="sd">        validated_road_network_consistency (): The network has been validated against</span>
<span class="sd">            the road network.</span>
<span class="sd">        SHAPES_FOREIGN_KEY (str): foreign key between shapes dataframe and roadway network nodes</span>
<span class="sd">        STOPS_FOREIGN_KEY (str): foreign  key between stops dataframe and roadway network nodes</span>
<span class="sd">        ID_SCALAR (int): scalar value added to create new IDs when necessary.</span>
<span class="sd">        REQUIRED_FILES (list[str]): list of files that the transit network requires.</span>

<span class="sd">    .. todo::</span>
<span class="sd">      investigate consolidating scalars this with RoadwayNetwork</span>
<span class="sd">      consolidate thes foreign key constants into one if possible</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># PK = primary key, FK = foreign key</span>
    <span class="n">SHAPES_FOREIGN_KEY</span> <span class="o">=</span> <span class="s2">&quot;shape_model_node_id&quot;</span>
    <span class="n">STOPS_FOREIGN_KEY</span> <span class="o">=</span> <span class="s2">&quot;model_node_id&quot;</span>

    <span class="c1"># TODO consolidate these two ^^^ constants if possible</span>

    <span class="n">ID_SCALAR</span> <span class="o">=</span> <span class="mi">100000000</span>

    <span class="c1"># TODO investigate consolidating this with RoadwayNetwork</span>

    <span class="n">REQUIRED_FILES</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;agency.txt&quot;</span><span class="p">,</span>
        <span class="s2">&quot;frequencies.txt&quot;</span><span class="p">,</span>
        <span class="s2">&quot;routes.txt&quot;</span><span class="p">,</span>
        <span class="s2">&quot;shapes.txt&quot;</span><span class="p">,</span>
        <span class="s2">&quot;stop_times.txt&quot;</span><span class="p">,</span>
        <span class="s2">&quot;stops.txt&quot;</span><span class="p">,</span>
        <span class="s2">&quot;trips.txt&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feed</span><span class="p">:</span> <span class="n">DotDict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor</span>

<span class="sd">        .. todo:: Make graph a reference to associated RoadwayNetwork&#39;s graph, not its own thing.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feed</span><span class="p">:</span> <span class="n">DotDict</span> <span class="o">=</span> <span class="n">feed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">:</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span> <span class="o">=</span> <span class="n">config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">road_net</span><span class="p">:</span> <span class="n">RoadwayNetwork</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="p">:</span> <span class="n">nx</span><span class="o">.</span><span class="n">MultiDiGraph</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feed_path</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">validated_frequencies</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validated_road_network_consistency</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_frequencies</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Transit lines with non-positive frequencies exist in the network&quot;</span>
            <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">empty</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">TransitNetwork</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create an empty transit network instance using the default config.</span>

<span class="sd">        .. todo:: fill out this method</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO</span>

        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;TransitNetwork.empty is not implemented.&quot;</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">feed_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TransitNetwork</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read GTFS feed from folder and TransitNetwork object</span>

<span class="sd">        Args:</span>
<span class="sd">            feed_path: where to read transit network files from</span>

<span class="sd">        Returns: a TransitNetwork object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">default_config</span><span class="p">()</span>
        <span class="n">feed</span> <span class="o">=</span> <span class="n">ptg</span><span class="o">.</span><span class="n">load_feed</span><span class="p">(</span><span class="n">feed_path</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Read in transit feed from: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">feed_path</span><span class="p">))</span>

        <span class="n">updated_config</span> <span class="o">=</span> <span class="n">TransitNetwork</span><span class="o">.</span><span class="n">validate_feed</span><span class="p">(</span><span class="n">feed</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>

        <span class="c1"># Read in each feed so we can write over them</span>
        <span class="n">editable_feed</span> <span class="o">=</span> <span class="n">DotDict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">updated_config</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="c1"># Load (initiate Partridge&#39;s lazy load)</span>
            <span class="n">editable_feed</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">feed</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

        <span class="n">transit_network</span> <span class="o">=</span> <span class="n">TransitNetwork</span><span class="p">(</span><span class="n">feed</span><span class="o">=</span><span class="n">editable_feed</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">updated_config</span><span class="p">)</span>
        <span class="n">transit_network</span><span class="o">.</span><span class="n">feed_path</span> <span class="o">=</span> <span class="n">feed_path</span>
        <span class="k">return</span> <span class="n">transit_network</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">validate_feed</span><span class="p">(</span><span class="n">feed</span><span class="p">:</span> <span class="n">DotDict</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Since Partridge lazily loads the df, load each file to make sure it</span>
<span class="sd">        actually works.</span>

<span class="sd">        Partridge uses a DiGraph from the networkx library to represent the</span>
<span class="sd">        relationships between GTFS files. Each file is a &#39;node&#39;, and the</span>
<span class="sd">        relationship between files are &#39;edges&#39;.</span>

<span class="sd">        Args:</span>
<span class="sd">            feed: partridge feed</span>
<span class="sd">            config: partridge config</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">updated_config</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
        <span class="n">files_not_found</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

            <span class="n">n</span> <span class="o">=</span> <span class="n">feed</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;...</span><span class="si">{}</span><span class="s2">:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">n</span><span class="p">[:</span><span class="mi">10</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s2">&quot;Removing </span><span class="si">{}</span><span class="s2"> from transit network config because file not found&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">node</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="n">updated_config</span><span class="o">.</span><span class="n">remove_node</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">TransitNetwork</span><span class="o">.</span><span class="n">REQUIRED_FILES</span><span class="p">:</span>
                    <span class="n">files_not_found</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">files_not_found</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Required files not found or valid: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">files_not_found</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="n">TransitNetwork</span><span class="o">.</span><span class="n">validate_network_keys</span><span class="p">(</span><span class="n">feed</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">updated_config</span>

    <span class="k">def</span> <span class="nf">validate_frequencies</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validates that there are no transit trips in the feed with zero frequencies.</span>

<span class="sd">        Changes state of self.validated_frequencies boolean based on outcome.</span>

<span class="sd">        Returns:</span>
<span class="sd">            boolean indicating if valid or not.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">_valid</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">zero_freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feed</span><span class="o">.</span><span class="n">frequencies</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">feed</span><span class="o">.</span><span class="n">frequencies</span><span class="o">.</span><span class="n">headway_secs</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">zero_freq</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">_valid</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Transit lines </span><span class="si">{}</span><span class="s2"> have non-positive frequencies&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">zero_freq</span><span class="o">.</span><span class="n">trip_id</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">validated_frequencies</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="n">_valid</span>

    <span class="k">def</span> <span class="nf">validate_road_network_consistencies</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validates transit network against the road network for both stops</span>
<span class="sd">        and shapes.</span>

<span class="sd">        Returns:</span>
<span class="sd">            boolean indicating if valid or not.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_net</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;RoadwayNetwork not set yet, see TransitNetwork.set_roadnet()&quot;</span>
            <span class="p">)</span>

        <span class="n">valid</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">valid_stops</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_transit_stops</span><span class="p">()</span>
        <span class="n">valid_shapes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_transit_shapes</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">validated_road_network_consistency</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_stops</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">valid_shapes</span><span class="p">:</span>
            <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Transit network is not consistent with road network.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">valid</span>

    <span class="k">def</span> <span class="nf">validate_transit_stops</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validates that all transit stops are part of the roadway network.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Boolean indicating if valid or not.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_net</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;RoadwayNetwork not set yet, see TransitNetwork.set_roadnet()&quot;</span>
            <span class="p">)</span>

        <span class="n">stops</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feed</span><span class="o">.</span><span class="n">stops</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_net</span><span class="o">.</span><span class="n">nodes_df</span>

        <span class="n">valid</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">stop_ids</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">stops</span><span class="p">[</span><span class="n">TransitNetwork</span><span class="o">.</span><span class="n">STOPS_FOREIGN_KEY</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()]</span>
        <span class="n">node_ids</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">NODE_FOREIGN_KEY_TO_LINK</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
        <span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">stop_ids</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">node_ids</span><span class="p">):</span>
            <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">missing_stops</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">stop_ids</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">node_ids</span><span class="p">))</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Not all transit stops are part of the roadyway network. &quot;</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;Missing stops (</span><span class="si">{}</span><span class="s2">) from the roadway nodes are </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">TransitNetwork</span><span class="o">.</span><span class="n">STOPS_FOREIGN_KEY</span><span class="p">,</span> <span class="n">missing_stops</span>
            <span class="p">)</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">valid</span>

    <span class="k">def</span> <span class="nf">validate_transit_shapes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validates that all transit shapes are part of the roadway network.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Boolean indicating if valid or not.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_net</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;RoadwayNetwork not set yet, see TransitNetwork.set_roadnet()&quot;</span>
            <span class="p">)</span>

        <span class="n">shapes_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feed</span><span class="o">.</span><span class="n">shapes</span>
        <span class="n">nodes_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_net</span><span class="o">.</span><span class="n">nodes_df</span>
        <span class="n">links_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_net</span><span class="o">.</span><span class="n">links_df</span>

        <span class="n">valid</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># check if all the node ids exist in the network</span>
        <span class="n">shape_ids</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">shapes_df</span><span class="p">[</span><span class="n">TransitNetwork</span><span class="o">.</span><span class="n">SHAPES_FOREIGN_KEY</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
        <span class="p">]</span>
        <span class="n">node_ids</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nodes_df</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">NODE_FOREIGN_KEY_TO_LINK</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
        <span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">shape_ids</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">node_ids</span><span class="p">):</span>
            <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">missing_shapes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">shape_ids</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">node_ids</span><span class="p">))</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Not all transit shapes are part of the roadyway network. &quot;</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;Missing shapes (</span><span class="si">{}</span><span class="s2">) from the roadway network are </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">TransitNetwork</span><span class="o">.</span><span class="n">SHAPES_FOREIGN_KEY</span><span class="p">,</span> <span class="n">missing_shapes</span>
            <span class="p">)</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">valid</span>

        <span class="c1"># check if all the links in transit shapes exist in the network</span>
        <span class="c1"># and transit is allowed</span>
        <span class="n">shapes_df</span> <span class="o">=</span> <span class="n">shapes_df</span><span class="o">.</span><span class="n">astype</span><span class="p">({</span><span class="n">TransitNetwork</span><span class="o">.</span><span class="n">SHAPES_FOREIGN_KEY</span><span class="p">:</span> <span class="nb">int</span><span class="p">})</span>
        <span class="n">unique_shape_ids</span> <span class="o">=</span> <span class="n">shapes_df</span><span class="o">.</span><span class="n">shape_id</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">unique_shape_ids</span><span class="p">:</span>
            <span class="n">subset_shapes_df</span> <span class="o">=</span> <span class="n">shapes_df</span><span class="p">[</span><span class="n">shapes_df</span><span class="p">[</span><span class="s2">&quot;shape_id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="nb">id</span><span class="p">]</span>
            <span class="n">subset_shapes_df</span> <span class="o">=</span> <span class="n">subset_shapes_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;shape_pt_sequence&quot;</span><span class="p">])</span>
            <span class="n">subset_shapes_df</span> <span class="o">=</span> <span class="n">subset_shapes_df</span><span class="o">.</span><span class="n">add_suffix</span><span class="p">(</span><span class="s2">&quot;_1&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">subset_shapes_df</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">add_suffix</span><span class="p">(</span><span class="s2">&quot;_2&quot;</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">subset_shapes_df</span> <span class="o">=</span> <span class="n">subset_shapes_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

            <span class="n">merged_df</span> <span class="o">=</span> <span class="n">subset_shapes_df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
                <span class="n">links_df</span><span class="p">,</span>
                <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
                <span class="n">left_on</span><span class="o">=</span><span class="p">[</span>
                    <span class="n">TransitNetwork</span><span class="o">.</span><span class="n">SHAPES_FOREIGN_KEY</span> <span class="o">+</span> <span class="s2">&quot;_1&quot;</span><span class="p">,</span>
                    <span class="n">TransitNetwork</span><span class="o">.</span><span class="n">SHAPES_FOREIGN_KEY</span> <span class="o">+</span> <span class="s2">&quot;_2&quot;</span><span class="p">,</span>
                <span class="p">],</span>
                <span class="n">right_on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">],</span>
                <span class="n">indicator</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">missing_links_df</span> <span class="o">=</span> <span class="n">merged_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;_merge == &quot;left_only&quot;&#39;</span><span class="p">)</span>

            <span class="c1"># there are shape links which does not exist in the roadway network</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">missing_links_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;There are links for shape id </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2"> which are missing in the </span><span class="se">\</span>
<span class="s2">                    roadway network.&quot;</span>
                <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

            <span class="n">transit_not_allowed_df</span> <span class="o">=</span> <span class="n">merged_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
                <span class="s1">&#39;_merge == &quot;both&quot; &amp; drive_access == 0 &amp; bus_only == 0 &amp; rail_only == 0&#39;</span>
            <span class="p">)</span>

            <span class="c1"># there are shape links where transit is not allowed</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">transit_not_allowed_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;There are links for shape id </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2"> which does not allow transit </span><span class="se">\</span>
<span class="s2">                    in the roadway network.&quot;</span>
                <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">valid</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">route_ids_in_routestxt</span><span class="p">(</span><span class="n">feed</span><span class="p">:</span> <span class="n">DotDict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Wherever route_id occurs, make sure it is in routes.txt</span>

<span class="sd">        Args:</span>
<span class="sd">            feed: partridge feed object</span>

<span class="sd">        Returns:</span>
<span class="sd">            Boolean indicating if feed is okay.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">route_ids_routestxt</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">feed</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">route_id</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
        <span class="n">route_ids_referenced</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">feed</span><span class="o">.</span><span class="n">trips</span><span class="o">.</span><span class="n">route_id</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

        <span class="n">missing_routes</span> <span class="o">=</span> <span class="n">route_ids_referenced</span> <span class="o">-</span> <span class="n">route_ids_routestxt</span>

        <span class="k">if</span> <span class="n">missing_routes</span><span class="p">:</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;The following route_ids are referenced but missing from routes.txt: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="nb">list</span><span class="p">(</span><span class="n">missing_routes</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">trip_ids_in_tripstxt</span><span class="p">(</span><span class="n">feed</span><span class="p">:</span> <span class="n">DotDict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Wherever trip_id occurs, make sure it is in trips.txt</span>

<span class="sd">        Args:</span>
<span class="sd">            feed: partridge feed object</span>

<span class="sd">        Returns:</span>
<span class="sd">            Boolean indicating if feed is okay.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">trip_ids_tripstxt</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">feed</span><span class="o">.</span><span class="n">trips</span><span class="o">.</span><span class="n">trip_id</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
        <span class="n">trip_ids_referenced</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
            <span class="n">feed</span><span class="o">.</span><span class="n">stop_times</span><span class="o">.</span><span class="n">trip_id</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="o">+</span> <span class="n">feed</span><span class="o">.</span><span class="n">frequencies</span><span class="o">.</span><span class="n">trip_id</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="n">missing_trips</span> <span class="o">=</span> <span class="n">trip_ids_referenced</span> <span class="o">-</span> <span class="n">trip_ids_tripstxt</span>

        <span class="k">if</span> <span class="n">missing_trips</span><span class="p">:</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;The following trip_ids are referenced but missing from trips.txt: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="nb">list</span><span class="p">(</span><span class="n">missing_trips</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">shape_ids_in_shapestxt</span><span class="p">(</span><span class="n">feed</span><span class="p">:</span> <span class="n">DotDict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Wherever shape_id occurs, make sure it is in shapes.txt</span>

<span class="sd">        Args:</span>
<span class="sd">            feed: partridge feed object</span>

<span class="sd">        Returns:</span>
<span class="sd">            Boolean indicating if feed is okay.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">shape_ids_shapestxt</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">feed</span><span class="o">.</span><span class="n">shapes</span><span class="o">.</span><span class="n">shape_id</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
        <span class="n">shape_ids_referenced</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">feed</span><span class="o">.</span><span class="n">trips</span><span class="o">.</span><span class="n">shape_id</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

        <span class="n">missing_shapes</span> <span class="o">=</span> <span class="n">shape_ids_referenced</span> <span class="o">-</span> <span class="n">shape_ids_shapestxt</span>

        <span class="k">if</span> <span class="n">missing_shapes</span><span class="p">:</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;The following shape_ids from trips.txt are missing from shapes.txt: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="nb">list</span><span class="p">(</span><span class="n">missing_shapes</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">stop_ids_in_stopstxt</span><span class="p">(</span><span class="n">feed</span><span class="p">:</span> <span class="n">DotDict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Wherever stop_id occurs, make sure it is in stops.txt</span>

<span class="sd">        Args:</span>
<span class="sd">            feed: partridge feed object</span>

<span class="sd">        Returns:</span>
<span class="sd">            Boolean indicating if feed is okay.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">stop_ids_stopstxt</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">feed</span><span class="o">.</span><span class="n">stops</span><span class="o">.</span><span class="n">stop_id</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
        <span class="n">stop_ids_referenced</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># STOP_TIMES</span>
        <span class="n">stop_ids_referenced</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">feed</span><span class="o">.</span><span class="n">stop_times</span><span class="o">.</span><span class="n">stop_id</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
        <span class="n">stop_ids_referenced</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">feed</span><span class="o">.</span><span class="n">stops</span><span class="o">.</span><span class="n">parent_station</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

        <span class="c1"># TRANSFERS</span>
        <span class="k">if</span> <span class="n">feed</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;transfers.txt&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">stop_ids_referenced</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">feed</span><span class="o">.</span><span class="n">transfers</span><span class="o">.</span><span class="n">from_stop_id</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
            <span class="n">stop_ids_referenced</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">feed</span><span class="o">.</span><span class="n">transfers</span><span class="o">.</span><span class="n">to_stop_id</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

        <span class="c1"># PATHWAYS</span>
        <span class="k">if</span> <span class="n">feed</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pathways.txt&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">stop_ids_referenced</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">feed</span><span class="o">.</span><span class="n">pathways</span><span class="o">.</span><span class="n">from_stop_id</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
            <span class="n">stop_ids_referenced</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">feed</span><span class="o">.</span><span class="n">pathways</span><span class="o">.</span><span class="n">to_stop_id</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

        <span class="n">stop_ids_referenced</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">stop_ids_referenced</span><span class="p">)</span>

        <span class="n">missing_stops</span> <span class="o">=</span> <span class="n">stop_ids_referenced</span> <span class="o">-</span> <span class="n">stop_ids_stopstxt</span>

        <span class="k">if</span> <span class="n">missing_stops</span><span class="p">:</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;The following stop_ids from are referenced but missing from stops.txt: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="nb">list</span><span class="p">(</span><span class="n">missing_stops</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">validate_network_keys</span><span class="p">(</span><span class="n">feed</span><span class="p">:</span> <span class="n">DotDict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validates foreign keys are present in all connecting feed files.</span>

<span class="sd">        Args:</span>
<span class="sd">            feed: partridge feed object</span>

<span class="sd">        Returns:</span>
<span class="sd">            Boolean indicating if feed is okay.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="ow">and</span> <span class="n">TransitNetwork</span><span class="o">.</span><span class="n">route_ids_in_routestxt</span><span class="p">(</span><span class="n">feed</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="ow">and</span> <span class="n">TransitNetwork</span><span class="o">.</span><span class="n">trip_ids_in_tripstxt</span><span class="p">(</span><span class="n">feed</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="ow">and</span> <span class="n">TransitNetwork</span><span class="o">.</span><span class="n">shape_ids_in_shapestxt</span><span class="p">(</span><span class="n">feed</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="ow">and</span> <span class="n">TransitNetwork</span><span class="o">.</span><span class="n">stop_ids_in_stopstxt</span><span class="p">(</span><span class="n">feed</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">set_roadnet</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">road_net</span><span class="p">:</span> <span class="n">RoadwayNetwork</span><span class="p">,</span>
        <span class="n">graph_shapes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">graph_stops</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">validate_consistency</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">road_net</span><span class="p">:</span> <span class="n">RoadwayNetwork</span> <span class="o">=</span> <span class="n">road_net</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="p">:</span> <span class="n">nx</span><span class="o">.</span><span class="n">MultiDiGraph</span> <span class="o">=</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">ox_graph</span><span class="p">(</span>
            <span class="n">road_net</span><span class="o">.</span><span class="n">nodes_df</span><span class="p">,</span> <span class="n">road_net</span><span class="o">.</span><span class="n">links_df</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">graph_shapes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_graph_shapes</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">graph_stops</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_graph_stops</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">validate_consistency</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validate_road_network_consistencies</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_graph_shapes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        .. todo:: Fill out this method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">existing_shapes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feed</span><span class="o">.</span><span class="n">shapes</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;_graph_shapes() not implemented yet.&quot;</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="c1"># graphed_shapes = pd.DataFrame()</span>

        <span class="c1"># for shape_id in shapes:</span>
        <span class="c1"># TODO traverse point by point, mapping shortest path on graph,</span>
        <span class="c1"># then append to a list</span>
        <span class="c1"># return total list of all link ids</span>
        <span class="c1"># rebuild rows in shapes dataframe and add to graphed_shapes</span>
        <span class="c1"># make graphed_shapes a GeoDataFrame</span>

        <span class="c1"># self.feed.shapes = graphed_shapes</span>

    <span class="k">def</span> <span class="nf">_graph_stops</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        .. todo:: Fill out this method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">existing_stops</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feed</span><span class="o">.</span><span class="n">stops</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;_graph_stops() not implemented yet.&quot;</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="c1"># graphed_stops = pd.DataFrame()</span>

        <span class="c1"># for stop_id in stops:</span>
        <span class="c1"># TODO</span>

        <span class="c1"># self.feed.stops = graphed_stops</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes a network in the transit network standard</span>

<span class="sd">        Args:</span>
<span class="sd">            path: the path were the output will be saved</span>
<span class="sd">            filename: the name prefix of the transit files that will be generated</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Writing transit to directory: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feed</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
                    <span class="n">outpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">filename</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">node</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">outpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>
                <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Writing file: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">outpath</span><span class="p">))</span>

                <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">outpath</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">transit_net_to_gdf</span><span class="p">(</span><span class="n">transit</span><span class="p">:</span> <span class="n">Union</span><span class="p">(</span><span class="s2">&quot;TransitNetwork&quot;</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a geodataframe given a TransitNetwork or a valid Shapes DataFrame.</span>

<span class="sd">        Args:</span>
<span class="sd">            transit: either a TransitNetwork or a Shapes GeoDataFrame</span>

<span class="sd">        .. todo:: Make more sophisticated.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">partridge</span> <span class="kn">import</span> <span class="n">geo</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">transit</span><span class="p">)</span> <span class="ow">is</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
            <span class="n">shapes</span> <span class="o">=</span> <span class="n">transit</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">shapes</span> <span class="o">=</span> <span class="n">transit</span><span class="o">.</span><span class="n">feed</span><span class="o">.</span><span class="n">shapes</span>

        <span class="n">transit_gdf</span> <span class="o">=</span> <span class="n">geo</span><span class="o">.</span><span class="n">build_shapes</span><span class="p">(</span><span class="n">shapes</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">transit_gdf</span>

    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_card_dictionary</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Wrapper method to apply a project to a transit network.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_card_dictionary: dict</span>
<span class="sd">                a dictionary of the project card object</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Applying Project to Transit Network: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">project_card_dictionary</span><span class="p">[</span><span class="s2">&quot;project&quot;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="k">def</span> <span class="nf">_apply_individual_change</span><span class="p">(</span><span class="n">project_dictionary</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">project_dictionary</span><span class="p">[</span><span class="s2">&quot;category&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="o">==</span> <span class="s2">&quot;transit service property change&quot;</span>
            <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">apply_transit_feature_change</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">select_transit_features</span><span class="p">(</span><span class="n">project_dictionary</span><span class="p">[</span><span class="s2">&quot;facility&quot;</span><span class="p">]),</span>
                    <span class="n">project_dictionary</span><span class="p">[</span><span class="s2">&quot;properties&quot;</span><span class="p">],</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">project_dictionary</span><span class="p">[</span><span class="s2">&quot;category&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;parallel managed lanes&quot;</span><span class="p">:</span>
                <span class="c1"># Grab the list of nodes in the facility from road_net</span>
                <span class="c1"># It should be cached because managed lane projects are</span>
                <span class="c1"># processed by RoadwayNetwork first via</span>
                <span class="c1"># Scenario.apply_all_projects</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">managed_lane_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_net</span><span class="o">.</span><span class="n">selections</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">road_net</span><span class="o">.</span><span class="n">build_selection_key</span><span class="p">(</span>
                            <span class="n">project_dictionary</span><span class="p">[</span><span class="s2">&quot;facility&quot;</span><span class="p">]</span>
                        <span class="p">)</span>
                    <span class="p">)[</span><span class="s2">&quot;route&quot;</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                        <span class="s2">&quot;RoadwayNetwork not set yet, see TransitNetwork.set_roadnet()&quot;</span>
                    <span class="p">)</span>

                <span class="c1"># Reroute any transit using these nodes</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">apply_transit_managed_lane</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">select_transit_features_by_nodes</span><span class="p">(</span><span class="n">managed_lane_nodes</span><span class="p">),</span>
                    <span class="n">managed_lane_nodes</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">project_dictionary</span><span class="p">[</span><span class="s2">&quot;category&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;add transit&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">apply_python_calculation</span><span class="p">(</span><span class="n">project_dictionary</span><span class="p">[</span><span class="s2">&quot;pycode&quot;</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">project_dictionary</span><span class="p">[</span><span class="s2">&quot;category&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;roadway deletion&quot;</span><span class="p">:</span>
                <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;Roadway Deletion not yet implemented in Transit; ignoring&quot;</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> not implemented yet in TransitNetwork; can&#39;t apply.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">project_dictionary</span><span class="p">[</span><span class="s2">&quot;category&quot;</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">raise</span> <span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">project_card_dictionary</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;changes&quot;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">project_dictionary</span> <span class="ow">in</span> <span class="n">project_card_dictionary</span><span class="p">[</span><span class="s2">&quot;changes&quot;</span><span class="p">]:</span>
                <span class="n">_apply_individual_change</span><span class="p">(</span><span class="n">project_dictionary</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_apply_individual_change</span><span class="p">(</span><span class="n">project_card_dictionary</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">apply_python_calculation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pycode</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;TransitNetwork&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Changes roadway network object by executing pycode.</span>

<span class="sd">        Args:</span>
<span class="sd">            pycode: python code which changes values in the roadway network object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">net</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">exec</span><span class="p">(</span><span class="n">pycode</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">net</span>

    <span class="k">def</span> <span class="nf">select_transit_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selection</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        combines multiple selections</span>

<span class="sd">        Args:</span>
<span class="sd">            selection : selection dictionary</span>

<span class="sd">        Returns: trip identifiers : list of GTFS trip IDs in the selection</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">trip_ids</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">selection</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;route&quot;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">route_dictionary</span> <span class="ow">in</span> <span class="n">selection</span><span class="p">[</span><span class="s2">&quot;route&quot;</span><span class="p">]:</span>
                <span class="n">trip_ids</span> <span class="o">=</span> <span class="n">trip_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_select_transit_features</span><span class="p">(</span><span class="n">route_dictionary</span><span class="p">)</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">trip_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_select_transit_features</span><span class="p">(</span><span class="n">selection</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">trip_ids</span>

    <span class="k">def</span> <span class="nf">_select_transit_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selection</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects transit features that satisfy selection criteria</span>

<span class="sd">        Args:</span>
<span class="sd">            selection : selection dictionary</span>

<span class="sd">        Returns: trip identifiers : list of GTFS trip IDs in the selection</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">trips</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feed</span><span class="o">.</span><span class="n">trips</span>
        <span class="n">routes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feed</span><span class="o">.</span><span class="n">routes</span>
        <span class="n">freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feed</span><span class="o">.</span><span class="n">frequencies</span>

        <span class="c1"># Turn selection&#39;s values into lists if they are not already</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">selection</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">selection</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">]:</span>
                <span class="n">selection</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">selection</span><span class="p">[</span><span class="n">key</span><span class="p">]]</span>

        <span class="c1"># Based on the key in selection, filter trips</span>
        <span class="k">if</span> <span class="s2">&quot;trip_id&quot;</span> <span class="ow">in</span> <span class="n">selection</span><span class="p">:</span>
            <span class="n">trips</span> <span class="o">=</span> <span class="n">trips</span><span class="p">[</span><span class="n">trips</span><span class="o">.</span><span class="n">trip_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">selection</span><span class="p">[</span><span class="s2">&quot;trip_id&quot;</span><span class="p">])]</span>

        <span class="k">elif</span> <span class="s2">&quot;route_id&quot;</span> <span class="ow">in</span> <span class="n">selection</span><span class="p">:</span>
            <span class="n">trips</span> <span class="o">=</span> <span class="n">trips</span><span class="p">[</span><span class="n">trips</span><span class="o">.</span><span class="n">route_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">selection</span><span class="p">[</span><span class="s2">&quot;route_id&quot;</span><span class="p">])]</span>

        <span class="k">elif</span> <span class="s2">&quot;route_short_name&quot;</span> <span class="ow">in</span> <span class="n">selection</span><span class="p">:</span>
            <span class="n">routes</span> <span class="o">=</span> <span class="n">routes</span><span class="p">[</span><span class="n">routes</span><span class="o">.</span><span class="n">route_short_name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">selection</span><span class="p">[</span><span class="s2">&quot;route_short_name&quot;</span><span class="p">])]</span>
            <span class="n">trips</span> <span class="o">=</span> <span class="n">trips</span><span class="p">[</span><span class="n">trips</span><span class="o">.</span><span class="n">route_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">routes</span><span class="p">[</span><span class="s2">&quot;route_id&quot;</span><span class="p">])]</span>

        <span class="k">elif</span> <span class="s2">&quot;route_long_name&quot;</span> <span class="ow">in</span> <span class="n">selection</span><span class="p">:</span>
            <span class="n">matches</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">sel</span> <span class="ow">in</span> <span class="n">selection</span><span class="p">[</span><span class="s2">&quot;route_long_name&quot;</span><span class="p">]:</span>
                <span class="k">for</span> <span class="n">route_long_name</span> <span class="ow">in</span> <span class="n">routes</span><span class="p">[</span><span class="s2">&quot;route_long_name&quot;</span><span class="p">]:</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">sel</span><span class="p">,</span> <span class="n">route_long_name</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">route_long_name</span><span class="p">)</span>

            <span class="n">routes</span> <span class="o">=</span> <span class="n">routes</span><span class="p">[</span><span class="n">routes</span><span class="o">.</span><span class="n">route_long_name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">matches</span><span class="p">)]</span>
            <span class="n">trips</span> <span class="o">=</span> <span class="n">trips</span><span class="p">[</span><span class="n">trips</span><span class="o">.</span><span class="n">route_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">routes</span><span class="p">[</span><span class="s2">&quot;route_id&quot;</span><span class="p">])]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Selection not supported </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">selection</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="k">raise</span> <span class="ne">ValueError</span>

        <span class="c1"># If a time key exists, filter trips using frequency table</span>
        <span class="k">if</span> <span class="n">selection</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">):</span>
            <span class="n">selection</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parse_time_spans_to_secs</span><span class="p">(</span><span class="n">selection</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">selection</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;start_time&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">selection</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;end_time&quot;</span><span class="p">):</span>
            <span class="n">selection</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parse_time_spans_to_secs</span><span class="p">(</span>
                <span class="p">[</span><span class="n">selection</span><span class="p">[</span><span class="s2">&quot;start_time&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">selection</span><span class="p">[</span><span class="s2">&quot;end_time&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
            <span class="p">)</span>
            <span class="c1"># Filter freq to trips in selection</span>
            <span class="n">freq</span> <span class="o">=</span> <span class="n">freq</span><span class="p">[</span><span class="n">freq</span><span class="o">.</span><span class="n">trip_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">trips</span><span class="p">[</span><span class="s2">&quot;trip_id&quot;</span><span class="p">])]</span>
            <span class="n">freq</span> <span class="o">=</span> <span class="n">freq</span><span class="p">[</span><span class="n">freq</span><span class="o">.</span><span class="n">start_time</span> <span class="o">==</span> <span class="n">selection</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">freq</span> <span class="o">=</span> <span class="n">freq</span><span class="p">[</span><span class="n">freq</span><span class="o">.</span><span class="n">end_time</span> <span class="o">==</span> <span class="n">selection</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>

            <span class="c1"># Filter trips table to those still in freq table</span>
            <span class="n">trips</span> <span class="o">=</span> <span class="n">trips</span><span class="p">[</span><span class="n">trips</span><span class="o">.</span><span class="n">trip_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="s2">&quot;trip_id&quot;</span><span class="p">])]</span>

        <span class="c1"># If any other key exists, filter routes or trips accordingly</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">selection</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="s2">&quot;trip_id&quot;</span><span class="p">,</span>
                <span class="s2">&quot;route_id&quot;</span><span class="p">,</span>
                <span class="s2">&quot;route_short_name&quot;</span><span class="p">,</span>
                <span class="s2">&quot;route_long_name&quot;</span><span class="p">,</span>
                <span class="s2">&quot;time&quot;</span><span class="p">,</span>
                <span class="s2">&quot;start_time&quot;</span><span class="p">,</span>
                <span class="s2">&quot;end_time&quot;</span><span class="p">,</span>
            <span class="p">]:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">trips</span><span class="p">:</span>
                    <span class="n">trips</span> <span class="o">=</span> <span class="n">trips</span><span class="p">[</span><span class="n">trips</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">selection</span><span class="p">[</span><span class="n">key</span><span class="p">])]</span>
                <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">routes</span><span class="p">:</span>
                    <span class="n">routes</span> <span class="o">=</span> <span class="n">routes</span><span class="p">[</span><span class="n">routes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">selection</span><span class="p">[</span><span class="n">key</span><span class="p">])]</span>
                    <span class="n">trips</span> <span class="o">=</span> <span class="n">trips</span><span class="p">[</span><span class="n">trips</span><span class="o">.</span><span class="n">route_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">routes</span><span class="p">[</span><span class="s2">&quot;route_id&quot;</span><span class="p">])]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Selection not supported </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span>

        <span class="c1"># Check that there is at least one trip in trips table or raise error</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">trips</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Selection returned zero trips&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span>

        <span class="c1"># Return pandas.Series of trip_ids</span>
        <span class="k">return</span> <span class="n">trips</span><span class="p">[</span><span class="s2">&quot;trip_id&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">select_transit_features_by_nodes</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">node_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">require_all</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects transit features that use any one of a list of node_ids</span>

<span class="sd">        Args:</span>
<span class="sd">            node_ids: list (generally coming from nx.shortest_path)</span>
<span class="sd">            require_all : bool if True, the returned trip_ids must traverse all of</span>
<span class="sd">              the nodes (default = False)</span>

<span class="sd">        Returns:</span>
<span class="sd">            trip identifiers  list of GTFS trip IDs in the selection</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If require_all, the returned trip_ids must traverse all of the nodes</span>
        <span class="c1"># Else, filter any shapes that use any one of the nodes in node_ids</span>
        <span class="k">if</span> <span class="n">require_all</span><span class="p">:</span>
            <span class="n">shape_ids</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">feed</span><span class="o">.</span><span class="n">shapes</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;shape_id&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">all</span><span class="p">(</span>
                        <span class="n">i</span> <span class="ow">in</span> <span class="n">x</span><span class="p">[</span><span class="n">TransitNetwork</span><span class="o">.</span><span class="n">SHAPES_FOREIGN_KEY</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">node_ids</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span><span class="o">.</span><span class="n">shape_id</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">shape_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feed</span><span class="o">.</span><span class="n">shapes</span><span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">feed</span><span class="o">.</span><span class="n">shapes</span><span class="p">[</span><span class="n">TransitNetwork</span><span class="o">.</span><span class="n">SHAPES_FOREIGN_KEY</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">node_ids</span><span class="p">)</span>
            <span class="p">]</span><span class="o">.</span><span class="n">shape_id</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>

        <span class="c1"># Return pandas.Series of trip_ids</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">feed</span><span class="o">.</span><span class="n">trips</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">feed</span><span class="o">.</span><span class="n">trips</span><span class="o">.</span><span class="n">shape_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">shape_ids</span><span class="p">)]</span><span class="o">.</span><span class="n">trip_id</span>

    <span class="k">def</span> <span class="nf">apply_transit_feature_change</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">trip_ids</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
        <span class="n">properties</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;TransitNetwork&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Changes the transit attributes for the selected features based on the</span>
<span class="sd">        project card information passed</span>

<span class="sd">        Args:</span>
<span class="sd">            net: transit network to manipulate</span>
<span class="sd">            trip_ids : pd.Series</span>
<span class="sd">                all trip_ids to apply change to</span>
<span class="sd">            properties : list of dictionaries</span>
<span class="sd">                transit properties to change</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">net</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">properties</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="s2">&quot;property&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;headway_secs&quot;</span><span class="p">]:</span>
                <span class="n">net</span> <span class="o">=</span> <span class="n">TransitNetwork</span><span class="o">.</span><span class="n">_apply_transit_feature_change_frequencies</span><span class="p">(</span>
                    <span class="n">net</span><span class="p">,</span> <span class="n">trip_ids</span><span class="p">,</span> <span class="n">i</span>
                <span class="p">)</span>

            <span class="k">elif</span> <span class="n">i</span><span class="p">[</span><span class="s2">&quot;property&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;routing&quot;</span><span class="p">]:</span>
                <span class="n">net</span> <span class="o">=</span> <span class="n">TransitNetwork</span><span class="o">.</span><span class="n">_apply_transit_feature_change_routing</span><span class="p">(</span>
                    <span class="n">net</span><span class="p">,</span> <span class="n">trip_ids</span><span class="p">,</span> <span class="n">i</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">net</span>

    <span class="k">def</span> <span class="nf">_apply_transit_feature_change_routing</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">trip_ids</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
        <span class="n">properties</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TransitNetwork</span><span class="p">:</span>

        <span class="n">net</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">shapes</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">feed</span><span class="o">.</span><span class="n">shapes</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">stop_times</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">feed</span><span class="o">.</span><span class="n">stop_times</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">stops</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">feed</span><span class="o">.</span><span class="n">stops</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># A negative sign in &quot;set&quot; indicates a traversed node without a stop</span>
        <span class="c1"># If any positive numbers, stops have changed</span>
        <span class="n">stops_change</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">properties</span><span class="p">[</span><span class="s2">&quot;set&quot;</span><span class="p">]):</span>
            <span class="c1"># Simplify &quot;set&quot; and &quot;existing&quot; to only stops</span>
            <span class="n">properties</span><span class="p">[</span><span class="s2">&quot;set_stops&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">properties</span><span class="p">[</span><span class="s2">&quot;set&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;existing&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">properties</span><span class="p">[</span><span class="s2">&quot;existing_stops&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">properties</span><span class="p">[</span><span class="s2">&quot;existing&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span>
                <span class="p">]</span>
            <span class="n">stops_change</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Convert ints to objects</span>
        <span class="n">properties</span><span class="p">[</span><span class="s2">&quot;set_shapes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">properties</span><span class="p">[</span><span class="s2">&quot;set&quot;</span><span class="p">]]</span>
        <span class="k">if</span> <span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;existing&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">properties</span><span class="p">[</span><span class="s2">&quot;existing_shapes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="nb">str</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">properties</span><span class="p">[</span><span class="s2">&quot;existing&quot;</span><span class="p">]</span>
            <span class="p">]</span>

        <span class="c1"># Replace shapes records</span>
        <span class="n">trips</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">feed</span><span class="o">.</span><span class="n">trips</span>  <span class="c1"># create pointer rather than a copy</span>
        <span class="n">shape_ids</span> <span class="o">=</span> <span class="n">trips</span><span class="p">[</span><span class="n">trips</span><span class="p">[</span><span class="s2">&quot;trip_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">trip_ids</span><span class="p">)]</span><span class="o">.</span><span class="n">shape_id</span>
        <span class="k">for</span> <span class="n">shape_id</span> <span class="ow">in</span> <span class="n">shape_ids</span><span class="p">:</span>
            <span class="c1"># Check if `shape_id` is used by trips that are not in</span>
            <span class="c1"># parameter `trip_ids`</span>
            <span class="n">trips_using_shape_id</span> <span class="o">=</span> <span class="n">trips</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">trips</span><span class="p">[</span><span class="s2">&quot;shape_id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">shape_id</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;trip_id&quot;</span><span class="p">]]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">trips_using_shape_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">trip_ids</span><span class="p">)[</span><span class="s2">&quot;trip_id&quot;</span><span class="p">]):</span>
                <span class="c1"># In this case, we need to create a new shape_id so as to leave</span>
                <span class="c1"># the trips not part of the query alone</span>
                <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;Trips that were not in your query selection use the &quot;</span>
                    <span class="s2">&quot;same `shape_id` as trips that are in your query. Only &quot;</span>
                    <span class="s2">&quot;the trips&#39; shape in your query will be changed.&quot;</span>
                <span class="p">)</span>
                <span class="n">old_shape_id</span> <span class="o">=</span> <span class="n">shape_id</span>
                <span class="n">shape_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">shape_id</span><span class="p">)</span> <span class="o">+</span> <span class="n">TransitNetwork</span><span class="o">.</span><span class="n">ID_SCALAR</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">shape_id</span> <span class="ow">in</span> <span class="n">shapes</span><span class="p">[</span><span class="s2">&quot;shape_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">():</span>
                    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Cannot create a unique new shape_id.&quot;</span><span class="p">)</span>
                <span class="n">dup_shape</span> <span class="o">=</span> <span class="n">shapes</span><span class="p">[</span><span class="n">shapes</span><span class="o">.</span><span class="n">shape_id</span> <span class="o">==</span> <span class="n">old_shape_id</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">dup_shape</span><span class="p">[</span><span class="s2">&quot;shape_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shape_id</span>
                <span class="n">shapes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">shapes</span><span class="p">,</span> <span class="n">dup_shape</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># Pop the rows that match shape_id</span>
            <span class="n">this_shape</span> <span class="o">=</span> <span class="n">shapes</span><span class="p">[</span><span class="n">shapes</span><span class="o">.</span><span class="n">shape_id</span> <span class="o">==</span> <span class="n">shape_id</span><span class="p">]</span>

            <span class="c1"># Make sure they are ordered by shape_pt_sequence</span>
            <span class="n">this_shape</span> <span class="o">=</span> <span class="n">this_shape</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;shape_pt_sequence&quot;</span><span class="p">])</span>

            <span class="c1"># Build a pd.DataFrame of new shape records</span>
            <span class="n">new_shape_rows</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;shape_id&quot;</span><span class="p">:</span> <span class="n">shape_id</span><span class="p">,</span>
                    <span class="s2">&quot;shape_pt_lat&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># FIXME Populate from self.road_net?</span>
                    <span class="s2">&quot;shape_pt_lon&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># FIXME</span>
                    <span class="s2">&quot;shape_osm_node_id&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># FIXME</span>
                    <span class="s2">&quot;shape_pt_sequence&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">TransitNetwork</span><span class="o">.</span><span class="n">SHAPES_FOREIGN_KEY</span><span class="p">:</span> <span class="n">properties</span><span class="p">[</span><span class="s2">&quot;set_shapes&quot;</span><span class="p">],</span>
                <span class="p">}</span>
            <span class="p">)</span>

            <span class="c1"># If &quot;existing&quot; is specified, replace only that segment</span>
            <span class="c1"># Else, replace the whole thing</span>
            <span class="k">if</span> <span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;existing&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># Match list</span>
                <span class="n">nodes</span> <span class="o">=</span> <span class="n">this_shape</span><span class="p">[</span><span class="n">TransitNetwork</span><span class="o">.</span><span class="n">SHAPES_FOREIGN_KEY</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="n">index_replacement_starts</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">i</span>
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="n">properties</span><span class="p">[</span><span class="s2">&quot;existing_shapes&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">index_replacement_ends</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">i</span>
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="n">properties</span><span class="p">[</span><span class="s2">&quot;existing_shapes&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">this_shape</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="n">this_shape</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">index_replacement_starts</span><span class="p">],</span>
                        <span class="n">new_shape_rows</span><span class="p">,</span>
                        <span class="n">this_shape</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">index_replacement_ends</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:],</span>
                    <span class="p">],</span>
                    <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">this_shape</span> <span class="o">=</span> <span class="n">new_shape_rows</span>

            <span class="c1"># Renumber shape_pt_sequence</span>
            <span class="n">this_shape</span><span class="p">[</span><span class="s2">&quot;shape_pt_sequence&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">this_shape</span><span class="p">))</span>

            <span class="c1"># Add rows back into shapes</span>
            <span class="n">shapes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                <span class="p">[</span><span class="n">shapes</span><span class="p">[</span><span class="n">shapes</span><span class="o">.</span><span class="n">shape_id</span> <span class="o">!=</span> <span class="n">shape_id</span><span class="p">],</span> <span class="n">this_shape</span><span class="p">],</span>
                <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># Replace stop_times and stops records (if required)</span>
        <span class="k">if</span> <span class="n">stops_change</span><span class="p">:</span>
            <span class="c1"># If node IDs in properties[&quot;set_stops&quot;] are not already</span>
            <span class="c1"># in stops.txt, create a new stop_id for them in stops</span>
            <span class="n">existing_fk_ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">stops</span><span class="p">[</span><span class="n">TransitNetwork</span><span class="o">.</span><span class="n">STOPS_FOREIGN_KEY</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
            <span class="n">nodes_df</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">road_net</span><span class="o">.</span><span class="n">nodes_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                <span class="p">:,</span> <span class="p">[</span><span class="n">TransitNetwork</span><span class="o">.</span><span class="n">STOPS_FOREIGN_KEY</span><span class="p">,</span> <span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">]</span>
            <span class="p">]</span>
            <span class="k">for</span> <span class="n">fk_i</span> <span class="ow">in</span> <span class="n">properties</span><span class="p">[</span><span class="s2">&quot;set_stops&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">fk_i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">existing_fk_ids</span><span class="p">:</span>
                    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="s2">&quot;Creating a new stop in stops.txt for node ID: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fk_i</span><span class="p">)</span>
                    <span class="p">)</span>
                    <span class="c1"># Add new row to stops</span>
                    <span class="n">new_stop_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">fk_i</span><span class="p">)</span> <span class="o">+</span> <span class="n">TransitNetwork</span><span class="o">.</span><span class="n">ID_SCALAR</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">new_stop_id</span> <span class="ow">in</span> <span class="n">stops</span><span class="p">[</span><span class="s2">&quot;stop_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">():</span>
                        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Cannot create a unique new stop_id.&quot;</span><span class="p">)</span>
                    <span class="n">stops</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                        <span class="nb">len</span><span class="p">(</span><span class="n">stops</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="p">[</span>
                            <span class="s2">&quot;stop_id&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;stop_lat&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;stop_lon&quot;</span><span class="p">,</span>
                            <span class="n">TransitNetwork</span><span class="o">.</span><span class="n">STOPS_FOREIGN_KEY</span><span class="p">,</span>
                        <span class="p">],</span>
                    <span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">new_stop_id</span><span class="p">,</span>
                        <span class="n">nodes_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                            <span class="n">nodes_df</span><span class="p">[</span><span class="n">TransitNetwork</span><span class="o">.</span><span class="n">STOPS_FOREIGN_KEY</span><span class="p">]</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">fk_i</span><span class="p">),</span> <span class="s2">&quot;Y&quot;</span>
                        <span class="p">],</span>
                        <span class="n">nodes_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                            <span class="n">nodes_df</span><span class="p">[</span><span class="n">TransitNetwork</span><span class="o">.</span><span class="n">STOPS_FOREIGN_KEY</span><span class="p">]</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">fk_i</span><span class="p">),</span> <span class="s2">&quot;X&quot;</span>
                        <span class="p">],</span>
                        <span class="n">fk_i</span><span class="p">,</span>
                    <span class="p">]</span>

            <span class="c1"># Loop through all the trip_ids</span>
            <span class="k">for</span> <span class="n">trip_id</span> <span class="ow">in</span> <span class="n">trip_ids</span><span class="p">:</span>
                <span class="c1"># Pop the rows that match trip_id</span>
                <span class="n">this_stoptime</span> <span class="o">=</span> <span class="n">stop_times</span><span class="p">[</span><span class="n">stop_times</span><span class="o">.</span><span class="n">trip_id</span> <span class="o">==</span> <span class="n">trip_id</span><span class="p">]</span>

                <span class="c1"># Merge on node IDs using stop_id (one node ID per stop_id)</span>
                <span class="n">this_stoptime</span> <span class="o">=</span> <span class="n">this_stoptime</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
                    <span class="n">stops</span><span class="p">[[</span><span class="s2">&quot;stop_id&quot;</span><span class="p">,</span> <span class="n">TransitNetwork</span><span class="o">.</span><span class="n">STOPS_FOREIGN_KEY</span><span class="p">]],</span>
                    <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
                    <span class="n">on</span><span class="o">=</span><span class="s2">&quot;stop_id&quot;</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="c1"># Make sure the stop_times are ordered by stop_sequence</span>
                <span class="n">this_stoptime</span> <span class="o">=</span> <span class="n">this_stoptime</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;stop_sequence&quot;</span><span class="p">])</span>

                <span class="c1"># Build a pd.DataFrame of new shape records from properties</span>
                <span class="n">new_stoptime_rows</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;trip_id&quot;</span><span class="p">:</span> <span class="n">trip_id</span><span class="p">,</span>
                        <span class="s2">&quot;arrival_time&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="s2">&quot;departure_time&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="s2">&quot;pickup_type&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="s2">&quot;drop_off_type&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="s2">&quot;stop_distance&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="s2">&quot;timepoint&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="s2">&quot;stop_is_skipped&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="n">TransitNetwork</span><span class="o">.</span><span class="n">STOPS_FOREIGN_KEY</span><span class="p">:</span> <span class="n">properties</span><span class="p">[</span><span class="s2">&quot;set_stops&quot;</span><span class="p">],</span>
                    <span class="p">}</span>
                <span class="p">)</span>

                <span class="c1"># Merge on stop_id using node IDs (many stop_id per node ID)</span>
                <span class="n">new_stoptime_rows</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">new_stoptime_rows</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
                        <span class="n">stops</span><span class="p">[[</span><span class="s2">&quot;stop_id&quot;</span><span class="p">,</span> <span class="n">TransitNetwork</span><span class="o">.</span><span class="n">STOPS_FOREIGN_KEY</span><span class="p">]],</span>
                        <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
                        <span class="n">on</span><span class="o">=</span><span class="n">TransitNetwork</span><span class="o">.</span><span class="n">STOPS_FOREIGN_KEY</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">TransitNetwork</span><span class="o">.</span><span class="n">STOPS_FOREIGN_KEY</span><span class="p">])</span>
                    <span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="p">)</span>  <span class="c1"># pick first</span>

                <span class="c1"># If &quot;existing&quot; is specified, replace only that segment</span>
                <span class="c1"># Else, replace the whole thing</span>
                <span class="k">if</span> <span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;existing&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1"># Match list (remember stops are passed in with node IDs)</span>
                    <span class="n">nodes</span> <span class="o">=</span> <span class="n">this_stoptime</span><span class="p">[</span><span class="n">TransitNetwork</span><span class="o">.</span><span class="n">STOPS_FOREIGN_KEY</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                    <span class="n">index_replacement_starts</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">index</span><span class="p">(</span>
                        <span class="n">properties</span><span class="p">[</span><span class="s2">&quot;existing_stops&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="p">)</span>
                    <span class="n">index_replacement_ends</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">index</span><span class="p">(</span>
                        <span class="n">properties</span><span class="p">[</span><span class="s2">&quot;existing_stops&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="p">)</span>
                    <span class="n">this_stoptime</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                        <span class="p">[</span>
                            <span class="n">this_stoptime</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">index_replacement_starts</span><span class="p">],</span>
                            <span class="n">new_stoptime_rows</span><span class="p">,</span>
                            <span class="n">this_stoptime</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">index_replacement_ends</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:],</span>
                        <span class="p">],</span>
                        <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">this_stoptime</span> <span class="o">=</span> <span class="n">new_stoptime_rows</span>

                <span class="c1"># Remove node ID</span>
                <span class="k">del</span> <span class="n">this_stoptime</span><span class="p">[</span><span class="n">TransitNetwork</span><span class="o">.</span><span class="n">STOPS_FOREIGN_KEY</span><span class="p">]</span>

                <span class="c1"># Renumber stop_sequence</span>
                <span class="n">this_stoptime</span><span class="p">[</span><span class="s2">&quot;stop_sequence&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">this_stoptime</span><span class="p">))</span>

                <span class="c1"># Add rows back into stoptime</span>
                <span class="n">stop_times</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">stop_times</span><span class="p">[</span><span class="n">stop_times</span><span class="o">.</span><span class="n">trip_id</span> <span class="o">!=</span> <span class="n">trip_id</span><span class="p">],</span> <span class="n">this_stoptime</span><span class="p">],</span>
                    <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="n">net</span><span class="o">.</span><span class="n">feed</span><span class="o">.</span><span class="n">shapes</span> <span class="o">=</span> <span class="n">shapes</span>
            <span class="n">net</span><span class="o">.</span><span class="n">feed</span><span class="o">.</span><span class="n">stops</span> <span class="o">=</span> <span class="n">stops</span>
            <span class="n">net</span><span class="o">.</span><span class="n">feed</span><span class="o">.</span><span class="n">stop_times</span> <span class="o">=</span> <span class="n">stop_times</span>
        <span class="k">return</span> <span class="n">net</span>

    <span class="k">def</span> <span class="nf">_apply_transit_feature_change_frequencies</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">trip_ids</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">properties</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TransitNetwork</span><span class="p">:</span>

        <span class="n">net</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">freq</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">feed</span><span class="o">.</span><span class="n">frequencies</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># Grab only those records matching trip_ids (aka selection)</span>
        <span class="n">freq</span> <span class="o">=</span> <span class="n">freq</span><span class="p">[</span><span class="n">freq</span><span class="o">.</span><span class="n">trip_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">trip_ids</span><span class="p">)]</span>

        <span class="c1"># Check all `existing` properties if given</span>
        <span class="k">if</span> <span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;existing&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">freq</span><span class="o">.</span><span class="n">headway_secs</span> <span class="o">==</span> <span class="n">properties</span><span class="p">[</span><span class="s2">&quot;existing&quot;</span><span class="p">]):</span>
                <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="s2">&quot;Existing does not match for at least &quot;</span>
                    <span class="s2">&quot;1 trip in:</span><span class="se">\n</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">trip_ids</span><span class="o">.</span><span class="n">to_string</span><span class="p">())</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="ne">ValueError</span>

        <span class="c1"># Calculate build value</span>
        <span class="k">if</span> <span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;set&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">build_value</span> <span class="o">=</span> <span class="n">properties</span><span class="p">[</span><span class="s2">&quot;set&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">build_value</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">properties</span><span class="p">[</span><span class="s2">&quot;change&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">freq</span><span class="o">.</span><span class="n">headway_secs</span><span class="p">]</span>

        <span class="n">q</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">feed</span><span class="o">.</span><span class="n">frequencies</span><span class="o">.</span><span class="n">trip_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="s2">&quot;trip_id&quot;</span><span class="p">])</span>

        <span class="n">net</span><span class="o">.</span><span class="n">feed</span><span class="o">.</span><span class="n">frequencies</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">q</span><span class="p">,</span> <span class="n">properties</span><span class="p">[</span><span class="s2">&quot;property&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">build_value</span>
        <span class="k">return</span> <span class="n">net</span>

    <span class="k">def</span> <span class="nf">apply_transit_managed_lane</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">trip_ids</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
        <span class="n">node_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TransitNetwork</span><span class="p">:</span>

        <span class="c1"># Traversed nodes without a stop should be negative integers</span>
        <span class="n">net</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">all_stops</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">feed</span><span class="o">.</span><span class="n">stops</span><span class="p">[</span><span class="n">TransitNetwork</span><span class="o">.</span><span class="n">STOPS_FOREIGN_KEY</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">node_ids</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">in</span> <span class="n">all_stops</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">node_ids</span><span class="p">]</span>

        <span class="n">TransitNetwork</span><span class="o">.</span><span class="n">_apply_transit_feature_change_routing</span><span class="p">(</span>
            <span class="n">net</span><span class="p">,</span>
            <span class="n">trip_ids</span><span class="o">=</span><span class="n">trip_ids</span><span class="p">,</span>
            <span class="n">properties</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;existing&quot;</span><span class="p">:</span> <span class="n">node_ids</span><span class="p">,</span>
                <span class="s2">&quot;set&quot;</span><span class="p">:</span> <span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">get_managed_lane_node_ids</span><span class="p">(</span><span class="n">node_ids</span><span class="p">),</span>
            <span class="p">},</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">net</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h4 id="network_wrangler.transitnetwork.TransitNetwork.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">feed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#network_wrangler.transitnetwork.TransitNetwork.__init__" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Constructor</p>
<p>.. todo:: Make graph a reference to associated RoadwayNetwork&rsquo;s graph, not its own thing.</p>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/transitnetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feed</span><span class="p">:</span> <span class="n">DotDict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Constructor</span>

<span class="sd">    .. todo:: Make graph a reference to associated RoadwayNetwork&#39;s graph, not its own thing.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">feed</span><span class="p">:</span> <span class="n">DotDict</span> <span class="o">=</span> <span class="n">feed</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">:</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span> <span class="o">=</span> <span class="n">config</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">road_net</span><span class="p">:</span> <span class="n">RoadwayNetwork</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="p">:</span> <span class="n">nx</span><span class="o">.</span><span class="n">MultiDiGraph</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">feed_path</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">validated_frequencies</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">validated_road_network_consistency</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_frequencies</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Transit lines with non-positive frequencies exist in the network&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.transitnetwork.TransitNetwork.apply" class="doc doc-heading">
<code class="highlight language-python"><span class="n">apply</span><span class="p">(</span><span class="n">project_card_dictionary</span><span class="p">)</span></code>

<a href="#network_wrangler.transitnetwork.TransitNetwork.apply" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Wrapper method to apply a project to a transit network.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>project_card_dictionary</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>dict
a dictionary of the project card object</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/transitnetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_card_dictionary</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wrapper method to apply a project to a transit network.</span>

<span class="sd">    Args:</span>
<span class="sd">        project_card_dictionary: dict</span>
<span class="sd">            a dictionary of the project card object</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="s2">&quot;Applying Project to Transit Network: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">project_card_dictionary</span><span class="p">[</span><span class="s2">&quot;project&quot;</span><span class="p">]</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_apply_individual_change</span><span class="p">(</span><span class="n">project_dictionary</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">project_dictionary</span><span class="p">[</span><span class="s2">&quot;category&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="o">==</span> <span class="s2">&quot;transit service property change&quot;</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">apply_transit_feature_change</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">select_transit_features</span><span class="p">(</span><span class="n">project_dictionary</span><span class="p">[</span><span class="s2">&quot;facility&quot;</span><span class="p">]),</span>
                <span class="n">project_dictionary</span><span class="p">[</span><span class="s2">&quot;properties&quot;</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">project_dictionary</span><span class="p">[</span><span class="s2">&quot;category&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;parallel managed lanes&quot;</span><span class="p">:</span>
            <span class="c1"># Grab the list of nodes in the facility from road_net</span>
            <span class="c1"># It should be cached because managed lane projects are</span>
            <span class="c1"># processed by RoadwayNetwork first via</span>
            <span class="c1"># Scenario.apply_all_projects</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">managed_lane_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_net</span><span class="o">.</span><span class="n">selections</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">road_net</span><span class="o">.</span><span class="n">build_selection_key</span><span class="p">(</span>
                        <span class="n">project_dictionary</span><span class="p">[</span><span class="s2">&quot;facility&quot;</span><span class="p">]</span>
                    <span class="p">)</span>
                <span class="p">)[</span><span class="s2">&quot;route&quot;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="s2">&quot;RoadwayNetwork not set yet, see TransitNetwork.set_roadnet()&quot;</span>
                <span class="p">)</span>

            <span class="c1"># Reroute any transit using these nodes</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">apply_transit_managed_lane</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">select_transit_features_by_nodes</span><span class="p">(</span><span class="n">managed_lane_nodes</span><span class="p">),</span>
                <span class="n">managed_lane_nodes</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">project_dictionary</span><span class="p">[</span><span class="s2">&quot;category&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;add transit&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">apply_python_calculation</span><span class="p">(</span><span class="n">project_dictionary</span><span class="p">[</span><span class="s2">&quot;pycode&quot;</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">project_dictionary</span><span class="p">[</span><span class="s2">&quot;category&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;roadway deletion&quot;</span><span class="p">:</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Roadway Deletion not yet implemented in Transit; ignoring&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> not implemented yet in TransitNetwork; can&#39;t apply.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">project_dictionary</span><span class="p">[</span><span class="s2">&quot;category&quot;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">project_card_dictionary</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;changes&quot;</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">project_dictionary</span> <span class="ow">in</span> <span class="n">project_card_dictionary</span><span class="p">[</span><span class="s2">&quot;changes&quot;</span><span class="p">]:</span>
            <span class="n">_apply_individual_change</span><span class="p">(</span><span class="n">project_dictionary</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_apply_individual_change</span><span class="p">(</span><span class="n">project_card_dictionary</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.transitnetwork.TransitNetwork.apply_python_calculation" class="doc doc-heading">
<code class="highlight language-python"><span class="n">apply_python_calculation</span><span class="p">(</span><span class="n">pycode</span><span class="p">)</span></code>

<a href="#network_wrangler.transitnetwork.TransitNetwork.apply_python_calculation" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Changes roadway network object by executing pycode.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>pycode</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>python code which changes values in the roadway network object</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/transitnetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">apply_python_calculation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pycode</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;TransitNetwork&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Changes roadway network object by executing pycode.</span>

<span class="sd">    Args:</span>
<span class="sd">        pycode: python code which changes values in the roadway network object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">net</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">exec</span><span class="p">(</span><span class="n">pycode</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">net</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.transitnetwork.TransitNetwork.apply_transit_feature_change" class="doc doc-heading">
<code class="highlight language-python"><span class="n">apply_transit_feature_change</span><span class="p">(</span><span class="n">trip_ids</span><span class="p">,</span> <span class="n">properties</span><span class="p">)</span></code>

<a href="#network_wrangler.transitnetwork.TransitNetwork.apply_transit_feature_change" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Changes the transit attributes for the selected features based on the
project card information passed</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>net</code></td>
          <td>
          </td>
          <td><p>transit network to manipulate</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>trip_ids</code></td>
          <td>
          </td>
          <td><p>pd.Series
all trip_ids to apply change to</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>properties</code></td>
          <td>
          </td>
          <td><p>list of dictionaries
transit properties to change</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><a class="autorefs autorefs-internal" title="network_wrangler.transitnetwork.TransitNetwork" href="#network_wrangler.TransitNetwork">TransitNetwork</a></code>
          </td>
          <td><p>None</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/transitnetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">apply_transit_feature_change</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">trip_ids</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
    <span class="n">properties</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;TransitNetwork&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Changes the transit attributes for the selected features based on the</span>
<span class="sd">    project card information passed</span>

<span class="sd">    Args:</span>
<span class="sd">        net: transit network to manipulate</span>
<span class="sd">        trip_ids : pd.Series</span>
<span class="sd">            all trip_ids to apply change to</span>
<span class="sd">        properties : list of dictionaries</span>
<span class="sd">            transit properties to change</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">net</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">properties</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="s2">&quot;property&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;headway_secs&quot;</span><span class="p">]:</span>
            <span class="n">net</span> <span class="o">=</span> <span class="n">TransitNetwork</span><span class="o">.</span><span class="n">_apply_transit_feature_change_frequencies</span><span class="p">(</span>
                <span class="n">net</span><span class="p">,</span> <span class="n">trip_ids</span><span class="p">,</span> <span class="n">i</span>
            <span class="p">)</span>

        <span class="k">elif</span> <span class="n">i</span><span class="p">[</span><span class="s2">&quot;property&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;routing&quot;</span><span class="p">]:</span>
            <span class="n">net</span> <span class="o">=</span> <span class="n">TransitNetwork</span><span class="o">.</span><span class="n">_apply_transit_feature_change_routing</span><span class="p">(</span>
                <span class="n">net</span><span class="p">,</span> <span class="n">trip_ids</span><span class="p">,</span> <span class="n">i</span>
            <span class="p">)</span>
    <span class="k">return</span> <span class="n">net</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.transitnetwork.TransitNetwork.empty" class="doc doc-heading">
<code class="highlight language-python"><span class="n">empty</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#network_wrangler.transitnetwork.TransitNetwork.empty" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Create an empty transit network instance using the default config.</p>
<p>.. todo:: fill out this method</p>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/transitnetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">empty</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">TransitNetwork</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create an empty transit network instance using the default config.</span>

<span class="sd">    .. todo:: fill out this method</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO</span>

    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;TransitNetwork.empty is not implemented.&quot;</span>
    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.transitnetwork.TransitNetwork.read" class="doc doc-heading">
<code class="highlight language-python"><span class="n">read</span><span class="p">(</span><span class="n">feed_path</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#network_wrangler.transitnetwork.TransitNetwork.read" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Read GTFS feed from folder and TransitNetwork object</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>feed_path</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>where to read transit network files from</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/transitnetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">feed_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TransitNetwork</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read GTFS feed from folder and TransitNetwork object</span>

<span class="sd">    Args:</span>
<span class="sd">        feed_path: where to read transit network files from</span>

<span class="sd">    Returns: a TransitNetwork object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">default_config</span><span class="p">()</span>
    <span class="n">feed</span> <span class="o">=</span> <span class="n">ptg</span><span class="o">.</span><span class="n">load_feed</span><span class="p">(</span><span class="n">feed_path</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>
    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Read in transit feed from: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">feed_path</span><span class="p">))</span>

    <span class="n">updated_config</span> <span class="o">=</span> <span class="n">TransitNetwork</span><span class="o">.</span><span class="n">validate_feed</span><span class="p">(</span><span class="n">feed</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>

    <span class="c1"># Read in each feed so we can write over them</span>
    <span class="n">editable_feed</span> <span class="o">=</span> <span class="n">DotDict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">updated_config</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="c1"># Load (initiate Partridge&#39;s lazy load)</span>
        <span class="n">editable_feed</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">feed</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

    <span class="n">transit_network</span> <span class="o">=</span> <span class="n">TransitNetwork</span><span class="p">(</span><span class="n">feed</span><span class="o">=</span><span class="n">editable_feed</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">updated_config</span><span class="p">)</span>
    <span class="n">transit_network</span><span class="o">.</span><span class="n">feed_path</span> <span class="o">=</span> <span class="n">feed_path</span>
    <span class="k">return</span> <span class="n">transit_network</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.transitnetwork.TransitNetwork.route_ids_in_routestxt" class="doc doc-heading">
<code class="highlight language-python"><span class="n">route_ids_in_routestxt</span><span class="p">(</span><span class="n">feed</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#network_wrangler.transitnetwork.TransitNetwork.route_ids_in_routestxt" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Wherever route_id occurs, make sure it is in routes.txt</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>feed</code></td>
          <td>
                <code><span title="network_wrangler.transitnetwork.DotDict">DotDict</span></code>
          </td>
          <td><p>partridge feed object</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>bool</code>
          </td>
          <td><p>Boolean indicating if feed is okay.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/transitnetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">route_ids_in_routestxt</span><span class="p">(</span><span class="n">feed</span><span class="p">:</span> <span class="n">DotDict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wherever route_id occurs, make sure it is in routes.txt</span>

<span class="sd">    Args:</span>
<span class="sd">        feed: partridge feed object</span>

<span class="sd">    Returns:</span>
<span class="sd">        Boolean indicating if feed is okay.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">route_ids_routestxt</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">feed</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">route_id</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
    <span class="n">route_ids_referenced</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">feed</span><span class="o">.</span><span class="n">trips</span><span class="o">.</span><span class="n">route_id</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

    <span class="n">missing_routes</span> <span class="o">=</span> <span class="n">route_ids_referenced</span> <span class="o">-</span> <span class="n">route_ids_routestxt</span>

    <span class="k">if</span> <span class="n">missing_routes</span><span class="p">:</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s2">&quot;The following route_ids are referenced but missing from routes.txt: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="nb">list</span><span class="p">(</span><span class="n">missing_routes</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.transitnetwork.TransitNetwork.select_transit_features" class="doc doc-heading">
<code class="highlight language-python"><span class="n">select_transit_features</span><span class="p">(</span><span class="n">selection</span><span class="p">)</span></code>

<a href="#network_wrangler.transitnetwork.TransitNetwork.select_transit_features" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>combines multiple selections</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>selection</code></td>
          <td>
          </td>
          <td><p>selection dictionary</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/transitnetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">select_transit_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selection</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    combines multiple selections</span>

<span class="sd">    Args:</span>
<span class="sd">        selection : selection dictionary</span>

<span class="sd">    Returns: trip identifiers : list of GTFS trip IDs in the selection</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">trip_ids</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">selection</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;route&quot;</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">route_dictionary</span> <span class="ow">in</span> <span class="n">selection</span><span class="p">[</span><span class="s2">&quot;route&quot;</span><span class="p">]:</span>
            <span class="n">trip_ids</span> <span class="o">=</span> <span class="n">trip_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_select_transit_features</span><span class="p">(</span><span class="n">route_dictionary</span><span class="p">)</span>
            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">trip_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_select_transit_features</span><span class="p">(</span><span class="n">selection</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">trip_ids</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.transitnetwork.TransitNetwork.select_transit_features_by_nodes" class="doc doc-heading">
<code class="highlight language-python"><span class="n">select_transit_features_by_nodes</span><span class="p">(</span><span class="n">node_ids</span><span class="p">,</span> <span class="n">require_all</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#network_wrangler.transitnetwork.TransitNetwork.select_transit_features_by_nodes" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Selects transit features that use any one of a list of node_ids</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>node_ids</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>list (generally coming from nx.shortest_path)</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>require_all</code></td>
          <td>
          </td>
          <td><p>bool if True, the returned trip_ids must traverse all of
the nodes (default = False)</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="pandas">pd</span>.<span title="pandas.Series">Series</span></code>
          </td>
          <td><p>trip identifiers  list of GTFS trip IDs in the selection</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/transitnetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">select_transit_features_by_nodes</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">node_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">require_all</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Selects transit features that use any one of a list of node_ids</span>

<span class="sd">    Args:</span>
<span class="sd">        node_ids: list (generally coming from nx.shortest_path)</span>
<span class="sd">        require_all : bool if True, the returned trip_ids must traverse all of</span>
<span class="sd">          the nodes (default = False)</span>

<span class="sd">    Returns:</span>
<span class="sd">        trip identifiers  list of GTFS trip IDs in the selection</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># If require_all, the returned trip_ids must traverse all of the nodes</span>
    <span class="c1"># Else, filter any shapes that use any one of the nodes in node_ids</span>
    <span class="k">if</span> <span class="n">require_all</span><span class="p">:</span>
        <span class="n">shape_ids</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">feed</span><span class="o">.</span><span class="n">shapes</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;shape_id&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">all</span><span class="p">(</span>
                    <span class="n">i</span> <span class="ow">in</span> <span class="n">x</span><span class="p">[</span><span class="n">TransitNetwork</span><span class="o">.</span><span class="n">SHAPES_FOREIGN_KEY</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">node_ids</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">shape_id</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">shape_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feed</span><span class="o">.</span><span class="n">shapes</span><span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">feed</span><span class="o">.</span><span class="n">shapes</span><span class="p">[</span><span class="n">TransitNetwork</span><span class="o">.</span><span class="n">SHAPES_FOREIGN_KEY</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">node_ids</span><span class="p">)</span>
        <span class="p">]</span><span class="o">.</span><span class="n">shape_id</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>

    <span class="c1"># Return pandas.Series of trip_ids</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">feed</span><span class="o">.</span><span class="n">trips</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">feed</span><span class="o">.</span><span class="n">trips</span><span class="o">.</span><span class="n">shape_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">shape_ids</span><span class="p">)]</span><span class="o">.</span><span class="n">trip_id</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.transitnetwork.TransitNetwork.shape_ids_in_shapestxt" class="doc doc-heading">
<code class="highlight language-python"><span class="n">shape_ids_in_shapestxt</span><span class="p">(</span><span class="n">feed</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#network_wrangler.transitnetwork.TransitNetwork.shape_ids_in_shapestxt" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Wherever shape_id occurs, make sure it is in shapes.txt</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>feed</code></td>
          <td>
                <code><span title="network_wrangler.transitnetwork.DotDict">DotDict</span></code>
          </td>
          <td><p>partridge feed object</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>bool</code>
          </td>
          <td><p>Boolean indicating if feed is okay.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/transitnetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">shape_ids_in_shapestxt</span><span class="p">(</span><span class="n">feed</span><span class="p">:</span> <span class="n">DotDict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wherever shape_id occurs, make sure it is in shapes.txt</span>

<span class="sd">    Args:</span>
<span class="sd">        feed: partridge feed object</span>

<span class="sd">    Returns:</span>
<span class="sd">        Boolean indicating if feed is okay.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">shape_ids_shapestxt</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">feed</span><span class="o">.</span><span class="n">shapes</span><span class="o">.</span><span class="n">shape_id</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
    <span class="n">shape_ids_referenced</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">feed</span><span class="o">.</span><span class="n">trips</span><span class="o">.</span><span class="n">shape_id</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

    <span class="n">missing_shapes</span> <span class="o">=</span> <span class="n">shape_ids_referenced</span> <span class="o">-</span> <span class="n">shape_ids_shapestxt</span>

    <span class="k">if</span> <span class="n">missing_shapes</span><span class="p">:</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s2">&quot;The following shape_ids from trips.txt are missing from shapes.txt: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="nb">list</span><span class="p">(</span><span class="n">missing_shapes</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.transitnetwork.TransitNetwork.stop_ids_in_stopstxt" class="doc doc-heading">
<code class="highlight language-python"><span class="n">stop_ids_in_stopstxt</span><span class="p">(</span><span class="n">feed</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#network_wrangler.transitnetwork.TransitNetwork.stop_ids_in_stopstxt" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Wherever stop_id occurs, make sure it is in stops.txt</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>feed</code></td>
          <td>
                <code><span title="network_wrangler.transitnetwork.DotDict">DotDict</span></code>
          </td>
          <td><p>partridge feed object</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>bool</code>
          </td>
          <td><p>Boolean indicating if feed is okay.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/transitnetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">stop_ids_in_stopstxt</span><span class="p">(</span><span class="n">feed</span><span class="p">:</span> <span class="n">DotDict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wherever stop_id occurs, make sure it is in stops.txt</span>

<span class="sd">    Args:</span>
<span class="sd">        feed: partridge feed object</span>

<span class="sd">    Returns:</span>
<span class="sd">        Boolean indicating if feed is okay.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">stop_ids_stopstxt</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">feed</span><span class="o">.</span><span class="n">stops</span><span class="o">.</span><span class="n">stop_id</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
    <span class="n">stop_ids_referenced</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># STOP_TIMES</span>
    <span class="n">stop_ids_referenced</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">feed</span><span class="o">.</span><span class="n">stop_times</span><span class="o">.</span><span class="n">stop_id</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
    <span class="n">stop_ids_referenced</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">feed</span><span class="o">.</span><span class="n">stops</span><span class="o">.</span><span class="n">parent_station</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

    <span class="c1"># TRANSFERS</span>
    <span class="k">if</span> <span class="n">feed</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;transfers.txt&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">stop_ids_referenced</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">feed</span><span class="o">.</span><span class="n">transfers</span><span class="o">.</span><span class="n">from_stop_id</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
        <span class="n">stop_ids_referenced</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">feed</span><span class="o">.</span><span class="n">transfers</span><span class="o">.</span><span class="n">to_stop_id</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

    <span class="c1"># PATHWAYS</span>
    <span class="k">if</span> <span class="n">feed</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pathways.txt&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">stop_ids_referenced</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">feed</span><span class="o">.</span><span class="n">pathways</span><span class="o">.</span><span class="n">from_stop_id</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
        <span class="n">stop_ids_referenced</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">feed</span><span class="o">.</span><span class="n">pathways</span><span class="o">.</span><span class="n">to_stop_id</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

    <span class="n">stop_ids_referenced</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">stop_ids_referenced</span><span class="p">)</span>

    <span class="n">missing_stops</span> <span class="o">=</span> <span class="n">stop_ids_referenced</span> <span class="o">-</span> <span class="n">stop_ids_stopstxt</span>

    <span class="k">if</span> <span class="n">missing_stops</span><span class="p">:</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s2">&quot;The following stop_ids from are referenced but missing from stops.txt: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="nb">list</span><span class="p">(</span><span class="n">missing_stops</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.transitnetwork.TransitNetwork.transit_net_to_gdf" class="doc doc-heading">
<code class="highlight language-python"><span class="n">transit_net_to_gdf</span><span class="p">(</span><span class="n">transit</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#network_wrangler.transitnetwork.TransitNetwork.transit_net_to_gdf" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Returns a geodataframe given a TransitNetwork or a valid Shapes DataFrame.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>transit</code></td>
          <td>
                <code><span title="typing.Union">Union</span>(<a class="autorefs autorefs-internal" title="network_wrangler.transitnetwork.TransitNetwork" href="#network_wrangler.TransitNetwork">TransitNetwork</a>, <span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span>)</code>
          </td>
          <td><p>either a TransitNetwork or a Shapes GeoDataFrame</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>
      <p>.. todo:: Make more sophisticated.</p>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/transitnetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">transit_net_to_gdf</span><span class="p">(</span><span class="n">transit</span><span class="p">:</span> <span class="n">Union</span><span class="p">(</span><span class="s2">&quot;TransitNetwork&quot;</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a geodataframe given a TransitNetwork or a valid Shapes DataFrame.</span>

<span class="sd">    Args:</span>
<span class="sd">        transit: either a TransitNetwork or a Shapes GeoDataFrame</span>

<span class="sd">    .. todo:: Make more sophisticated.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">partridge</span> <span class="kn">import</span> <span class="n">geo</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">transit</span><span class="p">)</span> <span class="ow">is</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="n">shapes</span> <span class="o">=</span> <span class="n">transit</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">shapes</span> <span class="o">=</span> <span class="n">transit</span><span class="o">.</span><span class="n">feed</span><span class="o">.</span><span class="n">shapes</span>

    <span class="n">transit_gdf</span> <span class="o">=</span> <span class="n">geo</span><span class="o">.</span><span class="n">build_shapes</span><span class="p">(</span><span class="n">shapes</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">transit_gdf</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.transitnetwork.TransitNetwork.trip_ids_in_tripstxt" class="doc doc-heading">
<code class="highlight language-python"><span class="n">trip_ids_in_tripstxt</span><span class="p">(</span><span class="n">feed</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#network_wrangler.transitnetwork.TransitNetwork.trip_ids_in_tripstxt" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Wherever trip_id occurs, make sure it is in trips.txt</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>feed</code></td>
          <td>
                <code><span title="network_wrangler.transitnetwork.DotDict">DotDict</span></code>
          </td>
          <td><p>partridge feed object</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>bool</code>
          </td>
          <td><p>Boolean indicating if feed is okay.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/transitnetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">trip_ids_in_tripstxt</span><span class="p">(</span><span class="n">feed</span><span class="p">:</span> <span class="n">DotDict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wherever trip_id occurs, make sure it is in trips.txt</span>

<span class="sd">    Args:</span>
<span class="sd">        feed: partridge feed object</span>

<span class="sd">    Returns:</span>
<span class="sd">        Boolean indicating if feed is okay.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">trip_ids_tripstxt</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">feed</span><span class="o">.</span><span class="n">trips</span><span class="o">.</span><span class="n">trip_id</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
    <span class="n">trip_ids_referenced</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
        <span class="n">feed</span><span class="o">.</span><span class="n">stop_times</span><span class="o">.</span><span class="n">trip_id</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="o">+</span> <span class="n">feed</span><span class="o">.</span><span class="n">frequencies</span><span class="o">.</span><span class="n">trip_id</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="p">)</span>

    <span class="n">missing_trips</span> <span class="o">=</span> <span class="n">trip_ids_referenced</span> <span class="o">-</span> <span class="n">trip_ids_tripstxt</span>

    <span class="k">if</span> <span class="n">missing_trips</span><span class="p">:</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s2">&quot;The following trip_ids are referenced but missing from trips.txt: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="nb">list</span><span class="p">(</span><span class="n">missing_trips</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.transitnetwork.TransitNetwork.validate_feed" class="doc doc-heading">
<code class="highlight language-python"><span class="n">validate_feed</span><span class="p">(</span><span class="n">feed</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#network_wrangler.transitnetwork.TransitNetwork.validate_feed" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Since Partridge lazily loads the df, load each file to make sure it
actually works.</p>
<p>Partridge uses a DiGraph from the networkx library to represent the
relationships between GTFS files. Each file is a &lsquo;node&rsquo;, and the
relationship between files are &lsquo;edges&rsquo;.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>feed</code></td>
          <td>
                <code><span title="network_wrangler.transitnetwork.DotDict">DotDict</span></code>
          </td>
          <td><p>partridge feed</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>config</code></td>
          <td>
                <code><span title="networkx">nx</span>.<span title="networkx.DiGraph">DiGraph</span></code>
          </td>
          <td><p>partridge config</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/transitnetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">validate_feed</span><span class="p">(</span><span class="n">feed</span><span class="p">:</span> <span class="n">DotDict</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Since Partridge lazily loads the df, load each file to make sure it</span>
<span class="sd">    actually works.</span>

<span class="sd">    Partridge uses a DiGraph from the networkx library to represent the</span>
<span class="sd">    relationships between GTFS files. Each file is a &#39;node&#39;, and the</span>
<span class="sd">    relationship between files are &#39;edges&#39;.</span>

<span class="sd">    Args:</span>
<span class="sd">        feed: partridge feed</span>
<span class="sd">        config: partridge config</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">updated_config</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
    <span class="n">files_not_found</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

        <span class="n">n</span> <span class="o">=</span> <span class="n">feed</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;...</span><span class="si">{}</span><span class="s2">:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">n</span><span class="p">[:</span><span class="mi">10</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Removing </span><span class="si">{}</span><span class="s2"> from transit network config because file not found&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">node</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">updated_config</span><span class="o">.</span><span class="n">remove_node</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">TransitNetwork</span><span class="o">.</span><span class="n">REQUIRED_FILES</span><span class="p">:</span>
                <span class="n">files_not_found</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">files_not_found</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Required files not found or valid: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">files_not_found</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="n">TransitNetwork</span><span class="o">.</span><span class="n">validate_network_keys</span><span class="p">(</span><span class="n">feed</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">updated_config</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.transitnetwork.TransitNetwork.validate_frequencies" class="doc doc-heading">
<code class="highlight language-python"><span class="n">validate_frequencies</span><span class="p">()</span></code>

<a href="#network_wrangler.transitnetwork.TransitNetwork.validate_frequencies" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Validates that there are no transit trips in the feed with zero frequencies.</p>
<p>Changes state of self.validated_frequencies boolean based on outcome.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>bool</code>
          </td>
          <td><p>boolean indicating if valid or not.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/transitnetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">validate_frequencies</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validates that there are no transit trips in the feed with zero frequencies.</span>

<span class="sd">    Changes state of self.validated_frequencies boolean based on outcome.</span>

<span class="sd">    Returns:</span>
<span class="sd">        boolean indicating if valid or not.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_valid</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">zero_freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feed</span><span class="o">.</span><span class="n">frequencies</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">feed</span><span class="o">.</span><span class="n">frequencies</span><span class="o">.</span><span class="n">headway_secs</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">zero_freq</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">_valid</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Transit lines </span><span class="si">{}</span><span class="s2"> have non-positive frequencies&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">zero_freq</span><span class="o">.</span><span class="n">trip_id</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">validated_frequencies</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="n">_valid</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.transitnetwork.TransitNetwork.validate_network_keys" class="doc doc-heading">
<code class="highlight language-python"><span class="n">validate_network_keys</span><span class="p">(</span><span class="n">feed</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#network_wrangler.transitnetwork.TransitNetwork.validate_network_keys" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Validates foreign keys are present in all connecting feed files.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>feed</code></td>
          <td>
                <code><span title="network_wrangler.transitnetwork.DotDict">DotDict</span></code>
          </td>
          <td><p>partridge feed object</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>bool</code>
          </td>
          <td><p>Boolean indicating if feed is okay.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/transitnetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">validate_network_keys</span><span class="p">(</span><span class="n">feed</span><span class="p">:</span> <span class="n">DotDict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validates foreign keys are present in all connecting feed files.</span>

<span class="sd">    Args:</span>
<span class="sd">        feed: partridge feed object</span>

<span class="sd">    Returns:</span>
<span class="sd">        Boolean indicating if feed is okay.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="ow">and</span> <span class="n">TransitNetwork</span><span class="o">.</span><span class="n">route_ids_in_routestxt</span><span class="p">(</span><span class="n">feed</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="ow">and</span> <span class="n">TransitNetwork</span><span class="o">.</span><span class="n">trip_ids_in_tripstxt</span><span class="p">(</span><span class="n">feed</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="ow">and</span> <span class="n">TransitNetwork</span><span class="o">.</span><span class="n">shape_ids_in_shapestxt</span><span class="p">(</span><span class="n">feed</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="ow">and</span> <span class="n">TransitNetwork</span><span class="o">.</span><span class="n">stop_ids_in_stopstxt</span><span class="p">(</span><span class="n">feed</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.transitnetwork.TransitNetwork.validate_road_network_consistencies" class="doc doc-heading">
<code class="highlight language-python"><span class="n">validate_road_network_consistencies</span><span class="p">()</span></code>

<a href="#network_wrangler.transitnetwork.TransitNetwork.validate_road_network_consistencies" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Validates transit network against the road network for both stops
and shapes.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>bool</code>
          </td>
          <td><p>boolean indicating if valid or not.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/transitnetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">validate_road_network_consistencies</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validates transit network against the road network for both stops</span>
<span class="sd">    and shapes.</span>

<span class="sd">    Returns:</span>
<span class="sd">        boolean indicating if valid or not.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_net</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;RoadwayNetwork not set yet, see TransitNetwork.set_roadnet()&quot;</span>
        <span class="p">)</span>

    <span class="n">valid</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">valid_stops</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_transit_stops</span><span class="p">()</span>
    <span class="n">valid_shapes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_transit_shapes</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">validated_road_network_consistency</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_stops</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">valid_shapes</span><span class="p">:</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Transit network is not consistent with road network.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">valid</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.transitnetwork.TransitNetwork.validate_transit_shapes" class="doc doc-heading">
<code class="highlight language-python"><span class="n">validate_transit_shapes</span><span class="p">()</span></code>

<a href="#network_wrangler.transitnetwork.TransitNetwork.validate_transit_shapes" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Validates that all transit shapes are part of the roadway network.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>bool</code>
          </td>
          <td><p>Boolean indicating if valid or not.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/transitnetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">validate_transit_shapes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validates that all transit shapes are part of the roadway network.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Boolean indicating if valid or not.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_net</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;RoadwayNetwork not set yet, see TransitNetwork.set_roadnet()&quot;</span>
        <span class="p">)</span>

    <span class="n">shapes_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feed</span><span class="o">.</span><span class="n">shapes</span>
    <span class="n">nodes_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_net</span><span class="o">.</span><span class="n">nodes_df</span>
    <span class="n">links_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_net</span><span class="o">.</span><span class="n">links_df</span>

    <span class="n">valid</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># check if all the node ids exist in the network</span>
    <span class="n">shape_ids</span> <span class="o">=</span> <span class="p">[</span>
        <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">shapes_df</span><span class="p">[</span><span class="n">TransitNetwork</span><span class="o">.</span><span class="n">SHAPES_FOREIGN_KEY</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
    <span class="p">]</span>
    <span class="n">node_ids</span> <span class="o">=</span> <span class="p">[</span>
        <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nodes_df</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">NODE_FOREIGN_KEY_TO_LINK</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
    <span class="p">]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">shape_ids</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">node_ids</span><span class="p">):</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">missing_shapes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">shape_ids</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">node_ids</span><span class="p">))</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Not all transit shapes are part of the roadyway network. &quot;</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;Missing shapes (</span><span class="si">{}</span><span class="s2">) from the roadway network are </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">TransitNetwork</span><span class="o">.</span><span class="n">SHAPES_FOREIGN_KEY</span><span class="p">,</span> <span class="n">missing_shapes</span>
        <span class="p">)</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">valid</span>

    <span class="c1"># check if all the links in transit shapes exist in the network</span>
    <span class="c1"># and transit is allowed</span>
    <span class="n">shapes_df</span> <span class="o">=</span> <span class="n">shapes_df</span><span class="o">.</span><span class="n">astype</span><span class="p">({</span><span class="n">TransitNetwork</span><span class="o">.</span><span class="n">SHAPES_FOREIGN_KEY</span><span class="p">:</span> <span class="nb">int</span><span class="p">})</span>
    <span class="n">unique_shape_ids</span> <span class="o">=</span> <span class="n">shapes_df</span><span class="o">.</span><span class="n">shape_id</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">unique_shape_ids</span><span class="p">:</span>
        <span class="n">subset_shapes_df</span> <span class="o">=</span> <span class="n">shapes_df</span><span class="p">[</span><span class="n">shapes_df</span><span class="p">[</span><span class="s2">&quot;shape_id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="nb">id</span><span class="p">]</span>
        <span class="n">subset_shapes_df</span> <span class="o">=</span> <span class="n">subset_shapes_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;shape_pt_sequence&quot;</span><span class="p">])</span>
        <span class="n">subset_shapes_df</span> <span class="o">=</span> <span class="n">subset_shapes_df</span><span class="o">.</span><span class="n">add_suffix</span><span class="p">(</span><span class="s2">&quot;_1&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">subset_shapes_df</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">add_suffix</span><span class="p">(</span><span class="s2">&quot;_2&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">subset_shapes_df</span> <span class="o">=</span> <span class="n">subset_shapes_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

        <span class="n">merged_df</span> <span class="o">=</span> <span class="n">subset_shapes_df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
            <span class="n">links_df</span><span class="p">,</span>
            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
            <span class="n">left_on</span><span class="o">=</span><span class="p">[</span>
                <span class="n">TransitNetwork</span><span class="o">.</span><span class="n">SHAPES_FOREIGN_KEY</span> <span class="o">+</span> <span class="s2">&quot;_1&quot;</span><span class="p">,</span>
                <span class="n">TransitNetwork</span><span class="o">.</span><span class="n">SHAPES_FOREIGN_KEY</span> <span class="o">+</span> <span class="s2">&quot;_2&quot;</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="n">right_on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">],</span>
            <span class="n">indicator</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">missing_links_df</span> <span class="o">=</span> <span class="n">merged_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;_merge == &quot;left_only&quot;&#39;</span><span class="p">)</span>

        <span class="c1"># there are shape links which does not exist in the roadway network</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">missing_links_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;There are links for shape id </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2"> which are missing in the </span><span class="se">\</span>
<span class="s2">                roadway network.&quot;</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">transit_not_allowed_df</span> <span class="o">=</span> <span class="n">merged_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
            <span class="s1">&#39;_merge == &quot;both&quot; &amp; drive_access == 0 &amp; bus_only == 0 &amp; rail_only == 0&#39;</span>
        <span class="p">)</span>

        <span class="c1"># there are shape links where transit is not allowed</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">transit_not_allowed_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;There are links for shape id </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2"> which does not allow transit </span><span class="se">\</span>
<span class="s2">                in the roadway network.&quot;</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">valid</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.transitnetwork.TransitNetwork.validate_transit_stops" class="doc doc-heading">
<code class="highlight language-python"><span class="n">validate_transit_stops</span><span class="p">()</span></code>

<a href="#network_wrangler.transitnetwork.TransitNetwork.validate_transit_stops" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Validates that all transit stops are part of the roadway network.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>bool</code>
          </td>
          <td><p>Boolean indicating if valid or not.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/transitnetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">validate_transit_stops</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validates that all transit stops are part of the roadway network.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Boolean indicating if valid or not.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_net</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;RoadwayNetwork not set yet, see TransitNetwork.set_roadnet()&quot;</span>
        <span class="p">)</span>

    <span class="n">stops</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feed</span><span class="o">.</span><span class="n">stops</span>
    <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">road_net</span><span class="o">.</span><span class="n">nodes_df</span>

    <span class="n">valid</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">stop_ids</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">stops</span><span class="p">[</span><span class="n">TransitNetwork</span><span class="o">.</span><span class="n">STOPS_FOREIGN_KEY</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()]</span>
    <span class="n">node_ids</span> <span class="o">=</span> <span class="p">[</span>
        <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">[</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">NODE_FOREIGN_KEY_TO_LINK</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
    <span class="p">]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">stop_ids</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">node_ids</span><span class="p">):</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">missing_stops</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">stop_ids</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">node_ids</span><span class="p">))</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Not all transit stops are part of the roadyway network. &quot;</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;Missing stops (</span><span class="si">{}</span><span class="s2">) from the roadway nodes are </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">TransitNetwork</span><span class="o">.</span><span class="n">STOPS_FOREIGN_KEY</span><span class="p">,</span> <span class="n">missing_stops</span>
        <span class="p">)</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">valid</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.transitnetwork.TransitNetwork.write" class="doc doc-heading">
<code class="highlight language-python"><span class="n">write</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#network_wrangler.transitnetwork.TransitNetwork.write" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Writes a network in the transit network standard</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>path</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>the path were the output will be saved</p></td>
          <td>
                <code>&#39;.&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>filename</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>the name prefix of the transit files that will be generated</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/transitnetwork.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Writes a network in the transit network standard</span>

<span class="sd">    Args:</span>
<span class="sd">        path: the path were the output will be saved</span>
<span class="sd">        filename: the name prefix of the transit files that will be generated</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Writing transit to directory: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feed</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
                <span class="n">outpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">filename</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">node</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">outpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>
            <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Writing file: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">outpath</span><span class="p">))</span>

            <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">outpath</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div><h2 id="utils-and-functions">Utils and Functions<a class="headerlink" href="#utils-and-functions" title="Permanent link"> ¶</a></h2>


<div class="doc doc-object doc-module">



<h3 id="network_wrangler.utils" class="doc doc-heading">
          <code>network_wrangler.utils</code>


<a href="#network_wrangler.utils" class="headerlink" title="Permanent link"> ¶</a></h3>

  <div class="doc doc-contents first">

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h4 id="network_wrangler.utils.create_unique_shape_id" class="doc doc-heading">
<code class="highlight language-python"><span class="n">create_unique_shape_id</span><span class="p">(</span><span class="n">line_string</span><span class="p">)</span></code>

<a href="#network_wrangler.utils.create_unique_shape_id" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Creates a unique hash id using the coordinates of the geometry using first and last locations.</p>
      

      <details class="quote">
        <summary>Source code in <code>network_wrangler/utils/geo.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">create_unique_shape_id</span><span class="p">(</span><span class="n">line_string</span><span class="p">:</span> <span class="n">LineString</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a unique hash id using the coordinates of the geometry using first and last locations.</span>

<span class="sd">    Args:</span>
<span class="sd">    line_string: Line Geometry as a LineString</span>

<span class="sd">    Returns: string</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">line_string</span><span class="o">.</span><span class="n">coords</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># first coordinate (A node)</span>
    <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">line_string</span><span class="o">.</span><span class="n">coords</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># last coordinate (B node)</span>

    <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Geometry </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span>
    <span class="n">unhashed</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
    <span class="nb">hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">unhashed</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

    <span class="k">return</span> <span class="nb">hash</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.utils.haversine_distance" class="doc doc-heading">
<code class="highlight language-python"><span class="n">haversine_distance</span><span class="p">(</span><span class="n">origin</span><span class="p">,</span> <span class="n">destination</span><span class="p">)</span></code>

<a href="#network_wrangler.utils.haversine_distance" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Returns haversine distance between the coordinates of two points in lat/lon.</p>
      

      <details class="quote">
        <summary>Source code in <code>network_wrangler/utils/geo.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">haversine_distance</span><span class="p">(</span><span class="n">origin</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">destination</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns haversine distance between the coordinates of two points in lat/lon.</span>

<span class="sd">    Args:</span>
<span class="sd">    origin: lat/lon for point A</span>
<span class="sd">    destination: lat/lon for point B</span>

<span class="sd">    Returns: string</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">lon1</span><span class="p">,</span> <span class="n">lat1</span> <span class="o">=</span> <span class="n">origin</span>
    <span class="n">lon2</span><span class="p">,</span> <span class="n">lat2</span> <span class="o">=</span> <span class="n">destination</span>
    <span class="n">radius</span> <span class="o">=</span> <span class="mi">6378137</span>  <span class="c1"># meter</span>

    <span class="n">dlat</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">lat2</span> <span class="o">-</span> <span class="n">lat1</span><span class="p">)</span>
    <span class="n">dlon</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">lon2</span> <span class="o">-</span> <span class="n">lon1</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">dlat</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">dlat</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span>
        <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">lat1</span><span class="p">)</span>
    <span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">lat2</span><span class="p">))</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">dlon</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">dlon</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">a</span><span class="p">))</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">c</span>  <span class="c1"># meters</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">d</span> <span class="o">*</span> <span class="mf">0.000621371</span>  <span class="c1"># miles</span>

    <span class="k">return</span> <span class="n">d</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.utils.line_string_from_location_references" class="doc doc-heading">
<code class="highlight language-python"><span class="n">line_string_from_location_references</span><span class="p">(</span><span class="n">location_references</span><span class="p">)</span></code>

<a href="#network_wrangler.utils.line_string_from_location_references" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Creates a geometry as a LineString using a list of location references.</p>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/utils/geo.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">line_string_from_location_references</span><span class="p">(</span><span class="n">location_references</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a geometry as a LineString using a list of location references.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># WranglerLogger.debug(</span>
    <span class="c1">#    f&quot;line_string_from_location_references.location_references: {[lr[&#39;point&#39;] for lr in location_references]}.&quot;</span>
    <span class="c1">#    )</span>
    <span class="k">return</span> <span class="n">LineString</span><span class="p">([</span><span class="n">lr</span><span class="p">[</span><span class="s2">&quot;point&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">lr</span> <span class="ow">in</span> <span class="n">location_references</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.utils.links_df_to_json" class="doc doc-heading">
<code class="highlight language-python"><span class="n">links_df_to_json</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">properties</span><span class="p">)</span></code>

<a href="#network_wrangler.utils.links_df_to_json" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Export pandas dataframe as a json object.</p>
<p>Modified from: Geoff Boeing:
https://geoffboeing.com/2015/10/exporting-python-data-geojson/</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>df</code></td>
          <td>
                <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td><p>Dataframe to export</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>properties</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>list of properties to export</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/utils/utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">links_df_to_json</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">properties</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Export pandas dataframe as a json object.</span>

<span class="sd">    Modified from: Geoff Boeing:</span>
<span class="sd">    https://geoffboeing.com/2015/10/exporting-python-data-geojson/</span>

<span class="sd">    Args:</span>
<span class="sd">        df: Dataframe to export</span>
<span class="sd">        properties: list of properties to export</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># can&#39;t remember why we need this?</span>
    <span class="k">if</span> <span class="s2">&quot;distance&quot;</span> <span class="ow">in</span> <span class="n">properties</span><span class="p">:</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;distance&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">json</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">feature</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">properties</span><span class="p">:</span>
            <span class="n">feature</span><span class="p">[</span><span class="n">prop</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">prop</span><span class="p">]</span>
        <span class="n">json</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">json</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.utils.location_reference_from_nodes" class="doc doc-heading">
<code class="highlight language-python"><span class="n">location_reference_from_nodes</span><span class="p">(</span><span class="n">node_list</span><span class="p">)</span></code>

<a href="#network_wrangler.utils.location_reference_from_nodes" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Creates a location references using a list of nodes coordinates</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>node_list</code></td>
          <td>
                <code><span title="typing.Collection">Collection</span>[<span title="pandas">pd</span>.<span title="pandas.Series">Series</span>]</code>
          </td>
          <td><p>List of nodes represented as series or dicts with &ldquo;X&rdquo; and &ldquo;Y&rdquo; values.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/utils/geo.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">location_reference_from_nodes</span><span class="p">(</span><span class="n">node_list</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a location references using a list of nodes coordinates</span>

<span class="sd">    Args:</span>
<span class="sd">        node_list: List of nodes represented as series or dicts with &quot;X&quot; and &quot;Y&quot; values.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">out_location_references</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span><span class="s2">&quot;sequence&quot;</span><span class="p">:</span> <span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;point&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">n</span><span class="p">[</span><span class="s2">&quot;X&quot;</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="s2">&quot;Y&quot;</span><span class="p">]]}</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">node_list</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="c1"># WranglerLogger.debug(f&quot;out_location_references: {out_location_references}&quot;)</span>

    <span class="k">return</span> <span class="n">out_location_references</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.utils.make_slug" class="doc doc-heading">
<code class="highlight language-python"><span class="n">make_slug</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;_&#39;</span><span class="p">)</span></code>

<a href="#network_wrangler.utils.make_slug" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>makes a slug from text</p>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/utils/utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">make_slug</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">delimiter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    makes a slug from text</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">re</span>

    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;[,.;@#?!&amp;$&#39;]+&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;[\ ]+&quot;</span><span class="p">,</span> <span class="n">delimiter</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.utils.offset_location_reference" class="doc doc-heading">
<code class="highlight language-python"><span class="n">offset_location_reference</span><span class="p">(</span><span class="n">location_reference</span><span class="p">,</span> <span class="n">offset_meters</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span></code>

<a href="#network_wrangler.utils.offset_location_reference" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Creates a new location reference line
using the first and last nodes of given polyline location reference,
offseting it by 90 degree to the bearing of given location reference
and distance equals to offset_meters</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>location_reference</code></td>
          <td>
          </td>
          <td><p>existing location reference</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>offset_meters</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>(Optional) meters to offset the existing</p></td>
          <td>
                <code>10</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/utils/geo.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">offset_location_reference</span><span class="p">(</span><span class="n">location_reference</span><span class="p">,</span> <span class="n">offset_meters</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">10</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a new location reference line</span>
<span class="sd">    using the first and last nodes of given polyline location reference,</span>
<span class="sd">    offseting it by 90 degree to the bearing of given location reference</span>
<span class="sd">    and distance equals to offset_meters</span>

<span class="sd">    args:</span>
<span class="sd">        location_reference: existing location reference</span>
<span class="sd">        offset_meters: (Optional) meters to offset the existing</span>

<span class="sd">    returns: new location_reference with offset</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lon_1</span> <span class="o">=</span> <span class="n">location_reference</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;point&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">lat_1</span> <span class="o">=</span> <span class="n">location_reference</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;point&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">lon_2</span> <span class="o">=</span> <span class="n">location_reference</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;point&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">lat_2</span> <span class="o">=</span> <span class="n">location_reference</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;point&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">bearing</span> <span class="o">=</span> <span class="n">get_bearing</span><span class="p">(</span><span class="n">lat_1</span><span class="p">,</span> <span class="n">lon_1</span><span class="p">,</span> <span class="n">lat_2</span><span class="p">,</span> <span class="n">lon_2</span><span class="p">)</span>
    <span class="c1"># adding 90 degrees (1.57 radians) to the current bearing</span>
    <span class="n">bearing</span> <span class="o">=</span> <span class="n">bearing</span> <span class="o">+</span> <span class="mf">1.57</span>

    <span class="n">out_location_reference</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;sequence&quot;</span><span class="p">:</span> <span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;point&quot;</span><span class="p">:</span> <span class="n">offset_point_with_distance_and_bearing</span><span class="p">(</span>
                <span class="n">lr</span><span class="p">[</span><span class="s2">&quot;point&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">lr</span><span class="p">[</span><span class="s2">&quot;point&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">offset_meters</span><span class="p">,</span> <span class="n">bearing</span>
            <span class="p">),</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">lr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">location_reference</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="k">return</span> <span class="n">out_location_reference</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.utils.parse_time_spans_to_secs" class="doc doc-heading">
<code class="highlight language-python"><span class="n">parse_time_spans_to_secs</span><span class="p">(</span><span class="n">times</span><span class="p">)</span></code>

<a href="#network_wrangler.utils.parse_time_spans_to_secs" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>parse time spans into tuples of seconds from midnight
can also be used as an apply function for a pandas series
Parameters</p>
<hr />
<p>times: tuple(string) or tuple(int) or list(string) or list(int)</p>
<h6 id="network_wrangler.utils.parse_time_spans_to_secs--returns">returns<a class="headerlink" href="#network_wrangler.utils.parse_time_spans_to_secs--returns" title="Permanent link"> ¶</a></h6>
<p>tuple(integer)
  time span as seconds from midnight</p>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/utils/utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">parse_time_spans_to_secs</span><span class="p">(</span><span class="n">times</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    parse time spans into tuples of seconds from midnight</span>
<span class="sd">    can also be used as an apply function for a pandas series</span>
<span class="sd">    Parameters</span>
<span class="sd">    -----------</span>
<span class="sd">    times: tuple(string) or tuple(int) or list(string) or list(int)</span>

<span class="sd">    returns</span>
<span class="sd">    --------</span>
<span class="sd">    tuple(integer)</span>
<span class="sd">      time span as seconds from midnight</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span> <span class="o">=</span> <span class="n">times</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;ERROR: times should be a tuple or list of two, got: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">times</span><span class="p">)</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="c1"># If times are strings, convert to int in seconds, else return as ints</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start_time</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">end_time</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">start_time</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">end_time</span> <span class="o">=</span> <span class="n">end_time</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="c1"># If time is given without seconds, add 00</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">start_time</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">start_time</span> <span class="o">+=</span> <span class="s2">&quot;:00&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">end_time</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">end_time</span> <span class="o">+=</span> <span class="s2">&quot;:00&quot;</span>

        <span class="c1"># Convert times to seconds from midnight (Partride&#39;s time storage)</span>
        <span class="n">h0</span><span class="p">,</span> <span class="n">m0</span><span class="p">,</span> <span class="n">s0</span> <span class="o">=</span> <span class="n">start_time</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
        <span class="n">start_time_sec</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">h0</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3600</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">m0</span><span class="p">)</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">s0</span><span class="p">)</span>

        <span class="n">h1</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">s1</span> <span class="o">=</span> <span class="n">end_time</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
        <span class="n">end_time_sec</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">h1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3600</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">m1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">s1</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">start_time_sec</span><span class="p">,</span> <span class="n">end_time_sec</span><span class="p">)</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start_time</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">end_time</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">times</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;ERROR: times should be ints or strings&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">()</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">start_time_sec</span><span class="p">,</span> <span class="n">end_time_sec</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.utils.point_df_to_geojson" class="doc doc-heading">
<code class="highlight language-python"><span class="n">point_df_to_geojson</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">properties</span><span class="p">)</span></code>

<a href="#network_wrangler.utils.point_df_to_geojson" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      

      <details class="quote">
        <summary>Source code in <code>network_wrangler/utils/utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">point_df_to_geojson</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">properties</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Author: Geoff Boeing:</span>
<span class="sd">    https://geoffboeing.com/2015/10/exporting-python-data-geojson/</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">..roadwaynetwork</span> <span class="kn">import</span> <span class="n">RoadwayNetwork</span>

    <span class="n">geojson</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;FeatureCollection&quot;</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="p">[]}</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">feature</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;Feature&quot;</span><span class="p">,</span>
            <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{},</span>
            <span class="s2">&quot;geometry&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;Point&quot;</span><span class="p">,</span> <span class="s2">&quot;coordinates&quot;</span><span class="p">:</span> <span class="p">[]},</span>
        <span class="p">}</span>
        <span class="n">feature</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">][</span><span class="s2">&quot;coordinates&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">y</span><span class="p">]</span>
        <span class="n">feature</span><span class="p">[</span><span class="s2">&quot;properties&quot;</span><span class="p">][</span><span class="n">RoadwayNetwork</span><span class="o">.</span><span class="n">NODE_FOREIGN_KEY_TO_LINK</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">name</span>
        <span class="k">for</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">properties</span><span class="p">:</span>
            <span class="n">feature</span><span class="p">[</span><span class="s2">&quot;properties&quot;</span><span class="p">][</span><span class="n">prop</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">prop</span><span class="p">]</span>
        <span class="n">geojson</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">geojson</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.utils.point_from_xy" class="doc doc-heading">
<code class="highlight language-python"><span class="n">point_from_xy</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">xy_crs</span><span class="o">=</span><span class="mi">4326</span><span class="p">,</span> <span class="n">point_crs</span><span class="o">=</span><span class="mi">4326</span><span class="p">)</span></code>

<a href="#network_wrangler.utils.point_from_xy" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Creates a point geometry from x and y coordinates.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>x</code></td>
          <td>
          </td>
          <td><p>x coordinate, in xy_crs</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>y</code></td>
          <td>
          </td>
          <td><p>y coordinate, in xy_crs</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>xy_crs</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>coordinate reference system in ESPG code for x/y inputs. Defaults to 4326 (WGS84)</p></td>
          <td>
                <code>4326</code>
          </td>
        </tr>
        <tr>
          <td><code>point_crs</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>coordinate reference system in ESPG code for point output. Defaults to 4326 (WGS84)</p></td>
          <td>
                <code>4326</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/utils/geo.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">point_from_xy</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">xy_crs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4326</span><span class="p">,</span> <span class="n">point_crs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4326</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a point geometry from x and y coordinates.</span>

<span class="sd">    Args:</span>
<span class="sd">        x: x coordinate, in xy_crs</span>
<span class="sd">        y: y coordinate, in xy_crs</span>
<span class="sd">        xy_crs: coordinate reference system in ESPG code for x/y inputs. Defaults to 4326 (WGS84)</span>
<span class="sd">        point_crs: coordinate reference system in ESPG code for point output. Defaults to 4326 (WGS84)</span>

<span class="sd">    Returns: Shapely Point in point_crs</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">point</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">xy_crs</span> <span class="o">==</span> <span class="n">point_crs</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">point</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">xy_crs</span><span class="p">,</span> <span class="n">point_crs</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">transformers</span><span class="p">:</span>
        <span class="c1"># store transformers in dictionary because they are an &quot;expensive&quot; operation</span>
        <span class="n">transformers</span><span class="p">[(</span><span class="n">xy_crs</span><span class="p">,</span> <span class="n">point_crs</span><span class="p">)]</span> <span class="o">=</span> <span class="n">Transformer</span><span class="o">.</span><span class="n">from_proj</span><span class="p">(</span>
            <span class="n">Proj</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="s2">&quot;epsg:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">xy_crs</span><span class="p">)),</span>
            <span class="n">Proj</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="s2">&quot;epsg:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">point_crs</span><span class="p">)),</span>
            <span class="n">always_xy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># required b/c Proj v6+ uses lon/lat instead of x/y</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">transform</span><span class="p">(</span><span class="n">transformers</span><span class="p">[(</span><span class="n">xy_crs</span><span class="p">,</span> <span class="n">point_crs</span><span class="p">)]</span><span class="o">.</span><span class="n">transform</span><span class="p">,</span> <span class="n">point</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.utils.topological_sort" class="doc doc-heading">
<code class="highlight language-python"><span class="n">topological_sort</span><span class="p">(</span><span class="n">adjacency_list</span><span class="p">,</span> <span class="n">visited_list</span><span class="p">)</span></code>

<a href="#network_wrangler.utils.topological_sort" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Topological sorting for Acyclic Directed Graph</p>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/utils/utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">topological_sort</span><span class="p">(</span><span class="n">adjacency_list</span><span class="p">,</span> <span class="n">visited_list</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Topological sorting for Acyclic Directed Graph</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">output_stack</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_topology_sort_util</span><span class="p">(</span><span class="n">vertex</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">visited_list</span><span class="p">[</span><span class="n">vertex</span><span class="p">]:</span>
            <span class="n">visited_list</span><span class="p">[</span><span class="n">vertex</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">for</span> <span class="n">neighbor</span> <span class="ow">in</span> <span class="n">adjacency_list</span><span class="p">[</span><span class="n">vertex</span><span class="p">]:</span>
                <span class="n">_topology_sort_util</span><span class="p">(</span><span class="n">neighbor</span><span class="p">)</span>
            <span class="n">output_stack</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">vertex</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">vertex</span> <span class="ow">in</span> <span class="n">visited_list</span><span class="p">:</span>
        <span class="n">_topology_sort_util</span><span class="p">(</span><span class="n">vertex</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">output_stack</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="network_wrangler.utils.update_points_in_linestring" class="doc doc-heading">
<code class="highlight language-python"><span class="n">update_points_in_linestring</span><span class="p">(</span><span class="n">linestring</span><span class="p">,</span> <span class="n">updated_coords</span><span class="p">,</span> <span class="n">position</span><span class="p">)</span></code>

<a href="#network_wrangler.utils.update_points_in_linestring" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Replaces</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>linestring</code></td>
          <td>
                <code><span title="shapely.geometry.LineString">LineString</span></code>
          </td>
          <td><p><em>description</em></p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>point_coords</code></td>
          <td>
                <code><span title="typing.List">List</span>[float]</code>
          </td>
          <td><p><em>description</em></p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>position</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p><em>description</em></p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/utils/geo.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">update_points_in_linestring</span><span class="p">(</span>
    <span class="n">linestring</span><span class="p">:</span> <span class="n">LineString</span><span class="p">,</span> <span class="n">updated_coords</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">position</span><span class="p">:</span> <span class="nb">int</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Replaces</span>

<span class="sd">    Args:</span>
<span class="sd">        linestring (LineString): _description_</span>
<span class="sd">        point_coords (List[float]): _description_</span>
<span class="sd">        position (int): _description_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">coords</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">linestring</span><span class="o">.</span><span class="n">coords</span><span class="p">]</span>
    <span class="n">coords</span><span class="p">[</span><span class="n">position</span><span class="p">]</span> <span class="o">=</span> <span class="n">updated_coords</span>
    <span class="k">return</span> <span class="n">LineString</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="network_wrangler.logger" class="doc doc-heading">
          <code>network_wrangler.logger</code>


<a href="#network_wrangler.logger" class="headerlink" title="Permanent link"> ¶</a></h3>

  <div class="doc doc-contents first">

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h4 id="network_wrangler.logger.setup_logging" class="doc doc-heading">
<code class="highlight language-python"><span class="n">setup_logging</span><span class="p">(</span><span class="n">info_log_filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">debug_log_filename</span><span class="o">=</span><span class="s1">&#39;wrangler_</span><span class="si">{}</span><span class="s1">.debug.log&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y_%m_</span><span class="si">%d</span><span class="s1">__%H_%M_%S&#39;</span><span class="p">)),</span> <span class="n">log_to_console</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#network_wrangler.logger.setup_logging" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Sets up the WranglerLogger w.r.t. the debug file location and if logging to console.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>info_log_filename</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>the location of the log file that will get created to add the INFO log.
The INFO Log is terse, just gives the bare minimum of details.
Defaults to file in cwd() <code>wrangler_[datetime].log</code>. To turn off logging to a file,
use log_filename = None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>debug_log_filename</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>the location of the log file that will get created to add the DEBUG log.
The DEBUG log is very noisy, for debugging. Defaults to file in cwd()
<code>wrangler_[datetime].log</code>. To turn off logging to a file, use log_filename = None.</p></td>
          <td>
                <code>&#39;wrangler_{}.debug.log&#39;.format(datetime.now().strftime(&#39;%Y_%m_%d__%H_%M_%S&#39;))</code>
          </td>
        </tr>
        <tr>
          <td><code>log_to_console</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>if True, logging will go to the console at DEBUG level. Defaults to False.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>network_wrangler/logger.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">setup_logging</span><span class="p">(</span>
    <span class="n">info_log_filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">debug_log_filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;wrangler_</span><span class="si">{}</span><span class="s2">.debug.log&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y_%m_</span><span class="si">%d</span><span class="s2">__%H_%M_%S&quot;</span><span class="p">)</span>
    <span class="p">),</span>
    <span class="n">log_to_console</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sets up the WranglerLogger w.r.t. the debug file location and if logging to console.</span>

<span class="sd">    args:</span>
<span class="sd">        info_log_filename: the location of the log file that will get created to add the INFO log.</span>
<span class="sd">            The INFO Log is terse, just gives the bare minimum of details.</span>
<span class="sd">            Defaults to file in cwd() `wrangler_[datetime].log`. To turn off logging to a file,</span>
<span class="sd">            use log_filename = None.</span>
<span class="sd">        debug_log_filename: the location of the log file that will get created to add the DEBUG log.</span>
<span class="sd">            The DEBUG log is very noisy, for debugging. Defaults to file in cwd()</span>
<span class="sd">            `wrangler_[datetime].log`. To turn off logging to a file, use log_filename = None.</span>
<span class="sd">        log_to_console: if True, logging will go to the console at DEBUG level. Defaults to False.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># add function variable so that we know if logging has been called</span>
    <span class="n">setup_logging</span><span class="o">.</span><span class="n">called</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Clear handles if any exist already</span>
    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">handlers</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

    <span class="n">FORMAT</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span>
        <span class="s2">&quot;</span><span class="si">%(asctime)-15s</span><span class="s2"> </span><span class="si">%(levelname)s</span><span class="s2">: </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">datefmt</span><span class="o">=</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S,&quot;</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">info_log_filename</span><span class="p">:</span>
        <span class="n">info_log_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span>
            <span class="s2">&quot;network_wrangler_</span><span class="si">{}</span><span class="s2">.info.log&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y_%m_</span><span class="si">%d</span><span class="s2">__%H_%M_%S&quot;</span><span class="p">)</span>
            <span class="p">),</span>
        <span class="p">)</span>

    <span class="n">info_file_handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">info_log_filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">))</span>
    <span class="n">info_file_handler</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
    <span class="n">info_file_handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">FORMAT</span><span class="p">)</span>
    <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">info_file_handler</span><span class="p">)</span>

    <span class="c1"># create debug file only when debug_log_filename is provided</span>
    <span class="k">if</span> <span class="n">debug_log_filename</span><span class="p">:</span>
        <span class="n">debug_log_handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">debug_log_filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">))</span>
        <span class="n">debug_log_handler</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
        <span class="n">debug_log_handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">FORMAT</span><span class="p">)</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">debug_log_handler</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">log_to_console</span><span class="p">:</span>
        <span class="n">console_handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
        <span class="n">console_handler</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
        <span class="n">console_handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">FORMAT</span><span class="p">)</span>
        <span class="n">WranglerLogger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">console_handler</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div><h2 id="schemas">Schemas<a class="headerlink" href="#schemas" title="Permanent link"> ¶</a></h2>



  



                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "content.code.annotate", "content.tabs.link", "navigation.indexes"], "search": "../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "latest", "provider": "mike"}}</script>
    
    
      <script src="../assets/javascripts/bundle.51198bba.min.js"></script>
      
        <script src="https://unpkg.com/mermaid@8.5.0/dist/mermaid.min.js"></script>
      
    
  </body>
</html>